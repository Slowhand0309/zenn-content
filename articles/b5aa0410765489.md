---
title: "ã€Flutterã€‘codemagic.yamlã§Firebase App Distributionã«ãƒ™ãƒ¼ã‚¿é…å¸ƒã™ã‚‹ (Androidç‰ˆ)"
emoji: "ğŸ› ï¸"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics:
  - "flutter"
  - "codemagic"
  - "CI"
  - "android"
published: true
---

# [Codemagic](https://codemagic.io/start/)

ä»Šå›ã¯æ—¢å­˜ã®Flutterã‚¢ãƒ—ãƒªã®Androidã®ã¿ã‚’Codemagicã®ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã¯ä½¿ã‚ãšã€`codemagic.yaml` ã‚’ä½¿ç”¨ã—ã¦[Firebase App Distribution](https://firebase.google.com/docs/app-distribution)ã¸ãƒ™ãƒ¼ã‚¿é…å¸ƒã™ã‚‹ã¾ã§ã‚’ã‚„ã£ã¦ã¿ãŸã„ã¨æ€ã„ã¾ã™ã€‚
æ—¢ã«Flutterã‚¢ãƒ—ãƒªãŒç‰¹å®šã®Githubã®ãƒªãƒã‚¸ãƒˆãƒªã«ä½œæˆã•ã‚Œã¦ã„ã‚‹å‰æã«ãªã‚Šã¾ã™ã€‚

## Sign up

ã¾ãšã¯Codemagicã« `Github ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ` ã§Sign upã—ã¾ã™ã€‚

![image1](/images/b5aa0410765489/image1.png =500x)

ã€ŒGithubã€ã‚’é¸æŠã—ã¾ã™ã€‚

![image2](/images/b5aa0410765489/image2.png =500x)

æ¬¡ã«è¡¨ç¤ºã•ã‚ŒãŸå†…å®¹ã«å•é¡Œãªã‘ã‚Œã°ã€ŒAuthorize Codemagic CI/CDã€ã‚’é¸æŠã—ã¾ã™ã€‚

![image3](/images/b5aa0410765489/image3.png =300x)

ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ãŒè¡¨ç¤ºã•ã‚Œã‚Œã°æˆåŠŸã§ã™ âœ¨

![image4](/images/b5aa0410765489/image4.png =500x)

## ãƒªãƒã‚¸ãƒˆãƒªã‚’é€£æº

ã€ŒAdd your first appã€ã‹ã‚‰å¯¾è±¡ã®ãƒªãƒã‚¸ãƒˆãƒªã‚’è¿½åŠ ã—ã¾ã™ã€‚
ã€ŒConnect reporitoryã€ã§ã¯ã€ŒGithubã€ã‚’é¸æŠã—ã¾ã™ã€‚

![image5](/images/b5aa0410765489/image5.png =500x)

æ¬¡ã«å¯¾è±¡ã®ãƒªãƒã‚¸ãƒˆãƒªã‚’é¸æŠã—ã€ã€ŒSelect project typeã€ã¯ã€ŒFlutter Appã€ã‚’é¸æŠã—ã¾ã™ã€‚

![image6](/images/b5aa0410765489/image6.png =500x)

ä»Šå›ã¯ `codemagic.yaml` ã§ç®¡ç†ã—ãŸã„ã®ã§ã€ã€ŒSwitch to YAML configurationã€ã‚’é¸æŠã—ã¾ã™ã€‚

![image7](/images/b5aa0410765489/image7.png =500x)

å¿…è¦ã‚ã‚Œã°ã€ŒExport current ...ã€ã«ã‚‚ãƒã‚§ãƒƒã‚¯ã‚’å…¥ã‚Œã¦ã€ŒSave changesã€ã‚’é¸æŠã™ã‚‹ã¨ã€`codemagic.yaml` ãŒãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã•ã‚Œã¾ã™ã€‚

![image8](/images/b5aa0410765489/image8.png =500x)

ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®Workflowã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã•ã‚ŒãŸ `codemagic.yaml` ã®ä¸­èº«ã¯ã“ã¡ã‚‰â†“

```yaml
# Automatically generated on 2022-11-24 UTC from https://codemagic.io/app/637f727a8d8ede4cc95b6595/settings
# Note that this configuration is not an exact match to UI settings. Review and adjust as necessary.

workflows:
  default-workflow:
    name: Default Workflow
    max_build_duration: 60
    environment:
      flutter: default
      xcode: latest
      cocoapods: default
    scripts:
      - |
        # set up debug keystore
        rm -f ~/.android/debug.keystore
        keytool -genkeypair \
          -alias androiddebugkey \
          -keypass android \
          -keystore ~/.android/debug.keystore \
          -storepass android \
          -dname 'CN=Android Debug,O=Android,C=US' \
          -keyalg 'RSA' \
          -keysize 2048 \
          -validity 10000
      - |
        # set up local properties
        echo "flutter.sdk=$HOME/programs/flutter" > "$FCI_BUILD_DIR/android/local.properties"
      - flutter packages pub get
      - flutter build apk --debug
      - find . -name "Podfile" -execdir pod install \;
      - flutter build ios --debug --no-codesign
    artifacts:
      - build/**/outputs/apk/**/*.apk
      - build/**/outputs/bundle/**/*.aab
      - build/**/outputs/**/mapping.txt
      - build/ios/ipa/*.ipa
      - /tmp/xcodebuild_logs/*.log
      - build/windows/**/*.msix
      - flutter_drive.log
    publishing:
      email:
        recipients:
          - xxxxxxxxx@gmail.com
```

â†‘ã‚’ä¸€æ—¦Androidãƒ“ãƒ«ãƒ‰ã™ã‚‹ã ã‘ã®â†“ã«å¤‰æ›´ã—ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ«ãƒ¼ãƒˆã«ãƒ•ã‚¡ã‚¤ãƒ«ã‚’è¿½åŠ ã€ã‚³ãƒŸãƒƒãƒˆ&ãƒ—ãƒƒã‚·ãƒ¥ã—ã¾ã™ã€‚

```yaml
workflows:
  build-android-workflow:
    name: Build Android Workflow
    labels:
      - Android
    max_build_duration: 60
    instance_type: mac_mini_m1
    environment:
      flutter: v3.3.8
    scripts:
      - |
        # set up debug keystore
        rm -f ~/.android/debug.keystore
        keytool -genkeypair \
          -alias androiddebugkey \
          -keypass android \
          -keystore ~/.android/debug.keystore \
          -storepass android \
          -dname 'CN=Android Debug,O=Android,C=US' \
          -keyalg 'RSA' \
          -keysize 2048 \
          -validity 10000
      - |
        # set up local properties
        echo "flutter.sdk=$HOME/programs/flutter" > "$FCI_BUILD_DIR/android/local.properties"
      - flutter packages pub get
      - flutter build apk --debug
    artifacts:
      - build/**/outputs/apk/**/*.apk
      - build/**/outputs/bundle/**/*.aab
      - build/**/outputs/**/mapping.txt
      - flutter_drive.log
    publishing:
      email:
        recipients:
          - xxxxxx@gmail.com
```

ã€ŒAppã€ä¸€è¦§ã®å¯¾è±¡ãƒªãƒã‚¸ãƒˆãƒªã®è¨­å®šç”»é¢ã¸é€²ã¿ã€`codemagic.yaml` ãŒåæ˜ ã•ã‚Œã¦ã„ã‚‹äº‹ã‚’ç¢ºèªã—ã¦ã€ã€ŒStart ew buildã€ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚

![image9](/images/b5aa0410765489/image9.png =500x)

ãƒ“ãƒ«ãƒ‰ã«æˆåŠŸã™ã‚‹ã¨â†“ã®æ§˜ã«ãªã‚Šã¾ã™ã€‚
![image10](/images/b5aa0410765489/image10.png =500x)

è¨­å®šã—ã¦ãŠã„ãŸãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹å®›ã«ã¯â†“ã®æ§˜ãªãƒ¡ãƒ¼ãƒ«ãŒå±Šãã¾ã—ãŸã€‚
![image11](/images/b5aa0410765489/image11.png =500x)

## ç‰¹å®šã®ãƒ–ãƒ©ãƒ³ãƒã«pushã•ã‚ŒãŸã‚‰è‡ªå‹•ã§ãƒ“ãƒ«ãƒ‰ãŒèµ°ã‚‹æ§˜ã«ã™ã‚‹

```yaml
    triggering:
      events:
        - push
      branch_patterns:
        - pattern: "develop"
          include: true
          source: true
```

ç‰¹å®šã®workflowã«â†‘ã‚’è¿½åŠ ã—ã¾ã™ã€‚

## Environment variables

### [Build-inã•ã‚Œã¦ã„ã‚‹ç’°å¢ƒå¤‰æ•°](https://docs.codemagic.io/yaml-basic-configuration/environment-variables/)

Build-inã•ã‚Œã¦ã„ã‚‹ç’°å¢ƒå¤‰æ•°ã¨ã—ã¦ã¯ä»¥ä¸‹ãŒç”¨æ„ã•ã‚Œã¦ã„ã¾ã™ã€‚

|ç’°å¢ƒå¤‰æ•°|å€¤|
|-----|-----|
|ANDROID_SDK_ROOT|Android SDKã®çµ¶å¯¾ãƒ‘ã‚¹|
| CI | true |
| CONTINUOUS_INTEGRATION | true |
| BUILD_NUMBER | æŒ‡å®šã—ãŸWorkflowã§ãƒ“ãƒ«ãƒ‰ã•ã‚ŒãŸæ™‚ã®Build Number |
| PROJECT_BUILD_NUMBER | å¯¾è±¡ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®Build Number |
| FLUTTER_ROOT | Flutter SDKã®çµ¶å¯¾ãƒ‘ã‚¹ |
| CM_BRANCH | ç¾åœ¨ãƒ“ãƒ«ãƒ‰ã—ã¦ã„ã‚‹ãƒ–ãƒ©ãƒ³ãƒ |
| CM_TAG | ãƒ“ãƒ«ãƒ‰ãƒˆãƒªã‚¬ãƒ¼ã¨ãªã£ãŸã‚¿ã‚°(ãƒˆãƒªã‚¬ãƒ¼ãŒã‚¿ã‚°ã§ãªã„å ´åˆã¯è¨­å®šã•ã‚Œãªã„) |
| CM_REPO_SLUG | owner_name/repository_name å½¢å¼ã®slug |
| CM_COMMIT | ç¾åœ¨ãƒ“ãƒ«ãƒ‰ã—ã¦ã„ã‚‹ã‚³ãƒŸãƒƒãƒˆã®ãƒãƒƒã‚·ãƒ¥å€¤ |
| CM_PREVIOUS_COMMIT | å‰å›ãƒ“ãƒ«ãƒ‰ã«æˆåŠŸã—ãŸã‚³ãƒŸãƒƒãƒˆã®ãƒãƒƒã‚·ãƒ¥å€¤ (åˆã‚ã¦ã®å ´åˆã¯æœªè¨­å®š) |
| CM_PULL_REQUEST | PullRequestã®ãƒ“ãƒ«ãƒ‰ã®å ´åˆã¯trueã€ãã‚Œä»¥å¤–ã¯false |
| CM_PULL_REQUEST_NUMBER | Git ãƒ—ãƒ­ãƒã‚¤ãƒ€ (Bitbucketã€Github ãªã©) ã®ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’æ§‹ç¯‰ã—ã¦ã„ã‚‹å ´åˆã¯ã€ãã® ID |
| CM_PULL_REQUEST_DEST | PullRequestã®å ´åˆã¯ãƒãƒ¼ã‚¸å…ˆãƒ–ãƒ©ãƒ³ãƒ |
| CM_CLONE_UNSHALLOW | true ã«è¨­å®šã™ã‚‹ã¨ã€ä¸Šä½ 50 ã‚³ãƒŸãƒƒãƒˆã®ä»£ã‚ã‚Šã«ãƒªãƒã‚¸ãƒˆãƒªã®å®Œå…¨ãªã‚¯ãƒ­ãƒ¼ãƒ³ã‚’å®Ÿè¡Œ |
| CM_CLONE_DEPTH | ã‚¯ãƒ­ãƒ¼ãƒ³ä½œæˆæ™‚ã«ãƒªãƒã‚¸ãƒˆãƒªã‹ã‚‰å–å¾—ã™ã‚‹ã‚³ãƒŸãƒƒãƒˆæ•° |
| CM_RECURSIVE_SUBMODULE_INIT | false ã‚’è¨­å®šã™ã‚‹ã¨ã€å†å¸°çš„ãªã‚µãƒ–ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®cloneã¯ã•ã‚Œãªããªã‚‹ |
| CM_PROJECT_ID | ãƒ“ãƒ«ãƒ‰ä¸­ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®UUID |
| CM_BUILD_ID | ãƒ“ãƒ«ãƒ‰ã®UUID |
| CM_TEST_STEP_STATUS | ãƒ†ã‚¹ãƒˆã‚¹ãƒ†ãƒƒãƒ—ã®çŠ¶æ…‹ã€æˆåŠŸã¾ãŸã¯å¤±æ•— |
| CM_BUILD_STEP_STATUS | ãƒ“ãƒ«ãƒ‰ã‚¹ãƒ†ãƒƒãƒ—ã®çŠ¶æ…‹ã€æˆåŠŸã€å¤±æ•—ã€ã¾ãŸã¯ã‚¹ã‚­ãƒƒãƒ—ã€‚ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚¨ãƒ‡ã‚£ã‚¿ä½¿ç”¨æ™‚ã®ã¿æœ‰åŠ¹ã§ã€codemagic.yamlã§ã¯ä½¿ç”¨ã§ããªã„ |
| CM_BUILD_DIR | Codemagicãƒ“ãƒ«ãƒ€ãƒ¼ã§ã‚¯ãƒ­ãƒ¼ãƒ³ã—ãŸãƒªãƒã‚¸ãƒˆãƒªã®ãƒ«ãƒ¼ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¸ã®çµ¶å¯¾ãƒ‘ã‚¹ |
| CM_BUILD_OUTPUT_DIR | ãƒ“ãƒ«ãƒ‰ä¸­ã«ç”Ÿæˆã•ã‚ŒãŸã‚¢ãƒ¼ãƒ†ã‚£ãƒ•ã‚¡ã‚¯ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ‘ã‚¹ |
| CM_EXPORT_DIR | ã“ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«è¿½åŠ ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ã¯ã€ZIP ãƒ•ã‚¡ã‚¤ãƒ«ã«è¿½åŠ ã•ã‚Œã€ãƒ“ãƒ«ãƒ‰ã®æˆæœç‰©ã¨ã—ã¦åˆ©ç”¨ã§ãã‚‹ã‚ˆã†ã«ãªã‚‹ |
| CM_FLUTTER_SCHEME | ä½¿ç”¨ã™ã‚‹iOSã‚¹ã‚­ãƒ¼ãƒ ã®åç§° |
| CM_KEYSTORE_PASSWORD | UIã§è¨­å®šã•ã‚ŒãŸAndroid keystoreã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ |
| CM_KEY_PASSWORD | UIã§è¨­å®šã•ã‚ŒãŸAndroidã‚­ãƒ¼ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ |
| CM_KEY_ALIAS  | UIã§è¨­å®šã•ã‚ŒãŸã‚­ãƒ¼ã®ã‚¨ã‚¤ãƒªã‚¢ã‚¹ |
| CM_KEYSTORE_PATH | VMä¸Šã®ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ‘ã‚¹ |
| CM_ARTIFACT_LINKS | post-publishingã‚¹ãƒ†ãƒƒãƒ—ã§åˆ©ç”¨å¯èƒ½ãªã€ç”Ÿæˆã•ã‚ŒãŸãƒ“ãƒ«ãƒ‰æˆæœç‰©ã«é–¢ã™ã‚‹æƒ…å ± |

### è‡ªèº«ã§è¿½åŠ ã™ã‚‹ç’°å¢ƒå¤‰æ•°

#### [Variable groups](https://docs.codemagic.io/yaml-basic-configuration/configuring-environment-variables/#variable-groups)

è¤‡æ•°ã®ç’°å¢ƒå¤‰æ•°ã«ã‚°ãƒ«ãƒ¼ãƒ”ãƒ³ã‚°ã—ã¦ã‚¿ã‚°ä»˜ã‘ã§ãã‚‹ã‚‚ã®ã®æ§˜ã§ã™ã€‚
ä¾‹ã¨ã—ã¦stagingç’°å¢ƒç”¨ã¨ã€productionç’°å¢ƒç”¨ã§ã‚°ãƒ«ãƒ¼ãƒ”ãƒ³ã‚°ã—ã¦ãŠãã€ãã‚Œãã‚ŒåŒã˜ç’°å¢ƒå¤‰æ•°åã§å®šç¾©ã—ã¦ãŠã‘ã°ã€includeã™ã‚‹ã‚°ãƒ«ãƒ¼ãƒ—ã«å¿œã˜ã¦å€¤ãŒstagingç’°å¢ƒç”¨ã‹ã€productionç’°å¢ƒç”¨ã‹ã«è¨­å®šã•ã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

ä½¿ç”¨ã™ã‚‹å ´åˆã¯ `environment` ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã§å®šç¾©ã—ãŸã‚°ãƒ«ãƒ¼ãƒ—åã‚’ã‚¤ãƒ³ã‚¯ãƒ«ãƒ¼ãƒ‰ã—ã¾ã™ã€‚

```yaml
workflows:
  workflow-name:
    environment:
      groups:
        - magic_values
        - other_values
```

## Firebase App Distriutionã¸é…å¸ƒ

[Firebase App Distribution with codemagic.yaml - Codemagic Docs](https://docs.codemagic.io/yaml-publishing/firebase-app-distribution/)

### Android ç½²åæ™‚ã®keystoreãƒ•ã‚¡ã‚¤ãƒ«ã®è¨­å®š

ã¾ãšã¯é…å¸ƒæ™‚ã®ç½²åã§ä½¿ã† keystore ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¾ã™ã€‚
ä½œæˆã§ããŸã‚‰ã€macosã®å ´åˆä»¥ä¸‹ã‚³ãƒãƒ³ãƒ‰ã§ base64 ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã—ãŸã‚‚ã®ã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã™ã€‚

```sh
$ cat xxxx.keystore | base64 | pbcopy
```

æ¬¡ã«ã‚³ãƒ”ãƒ¼ã—ãŸkeystoreã‚’ç’°å¢ƒå¤‰æ•° `CM_KEYSTORE` ã¨ã—ã¦è¨­å®šã—ã¾ã™ã€‚

![image12](/images/b5aa0410765489/image12.png =500x)

ä»–ã«ã‚‚keystoreä½œæˆæ™‚ã® alias,  password, keystore_password ã‚’ãã‚Œãã‚Œ
 `CM_KEY_ALIAS`, `CM_PASSWORD`, `CM_KEYSTORE_PASSWORD` ã¨ã—ã¦ç’°å¢ƒå¤‰æ•°ã‚’è¨­å®šã—ã¾ã™ã€‚

![image13](/images/b5aa0410765489/image13.png =500x)

æ¬¡ã« `codemagic.yaml` ã‚’ä¿®æ­£ã—ã¾ã™ã€‚

```yaml
    environment:
      groups:
        - dev_keystore_credentials
      vars:
        CM_KEYSTORE_PATH: /tmp/keystore.keystore
    # ....
    scripts:
      - name: Set up key properties
        script: |
          echo $CM_KEYSTORE | base64 --decode > $CM_KEYSTORE_PATH
```

â†‘ `environment` ã«å…ˆã»ã©ç’°å¢ƒå¤‰æ•°ã§è¨­å®šã—ãŸgroupã‚’æŒ‡å®šã—ã¾ã™ã€‚
ã¾ãŸã€`CM_KEYSTORE_PATH` ã‚’åˆ¥é€”workflowå†…ã§ä½¿ç”¨ã™ã‚‹ç’°å¢ƒå¤‰æ•°ã¨ã—ã¦keystoreã®ä¿å­˜å…ˆã‚’å®šç¾©ã—ã¨ãã¾ã™ã€‚
æ¬¡ã«ã€`scripts` å†…ã§ base64 ã§ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã—ãŸ keystoreãƒ•ã‚¡ã‚¤ãƒ«ã‚’ ãƒ‡ã‚³ãƒ¼ãƒ‰ã—ã€ `CM_KEYSTORE_PATH` ã¸ä¿å­˜ã™ã‚‹å‡¦ç†ã‚’è¿½åŠ ã—ã¾ã™ã€‚

æ¬¡ã« `android/app/build.gradle` ã§â†‘ã§ä¿å­˜ã—ãŸkeystoreã‚’ä½¿ã†ã‚ˆã†ã«ä»¥ä¸‹ã‚’è¿½åŠ  & ä¿®æ­£ã—ã¾ã™ã€‚

```gradle
android {
    // ....
    signingConfigs {
        release {
            if (System.getenv()["CI"]) { // codemagicç”¨ã«è¿½åŠ 
                storeFile file(System.getenv()["CM_KEYSTORE_PATH"])
                storePassword System.getenv()["CM_KEYSTORE_PASSWORD"]
                keyAlias System.getenv()["CM_KEY_ALIAS"]
                keyPassword System.getenv()["CM_KEY_PASSWORD"]
            } else {
                // ....
            }
        }
    }

    buildTypes {
        release {
            signingConfig signingConfigs.release
        }
    }
}
```

### Firebase App Distributionã®è¨­å®š

Firebase App Distributionã¸é…å¸ƒã™ã‚‹ç‚ºã«ã¯ã€`Firebase token` ã‹ `service account (Firebase App Distribution Admin roleãŒä»˜ä¸ã•ã‚ŒãŸã‚‚ã®)` ãŒå¿…è¦ã«ãªã‚Šã¾ã™ã€‚
ä»Šå›ã¯ `Firebase token` ã‚’ä½¿ç”¨ã—ã¦é…å¸ƒã—ãŸã„ã¨æ€ã„ã¾ã™ã€‚

[ã“ã¡ã‚‰](https://firebase.google.com/docs/cli#cli-ci-systems) ã‚’å‚è€ƒã«ã€`firebase-tools` ã‚’ä½¿ç”¨ã— `firebase login:ci` ã§ç”Ÿæˆã•ã‚Œã‚‹tokenã‚’å–å¾—ã—ã¾ã™ã€‚

â€» Dockerã‚³ãƒ³ãƒ†ãƒŠå†…ãªã©ã§å®Ÿè¡Œã—ã¦ã„ã‚‹å ´åˆã€ã‚³ãƒ³ãƒ†ãƒŠå†…ã®localhostã«ã¯ã‚¢ã‚¯ã‚»ã‚¹ã§ããªã„ã®ã§ã€`--no-localhost` ã‚’æŒ‡å®šã™ã‚‹ã¨å¤‰ã‚ã‚Šã« `authorization code` ã§èªè¨¼ãŒã§ãã¾ã™ã€‚

```sh
$ firebase login:ci --no-localhost
âš   Authenticating with a `login:ci` token is deprecated and will be removed in a future major version of `firebase-tools`. Instead, use a service account key with `GOOGLE_APPLICATION_CREDENTIALS`: https://cloud.google.com/docs/authentication/getting-started

To sign in to the Firebase CLI:

1. Take note of your session ID:

   XXXXX

2. Visit the URL below on any device and follow the instructions to get your code:

   https://auth.firebase.tools/login?code_challenge=...

3. Paste or enter the authorization code below once you have it:

? Enter authorization code: 
XXXXXXXXXXXXXXXXXXXXXXXXXX

âœ”  Success! Use this token to login on a CI server:

XXXXXXXXXXXXXXXX # â† ã“ã‚Œ!

Example: firebase deploy --token "$FIREBASE_TOKEN"
```

å–å¾—ã—ãŸ token ã‚’ `FIREBASE_TOKEN` ã¨ã—ã¦ group `dev_firebase_credentials` ã§ç™»éŒ²ã—ã¾ã™ã€‚

![image14](/images/b5aa0410765489/image14.png =500x)

ã¾ãŸã€Firebaseã«è¨­å®šã—ã¦ã„ã‚‹Androidã‚¢ãƒ—ãƒªã®App IDã‚‚ç’°å¢ƒå¤‰æ•°ã«ç™»éŒ²ã—ã¨ãã¾ã™ã€‚

![image15](/images/b5aa0410765489/image15.png =500x)

æœ€å¾Œã« `codemagic.yaml` ã«ä»¥ä¸‹ã‚’è¿½åŠ ã—ã¾ã™ã€‚

```yaml
    environment:
      groups:
        - dev_firebase_credentials # è¿½åŠ 
    publishing:
      firebase: # publishingã«firebaseè¿½åŠ 
        firebase_token: $FIREBASE_TOKEN
        android:
          app_id: $ANDROID_APP_ID
          groups:
            - Developer
```

# ãƒãƒƒãƒ‰ãƒã‚¦ãƒã‚¦

`Error: This project is not linked to a Google Play account.` ãŒè¡¨ç¤ºã•ã‚Œã‚‹
`aab` ã§ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã‚ˆã†ã¨ã™ã‚‹ã¨ `Google Play account` ã¨ã® link ãŒ[å¿…è¦](https://firebase.google.com/docs/app-distribution/android/distribute-cli?apptype=aab#before-you-begin)ã€‚
`apk` ã§ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã ã¨å¿…è¦ãªã„ã€‚
[å‚è€ƒURL](https://github.com/wzieba/firebase-distribution-github-action/issues/73)

# å‚è€ƒURL

- [Codemagic ã§ãƒ¢ãƒã‚¤ãƒ«ã‚¢ãƒ—ãƒªã® CI/CD ã‚’å§‹ã‚ã¾ã—ã‚‡ã† | Codemagic Blog](https://blog.codemagic.io/getting-started-japanese/)
- [codemagic-sample-projects/codemagic.yaml at main Â· codemagic-ci-cd/codemagic-sample-projects](https://github.com/codemagic-ci-cd/codemagic-sample-projects/blob/main/Firebase-App-Distribution/codemagic_firebase_app_distribution_yaml-master/codemagic.yaml)