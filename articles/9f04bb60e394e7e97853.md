---
title: "Macã§VSCode Remote Containersã‚’CLIã‹ã‚‰ç›´æ¥é–‹ã"
emoji: "ğŸ› ï¸"
type: "tech"
topics:
  - "vscode"
  - "alfred"
  - "ruby"
  - "tool"
published: true
published_at: "2020-11-08 04:59"
---

## ä»•çµ„ã¿
ä¸€åº¦VSCode Remote Containersã‚’é–‹ã„ãŸå¾Œ `cat ~/Library/Application\ Support/Code/storage.json` ã®
`windowsState` > `lastActiveWindow` > `folder` ã‚’è¦‹ã‚‹ã¨ä»¥ä¸‹ã®ã‚ˆã†ãªæ„Ÿã˜ã«ãªã£ã¦ã„ã‚‹ã®ãŒåˆ†ã‹ã‚Šã¾ã™ã€‚

```json
    "windowsState": {
        "lastActiveWindow": {
            "folder": "vscode-remote://dev-container%2B2f557365722f6e616d652f646576656c6f702f70726f6a656374/usr/src",
            "backupPath": "...",
            "remoteAuthority": "dev-container+2f557365722f6e616d652f646576656c6f702f70726f6a656374",
            "uiState": {
                "mode": 1,
                "x": 0,
                "y": 23,
                "width": 3440,
                "height": 1417
            }
        },
        "openedWindows": []
    },
```
ã“ã® `folder` ã®URLãŒåˆ†ã‹ã‚Œã°

```sh
$ code --folder-uri vscode-remote://dev-container%2B2f557365722f6e616d652f646576656c6f702f70726f6a656374/usr/src
```
ã“ã®ã‚ˆã†ã«ç›´æ¥CLIã‹ã‚‰ç«‹ã¡ä¸Šã’ã‚‹äº‹ãŒå¯èƒ½ã§ã™ã€‚

`2f557365722f6e616d652f646576656c6f702f70726f6a656374` ã®éƒ¨åˆ†ã¯`16é€²æ•°æ–‡å­—åˆ—`ã«ãªã£ã¦ã„ã¦
ã“ã‚Œã‚’ãƒ‡ã‚³ãƒ¼ãƒ‰ã™ã‚‹ã¨ `/User/name/develop/project` ã¨ãªã‚Šã¾ã™ã€‚ã¾ãŸ `%2B` ãŒå«ã¾ã‚Œã¦ã„ã‚‹ã®ã§URLã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã•ã‚Œã¦ã„ã‚‹ã®ãŒåˆ†ã‹ã‚Šã¾ã™ã€‚
æœ€å¾Œã® `/usr/src` ã¯ `devcontainer.json` ã® `workspaceFolder` ã§æŒ‡å®šã—ãŸãƒ‘ã‚¹ã«ãªã‚Šã¾ã™ã€‚
ã“ã‚Œã‚‰ã‚’è¸ã¾ãˆã¦å…¨ä½“ã®URLæ§‹æˆè¦ç´ ã¨ã—ã¦ã¯

```ruby
"vscode-remote://" + URI.encode_www_form_component("dev-container+" + "/User/name/develop/project".unpack('H*')) + "/usr/src"
```
ã¨ãªã£ã¦ã„ã‚‹ã‚ˆã†ã§ã™ã€‚

## ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®ä½œæˆ
ãƒ‘ã‚¹ã‚’æŒ‡å®šã—ãŸã‚‰VSCode Remote Containersã‚’èµ·å‹•ã™ã‚‹ç‚ºã®URLã‚’ç”Ÿæˆã—ã¦ãã‚Œã‚‹ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’æ›¸ã„ã¦ã¿ã¾ã™ã€‚
æŒ‡å®šã—ãŸãƒ‘ã‚¹é…ä¸‹ã® `.devcontainer/devcontainer.json` ã® `workspaceFolder` ã‚’èª­ã¿è¾¼ã‚“ã§ç”Ÿæˆã—ã¦ã¾ã™ã€‚

```ruby:main.rb
# frozen_string_literal: true
# !/usr/bin/env ruby
require 'json'

module VSCodeRemoteContainer
  class Utility
    def initialize
    end

    def generate_url(root_path)
      folder = find_workspace_folder(root_path)
      path = "dev-container+#{root_path.unpack('H*')[0]}"
      puts "vscode-remote://#{URI.encode_www_form_component(path)}#{folder}"
    end

    def find_workspace_folder(root_path)
      unless File.exist?("#{root_path}/.devcontainer/devcontainer.json")
        puts 'Not found devcontainer.json file.'
        return
      end

      config = JSON.parse(File.read("#{root_path}/.devcontainer/devcontainer.json"))
      config['workspaceFolder']
    end
  end
end

VSCodeRemoteContainer::Utility.new.generate_url(*ARGV)
```
ä¸Šè¨˜ã‚’ `main.rb` ã¨ã—ã¦ä¿å­˜ã—ä»¥ä¸‹ã®æ§˜ã«å®Ÿè¡Œã™ã‚‹ã¨URLãŒç”Ÿæˆã•ã‚Œã¾ã™
```sh
$ ruby main.rb '/User/name/xxxx'
# => vscode-remote://dev-container%2B2f557365722f6e616d652f646576656c6f702f70726f6a656374/usr/src
```

## Alfredã®Workflowsã®ä½œæˆ
ä»Šå›ã¯[ghq](https://github.com/x-motemen/ghq)ã¨çµ„ã¿åˆã‚ã›ã¦å‹•ä½œã™ã‚‹Workflowsã‚’ä½œæˆã—ã¦ã¿ã¾ã—ãŸã€‚
å‹•ä½œã‚¤ãƒ¡ãƒ¼ã‚¸ã¨ã—ã¦â†“ã®READMEã®ã‚ˆã†ã«ãƒªãƒã‚¸ãƒˆãƒªåã‚’æŒ‡å®šã—ã¦ç›´æ¥VSCodeã‚’ã‚³ãƒ³ãƒ†ãƒŠå†…ã§èµ·å‹•ã—ã¦ã„ã¾ã™ã€‚
https://gist.github.com/Slowhand0309/253bb296cd7acb089601d2b32da4723b

Workflowsã‚’ä½œæˆã™ã‚‹ã«ã‚ãŸã£ã¦ä¸Šè¨˜ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã«è¿½è¨˜ã—ã¾ã—ãŸã€‚

```ruby
module VSCodeRemoteContainer
  class Utility
    attr_accessor :bin_path
    def initialize
      @bin_path = ENV['GHQ_PATH'] || '/usr/local/bin'
    end

    def ghq_exists?
      !`which #{@bin_path}/ghq`.empty?
    end

    def search
      return unless ghq_exists?

      result = []
      `#{@bin_path}/ghq list --full-path`.split(/\R/).each do |d|
        Dir.foreach(d) do |path|
          next if ['.', '..'].include?(path)

          file = File.join(d, path)
          result << d if file.include?('.devcontainer')
        end
      end
      result
    end
  end
end
```
ã‚„ã£ã¦ã‚‹äº‹ã¯ `ghq` ã‚’ä½¿ã£ã¦å¯¾è±¡ã®ãƒªãƒã‚¸ãƒˆãƒªä¸€è¦§ã‚’ã¨ã£ã¦ãã¦ã€
`.devcontainer` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãŒã‚ã‚‹ãƒªãƒã‚¸ãƒˆãƒªã ã‘ã‚’è¿”ã™ã‚ˆã†ã«ã—ã¦ã¾ã™ã€‚

å‡ºæ¥ä¸ŠãŒã£ãŸã‚‚ã®ã¯
https://gist.github.com/Slowhand0309/253bb296cd7acb089601d2b32da4723b
ã“ã¡ã‚‰ã«ç½®ã„ã¦ãŠã‚Šã¾ã™ã€‚ã¨ã‚Šã‚ãˆãšä½œã£ã¦ã¿ãŸç¨‹åº¦ãªã®ã§ä¸å…·åˆç­‰è¦‹ã¤ã‘ãŸã‚‰
ã”é€£çµ¡é ‚ã‘ã‚‹ã¨åŠ©ã‹ã‚Šã¾ã™ã€‚
â€» `zsh`ã‚’ãƒ™ãƒ¼ã‚¹ã«ä½œã£ã¦ã¾ã™ãŒã€ãŠä½¿ã„ã®ã‚·ã‚§ãƒ«ã§ãŠå¥½ã¿ã§ä¿®æ­£ã—ã¦é ‚ã‘ã‚Œã° ğŸ™
