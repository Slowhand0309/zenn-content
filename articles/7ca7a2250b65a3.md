---
title: "ã€Dartã€‘ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³å¼•æ•°è§£æãƒ©ã‚¤ãƒ–ãƒ©ãƒªargsã‚’è©¦ã™"
emoji: "ğŸ”¤"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics:
  - "dart"
  - "args"
  - "cli"
published: true
---
# ã¯ã˜ã‚ã«

ã“ã®è¨˜äº‹dartå…¬å¼ã®ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³å¼•æ•°ã®è§£æãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ã‚ã‚‹ args ã‚’è§¦ã‚ŠãªãŒã‚‰ã‚­ãƒ£ãƒƒãƒã‚¢ãƒƒãƒ—ã—ãŸéš›ã®è¨˜äº‹ã«ãªã‚Šã¾ã™ã€‚

[args | Dart Package](https://pub.dev/packages/args)

> ã“ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãƒ¼ã¯GNUã¨POSIXã‚¹ã‚¿ã‚¤ãƒ«ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ãŠã‚Šã€ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ã¨ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚µã‚¤ãƒ‰ã®ä¸¡æ–¹ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§å‹•ä½œã™ã‚‹ã€‚

- **GNUã‚¹ã‚¿ã‚¤ãƒ«ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³**
    1. ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã®æŒ‡å®šæ–¹æ³•:
        - é€šå¸¸ã€ãƒã‚¤ãƒ•ãƒ³ (-)ã¾ãŸã¯ãƒ€ãƒ–ãƒ«ãƒã‚¤ãƒ•ãƒ³ (â€”) ã‚’ä½¿ã£ã¦ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’æŒ‡å®šã—ã¾ã™
        - ä¾‹: `-a`, `--a`
    2. ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã«å€¤ã‚’æ¸¡ã™å ´åˆ:
        - ã‚¤ã‚³ãƒ¼ãƒ«ï¼ˆ**`=`**ï¼‰ã‹ã‚¹ãƒšãƒ¼ã‚¹ã§ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã¨å€¤ã‚’åŒºåˆ¥ã—ã¾ã™
        - ä¾‹: **`--file=file.txt`**ã€**`-o output.txt`**
    3. çŸ­ç¸®å½¢ã®çµåˆ:
        - è¤‡æ•°ã®çŸ­ç¸®å½¢ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã¯ä¸€åº¦ã«çµåˆã§ãã¾ã™
        - ä¾‹: **`-abc`**ï¼ˆã“ã‚Œã¯ **`-a -b -c`** ã¨åŒç­‰ï¼‰
    4. **[--version](http://www.gnu.org/prep/standards/html_node/_002d_002dversion.html) ã¨ [--help](http://www.gnu.org/prep/standards/html_node/_002d_002dhelp.html) ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’æœ€ä½é™ã¤ã‘ã‚‹**

- **POSIXã‚¹ã‚¿ã‚¤ãƒ«ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³**
    1. ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã®æŒ‡å®šæ–¹æ³•:
        - ãƒã‚¤ãƒ•ãƒ³(-)ã‚’ä½¿ã£ã¦ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’æŒ‡å®šã—ã¾ã™
        - ä¾‹:  `-a`
    2. ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã«å€¤ã‚’æ¸¡ã™å ´åˆ:
        - å€¤ã¨ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã¯ã‚¹ãƒšãƒ¼ã‚¹ã§åŒºåˆ‡ã‚Šã¾ã™
        - ä¾‹: **`-f file.txt`**
    3. çŸ­ç¸®å½¢ã®çµåˆ:
        - POSIXã§ã¯é€šå¸¸ã€ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã¯ä¸€åº¦ã«ä¸€ã¤ãšã¤æŒ‡å®šã•ã‚Œã¾ã™

# ç’°å¢ƒæ§‹ç¯‰ã‚„æº–å‚™

å„ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚„ç’°å¢ƒ

```bash
$ sw_vers
ProductName: macOS
ProductVersion: 13.4.1
ProductVersionExtra: (c)
BuildVersion: 22F770820d
$ dart --version
Dart SDK version: 3.2.0 (stable) (Tue Nov 14 18:26:59 2023 +0000) on "macos_arm64"
```

`pubspec.yaml`

```yaml
environment:
  sdk: ^3.2.0

dependencies:
  args: ^2.4.2

dev_dependencies:
  lints: ^2.1.0
  test: ^1.24.0
```

## 1. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆ

argsã‚’è©¦ã™ç‚ºã«ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã—ã¾ã™ã€‚

```bash
$ dart create -t console dart-args-example
$ cd dart-args-example
$ dart run
Building package executable... 
Built dart_args_example:dart_args_example.
Hello world: 42!
```

## 2. argsãƒ‘ãƒƒã‚±ãƒ¼ã‚¸è¿½åŠ 

ä»¥ä¸‹ã‚³ãƒãƒ³ãƒ‰ã§è¿½åŠ ã™ã‚‹ã‹ã€

```bash
dart pub add args
```

`pubspec.yaml` ã«ä»¥ä¸‹ã‚’è¿½åŠ ã— `dart pub get` ã‚’å®Ÿæ–½ã—ã¾ã™ã€‚

```yaml
dependencies:
  args: ^2.4.2
```

# å®Ÿè£…

## 1. ã‚·ãƒ³ãƒ—ãƒ«ãªå®Ÿè£…

ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆæ™‚ã«ä½œæˆã•ã‚ŒãŸ `bin/dart_args_example.dart` ã‚’ä»¥ä¸‹ã«å¤‰æ›´ã—ã¾ã™ã€‚

```dart
import 'package:args/args.dart';

void main(List<String> arguments) {
  var parser = ArgParser();
  parser.addOption('mode', abbr: 'm');
  parser.addFlag('verbose', abbr: 'v');

  var results = parser.parse(arguments);
  print('mode: ${results['mode']}');
  print('verbose: ${results['verbose']}');
}
```

æ¬¡ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’æŒ‡å®šã—ã¦å®Ÿè¡Œã—ã¦ã¿ã¾ã™ã€‚

```bash
$ dart run bin/dart_args_example.dart -m debug -v
mode: debug
verbose: true
# åˆã¯ dart run bin/dart_args_example.dart --mode debug --verbose
```

ä¸Šè¨˜ã®å‡¦ç†ã§ã¯ã¾ãšparseå‡¦ç†ã‚’è¡Œã† [ArgParser](https://pub.dev/documentation/args/latest/args/ArgParser/ArgParser.html) ã‚’ä½œæˆã—ã¦ã„ã¾ã™ã€‚

æ¬¡ã«ç‰¹å®šã®æ–‡å­—åˆ—ç­‰ã‚’æŒ‡å®šã™ã‚‹éš›ã«ä½¿ç”¨ã™ã‚‹ [addOption](https://pub.dev/documentation/args/latest/args/ArgParser/addOption.html) ã¨ãƒ•ãƒ©ã‚°å€¤(true/false) ã‚’æŒ‡å®šã™ã‚‹éš›ã«ä½¿ç”¨ã™ã‚‹ [addFlag](https://pub.dev/documentation/args/latest/args/ArgParser/addFlag.html) ã‚’ä½¿ç”¨ã—ã¦ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’æŒ‡å®šã—ã¦ã„ãã¾ã™ã€‚

æœ€å¾Œã« [parse](https://pub.dev/documentation/args/latest/args/ArgParser/parse.html) ã§å¼•æ•°ã‚’è§£æã—ã¾ã™ã€‚æˆ»ã‚Šå€¤ã¨ã—ã¦ã¯ [ArgResults](https://pub.dev/documentation/args/latest/args/ArgResults-class.html) ãŒè¿”å´ã•ã‚Œã¾ã™ã€‚

### 1-1. addOption

- `allowed` ã§è¨­å®šã§ãã‚‹å€¤ã‚’æŒ‡å®šã§ãã¾ã™
  - `parser.addOption('mode', abbr: 'm', allowed: ['debug', 'release']);`
- `defaultsTo` ã§ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã‚’æŒ‡å®šã§ãã¾ã™
  - `parser.addOption('mode', abbr: 'm', defaultsTo: 'debug');`

### 1-2. addFlag

- ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã€ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ç„¡åŠ¹ã«ã™ã‚‹ã€Œno-ã€ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ãŒã¤ã
  - ä¸Šè¨˜ã®ä¾‹ã ã¨ `dart run bin/dart_args_example.dart -m debug --no-verbose` ã¨å®Ÿè¡Œã™ã‚‹ã¨ verboseãŒ `false` ã«ãªã‚Šã¾ã™
  - longã‚ªãƒ—ã‚·ãƒ§ãƒ³ã®ã¿
- ã€Œno-ã€ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ã‚’ç„¡åŠ¹ã«ã™ã‚‹
  - `negatable` ã‚’ `false` ã§æŒ‡å®šã—ã¾ã™ã€‚
  - `parser.addFlag('verbose', abbr: 'v', negatable: false);`
  - `--no-verbose` ã‚’æŒ‡å®šã™ã‚‹ã¨ä¾‹å¤–ã‚’æŠ•ã’ã‚‹æ§˜ã«ãªã‚Šã¾ã™
- `defaultsTo` ã§ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã‚’æŒ‡å®šã§ãã¾ã™
  - `parser.addFlag('verbose', abbr: 'v', defaultsTo: true);`

## 2. [ã‚³ãƒãƒ³ãƒ‰å®šç¾©](https://pub.dev/packages/args#defining-commands)

å…¬å¼ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®ä¾‹ã«ã‚ã‚‹ã‚ˆã†ã«ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®šç¾©ã—ã¦ã¿ãŸã„ã¨æ€ã„ã¾ã™ã€‚

```bash
dart run bin/dart_args_example.dart commit -a
```

æ–°ãŸã« `commit` ã‚³ãƒãƒ³ãƒ‰ã‚’å®šç¾©ã—ã€ `commit` ã‚³ãƒãƒ³ãƒ‰ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã¨ã—ã¦ `-a` ã‚’å®šç¾©ã—ã¾ã™ã€‚

ã‚³ãƒãƒ³ãƒ‰ã¯ [addCommand](https://pub.dev/documentation/args/latest/args/ArgParser/addCommand.html) ã§å®šç¾©ã§ãã¾ã™ã€‚

```dart
void main(List<String> arguments) {
  var parser = ArgParser();
  parser.addOption('mode', abbr: 'm', allowed: ['debug', 'release']);
  parser.addFlag('verbose', abbr: 'v', defaultsTo: true);

  // command: commit
  var command = parser.addCommand('commit');
  command.addFlag('all', abbr: 'a');

  var results = parser.parse(arguments);
  print('mode: ${results['mode']}');
  print('verbose: ${results['verbose']}');
  var commandResults = results.command;
  if (commandResults != null) {
    print('command: ${commandResults.name}');
    print('command --all: ${commandResults['all']}');
  }
}
```

ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿæ–½ã—ã¦ã¿ã¾ã™ã€‚

```bash
$ dart run bin/dart_args_example.dart -m debug -v commit -a
mode: debug
verbose: true
command: commit
command --all: true
```

ã‚³ãƒãƒ³ãƒ‰ã®å‰ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³æŒ‡å®šã¯ã‚ã¾ã‚Šç„¡ã„ã‹ã‚‚ã§ã™ãŒã€ã¡ã‚ƒã‚“ã¨ã‚³ãƒãƒ³ãƒ‰ãŒè§£æã§ãã¦ã„ã¾ã™ã€‚

ã“ã“ã§è©¦ã—ã«2ã¤ã‚³ãƒãƒ³ãƒ‰ã‚’ç™»éŒ²ã—ã¦ã€2ã¤ã‚³ãƒãƒ³ãƒ‰ã‚’æŒ‡å®šã—ã¦å®Ÿè¡Œã—ãŸã‚‰ã©ã†ãªã‚‹ã‹è©¦ã—ã¦ã¿ãŸã„ã¨æ€ã„ã¾ã™ã€‚

```dart
void main(List<String> arguments) {
  var parser = ArgParser();
  parser.addOption('mode', abbr: 'm', allowed: ['debug', 'release']);
  parser.addFlag('verbose', abbr: 'v', defaultsTo: true);

  // command: commit
  var command = parser.addCommand('commit');
  command.addFlag('all', abbr: 'a');

  // command: stash
  var stash = parser.addCommand('stash');
  stash.addFlag('all', abbr: 'a');

  var results = parser.parse(arguments);
  print('mode: ${results['mode']}');
  print('verbose: ${results['verbose']}');
  var commandResults = results.command;
  if (commandResults != null) {
    print('command: ${commandResults.name}');
    print('command --all: ${commandResults['all']}');
  }
}
```

å…ˆã»ã©ã®å®Ÿè£…ã« `stash` ã‚³ãƒãƒ³ãƒ‰ã‚’è¿½åŠ ã—ã€ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã¯åŒã˜ `all` ã‚’è¨­å®šã—ã¦ã¿ã¾ã—ãŸã€‚

ã“ã‚Œã§å®Ÿè¡Œã—ã¦ã¿ã‚‹ã¨ã€

```bash
$ dart run bin/dart_args_example.dart -m debug -v stash --no-all commit -a
mode: debug
verbose: true
command: stash
command --all: true
```

ã‚³ãƒãƒ³ãƒ‰ã«é–¢ã—ã¦ã¯å…ˆã«æŒ‡å®šã—ãŸã‚³ãƒãƒ³ãƒ‰ãŒæ¡ç”¨ã•ã‚Œã¦ã„ã‚‹ã®ã§ã™ãŒã€ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã¯æœ€å¾Œã® `commit` ã®æ–¹ã® `all` ãŒæ¡ç”¨ã•ã‚Œã¦ã„ã¾ã™ã€‚

## 3. [ã‚³ãƒãƒ³ãƒ‰ã®ãƒ‡ã‚£ã‚¹ãƒ‘ãƒƒãƒ](https://pub.dev/packages/args#dispatching-commands)

ã‚³ãƒãƒ³ãƒ‰ãƒ™ãƒ¼ã‚¹ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä½œæˆã™ã‚‹å ´åˆã¯ã€[CommandRunner](https://pub.dev/documentation/args/latest/command_runner/CommandRunner-class.html)ã‚¯ãƒ©ã‚¹ã¨[Command](https://pub.dev/documentation/args/latest/command_runner/Command-class.html)ã‚¯ãƒ©ã‚¹ã‚’ä½¿ç”¨ã—ã¦ç‰¹åŒ–ã—ãŸæ§‹æˆã«ã™ã‚‹ã“ã¨ãŒã§ãã‚‹ãã†ã§ã™ã€‚

### 3-1. [CommandRunner](https://pub.dev/documentation/args/latest/command_runner/CommandRunner-class.html)

- ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³å¼•æ•°ã«åŸºã¥ã„ã¦Commandã«ãƒ‡ã‚£ã‚¹ãƒ‘ãƒƒãƒã™ã‚‹æ©Ÿèƒ½
- ãƒ•ãƒ©ã‚°ã‚„ç„¡åŠ¹ãªå¼•æ•°ã‚’å‡¦ç†ã™ã‚‹ãŸã‚ã®ã‚µãƒãƒ¼ãƒˆ

### 3-2. [Command](https://pub.dev/documentation/args/latest/command_runner/Command-class.html)

- ã‚³ãƒãƒ³ãƒ‰ã«ã‚µãƒ–ã‚³ãƒãƒ³ãƒ‰ãŒãªãã€å®Ÿè¡Œã™ã‚‹ã“ã¨ã‚’ç›®çš„ã¨ã—ã¦ã„ã‚‹å ´åˆã€ãã®ã‚³ãƒãƒ³ãƒ‰ã¯ã€Œãƒªãƒ¼ãƒ• ã‚³ãƒãƒ³ãƒ‰ã€ã¨å‘¼ã°ã‚Œã‚‹
- ãƒªãƒ¼ãƒ•ã‚³ãƒãƒ³ãƒ‰ã¯[run](https://pub.dev/documentation/args/latest/command_runner/Command/run.html)ã‚’ã‚ªãƒ¼ãƒãƒ¼ãƒ©ã‚¤ãƒ‰ã™ã‚‹å¿…è¦ãŒã‚ã‚‹
- ã‚µãƒ–ã‚³ãƒãƒ³ãƒ‰ã‚’å«ã‚€ã‚³ãƒãƒ³ãƒ‰ã¯ [addSubcommand](https://pub.dev/documentation/args/latest/command_runner/Command/addSubcommand.html) ã§ç™»éŒ²ã™ã‚‹å¿…è¦ãŒã‚ã‚‹

### 3-3. CommandRunnerã¨Commandã§ç½®ãæ›ãˆ

å…ˆã»ã©ã®ã‚µãƒ³ãƒ—ãƒ«ã‚’CommandRunnerã¨Commandã§ç½®ãæ›ãˆã¦ã¿ãŸã„ã¨æ€ã„ã¾ã™ã€‚

å…ˆã« `CommitCommand` ã‚¯ãƒ©ã‚¹ã¨ `StashCommand` ã‚¯ãƒ©ã‚¹ã‚’ä½œæˆã—ã¾ã™ã€‚

- CommitCommandã‚¯ãƒ©ã‚¹ (`lib/commit_command.dart`)

    ```dart
    import 'package:args/command_runner.dart';
    
    class CommitCommand extends Command {
      @override
      String get name => 'commit';
    
      @override
      String get description => 'Record changes to the repository.';
    
      CommitCommand() {
        // ã“ã“ã§ã‚³ãƒãƒ³ãƒ‰å›ºæœ‰ã®å¼•æ•°ã‚’è¿½åŠ ã§ãã‚‹ã€‚argParserã¯å†…éƒ¨ã§ä½œæˆã•ã‚Œã‚‹ã€‚
        argParser.addFlag('all', abbr: 'a');
      }
    
      @override
      void run() {
        print("CommitCommand --all: ${argResults?['all']}");
      }
    }
    ```

- StashCommandã‚¯ãƒ©ã‚¹ (`lib/stash_command.dart`)

    ```dart
    import 'package:args/command_runner.dart';
    
    class StashCommand extends Command {
      @override
      String get name => 'stash';
    
      @override
      String get description => 'Stash changes in the working directory.';
    
      StashCommand() {
        // ã“ã“ã§ã‚³ãƒãƒ³ãƒ‰å›ºæœ‰ã®å¼•æ•°ã‚’è¿½åŠ ã§ãã‚‹ã€‚argParserã¯å†…éƒ¨ã§ä½œæˆã•ã‚Œã‚‹ã€‚
        argParser.addFlag('all', abbr: 'a');
      }
    
      @override
      void run() {
        print("StashCommand --all: ${argResults?['all']}");
      }
    }
    ```

`bin/dart_args_example.dart` ã‚’ä»¥ä¸‹ã®æ§˜ã«ä¿®æ­£ã—ã¾ã™ã€‚

```dart
void main(List<String> arguments) {
  var runner = CommandRunner(
      'dgit', "A dart implementation of distributed version control.");
  runner.argParser.addOption('mode', abbr: 'm', allowed: ['debug', 'release']);
  runner.argParser.addFlag('verbose', abbr: 'v', defaultsTo: true);
  runner.addCommand(CommitCommand());
  runner.addCommand(StashCommand());
  runner.run(arguments);
}
```

[ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®ã‚µãƒ³ãƒ—ãƒ«](https://pub.dev/packages/args#dispatching-commands)ã«ã‚ã‚‹æ§˜ã« `dgit` ã¨ã„ã†CLIã‚¢ãƒ—ãƒªã®æƒ³å®šã§ä½œæˆã—ã¦ã„ã¾ã™ã€‚

æ—©é€Ÿå®Ÿè¡Œã—ã¦ã¿ã¾ã™ã€‚

```bash
$ dart run bin/dart_args_example.dart -m debug -v commit -a
CommitCommand --all: true
```

ã¡ã‚ƒã‚“ã¨å®Ÿè¡Œã§ãã¦ãã†ã§ã™!

ã¡ãªã¿ã«è¤‡æ•°ã‚³ãƒãƒ³ãƒ‰ã‚’æŒ‡å®šã™ã‚‹å ´åˆã®æŒ™å‹•ã‚‚å¤‰ã‚ã‚‰ãšã§ã—ãŸã€‚

```bash
$ dart run bin/dart_args_example.dart -m debug -v stash -a commit --no-all
StashCommand --all: false
```

> ã‚³ãƒãƒ³ãƒ‰ã«é–¢ã—ã¦ã¯å…ˆã«æŒ‡å®šã—ãŸã‚³ãƒãƒ³ãƒ‰ãŒæ¡ç”¨ã•ã‚Œã¦ã„ã‚‹ã®ã§ã™ãŒã€ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã¯æœ€å¾Œã® `commit` ã®æ–¹ã® `all` ãŒæ¡ç”¨ã•ã‚Œã¦ã„ã¾ã™ã€‚

# å‚è€ƒURL

- [GNU Coding Standards - Command-Line Options](https://www.gnu.org/prep/standards/html_node/Command_002dLine-Interfaces.html)
- [GNU Core Utilities Manual](https://www.gnu.org/software/coreutils/manual/)
- [Utility Conventions](https://pubs.opengroup.org/onlinepubs/009696899/basedefs/xbd_chap12.html)
- [Rationale](https://pubs.opengroup.org/onlinepubs/009696899/xrat/xbd_chap12.html)