---
title: "ãƒ¢ãƒ€ãƒ³ãªãƒ‰ãƒ©ãƒƒã‚°ï¼†ãƒ‰ãƒ­ãƒƒãƒ—ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®dnd-kitã‚’è©¦ã—ã¦ã¿ãŸ"
emoji: "ğŸ˜¸"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics:
  - "dndkit"
  - "dnd"
  - "react"
  - "typescript"
  - "vite"
published: true
---
# dnd-kit ã¨ã¯?

https://dndkit.com/

> Reactã®ãŸã‚ã®ã€è»½é‡ã€é«˜æ€§èƒ½ã€ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ã€æ‹¡å¼µå¯èƒ½ãªãƒ‰ãƒ©ãƒƒã‚°ï¼†ãƒ‰ãƒ­ãƒƒãƒ—ãƒ„ãƒ¼ãƒ«ã‚­ãƒƒãƒˆã§ã™

- **æ©Ÿèƒ½è±Šå¯Œ**ï¼šè¡çªæ¤œå‡ºã€ãƒ‰ãƒ©ãƒƒã‚°ãƒãƒ³ãƒ‰ãƒ«ã€è‡ªå‹•ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãªã©ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºå¯èƒ½ã€‚
- **Reactå¯¾å¿œ**ï¼š`useDraggable` ã‚„ `useDroppable` ãƒ•ãƒƒã‚¯ãŒæä¾›ã•ã‚Œã€å†æ§‹ç¯‰ä¸è¦ã€‚
- **å¤šæ§˜ãªç”¨é€”ã«å¯¾å¿œ**ï¼šãƒªã‚¹ãƒˆã‚„ã‚°ãƒªãƒƒãƒ‰ã€è¤‡æ•°ã‚³ãƒ³ãƒ†ãƒŠã€2Dã‚²ãƒ¼ãƒ ãªã©ã«å¯¾å¿œã€‚
- **ä¾å­˜ãªã—ï¼†ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«å¼**ï¼š10KBæœªæº€ã§ã€å¤–éƒ¨ä¾å­˜ãŒãªã„è»½é‡è¨­è¨ˆã€‚
- **å¤šå…¥åŠ›å¯¾å¿œ**ï¼šãƒã‚¤ãƒ³ã‚¿ã€ãƒã‚¦ã‚¹ã€ã‚¿ãƒƒãƒã€ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰å…¥åŠ›ã«å¯¾å¿œã€‚
- **ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºæ€§**ï¼šã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚„ã‚¹ã‚¿ã‚¤ãƒ«ã€è¡çªæ¤œå‡ºã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã‚’è‡ªç”±ã«è¨­å®šå¯èƒ½ã€‚
- **ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£**ï¼šã‚­ãƒ¼ãƒœãƒ¼ãƒ‰æ“ä½œã€ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ãƒªãƒ¼ãƒ€ãƒ¼å¯¾å¿œã€‚
- **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹é‡è¦–**ï¼šã‚¹ãƒ ãƒ¼ã‚ºãªã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿç¾ã€‚
- **ãƒ—ãƒªã‚»ãƒƒãƒˆã‚ã‚Š**ï¼š`dnd-kit/sortable` ãªã©ã€ç°¡å˜ã«ä¸¦ã¹æ›¿ãˆã‚’å®Ÿè£…å¯èƒ½ã€‚

# æ¤œè¨¼ç”¨ã®ç’°å¢ƒæ§‹ç¯‰

https://github.com/Slowhand0309/nodejs-devcontainer-boilerplate

ğŸ‘†ä»Šå›ã‚‚ã“ã¡ã‚‰ã‚’ãƒ™ãƒ¼ã‚¹ã«ç’°å¢ƒæ§‹ç¯‰ã—ã¦ã„ãã¾ã™ã€‚

```bash
$ yarn create vite . --template react-ts
Current directory is not empty. Please choose how to proceed:
    Remove existing files and continue
    Cancel operation
â¯   Ignore files and continue
```

`.devcontainer/postAttach.sh` ã«ä»¥ä¸‹ã‚’è¿½åŠ ã—ã¾ã™ã€‚

```bash
yarn install
yarn dev
```

`.devcontainer/docker-compose.yml` ã«ä»¥ä¸‹ã‚’è¿½åŠ ã—ã¾ã™ã€‚

```yaml
services:
  app:
    build: .
    ...
    working_dir: /usr/src
    ports: # ports è¿½åŠ 
      - "5173:5173"
```

`package.json` ã® `scripts` > `dev` ã‚’ä»¥ä¸‹ã«å¤‰æ›´ã—ã¾ã™ã€‚

```json
  "scripts": {
    "dev": "vite --host=0.0.0.0",
    // ...
  },
```

ã“ã“ã¾ã§ã—ã¦ã€å†åº¦VSCodeã§devcontainerã‚’ä½¿ã£ã¦ã‚³ãƒ³ãƒ†ãƒŠã‚’èµ·å‹•ã—ç›´ã—ã¾ã™ã€‚

ãƒ–ãƒ©ã‚¦ã‚¶ã§ [http://localhost:5173/](http://localhost:5173/) ã«ã‚¢ã‚¯ã‚»ã‚¹ã—Vite + React ãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã‚Œã°OKã§ã™ã€‚

# å¿…è¦ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```bash
yarn add @dnd-kit/core
```

# ã‚·ãƒ³ãƒ—ãƒ«ãªå®Ÿè£…

`src/App.tsx` ã‚’ä»¥ä¸‹ã«ä¿®æ­£ã—ã¾ã™ã€‚

```tsx
import { DndContext, useDraggable, useDroppable } from "@dnd-kit/core";

function DraggableItem() {
  const { attributes, listeners, setNodeRef, transform } = useDraggable({
    id: "draggable-item",
  });

  return (
    <button
      ref={setNodeRef}
      style={{
        transform: `translate3d(${transform?.x}px, ${transform?.y}px, 0)`,
      }}
      {...listeners}
      {...attributes}
    >
      Drag me!
    </button>
  );
}

function DroppableArea() {
  const { isOver, setNodeRef } = useDroppable({
    id: "droppable-area",
  });

  return (
    <div
      ref={setNodeRef}
      style={{
        backgroundColor: isOver ? "lightgreen" : "lightgray",
        width: 200,
        height: 200,
      }}
    >
      Drop here
    </div>
  );
}

function App() {
  return (
    <DndContext>
      <DroppableArea />
      <DraggableItem />
    </DndContext>
  );
}

export default App;

```

å‹•ä½œã•ã›ã¦ã¿ã‚‹ã¨ä»¥ä¸‹ã®æ§˜ã«ãªã‚Šã¾ã™ã€‚

![image1.gif](/images/db961d8c60cf1a/image1.gif =400x)

## onDragStart / onDragEnd / onDragMove / onDragCancel / onDragOver

`DndContext` ã«ã¯ä¸Šè¨˜ã® `onDragXXX` ã‚¤ãƒ™ãƒ³ãƒˆãŒå®šç¾©ã§ãã‚‹ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã™ã€‚

ãã‚Œãã‚Œç™ºç«ã™ã‚‹ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã¨ã—ã¦ã¯ä»¥ä¸‹ã«ãªã£ã¦ã„ã¾ã™ã€‚

- onDragStart
  - Dragæ“ä½œé–‹å§‹æ™‚
- onDragEnd
  - Dragæ“ä½œçµ‚äº†æ™‚
- onDragMove
  - Dragä¸­
- onDragCancel
  - escç­‰ã§Dragã‚­ãƒ£ãƒ³ã‚»ãƒ«ã—ãŸæ™‚
- onDragOver
  - dropå¯¾è±¡ã‚¨ãƒªã‚¢ã®ä¸Šã®Hoverã—ãŸæ™‚

![image2.gif](/images/db961d8c60cf1a/image2.gif =400x)

# Modifiers

**Modifiers**ã‚’ä½¿ç”¨ã™ã‚‹ã¨ã€Sensorã«ã‚ˆã£ã¦æ¤œå‡ºã•ã‚ŒãŸç§»å‹•åº§æ¨™ã‚’å‹•çš„ã«å¤‰æ›´ã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã‚‰ã—ã„ã€‚ä»¥ä¸‹ã®æ§˜ãªä¾‹ãŒæŒ™ã’ã‚‰ã‚Œã‚‹ã€‚

- å‹•ãã‚’1è»¸ã«åˆ¶é™ã™ã‚‹
- ãƒ‰ãƒ©ãƒƒã‚°å¯èƒ½ãªãƒãƒ¼ãƒ‰ã‚³ãƒ³ãƒ†ãƒŠã®å¤–æ¥çŸ©å½¢ã«å‹•ãã‚’åˆ¶é™ã™ã‚‹
- ãƒ‰ãƒ©ãƒƒã‚°å¯èƒ½ãªãƒãƒ¼ãƒ‰ã®ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚³ãƒ³ãƒ†ãƒŠå¢ƒç•ŒçŸ©å½¢ã«å‹•ãã‚’åˆ¶é™ã™ã‚‹
- æŠµæŠ—ã‚’åŠ ãˆã‚‹ã‹ã€å‹•ãã‚’ã‚¯ãƒ©ãƒ³ãƒ—ã™ã‚‹

åˆ¥é€” `@dnd-kit/modifiers` ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãŒå¿…è¦ã«ãªã‚Šã¾ã™ã€‚

```bash
yarn add @dnd-kit/modifiers
```

Modifiersã«ã¯å…¬å¼ã§ç”¨æ„ã—ã¦ã„ã‚‹ã‚‚ã®ã‚‚ã‚ã‚Œã°ã€ã‚«ã‚¹ã‚¿ãƒ ã™ã‚‹äº‹ã‚‚ã§ãã¾ã™ã€‚

ä»¥ä¸‹ã¯å…¬å¼ã§ç”¨æ„ã•ã‚Œã¦ã„ã‚‹Modifiersã«ãªã‚Šã¾ã™ã€‚

## restrictToVerticalAxis

ç¸¦æ–¹å‘ã«ã—ã‹Dragå¯¾è±¡ã‚’ç§»å‹•ã§ããªããªã‚‹

```tsx
import { restrictToVerticalAxis } from '@dnd-kit/modifiers';

function App() {
  return (
    <DndContext modifiers={[restrictToVerticalAxis]}>
      // ...
    </DndContext>
  );
}
```

![image3.gif](/images/db961d8c60cf1a/image3.gif =400x)

## restrictToHorizontalAxis

æ¨ªæ–¹å‘ã«ã—ã‹Dragå¯¾è±¡ã‚’ç§»å‹•ã§ããªããªã‚‹

```tsx
import { restrictToHorizontalAxis } from '@dnd-kit/modifiers';

function App() {
  return (
    <DndContext modifiers={[restrictToHorizontalAxis]}>
      // ...
    </DndContext>
  );
}
```

![image4.gif](/images/db961d8c60cf1a/image4.gif =400x)

# Sortable

åå‰ã®é€šã‚Šã€D&Dã§ä¸¦ã³æ›¿ãˆã‚’è¡Œã†æ§˜ãªå ´é¢ã§ä½¿ã„ã¾ã™ã€‚ç°¡å˜ãªã‚µãƒ³ãƒ—ãƒ«ã‚’ä½œæˆã—ã¦ã¿ã¾ã™ã€‚

ã“ã¡ã‚‰ã‚‚åˆ¥é€” `@dnd-kit/sortable` ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

```bash
yarn add @dnd-kit/sortable
```

æ–°è¦ã« `src/SortableItem.tsx` ã‚’ä»¥ä¸‹å†…å®¹ã§ä½œæˆã—ã¾ã™ã€‚

```tsx
import { useSortable } from '@dnd-kit/sortable';
import { CSS } from '@dnd-kit/utilities';

export const SortableItem = (props: { id: number }) => {
  const { attributes, listeners, setNodeRef, transform, transition } =
    useSortable({ id: props.id });

  const style = {
    width: '200px',
    height: '50px',
    color: 'black',
    backgroundColor: 'white',
    border: '1px solid black',
    transform: CSS.Transform.toString(transform),
    transition,
  };

  return (
    <div ref={setNodeRef} style={style} {...attributes} {...listeners}>
      {props.id}
    </div>
  );
};
```

æ¬¡ã« `src/App.tsx` ã‚’ä»¥ä¸‹ã«ä¿®æ­£ã—ã¾ã™ã€‚

```tsx
import {
  DndContext,
  type DragEndEvent,
  KeyboardSensor,
  PointerSensor,
  closestCenter,
  useSensor,
  useSensors,
} from '@dnd-kit/core';
import {
  SortableContext,
  arrayMove,
  sortableKeyboardCoordinates,
  verticalListSortingStrategy,
} from '@dnd-kit/sortable';
import { useState } from 'react';

import { SortableItem } from './SortableItem';

function App() {
  const [items, setItems] = useState([1, 2, 3]);
  const sensors = useSensors(
    useSensor(PointerSensor),
    useSensor(KeyboardSensor, {
      coordinateGetter: sortableKeyboardCoordinates,
    }),
  );

  return (
    <div style={{ width: '500px', height: '100vh' }}>
      <DndContext
        sensors={sensors}
        collisionDetection={closestCenter}
        onDragEnd={handleDragEnd}
      >
        <SortableContext items={items} strategy={verticalListSortingStrategy}>
          {items.map((id) => (
            <SortableItem key={id} id={id} />
          ))}
        </SortableContext>
      </DndContext>
    </div>
  );

  function handleDragEnd(event: DragEndEvent) {
    const { active, over } = event;

    if (active.id !== over?.id) {
      setItems((items) => {
        const oldIndex = items.indexOf(active.id as number);
        const newIndex = items.indexOf(over?.id as number);

        return arrayMove(items, oldIndex, newIndex);
      });
    }
  }
}

export default App;

```

ã“ã®çŠ¶æ…‹ã§å®Ÿè¡Œã™ã‚‹ã¨ã€ä»¥ä¸‹ã®æ§˜ã«D&Dã§ä¸¦ã³æ›¿ãˆãŒã§ãã‚‹æ§˜ãªUIãŒå®Ÿè£…ã§ãã¾ã™

![image5.gif](/images/db961d8c60cf1a/image5.gif =400x)

# DragOverlay

ãƒ‰ãƒ©ãƒƒã‚°æ™‚ã«åˆ¥ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’Overlayè¡¨ç¤ºã—ã¦ãã‚Œã¾ã™ã€‚å…ˆã»ã©ã®**Sortable**ã®ã‚µãƒ³ãƒ—ãƒ«ã‚’Dragæ™‚ã«Overlayè¡¨ç¤ºã™ã‚‹æ§˜ã«ã—ã¦ã¿ã¾ã™ã€‚`src/App.tsx` ã‚’ä¿®æ­£ã—ã¾ã™ã€‚

```tsx
// è¿½åŠ 
const OverlayItem = () => {
  return <div style={{ width: '200px', height: '50px', background: 'red' }} />;
};

function App() {
  // è¿½åŠ 
  const [activeId, setActiveId] = useState<UniqueIdentifier | null>(null);

  return (
    <div style={{ width: '500px', height: '100vh' }}>
      <DndContext
        sensors={sensors}
        collisionDetection={closestCenter}
        onDragStart={handleDragStart} // è¿½åŠ 
        onDragEnd={handleDragEnd}
      >
        ...
        {/* è¿½åŠ  */}
        <DragOverlay>
          {activeId ? <OverlayItem key={activeId} /> : null}
        </DragOverlay>
      </DndContext>
    </div>
  );
  // è¿½åŠ 
  function handleDragStart(event: DragEndEvent) {
    setActiveId(event.active.id);
  }
}

export default App;
```

å®Ÿè¡Œã—ã¦ã¿ã‚‹ã¨ä»¥ä¸‹ã®æ§˜ã«Dragæ™‚ã«åˆ¥ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒOverlayè¡¨ç¤ºã—ã¦ã„ã‚‹ã®ãŒåˆ†ã‹ã‚Šã¾ã™ã€‚

![image6.gif](/images/db961d8c60cf1a/image6.gif =400x)

ãŸã ğŸ‘†ã®ä¾‹ã ã¨Windowã®å¤–ã«OverloayãŒã¯ã¿å‡ºã—ã¦ã„ã¾ã™ã€‚ã“ã‚Œã‚’ã¯ã¿å‡ºã•ãªã„ã‚ˆã†ã«ã™ã‚‹ModifierãŒã‚ã‚Šã¾ã™ã€‚

## restrictToWindowEdges

å…ˆã»ã©ã® `DragOverlay` ã« `restrictToWindowEdges` ã‚’è¨­å®šã—ã¾ã™ã€‚

```tsx
<DragOverlay modifiers={[restrictToWindowEdges]}>
```

![image7.gif](/images/db961d8c60cf1a/image7.gif =400x)

ğŸ‘†ã¯ã¿å‡ºã›ãªã„æ§˜ã«ãªã£ã¦ã„ã‚‹ã®ãŒåˆ†ã‹ã‚‹ã‹ã¨æ€ã„ã¾ã™ã€‚

