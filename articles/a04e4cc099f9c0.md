---
title: "Cloudflareã®AutoRAGã§ç°¡å˜ãƒãƒ£ãƒƒãƒˆãƒœãƒƒãƒˆæ§‹ç¯‰"
emoji: "ğŸ’¬"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics:
  - "cloudflare"
  - "autorag"
  - "cloudflareworkers"
  - "ai"
  - "rag"
published: true
---
# æ¦‚è¦

ä»Šå›ã¯Cloudflareã®AutoRAGã¨ã„ã†åå‰ã®é€šã‚ŠRAGå‘¨ã‚Šã‚’è‡ªå‹•åŒ–ã—ã¦ãã‚Œã‚‹ã‚µãƒ¼ãƒ“ã‚¹ã‚’ä½¿ã£ã¦ç°¡æ˜“çš„ãªæ¤œç´¢ã‚„ã€ãƒãƒ£ãƒƒãƒˆãƒœãƒƒãƒˆã‚’Cloudflare Workers ã§ä½œã£ã¦ã¿ã¾ã—ãŸï¼

## AutoRagã¨ã¯?

https://developers.cloudflare.com/autorag/

> AutoRAGã¯Cloudflareã®å®Œå…¨ç®¡ç†å‹RAGãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã§ã€ãƒ‡ãƒ¼ã‚¿å–è¾¼â†’åˆ†å‰²â†’ãƒ™ã‚¯ãƒˆãƒ«åŒ–â†’æ¤œç´¢â†’ç”Ÿæˆã‚’ä¸€æ‹¬è‡ªå‹•åŒ–ã™ã‚‹ã€‚Vectorizeã¨Workers AIã‚’æ´»ç”¨ã—ã€æ•°åˆ†ã§è‡ªç¤¾ãƒ‡ãƒ¼ã‚¿å¯¾å¿œã®ç”ŸæˆAIã‚’æ§‹ç¯‰ã§ãã€å†ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚„ã‚¤ãƒ³ãƒ•ãƒ©é‹ç”¨ã‚‚ä¸è¦

ç¾æ™‚ç‚¹(2025å¹´6æœˆ)ã§ã¯ã¾ã ãƒ™ãƒ¼ã‚¿ç‰ˆã®çŠ¶æ…‹ã§ã€ãƒ‡ãƒ¼ã‚¿ã®å–ã‚Šè¾¼ã¿å…ˆã‚‚R2ã ã‘ã§ã™ãŒã€ã‚†ãã‚†ãã¯ã€ŒWebã‚¯ãƒ­ãƒ¼ãƒ©ãƒ¼ã€ã‚„ã€ŒD1ã€ã‹ã‚‰ã®å–ã‚Šè¾¼ã¿ã‚‚ã§ãã‚‹æ§˜ã«ãªã‚Šãã†ã§ã™ã€‚

ä½¿ã„æ–¹ã¨ã—ã¦ã¯ã€R2ã«ç”¨æ„ã—ãŸãƒ‡ãƒ¼ã‚¿ã‚’è‡ªå‹•ã§å–ã‚Šè¾¼ã‚“ã§ãƒ™ã‚¯ãƒˆãƒ«åŒ–ã—ã¦Vectorizeã«ä¿å­˜ã—ã¨ã„ã¦ãã‚Œã¦ã€ç¶™ç¶šçš„ã«ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹åŒ–ã‚’ã—ã¨ã„ã¦ãã‚Œã‚‹å„ªã‚Œã‚‚ã®ã§ã™ã€‚

## ä»Šå›å®Ÿè£…ã™ã‚‹ãƒãƒ£ãƒƒãƒˆãƒœãƒƒãƒˆã®æ§‹æˆ

ä»Šå›ã¯2ã¤ã®ç•°ãªã‚‹2ã¤ã®æ¶ç©ºã®ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã®è³ªå•ã‚’å—ã‘ä»˜ã‘ã¦ãã‚Œã‚‹ãƒãƒ£ãƒƒãƒˆãƒœãƒƒãƒˆã‚’ä½œæˆã—ã¦ã¿ãŸã„ã¨æ€ã„ã¾ã™ã€‚æ¶ç©ºã®ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã¯LLMã«è€ƒãˆã¦ã‚‚ã‚‰ã„ã¾ã—ãŸã€‚

1. **NeuroNote X**
:::details ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆè³‡æ–™

# NeuroNote X

AI ã‚’æ´»ç”¨ã—ãŸ â€œæ€è€ƒã®è‡ªå‹•æ•´ç†ãƒãƒ¼ãƒˆâ€ã€‚è„³å†…ã§æµ®ã‹ã‚“ã ã‚¢ã‚¤ãƒ‡ã‚¢ã‚„ã‚¿ã‚¹ã‚¯ã‚’ç¬æ™‚ã«ãƒ†ã‚­ã‚¹ãƒˆåŒ–ã—ã€ã‚¿ã‚°ä»˜ã‘ãƒ»è¦ç´„ãƒ»é–¢é€£ä»˜ã‘ã¾ã§è¡Œã†ã“ã¨ã§ **ã€Œè€ƒãˆã‚‹æ™‚é–“ã‚’å‰µé€ ã™ã‚‹ã€** æ¬¡ä¸–ä»£ãƒãƒ¼ãƒˆã‚¢ãƒ—ãƒªã§ã™ã€‚

---

## ç›®æ¬¡

1. è£½å“æ¦‚è¦
2. ä¸»ãªæ©Ÿèƒ½
3. ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£
4. ä»•æ§˜
5. å°å…¥æ–¹æ³•
6. ã‚ˆãã‚ã‚‹è³ªå•ï¼ˆFAQï¼‰
7. ãƒ©ã‚¤ã‚»ãƒ³ã‚¹
8. æ–™é‡‘ãƒ—ãƒ©ãƒ³

---

## 1. è£½å“æ¦‚è¦

- **ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆå**ï¼šNeuroNote X
- **ã‚«ãƒ†ã‚´ãƒª**ï¼šAI ãƒãƒ¼ãƒˆ / çŸ¥çš„ç”Ÿç”£æ”¯æ´ãƒ„ãƒ¼ãƒ«
- **ã‚¿ãƒ¼ã‚²ãƒƒãƒˆ**ï¼šç ”ç©¶è€…ãƒ»é–‹ç™ºè€…ãƒ»ã‚¯ãƒªã‚¨ã‚¤ã‚¿ãƒ¼ãƒ»ãƒ“ã‚¸ãƒã‚¹ãƒ‘ãƒ¼ã‚½ãƒ³
- **ã‚³ã‚¢ä¾¡å€¤**
  - â€œé ­ã®ä¸­â€ ã‚’å³åº§ã«ãƒ‡ã‚¸ã‚¿ãƒ«åŒ–ã—ã€é–¢é€£æƒ…å ±ã‚’è‡ªå‹•ã§çµã³ã¤ã‘ã‚‹
  - æ›¸ããƒ»æ¢ã™ãƒ»æ•´ç†ã™ã‚‹æ™‚é–“ã‚’å¤§å¹…ã«å‰Šæ¸›
  - æ€è€ƒã®è»Œè·¡ã‚’å¯è¦–åŒ–ã—ã€å†ç™ºè¦‹ã‚„ç™ºæƒ³è»¢æ›ã‚’ä¿ƒé€²

---

## 2. ä¸»ãªæ©Ÿèƒ½

### 2.1 ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ éŸ³å£°ã‚­ãƒ£ãƒ—ãƒãƒ£

- ãƒã‚¤ã‚¯ã‚„ã‚¦ã‚§ã‚¢ãƒ©ãƒ–ãƒ«ç«¯æœ«çµŒç”±ã§éŸ³å£°ã‚’å¸¸æ™‚å¾…æ©Ÿ
- ãƒã‚¤ã‚ºæŠ‘åˆ¶ã¨å€‹äººè¾æ›¸ã«ã‚ˆã‚Šé«˜ç²¾åº¦ã§æ–‡å­—èµ·ã“ã—

### 2.2 ã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯è¦ç´„

- Transformer ãƒ™ãƒ¼ã‚¹ã®ãƒ¢ãƒ‡ãƒ«ã§æ–‡è„ˆã‚’ä¿ã£ãŸ 3 è¡Œã‚µãƒãƒªãƒ¼ç”Ÿæˆ
- â€œç›®çš„åˆ¥è¦ç´„â€ ãƒ—ãƒªã‚»ãƒƒãƒˆï¼ˆãƒ¡ãƒ¼ãƒ«å‘ã‘ï¼ãƒ–ãƒ­ã‚°å‘ã‘ ç­‰ï¼‰ã‚’ç”¨æ„

### 2.3 ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆãƒªãƒ³ã‚¯

- Embedding ã§é¡ä¼¼åº¦ã‚’è¨ˆç®—ã—ã€éå»ãƒãƒ¼ãƒˆã‚„å¤–éƒ¨è³‡æ–™ã‚’è‡ªå‹•ãƒ¬ã‚³ãƒ¡ãƒ³ãƒ‰
- â€œã²ã‚‰ã‚ããƒ„ãƒªãƒ¼â€ ãƒ“ãƒ¥ãƒ¼ã§é–¢é€£ãƒãƒ¼ãƒˆã‚’ã‚°ãƒ©ãƒ•è¡¨ç¤º

### 2.4 ã‚¿ã‚¹ã‚¯æŠ½å‡º & ãƒªãƒã‚¤ãƒ³ãƒ‰

- â€œTODO:â€ ã‚„ã€Œã€œã—ãªã‘ã‚Œã°ã€ã‚’æ¤œçŸ¥ã—ã¦ã‚¿ã‚¹ã‚¯åŒ–
- æœŸé™ã‚’æ¨å®šã—ã€ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ï¼Slackï¼ãƒ¡ãƒ¼ãƒ«ã¸é€šçŸ¥

### 2.5 ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒ¢ãƒ¼ãƒ‰

- ã‚ªãƒ•ãƒ©ã‚¤ãƒ³æ¨è«–å¯¾å¿œï¼ˆM2 Mac & Win on-deviceï¼‰
- ã‚¼ãƒ­çŸ¥è­˜æš—å·åŒ–ã§ã‚µãƒ¼ãƒåŒæœŸæ™‚ã‚‚å†…å®¹ã‚’ç§˜åŒ¿

---

## 3. ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

```mermaid
graph TD
  A[å…¥åŠ›: éŸ³å£° / ãƒ†ã‚­ã‚¹ãƒˆ] --> B[Transcription Service]
  B --> C[Embedding Generator]
  C --> D[Vector DB]
  C --> E[Summarizer LLM]
  D --> F[Context Linker]
  E --> G[Note Store]
  F --> G
  G --> H[Frontend]
```

- **LLM**ï¼šç¤¾å†…ãƒ•ã‚¡ã‚¤ãƒ³ãƒãƒ¥ãƒ¼ãƒ‹ãƒ³ã‚°ã—ãŸ 7 B ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«
- **DB**ï¼šPostgreSQL 15ã€èªå½™æ¤œç´¢ã¯ pgvector æ‹¡å¼µ
- **ã‚¤ãƒ³ãƒ•ãƒ©**ï¼šKubernetesï¼ˆGKEï¼‰ï¼‹ Cloud SQL ï¼‹ Cloud Storage
- **ã‚¨ãƒƒã‚¸**ï¼šCloudflare Workers ã§ CDN & èªè¨¼

---

## 4. ä»•æ§˜

| é …ç›® | å†…å®¹ |
| --- | --- |
| å¯¾å¿œ OS | macOS 12+, Windows 11, iOS 17+, Android 14+ |
| ãƒ‡ãƒ¼ã‚¿å®¹é‡åˆ¶é™ | 1 TBï¼ãƒ¦ãƒ¼ã‚¶ãƒ¼ï¼ˆãƒ—ãƒ¬ãƒŸã‚¢ãƒ ï¼‰ |
| åŒæœŸé€Ÿåº¦ç›®å®‰ | å¹³å‡ 150 msï¼ˆå›½å†…ï¼‰ã€220 msï¼ˆæµ·å¤–ï¼‰ |
| éŸ³å£°å…¥åŠ›å¯¾å¿œè¨€èª | æ—¥æœ¬èªãƒ»è‹±èªãƒ»ä¸­å›½èªï¼ˆç°¡ä½“ï¼‰ãƒ»ã‚¹ãƒšã‚¤ãƒ³èª |
| API ãƒ¬ãƒ¼ãƒˆåˆ¶é™ | 100 req/minï¼ˆFreeï¼‰ã€ç„¡åˆ¶é™ï¼ˆEnterpriseï¼‰ |

---

## 5. å°å…¥æ–¹æ³•

1. å…¬å¼ã‚µã‚¤ãƒˆã‹ã‚‰ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ©ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
2. ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆå¾Œã€**è¨­å®š â†’ å€‹äººè¾æ›¸** ã«æ¥­ç•Œç”¨èªã‚’ç™»éŒ²
3. ãƒ‡ãƒã‚¤ã‚¹ã¨ãƒã‚¤ã‚¯ã¸ã®æ¨©é™ã‚’è¨±å¯
4. â€œã‚­ãƒ£ãƒ—ãƒãƒ£é–‹å§‹â€ ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦åˆ©ç”¨é–‹å§‹

> Tip: ã‚ªãƒ•ãƒ©ã‚¤ãƒ³æ¨è«–å°‚ç”¨ãƒ¢ãƒ‡ãƒ«ã¯ã€Œè¨­å®š â†’ AI ã‚¨ãƒ³ã‚¸ãƒ³ â†’ ãƒ­ãƒ¼ã‚«ãƒ«ãƒ¢ãƒ‡ãƒ«ã‚’å„ªå…ˆã€ã§åˆ‡æ›¿ã€‚

---

## 6. ã‚ˆãã‚ã‚‹è³ªå•ï¼ˆFAQï¼‰

**Q1. ãƒ‡ãƒ¼ã‚¿ã¯ã©ã“ã«ä¿å­˜ã•ã‚Œã¾ã™ã‹ï¼Ÿ**

A. æ—¥æœ¬ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã® Cloud Storage ã«æš—å·åŒ–ï¼ˆAES-256ï¼‰ã—ã¦ä¿å­˜ã•ã‚Œã¾ã™ã€‚ã‚ªãƒ³ãƒ—ãƒ¬å¯¾å¿œã‚‚å¯èƒ½ã§ã™ã€‚

**Q2. å€‹äººæƒ…å ±ãŒãƒ¢ãƒ‡ãƒ«å­¦ç¿’ã«ä½¿ã‚ã‚Œã‚‹ã“ã¨ã¯ï¼Ÿ**

A. ã‚ã‚Šã¾ã›ã‚“ã€‚å­¦ç¿’ç”¨ã«ä½¿ç”¨ã™ã‚‹å ´åˆã¯åŒ¿ååŒ–ã‚ªãƒ—ãƒˆã‚¤ãƒ³åˆ¶ã‚’æ¡ç”¨ã—ã¦ã„ã¾ã™ã€‚

**Q3. ãƒãƒ¼ãƒ å…±æœ‰ã¯ã§ãã¾ã™ã‹ï¼Ÿ**

A. Enterprise ãƒ—ãƒ©ãƒ³ã§ãƒãƒ¼ãƒˆå…±æœ‰ãƒ»å…±åŒç·¨é›†ãŒåˆ©ç”¨å¯èƒ½ã§ã™ã€‚

---

## 7. ãƒ©ã‚¤ã‚»ãƒ³ã‚¹

NeuroNote X ã¯ **EULA-NND v2.3** ã«åŸºã¥ãæä¾›ã•ã‚Œã¾ã™ã€‚è©³ç´°ã¯ `/LICENSE` ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

---

## 8. æ–™é‡‘ãƒ—ãƒ©ãƒ³

| ãƒ—ãƒ©ãƒ³ | æœˆé¡ (JPY) | ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ | æ©Ÿèƒ½åˆ¶é™ |
| --- | --- | --- | --- |
| Free | 0 | 5 GB | 1 ãƒ‡ãƒã‚¤ã‚¹ / API 30 req/min |
| Pro | 980 | 100 GB | å…¨æ©Ÿèƒ½ãƒ»5 ãƒ‡ãƒã‚¤ã‚¹ |
| Premium | 2,480 | 1 TB | ãƒ­ãƒ¼ã‚«ãƒ«æ¨è«–ãƒ¢ãƒ‡ãƒ« / å„ªå…ˆã‚µãƒãƒ¼ãƒˆ |
| Enterprise | ãŠå•ã„åˆã‚ã› | ç„¡åˆ¶é™ | SSO / SLA 99.9 % / å°‚ç”¨ã‚µãƒ¼ãƒ |

:::

2. **HoloMeet Pro**
:::details ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆè³‡æ–™

# HoloMeet Pro

- ã€Œè·é›¢ã‚¼ãƒ­ã®å…±åŒä½œæ¥­ã€ã‚’å®Ÿç¾ã™ã‚‹ã€æ¬¡ä¸–ä»£ã® *ARï¼MR ã‚³ãƒ©ãƒœãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ»ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã€‚

ç‰©ç†ç©ºé–“ã« 3D ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚„ãƒ›ãƒ¯ã‚¤ãƒˆãƒœãƒ¼ãƒ‰ã‚’æŠ•å½±ã—ãªãŒã‚‰ã€é›¢ã‚ŒãŸç›¸æ‰‹ã¨ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§è¨­è¨ˆãƒ»ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ»ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã‚’è¡Œãˆã¾ã™ã€‚

---

## ç›®æ¬¡

1. è£½å“æ¦‚è¦
2. ä¸»ãªæ©Ÿèƒ½
3. ã‚·ã‚¹ãƒ†ãƒ æ§‹æˆ
4. æŠ€è¡“ä»•æ§˜
5. å°å…¥æ‰‹é †
6. FAQ
7. ãƒ©ã‚¤ã‚»ãƒ³ã‚¹
8. æ–™é‡‘ãƒ—ãƒ©ãƒ³

---

## 1. è£½å“æ¦‚è¦

| é …ç›® | å†…å®¹ |
| --- | --- |
| ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆå | **HoloMeet Pro** |
| ã‚«ãƒ†ã‚´ãƒª | AR/MR ã‚³ãƒ©ãƒœãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ SaaS |
| æƒ³å®šãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ | è£½é€ ãƒ©ã‚¤ãƒ³è¨­è¨ˆãƒ»å»ºç¯‰ BIM ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ»é éš”åŒ»ç™‚ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ãƒ»æ•™è‚²å®Ÿç¿’ |
| æä¾›å½¢æ…‹ | ã‚¯ãƒ©ã‚¦ãƒ‰ï¼‹ã‚¨ãƒƒã‚¸ï¼ˆã‚ªãƒ³ãƒ—ãƒ¬æ§‹æˆã‚‚å¯ï¼‰ |
| ã‚³ã‚¢ãƒãƒªãƒ¥ãƒ¼ | è¶…ä½é…å»¶ 3D åŒæœŸãƒ»ç©ºé–“ã‚¢ãƒ³ã‚«ãƒ¼å…±æœ‰ãƒ»ãƒãƒ«ãƒãƒ‡ãƒã‚¤ã‚¹ç›¸äº’é‹ç”¨ |

---

## 2. ä¸»ãªæ©Ÿèƒ½

### 2.1 ãƒãƒ«ãƒãƒ‡ãƒã‚¤ã‚¹ç©ºé–“å…±æœ‰

- Meta Quest / HoloLens / iPad LiDAR / WebXR ãƒ–ãƒ©ã‚¦ã‚¶ã«åŒä¸€ã‚»ãƒƒã‚·ãƒ§ãƒ³ã§å‚åŠ 
- **Spatial Anchor v2** ã§èª¤å·® â‰¤ 5 mm ã®ä½ç½®åˆã‚ã›

### 2.2 ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ– 3D ãƒ›ãƒ¯ã‚¤ãƒˆãƒœãƒ¼ãƒ‰

- ãƒœã‚¯ã‚»ãƒ«ãƒ»ãƒ¡ãƒƒã‚·ãƒ¥æç”»ã«å¯¾å¿œ
- æ‰‹æãç·šã¨ 3D ãƒ¢ãƒ‡ãƒ«ã®è¡çªã‚’è‡ªå‹•è£œæ­£

### 2.3 è‡ªå‹•ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†

- ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã”ã¨ã« Git-like å·®åˆ†ç®¡ç†ï¼ˆglTF + JSONï¼‰
- ã€Œæ™‚é–“å·»ãæˆ»ã—ã€ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ã§å¤‰æ›´ç‚¹ã‚’å¯è¦–åŒ–

### 2.4 ã‚¸ã‚§ã‚¹ãƒãƒ£ãƒ¼ç¿»è¨³ & éŸ³å£°å­—å¹•

- éª¨æ ¼ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°ã§èº«æŒ¯ã‚Šã‚’ãƒ†ã‚­ã‚¹ãƒˆã«å¤‰æ› â†’ ç¿»è¨³å­—å¹•ã‚’ AR ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤
- 37 è¨€èªå¯¾å¿œã€å¹³å‡ãƒ¬ã‚¤ãƒ†ãƒ³ã‚· 280 ms

### 2.5 ç§˜åŒ¿å…±æœ‰ãƒ¢ãƒ¼ãƒ‰

- E2EE + ãƒ›ãƒ¢ãƒ¢ãƒ«ãƒ•ã‚£ãƒƒã‚¯æš—å·ã§ã‚¯ãƒ©ã‚¦ãƒ‰å´ã«ãƒ¢ãƒ‡ãƒ«ã‚’å¾©å·ã•ã›ãªã„è¨­è¨ˆ
- è»äº‹ãƒ»åŒ»ç™‚å‘ã‘ã‚³ãƒ³ãƒ—ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹ï¼ˆHIPAAï¼ITARï¼‰ã‚ªãƒ—ã‚·ãƒ§ãƒ³

---

## 3. ã‚·ã‚¹ãƒ†ãƒ æ§‹æˆ

```mermaid
flowchart LR
  subgraph Edge
    A[AR/MR ãƒ‡ãƒã‚¤ã‚¹] -->|WebRTC| B(HoloEdge Node)
  end
  B -->|gRPC| C(HoloMeet Cloud)
  C --> D[Redis Cluster]
  C --> E[Object Store]
  C --> F[Auth Service]
  D --> G[Analytics & ML]
  E --> G

```

- **ä½é…å»¶é€šä¿¡**: WebRTC + QUICï¼ˆå¹³å‡ RTT 45 ms æ—¥æœ¬å›½å†…ï¼‰
- **3D ãƒ‡ãƒ¼ã‚¿**: glTF / USDZ / IFC å¤‰æ›ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³å†…è”µ
- **æ‹¡å¼µæ€§**: ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ SDKï¼ˆTypeScript / Rust FFIï¼‰ã§ UI æ‹¡å¼µå¯èƒ½

## 4. æŠ€è¡“ä»•æ§˜

| åŒºåˆ† | å†…å®¹ |
| --- | --- |
| åŒæœŸã‚¹ã‚±ãƒ¼ãƒ« | æœ€å¤§ 50 ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ / ã‚»ãƒƒã‚·ãƒ§ãƒ³ |
| ç©ºé–“è§£åƒåº¦ | 0.5 cm ãƒœã‚¯ã‚»ãƒ«ãƒ»64 å±¤æ·±åº¦ãƒãƒƒãƒ— |
| æ¨è«–ãƒ¢ãƒ‡ãƒ« | JetStream-AR (1.1 B params) |
| ãƒ‡ãƒ¼ã‚¿ä¿æŒæœŸé–“ | 90 æ—¥ï¼ˆFreeï¼‰ï¼ 3 å¹´ï¼ˆEnterpriseï¼‰ |
| API ãƒ¬ãƒ¼ãƒˆåˆ¶é™ | 150 req/minï¼ˆFreeï¼‰ãƒ»ç„¡åˆ¶é™ï¼ˆPaidï¼‰ |
| ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ | ISO / IEC 27001ãƒ»SOC 2 Type II æº–æ‹  |

---

## 5. å°å…¥æ‰‹é †

1. å…¬å¼ã‚µã‚¤ãƒˆ ã§çµ„ç¹”ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆ
2. **HoloEdge Node** ã‚’ã‚ªãƒ³ãƒ—ãƒ¬ or VMï¼ˆUbuntu 22.04ï¼‰ã¸ `curl | bash` ã§ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
3. ç®¡ç†ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã§ **ãƒ‡ãƒã‚¤ã‚¹ç™»éŒ² QR** ã‚’ç™ºè¡Œã—ã€å„ãƒ‡ãƒã‚¤ã‚¹ã§èª­ã¿è¾¼ã‚€
4. **ã€Œæ–°è¦ã‚»ãƒƒã‚·ãƒ§ãƒ³ â†’ ç©ºé–“ã‚¹ã‚­ãƒ£ãƒ³é–‹å§‹ã€** ã‚’ã‚¿ãƒƒãƒ—ã—ã¦åˆ©ç”¨é–‹å§‹

> Tip: Edge Node ã‚’è¨­ç½®ã§ããªã„å ´åˆã¯ã€Cloud Relay ãƒ¢ãƒ¼ãƒ‰ã«åˆ‡æ›¿ãˆå¯èƒ½ã§ã™ã€‚

---

## 6. FAQ

**Q1. HoloLens 1 ã¯ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã¾ã™ã‹ï¼Ÿ**

A. ç¾è¡Œ v2.3 ä»¥é™ã¯ HoloLens 2 ä»¥ä¸ŠãŒå¯¾è±¡ã§ã™ã€‚æ—§ãƒ‡ãƒã‚¤ã‚¹å‘ã‘ã«ã¯ LTS ç‰ˆ v1.9 ã‚’ã”åˆ©ç”¨ãã ã•ã„ã€‚

**Q2. ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ã§ä½¿ãˆã¾ã™ã‹ï¼Ÿ**

A. Edge Node ã¨åŒä¸€ LAN å†…ã§ã‚ã‚Œã°ã‚¯ãƒ©ã‚¦ãƒ‰æ¥ç¶šãªã—ã§ã‚‚ã‚»ãƒƒã‚·ãƒ§ãƒ³ãŒæˆç«‹ã—ã¾ã™ã€‚

**Q3. CAD ãƒ•ã‚¡ã‚¤ãƒ«ã¯èª­ã¿è¾¼ã‚ã¾ã™ã‹ï¼Ÿ**

A. STEPï¼IGES ã‚’ã‚µãƒ¼ãƒå´ã§ glTF ã¸å¤‰æ›ã—ã€ç¸®å°ºã‚’ä¿æŒã—ãŸã¾ã¾è¡¨ç¤ºã§ãã¾ã™ã€‚

---

## 7. ãƒ©ã‚¤ã‚»ãƒ³ã‚¹

HoloMeet Pro ã¯ **Commercial Source License v1.4** ã®ä¸‹ã§æä¾›ã•ã‚Œã¾ã™ã€‚è©³ç´°ã¯ `/LICENSE` ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

---

## 8. æ–™é‡‘ãƒ—ãƒ©ãƒ³

| ãƒ—ãƒ©ãƒ³ | æœˆé¡ (JPY) | Edge Node | ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ | åŒæœŸä¸Šé™ | ã‚µãƒãƒ¼ãƒˆ |
| --- | --- | --- | --- | --- | --- |
| Free | 0 | 0 | 5 GB | 5 äºº | ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã®ã¿ |
| Team | 8,800 | 1 | 200 GB | 20 äºº | ãƒ¡ãƒ¼ãƒ« & ãƒãƒ£ãƒƒãƒˆ |
| Business | 29,800 | 3 | 2 TB | 50 äºº | 6 h SLA |
| Enterprise | ãŠå•ã„åˆã‚ã› | ç„¡åˆ¶é™ | ç„¡åˆ¶é™ | ç„¡åˆ¶é™ | 24 h Ã— 365 é›»è©± |

:::

![image1.png](/images/a04e4cc099f9c0/image1.png)

# æº–å‚™

## R2ãƒã‚±ãƒƒãƒˆã®ä½œæˆ

Cloudflareã®ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã‹ã‚‰ã€ŒR2 ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã€>ã€Œãƒã‚±ãƒƒãƒˆã‚’ä½œæˆã™ã‚‹ã€ã‹ã‚‰AutoRagã®å–ã‚Šè¾¼ã¿å…ˆã®ãƒã‚±ãƒƒãƒˆã‚’ç”¨æ„ã—ã¨ãã¾ã™ã€‚ä»Šå›ã¯ `autorag-chatbot-ex` ã¨ã„ã†åå‰ã§ä½œæˆã—ã¾ã—ãŸã€‚

![image2.png](/images/a04e4cc099f9c0/image2.png)

## ãƒ‡ãƒ¼ã‚¿ã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰

https://developers.cloudflare.com/autorag/how-to/multitenancy/

AutoRAGã¯ãƒãƒ«ãƒãƒ†ãƒŠãƒ³ãƒˆã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã¾ã™ã€‚

> ãƒ†ãƒŠãƒ³ãƒˆã”ã¨ã«ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’ã‚»ã‚°ãƒ¡ãƒ³ãƒˆåŒ–ã™ã‚‹ã“ã¨ã§ãƒãƒ«ãƒãƒ†ãƒŠãƒ³ãƒˆã‚’ã‚µãƒãƒ¼ãƒˆã—ã€å„ãƒ¦ãƒ¼ã‚¶ãƒ¼ã€é¡§å®¢ã€ã¾ãŸã¯ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹ã¯è‡ªèº«ã®ãƒ‡ãƒ¼ã‚¿ã«ã®ã¿ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚ã“ã‚Œã¯é€šå¸¸ã€ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ãƒ†ãƒŠãƒ³ãƒˆã”ã¨ã®ãƒ•ã‚©ãƒ«ãƒ€ã«æ•´ç†ã—ã€ã‚¯ã‚¨ãƒªæ™‚ã«ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚’é©ç”¨ã™ã‚‹ã“ã¨ã§å®Ÿç¾ã•ã‚Œã¾ã™

å¼•ç”¨ã«ã‚‚ã‚ã‚‹é€šã‚Šã€ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ãƒ†ãƒŠãƒ³ãƒˆæ¯ã®ãƒ•ã‚©ãƒ«ãƒ€ã«æ•´ç†ã—ã€ã‚¯ã‚¨ãƒªæ™‚ã«ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‹ã‘ã‚‹ã“ã¨ã§å®Ÿç¾ã§ãã¾ã™ã€‚

ãã“ã§ä»Šå›ã¯å…ˆã»ã©ã®2ã¤ã®æ¶ç©ºã®ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆæ¯ã«ãƒ•ã‚©ãƒ«ãƒ€ã‚’ä½œæˆã—ã€ãã®ä¸­ã«ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ä½œæˆã—ã¾ã™ã€‚æ‰‹å…ƒã®PCã§ä»¥ä¸‹ã®æ§‹é€ ã§ãƒ•ã‚©ãƒ«ãƒ€ã¨å…ˆã»ã©ã®LLMãŒè€ƒãˆã¦ãã‚ŒãŸãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’è¨­ç½®ã—ã€å„ãƒ•ã‚©ãƒ«ãƒ€ã‚’R2ã¸ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¾ã™ã€‚

```bash
 .
 â”œâ”€ NeuroNote_X
 â”‚  â””â”€ OVERVIEW.md
 â””â”€ HoloMeet_Pro
    â””â”€ OVERVIEW.md
```

ğŸ‘‡ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã•ã‚ŒãŸæ§˜å­

![image3.png](/images/a04e4cc099f9c0/image3.png)

ä¸€æ—¦ã“ã‚Œã§ãƒ‡ãƒ¼ã‚¿ã®æº–å‚™ãŒã§ãã¾ã—ãŸï¼

# AutoRAGã‚’ä½œæˆãƒ»è¨­å®šã™ã‚‹

æ¬¡ã«ã„ã‚ˆã„ã‚ˆãƒ¡ã‚¤ãƒ³ã®AutoRAGã‚’ä½œæˆã—ã¦ã„ãã¾ã™ã€‚Cloudflareãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã§ã‚µã‚¤ãƒ‰ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã®ã€ŒAIã€>ã€ŒAutoRAGã€ã‹ã‚‰ã€ŒAutoRAGã‚’ä½œæˆã™ã‚‹ã€ã‚’é¸æŠã—ã¾ã™ã€‚

![image4.png](/images/a04e4cc099f9c0/image4.png)

ã€Œãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹ã‚’æ¥ç¶šã™ã‚‹ã€ã§å…ˆã»ã©ä½œæˆã—ãŸãƒã‚±ãƒƒãƒˆã‚’é¸æŠã—ã¾ã™ã€‚

![image5.png](/images/a04e4cc099f9c0/image5.png)

ã€Œã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’ä½œæˆã™ã‚‹ã€ã§ãƒ¢ãƒ‡ãƒ«ã‚’é¸æŠã—ã¾ã™ã€‚

![image6.png](/images/a04e4cc099f9c0/image6.png)

ç¾æ™‚ç‚¹(2025å¹´7æœˆ)ã§ã¯ä»¥ä¸‹ã®2ã¤ã®ä¸­ã‹ã‚‰ã—ã‹é¸ã¹ãªã„æ§˜ã§ã™ã€‚

| é …ç›® | **bge-m3** | **bge-large-en-v1.5** |
| --- | --- | --- |
| å¯¾å¿œè¨€èª | 100 ä»¥ä¸Šã®å¤šè¨€èª | è‹±èªã®ã¿ |
| æœ€å¤§å…¥åŠ›ãƒˆãƒ¼ã‚¯ãƒ³ | 8192 tokens | 512 tokens |
| å‡ºåŠ›ãƒ™ã‚¯ãƒˆãƒ«æ¬¡å…ƒ | 1 024 dims | 1 024 dims |
| æ¨å®šãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿æ•° | â‰ˆ 568 M params | â‰ˆ 335 M params |
| æ–™é‡‘ (å…¥åŠ› 100 ä¸‡ tokens) | **US $ 0.012**â€‚(æœ€å®‰) | **US $ 0.204** |
| 1 åˆ†ã‚ãŸã‚Š RPS ä¸Šé™ | 3 000 rpm (Text Embeddings ã®æ—¢å®š) | 1 500 rpm (å€‹åˆ¥åˆ¶é™) |
| ä¸»ãªå¼·ã¿ | Denseï¼‹Sparseï¼‹Multi-vector ã‚’å˜ä¸€ãƒ¢ãƒ‡ãƒ«ã§æä¾›ã€‚é•·æ–‡ RAGãƒ»å¤šè¨€èªæ¤œç´¢ã«æœ€é©ã€‚ | è‹±èªãƒ‰ãƒ¡ã‚¤ãƒ³ã§é«˜ç²¾åº¦ã®æ¤œç´¢ï¼ã‚¯ãƒ©ã‚¹ã‚¿ãƒªãƒ³ã‚°ã€‚æ—¢å­˜ RAG ä¾‹ãŒå¤šãå°å…¥å®¹æ˜“ã€‚ |
| ä¸»ãªå¼±ã¿ | ãƒ¢ãƒ‡ãƒ«ãŒå¤§ããè‹±èªå˜ç‹¬ã®ç²¾åº¦ã¯ v1.5 ã«åŠã°ãªã„ã‚±ãƒ¼ã‚¹ã‚ã‚Šã€‚ | ãƒˆãƒ¼ã‚¯ãƒ³ä¸Šé™ãŒçŸ­ãå¤šè¨€èªéå¯¾å¿œã€æ–™é‡‘ãŒé«˜ã‚ã€‚ |

ä»Šå›ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ( `bge-m3` )ã‚’é¸æŠã—ã¾ã—ãŸã€‚ã¾ãŸãƒãƒ£ãƒ³ã‚¯é–¢é€£ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®šã®ã¾ã¾ã«ã—ã¦ã¾ã™ã€‚

æ¬¡ã«ã€Œ**å–å¾—ã¨ç”Ÿæˆã‚’æ§‹æˆã™ã‚‹**ã€ã§ã¯Worker AIä¸Šã§Vectorizeã‹ã‚‰ã®ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ã¨ã€ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’ç”Ÿæˆã™ã‚‹ãƒ¢ãƒ‡ãƒ«ã‚’é¸æŠã—ã¾ã™ã€‚ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã® `@cf/meta/llama-3.3-70b-instruct-fp8-fast` ã‚’é¸æŠã—ã¾ã—ãŸã€‚

![image7.png](/images/a04e4cc099f9c0/image7.png)

ã¡ãªã¿ã«ç¾æ™‚ç‚¹(2025å¹´6æœˆ)è¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹ãƒ¢ãƒ‡ãƒ«ã®æ¦‚è¦ã¯ä»¥ä¸‹ã«ãªã‚Šã¾ã™ã€‚

| ãƒ¢ãƒ‡ãƒ« | æœ€å¤§ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆé•· | Batch / Function Call | æ–™é‡‘(USD / 1 M tokens) | ä»£è¡¨ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ |
| --- | --- | --- | --- | --- |
| **@cf/meta/llama-3.3-70b-instruct-fp8-fast** | 24,000 tokens | âœ… / âœ…  | $0.29 per M input tokens, $2.25 per M output tokens | é«˜ç²¾åº¦ãƒãƒ£ãƒƒãƒˆã€å°‘é‡ but é«˜å“è³ª RAG |
| **@cf/meta/llama-3.1-8b-instruct-fast** | 128,000 tokens | *æœªæ²è¼‰* | *æœªæ²è¼‰* | è¶…é•·æ–‡ãƒãƒ£ãƒƒãƒˆã€å¤šè¨€èª FAQ ãƒœãƒƒãƒˆ |
| **@cf/meta/llama-3.1-8b-instruct-fp8** | 32,000 tokens | *æœªæ²è¼‰* | $0.15 per M input tokens, $0.29 per M output tokens | ä½ã‚³ã‚¹ãƒˆ Q&Aã€ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ è£œåŠ© |
| **@cf/meta/llama-4-scout-17b-16e-instruct** | 131,000 tokens | âœ… / âœ… | $0.27 per M input tokens, $0.85 per M output tokens | ç”»åƒä»˜ããƒãƒ£ãƒƒãƒˆã€100 k+ è¦ç´„ï¼åˆ†æ |

:::message
ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã§ã¯ã‚¯ã‚¨ãƒªæ™‚ã«ãƒ¢ãƒ‡ãƒ«ã‚’æŒ‡å®šã§ãã‚‹ã‚ˆã†ãªã‚ªãƒ—ã‚·ãƒ§ãƒ³ãŒæ›¸ã‹ã‚Œã¦ã„ã¾ã™ãŒ `wrangler: 4.23.0` ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã§ã¯ `wrangler types` ã§ç”Ÿæˆã—ãŸ `worker-configuration.d.ts` ã«ã¯ãã‚“ãªã‚ªãƒ—ã‚·ãƒ§ãƒ³ãŒå­˜åœ¨ã—ã¾ã›ã‚“ã§ã—ãŸã€‚(ã“ã“ã‚‰è¾ºåˆ†ã‹ã‚‹æ–¹æ•™ãˆã¦ã‚‚ã‚‰ãˆã‚‹ã¨åŠ©ã‹ã‚Šã¾ã™)

[Workers Binding](https://developers.cloudflare.com/autorag/usage/workers-binding/#aisearch)
:::

ã¾ãŸã€Workers AI ãŒç”¨æ„ã—ã¦ã„ã‚‹ãƒ¢ãƒ‡ãƒ«ã ã‘ã§ãªãã€ãƒ¬ã‚¹ãƒãƒ³ã‚¹ç”Ÿæˆæ™‚ã«ä½¿ç”¨ã™ã‚‹ãƒ¢ãƒ‡ãƒ«ã«é–¢ã—ã¦ã¯ä»–ã®ãƒ¢ãƒ‡ãƒ«(ä¾‹ OpenAIã®ãƒ¢ãƒ‡ãƒ«ãªã©) ã‚’ä½¿ç”¨ã§ãã¾ã™ã€‚

https://developers.cloudflare.com/autorag/how-to/bring-your-own-generation-model/

ä»–ã®é …ç›®ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ã¾ã¾ã§ã€Œæ¬¡ã¸ã€ã‚’é¸æŠã—ã€AutoRagã®åå‰ã‚’è¨­å®šã—ä»–ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ã¾ã¾ã€Œä½œæˆã€ã—ã¾ã™ã€‚åå‰ã¯ä»Šå›ã¯ `autorag-chatbot-ex` ã«ã—ã¾ã—ãŸã€‚

![image8.png](/images/a04e4cc099f9c0/image8.png)

ä½œæˆãŒå®Œäº†ã™ã‚‹ã¨ä»¥ä¸‹ã®æ§˜ã«ã€ŒVector Databaseã€ãŒä½œæˆã•ã‚Œè‡ªå‹•ã§R2ãƒã‚±ãƒƒãƒˆã«æŒ‡å®šã—ãŸãƒ‡ãƒ¼ã‚¿ãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã¾ã™ã€‚

![image9.png](/images/a04e4cc099f9c0/image9.png)

ã“ã®å¾Œã«R2ãƒã‚±ãƒƒãƒˆã«ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®æ›´æ–°ãŒã‚ã‚Œã°å®šæœŸçš„ã«ç›£è¦–ã—ã¦ãã‚Œã¦ã€è‡ªå‹•ã§ã€ŒVector Databaseã€ãŒæ›´æ–°ã•ã‚Œã¾ã™ã€‚

# ãƒ—ãƒ¬ã‚¤ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§è©¦ã—ã¦ã¿ã‚‹

AutoRAGã«ã¯ãƒ—ãƒ¬ã‚¤ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ãŒã‚ã‚‹ã®ã§åæ˜ ã•ã‚Œã¦ã„ã‚‹ã‹è»½ãç¢ºã‹ã‚ã¦ã¿ã¾ã™ã€‚

![image10.png](/images/a04e4cc099f9c0/image10.png)

â€» ã¡ãªã¿ã«ã€ŒNeuroNote Xã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚ã€ã®ãƒªãƒ³ã‚¯å…ˆã¯ä½•ã‚‚è¦‹ã‚Œã¾ã›ã‚“ã§ã—ãŸã€‚

![image11.png](/images/a04e4cc099f9c0/image11.png)

ã¡ã‚ƒã‚“ã¨ãƒ‡ãƒ¼ã‚¿ã¯åæ˜ ã•ã‚Œã¦ã„ãã†ã§ã™ï¼

# ã‚¢ãƒ—ãƒªã‚’å®Ÿè£…ã™ã‚‹

æ¬¡ã«ãƒãƒ£ãƒƒãƒˆãƒœãƒƒãƒˆã§å…ˆã»ã©ä½œæˆã—ãŸAutoRAGã¨ã‚„ã‚Šã¨ã‚Šã™ã‚‹ç°¡å˜ãªã‚¢ãƒ—ãƒªã‚’å®Ÿè£…ã—ã¦ã¿ãŸã„ã¨æ€ã„ã¾ã™ã€‚

## æ§‹æˆ

Cloudflare Workersã§ã¯ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‚‚ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚‚ä¸¡æ–¹ã„ã‘ã‚‹ã®ã§ã€ä»Šå›ã¯ ã€ŒVite + React + Honoã€ã®æ§‹æˆã§å®Ÿè£…ã‚’é€²ã‚ã¦ã„ãã¾ã™ã€‚

https://blog.cloudflare.com/ja-jp/full-stack-development-on-cloudflare-workers/

## å‹•ä½œç’°å¢ƒ

https://github.com/Slowhand0309/nodejs-devcontainer-boilerplate

ğŸ‘†ã“ã¡ã‚‰ã®ç’°å¢ƒã‚’ãƒ™ãƒ¼ã‚¹ã«é€²ã‚ã¦ã„ãã¾ã™ã€‚

## ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

Vite + React + Honoæ§‹æˆã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ä½¿ã£ã¦ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã—ã¾ã™ã€‚

```bash
yarn create cloudflare app --template=cloudflare/templates/vite-react-template
```

â€» gitç®¡ç†ã¨deployã¯ `NO` ã«ã—ã¾ã—ãŸã€‚

ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãŒä½œæˆã•ã‚ŒãŸã‚‰ã€æ—©é€Ÿèµ·å‹•ã—ã¦ã¿ã¾ã™ã€‚

ã¾ãšã¯ `.devcontainer/compose.yaml` ã«ãƒãƒ¼ãƒˆã‚’è¿½åŠ ã—ã¾ã™ã€‚

```yaml
services:
  app:
    # ...
    ports:
      - 5173:5173
```

æ¬¡ã« `app/package.json` ã® `scripts` > `dev` ã‚’ä»¥ä¸‹ã«ä¿®æ­£ã—ã¾ã™ã€‚

```yaml
 {
  ...
  "scripts": {
    ...
    "dev": "vite --host=0.0.0.0",
  },
}
```

ã“ã‚Œã§æº–å‚™ãŒã§ããŸã®ã§æ—©é€Ÿèµ·å‹•ã—ã¦ã¿ã¾ã™ã€‚

```bash
$ cd app
$ yarn install
$ yarn dev
```

ã†ã¾ãèµ·å‹•ã§ãã¦ [http://localhost:5173](http://localhost:5173) ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ä»¥ä¸‹ãŒè¡¨ç¤ºã•ã‚Œã¨ã‘ã°OKã§ã™ã€‚

![image12.png](/images/a04e4cc099f9c0/image12.png)

## Cloudflareãƒ­ã‚°ã‚¤ãƒ³

ä»¥ä¸‹ã‚’å®Ÿæ–½ã—ã¦ã€äº‹å‰ã«Cloudflareã«ãƒ­ã‚°ã‚¤ãƒ³ã—ã¨ãã¾ã™ã€‚

```bash
yarn wrangler login
```

â€» ã‚³ãƒ³ãƒ†ãƒŠä¸Šã§å®Ÿæ–½ã™ã‚‹å ´åˆã€[ã“ã¡ã‚‰](https://zenn.dev/frog/articles/f77b80a0d78497)ã‚’å‚è€ƒã«ãƒ­ã‚°ã‚¤ãƒ³å®Ÿæ–½ã§ãã¾ã™ã€‚

ä»¥ä¸‹ã§ãƒ­ã‚°ã‚¤ãƒ³çŠ¶æ³ã‚’ç¢ºèªã§ãã¾ã™ã€‚

```bash
yarn wrangler whoami
```

## Bindingsè¨­å®š

æ¬¡ã« `app/wrangler.json` ã« [Workers AI](https://developers.cloudflare.com/workers-ai/configuration/bindings/) ã®Bindingã‚’è¿½åŠ ã—ã¾ã™ã€‚

```json
{
  // ...
  },
  "ai": {
    "binding": "AI"
  }
}
```

è¿½åŠ ã—ãŸã‚‰ä»¥ä¸‹ã‚’å®Ÿæ–½ã—ã¦ `app/worker-configuration.d.ts` ã‚’æ›´æ–°ã—ã¨ãã¾ã™ã€‚

```bash
yarn cf-typegen
```

## ã‚·ãƒ³ãƒ—ãƒ«ãªæ¤œç´¢ã®å®Ÿè£…

ã¾ãšã¯ã‚·ãƒ³ãƒ—ãƒ«ã«ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã§è³ªå•ã‚’æŠ•ã’ãŸã‚‰è¿”ç­”ã‚’è¿”ã™APIã‚’å®Ÿè£…ã—ã¦ã¿ã¾ã™ã€‚

`app/src/worker/index.ts` ã«ä»¥ä¸‹ã‚’è¿½åŠ ã—ã¾ã™ã€‚

```tsx
app.get("/query", async (c) => {
  const query = c.req.query("query");
  if (!query) {
    return c.json({ error: "Query parameter is required" }, 400);
  }

  try {
    const result = await c.env.AI.autorag("autorag-chatbot-ex").aiSearch({
      query,
      rewrite_query: true,
    });
    return c.json(result);
  } catch (error) {
    console.error("AutoRAG query failed:", error);
    return c.json({ error: "Failed to process query" }, 500);
  }
});
```

`AI.autorag` ã‚’ä½¿ã£ã¦AutoRAGã®æ©Ÿèƒ½ã‚’ä½¿ã„ã¾ã™ã€‚å¼•æ•°ã«ã¯å…ˆã»ã©ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ä¸Šã§ä½œæˆã—ãŸ `autorag-chatbot-ex` ã‚’æŒ‡å®šã—ã¦ã„ã¾ã™ã€‚

æ¤œç´¢ã«ã¯ä»¥ä¸‹ã®2é€šã‚Šã‚ã‚Šã¾ã™ã€‚

1. [aiSearch](https://developers.cloudflare.com/autorag/usage/workers-binding/#aisearch)
    - ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹ã‹ã‚‰é–¢é€£ã™ã‚‹çµæœã‚’æ¤œç´¢ã—ã€æŒ‡å®šã—ãŸAutoRAGã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ¢ãƒ‡ãƒ«ã¨æ¤œç´¢ã•ã‚ŒãŸã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’ä½¿ç”¨ã—ã¦ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’ç”Ÿæˆã—ã¾ã™
2. [search](https://developers.cloudflare.com/autorag/usage/workers-binding/#search)
    - ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹ã‹ã‚‰é–¢é€£ã™ã‚‹çµæœã‚’æ¤œç´¢ã—ã€é–¢é€£ã™ã‚‹çµæœã‚’è¿”ã—ã¾ã™

å˜ã«çµæœã‚’è¿”ã™ `search` ã¨ã¯é•ã£ã¦ `aiSearch` ã ã¨æŒ‡å®šã—ãŸãƒ¢ãƒ‡ãƒ«ã§ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’ä½œæˆã—ã¦ãã‚Œã¾ã™ã€‚

æ¬¡ã«ãƒ•ãƒ­ãƒ³ãƒˆå´ã‹ã‚‰ã“ã®APIã‚’å‘¼ã³å‡ºã™ç”»é¢ã‚’å®Ÿè£…ã—ã¾ã™ã€‚

`app/src/react-app/App.tsx` ã‚’ä»¥ä¸‹ã«ä¿®æ­£ã—ã¾ã™ã€‚

:::details App.tsx

```tsx
// src/App.tsx

import { useState } from "react";
import "./App.css";

interface AutoRagResult {
  object: string;
  search_query: string;
  response: string;
  data: {
    file_id: string;
    filename: string;
    score: number;
    attributes: Record<string, unknown>;
    content: unknown[];
  }[];
  has_more: boolean;
  next_page: string | null;
}

function App() {
  const [query, setQuery] = useState("");
  const [result, setResult] = useState<AutoRagResult | null>(null);
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState<string | null>(null);

  const handleQuery = async () => {
    if (!query.trim()) return;

    setLoading(true);
    setError(null);
    setResult(null);

    try {
      const response = await fetch(`/query?q=${encodeURIComponent(query)}`);
      if (!response.ok) {
        throw new Error("Failed to fetch");
      }
      const data = await response.json();
      setResult(data);
    } catch {
      setError("Failed to process query");
    } finally {
      setLoading(false);
    }
  };

  return (
    <>
      <h1>AutoRAG Query & Chat</h1>

      <div
        style={{
          display: "flex",
          gap: "2rem",
          maxWidth: "1200px",
          margin: "0 auto",
        }}
      >
        <div style={{ flex: 1 }}>
          <h2>Search</h2>
          <div className="card">
            <div style={{ marginBottom: "1rem" }}>
              <input
                type="text"
                value={query}
                onChange={(e) => setQuery(e.target.value)}
                placeholder="Enter your query..."
                style={{
                  padding: "0.5rem",
                  fontSize: "1rem",
                  width: "300px",
                  marginRight: "0.5rem",
                }}
              />
              <button
                onClick={handleQuery}
                disabled={loading || !query.trim()}
                style={{
                  padding: "0.5rem 1rem",
                  fontSize: "1rem",
                }}
              >
                {loading ? "Searching..." : "Search"}
              </button>
            </div>
            {error && (
              <div style={{ color: "red", marginBottom: "1rem" }}>
                Error: {error}
              </div>
            )}
            {result && (
              <div
                style={{
                  textAlign: "left",
                  maxWidth: "800px",
                  margin: "0 auto",
                }}
              >
                <h3>Response:</h3>
                <p
                  style={{
                    color: "black",
                    background: "#f5f5f5",
                    padding: "1rem",
                    borderRadius: "4px",
                    lineHeight: "1.6",
                  }}
                >
                  {result.response}
                </p>

                {result.data && result.data.length > 0 && (
                  <div style={{ marginTop: "2rem" }}>
                    <h4>Sources ({result.data.length} documents):</h4>
                    {result.data.map((source) => (
                      <div
                        key={source.file_id}
                        style={{
                          color: "black",
                          background: "#f9f9f9",
                          padding: "1rem",
                          marginBottom: "1rem",
                          borderRadius: "4px",
                          border: "1px solid #e0e0e0",
                        }}
                      >
                        <div
                          style={{
                            display: "flex",
                            justifyContent: "space-between",
                            alignItems: "center",
                            marginBottom: "0.5rem",
                          }}
                        >
                          <strong>{source.filename}</strong>
                          <span style={{ fontSize: "0.9em", color: "#666" }}>
                            Score: {(source.score * 100).toFixed(1)}%
                          </span>
                        </div>
                        <div
                          style={{
                            fontSize: "0.9em",
                            color: "#666",
                            marginBottom: "0.5rem",
                          }}
                        >
                          File ID: {source.file_id}
                        </div>
                        {source.content && source.content.length > 0 && (
                          <div>
                            <strong>Content:</strong>
                            <div
                              style={{ marginTop: "0.5rem", fontSize: "0.9em" }}
                            >
                              {Array.isArray(source.content)
                                ? source.content
                                    .map((c) => JSON.stringify(c, null, 2))
                                    .join(" ")
                                : String(
                                    JSON.stringify(source.content, null, 2)
                                  )}
                            </div>
                          </div>
                        )}
                      </div>
                    ))}
                  </div>
                )}

                <div
                  style={{
                    marginTop: "1rem",
                    fontSize: "0.9em",
                    color: "#666",
                  }}
                >
                  <div>Search Query: "{result.search_query}"</div>
                  {result.has_more && <div>More results available...</div>}
                </div>
              </div>
            )}
          </div>
        </div>
      </div>
    </>
  );
}

export default App;
```

:::

ã‚„ã£ã¦ã„ã‚‹äº‹ã¨ã—ã¦ã¯ã€ŒSearchã€ãƒœã‚¿ãƒ³ãŒæŠ¼ã•ã‚Œã‚‹ã¨å…¥åŠ›ã•ã‚ŒãŸå†…å®¹ã‚’å…ˆã»ã©ä½œæˆã—ãŸ `/query` APIã«æŠ•ã’ã¦ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’è¡¨ç¤ºã—ã¦ã„ã¾ã™ã€‚

![image13.png](/images/a04e4cc099f9c0/image13.png)

ğŸ‘†ã¡ã‚ƒã‚“ã¨æ¤œç´¢ã§ãã¦ãã†ã§ã™ã€‚

## ãƒãƒ£ãƒƒãƒˆãƒœãƒƒãƒˆã®å®Ÿè£…

ã‚„ã£ã¨æœ¬é¡Œã®ãƒãƒ£ãƒƒãƒˆãƒœãƒƒãƒˆã®å®Ÿè£…ã«ãªã‚Šã¾ã™ã€‚å…ˆã»ã©åŒæ§˜ã« `app/src/worker/index.ts` ã«ãƒãƒ£ãƒƒãƒˆãƒœãƒƒãƒˆã¨ã®ã‚„ã‚Šå–ã‚Šã‚’è¡Œã†APIã‚’è¿½åŠ ã—ã¾ã™ã€‚

```tsx
app.post("/chat", async (c) => {
  try {
    const body = await c.req.json();
    const { query, messages } = body;

    if (!query) {
      return c.json({ error: "Query parameter is required" }, 400);
    }

    return streamText(c, async (stream) => {
      let contextQuery = query;

      if (messages && messages.length > 0) {
        const recentMessages = messages.slice(-6);
        const context = recentMessages
          .map(
            (msg: { role: string; content: string }) =>
              `${msg.role}: ${msg.content}`
          )
          .join("\n");
        contextQuery = `Previous conversation:\n${context}\n\nCurrent question: ${query}`;
      }

      const result = await c.env.AI.autorag("autorag-chatbot-ex").aiSearch({
        query: contextQuery,
        rewrite_query: true,
      });

      if (result && result.response) {
        stream.write(result.response);
      }
    });
  } catch (error) {
    console.error("AutoRAG chat failed:", error);
    return c.json({ error: "Failed to process chat" }, 500);
  }
});
```

ã‚„ã£ã¦ã„ã‚‹äº‹ã¨ã—ã¦ã¯å…ˆã»ã©åŒæ§˜ `aiSearch` ã‚’ä½¿ã£ã¦ã„ã‚‹ã®ã¯å¤‰ã‚ã‚‰ãšã€ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã«æ¤œç´¢æ–‡å­—ã¨ã¯åˆ¥ã«ä»Šã¾ã§ã®ãƒãƒ£ãƒƒãƒˆãƒœãƒƒãƒˆã¨ã®ã‚„ã‚Šå–ã‚Šã‚’ `messages` ã¨ã—ã¦æ¸¡ã—ã¦ã„ã¾ã™ã€‚

æ—©é€Ÿãƒ•ãƒ­ãƒ³ãƒˆå´ã‚‚å®Ÿè£…ã—ã¦APIã¨ç¹‹ãè¾¼ã‚“ã§ã¿ã¾ã™ã€‚

:::details App.tsx

```tsx
// src/App.tsx

import { useEffect, useRef, useState } from "react";
import "./App.css";

// ...

// ä»¥ä¸‹è¿½åŠ 
interface ChatMessage {
  role: "user" | "assistant";
  content: string;
}

function App() {
  
  // ä»¥ä¸‹è¿½åŠ 
  const [chatMessages, setChatMessages] = useState<ChatMessage[]>([]);
  const [chatInput, setChatInput] = useState("");
  const [chatLoading, setChatLoading] = useState(false);
  const [currentResponse, setCurrentResponse] = useState("");
  const messagesEndRef = useRef<HTMLDivElement>(null);

  const handleChat = async () => {
    if (!chatInput.trim()) return;

    const userMessage: ChatMessage = { role: "user", content: chatInput };
    setChatMessages((prev) => [...prev, userMessage]);
    setChatInput("");
    setChatLoading(true);
    setCurrentResponse("");

    try {
      const response = await fetch("/chat", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify({
          query: chatInput,
          messages: chatMessages,
        }),
      });
      if (!response.ok) {
        throw new Error("Failed to fetch chat response");
      }

      const reader = response.body?.getReader();
      if (!reader) throw new Error("No reader available");

      let fullResponse = "";
      while (true) {
        const { done, value } = await reader.read();
        if (done) break;

        const chunk = new TextDecoder().decode(value);
        fullResponse += chunk;
        setCurrentResponse(fullResponse);
      }

      const assistantMessage: ChatMessage = {
        role: "assistant",
        content: fullResponse,
      };
      setChatMessages((prev) => [...prev, assistantMessage]);
      setCurrentResponse("");
    } catch {
      const errorMessage: ChatMessage = {
        role: "assistant",
        content: "Sorry, I encountered an error processing your message.",
      };
      setChatMessages((prev) => [...prev, errorMessage]);
    } finally {
      setChatLoading(false);
    }
  };

  useEffect(() => {
    messagesEndRef.current?.scrollIntoView({ behavior: "smooth" });
  }, [chatMessages, currentResponse]);

  return (
    <>
      <h1>AutoRAG Query & Chat</h1>

      <div
        style={{
          display: "flex",
          gap: "2rem",
          maxWidth: "1200px",
          margin: "0 auto",
        }}
      >
        {/* ä»¥ä¸‹è¿½åŠ  */}
        <div style={{ flex: 1 }}>
          <h2>Chat</h2>
          <div
            className="card"
            style={{
              height: "600px",
              display: "flex",
              flexDirection: "column",
            }}
          >
            <div
              style={{
                flex: 1,
                overflowY: "auto",
                border: "1px solid #e0e0e0",
                borderRadius: "4px",
                padding: "1rem",
                marginBottom: "1rem",
                backgroundColor: "#fafafa",
                color: "#333",
              }}
            >
              {chatMessages.map((message, index) => (
                <div
                  key={index}
                  style={{
                    marginBottom: "1rem",
                    padding: "0.75rem",
                    borderRadius: "8px",
                    backgroundColor:
                      message.role === "user" ? "#e3f2fd" : "#f5f5f5",
                    marginLeft: message.role === "user" ? "2rem" : "0",
                    marginRight: message.role === "assistant" ? "2rem" : "0",
                    textAlign: message.role === "user" ? "right" : "left",
                  }}
                >
                  <div
                    style={{
                      fontWeight: "bold",
                      marginBottom: "0.25rem",
                      fontSize: "0.9em",
                    }}
                  >
                    {message.role === "user" ? "You" : "Assistant"}
                  </div>
                  <div style={{ whiteSpace: "pre-wrap" }}>
                    {message.content}
                  </div>
                </div>
              ))}

              {chatLoading && currentResponse && (
                <div
                  style={{
                    marginBottom: "1rem",
                    padding: "0.75rem",
                    borderRadius: "8px",
                    backgroundColor: "#f5f5f5",
                    marginRight: "2rem",
                  }}
                >
                  <div
                    style={{
                      fontWeight: "bold",
                      marginBottom: "0.25rem",
                      fontSize: "0.9em",
                    }}
                  >
                    Assistant
                  </div>
                  <div style={{ whiteSpace: "pre-wrap" }}>
                    {currentResponse}
                  </div>
                </div>
              )}

              {chatLoading && !currentResponse && (
                <div
                  style={{
                    marginBottom: "1rem",
                    padding: "0.75rem",
                    borderRadius: "8px",
                    backgroundColor: "#f5f5f5",
                    marginRight: "2rem",
                  }}
                >
                  <div
                    style={{
                      fontWeight: "bold",
                      marginBottom: "0.25rem",
                      fontSize: "0.9em",
                    }}
                  >
                    Assistant
                  </div>
                  <div>Thinking...</div>
                </div>
              )}

              <div ref={messagesEndRef} />
            </div>

            <div style={{ display: "flex", gap: "0.5rem" }}>
              <input
                type="text"
                value={chatInput}
                onChange={(e) => setChatInput(e.target.value)}
                placeholder="Type your message..."
                style={{
                  flex: 1,
                  padding: "0.75rem",
                  fontSize: "1rem",
                  borderRadius: "4px",
                  border: "1px solid #ccc",
                }}
                onKeyDown={(e) =>
                  e.key === "Enter" && !chatLoading && handleChat()
                }
                disabled={chatLoading}
              />
              <button
                onClick={handleChat}
                disabled={chatLoading || !chatInput.trim()}
                style={{
                  padding: "0.75rem 1.5rem",
                  fontSize: "1rem",
                  borderRadius: "4px",
                  backgroundColor: "#007bff",
                  color: "white",
                  border: "none",
                  cursor: chatLoading ? "not-allowed" : "pointer",
                }}
              >
                {chatLoading ? "Sending..." : "Send"}
              </button>
            </div>
          </div>
        </div>
      </div>
    </>
  );
}

export default App;
```

:::

![image14.png](/images/a04e4cc099f9c0/image14.png)

ã†ã¾ãè¡¨ç¤ºã•ã‚Œã¦ã„ãã†ã§ã™ã€‚

## å‹•ä½œç¢ºèª

ãƒãƒ£ãƒƒãƒˆãƒœãƒƒãƒˆã¨å°‘ã—ã‚„ã‚Šå–ã‚Šã—ã¦ã¿ãŸã„ã¨æ€ã„ã¾ã™ã€‚

![image15.png](/images/a04e4cc099f9c0/image15.png =500x)

ã‚„ã‚Šå–ã‚Šã‚’å…¨éƒ¨é€ã£ã¦ã„ã‚‹ã‚“ã§ã€ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆãŒãšã‚Œãšã«ã‚„ã‚Šå–ã‚Šã§ãã¦ã„ã¾ã™ã€‚

ç°¡å˜ãªæ±ç”¨çš„ãªäº‹æŸ„ã‚‚èã‘ã‚‹æ§˜ã§ã™ã€‚

![image16.png](/images/a04e4cc099f9c0/image16.png =500x)

ãŸã ã“ã®ã¾ã¾ã ã¨ã€2ã¤ã®ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã©ã¡ã‚‰ã®å†…å®¹ã‚‚èã‘ã‚‹ã‚ˆã†ã«ãªã£ã¦ã—ã¾ã£ã¦ã„ã¾ã™ã€‚

![image17.png](/images/a04e4cc099f9c0/image17.png =500x)

ã‚»ã‚­ãƒ¥ã‚¢ãªæƒ…å ±ã‚’æ‰±ã£ã¦ã„ã‚‹å ´åˆã ã¨ã“ã®çŠ¶æ³ã¯ã‚ˆã‚ã—ããªã„ã®ã§ã€ãã‚Œãã‚Œã®ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆå°‚ç”¨ã®ãƒãƒ£ãƒƒãƒˆãƒœãƒƒãƒˆã‚’ä½œæˆã—ã¦ã¿ãŸã„ã¨æ€ã„ã¾ã™ã€‚

# ãƒãƒ«ãƒãƒ†ãƒŠãƒ³ãƒˆå¯¾å¿œ

ãƒãƒ«ãƒãƒ†ãƒŠãƒ³ãƒˆå¯¾å¿œã‚’å®Ÿç¾ã™ã‚‹ç‚ºã«ã€Metadata filtering ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚

https://developers.cloudflare.com/autorag/configuration/metadata/

å…ˆã»ã©ã®API `/query` å®Ÿè£…ã‚’å°‘ã—ä¿®æ­£ã—ã¾ã™ã€‚

```tsx
app.get("/query", async (c) => {
  const query = c.req.query("q");
  // ğŸ‘‡æ–°ãŸãªtargetãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’è¿½åŠ 
  const target = c.req.query("target");
  if (!query) {
    return c.json({ error: "Query parameter is required" }, 400);
  }
  if (!target) {
    return c.json({ error: "Target parameter is required" }, 400);
  }

  try {
    const result = await c.env.AI.autorag("autorag-chatbot-ex").aiSearch({
      query,
      rewrite_query: true,
      // ğŸ‘‡è¿½åŠ 
      filters: {
        type: "eq",
        key: "folder",
        value: `${target}/`, // æœ«å°¾ã® / ãŒç„¡ã„ã¨ä¸Šæ‰‹ãfilterã—ã¦ãã‚Œãªã„ã®ã§æ³¨æ„!
      },
    });
    return c.json(result);
  } catch (error) {
    console.error("AutoRAG query failed:", error);
    return c.json({ error: "Failed to process query" }, 500);
  }
});
```

`aiSearch` ã§ `filters` ã‚’ä½¿ã£ã¦ç‰¹å®šã® `folder` ã‚’å¯¾è±¡ã«ã‚¯ã‚¨ãƒªã‚’ã‹ã‘ã‚‹ã‚ˆã†ã«ä¿®æ­£ã—ã¦ã„ã¾ã™ã€‚

æ¬¡ã«ãƒ•ãƒ­ãƒ³ãƒˆå´ã‚‚ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã‚’é¸ã¹ã‚‹ã‚ˆã†ã«ä¿®æ­£ã—ã¾ã™ã€‚

`app/src/react-app/App.tsx`

```tsx
type Targets = "HoloMeet_Pro" | "NeuroNote_X";

function App() {
  // ğŸ‘‡è¿½åŠ 
  const [target, setTarget] = useState<Targets>("HoloMeet_Pro");

  const handleQuery = async () => {
    if (!query.trim()) return;

    setLoading(true);
    setError(null);
    setResult(null);

    try {
      // ğŸ‘‡ targetã‚’ã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã«è¿½åŠ 
      const response = await fetch(
        `/query?q=${encodeURIComponent(query)}&target=${target}`
      );
      if (!response.ok) {
        throw new Error("Failed to fetch");
      }
      const data = await response.json();
      setResult(data);
    } catch {
      setError("Failed to process query");
    } finally {
      setLoading(false);
    }
  };
  // ....
  return (
    <>
      <h1>AutoRAG Query & Chat</h1>
      {/* ğŸ‘‡ ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã‚’é¸æŠã§ãã‚‹ã‚ˆã†ã« */}
      <div style={{ marginBottom: "1rem" }}>
        <label htmlFor="target">Select Target:</label>
        <select
          id="target"
          value={target}
          onChange={(e) => setTarget(e.target.value as Targets)}
          style={{ marginLeft: "0.5rem", padding: "0.25rem" }}
        >
          <option value="HoloMeet_Pro">HoloMeet Pro</option>
          <option value="NeuroNote_X">NeuroNote X</option>
        </select>
      </div>

      <p>
        Current target: <strong>{target}</strong>
      </p>
      ...
  );
}
```

æ—©é€Ÿè©¦ã—ã¦ã¿ã¾ã™ã€‚

![image18.png](/images/a04e4cc099f9c0/image18.png)

`NeuroNote X` ã‚’é¸æŠä¸­ã« `HoloMeet Pro` ã«é–¢ã™ã‚‹ã“ã¨ã‚’èã„ã¦ã¿ã¦ã€ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®ä¸­ã«ã¯è¦‹ã¤ã‹ã‚‰ãªã„ã¨è¨€ã£ã¦ã¾ã™ã­ã€‚ã†ã¾ããƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã§ãã¦ãã†ã§ã™ã€‚

![image19.png](/images/a04e4cc099f9c0/image19.png)

é€†ã« `HoloMeet Pro` ã®ã“ã¨ã¯ã¡ã‚ƒã‚“ã¨ç­”ãˆã¦ãã‚Œã¾ã™ âœ¨

ä»Šå›ã¯ç°¡å˜ãªãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã—ã‹ä½¿ã£ã¦ã„ã¾ã›ã‚“ãŒã€ç´°ã‹ã„ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã‚‚ã§ãã‚‹æ§˜ãªã®ã§å¿…è¦ã‚ã‚Œã°ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’å‚ç…§ã—ã¦ã¿ã¦ä¸‹ã•ã„ã€‚

# OpenAIã®ãƒ¢ãƒ‡ãƒ«ã‚’ä½¿ã£ã¦ã¿ã‚‹

æœ€å¾Œã«ãƒ¬ã‚¹ãƒãƒ³ã‚¹ç”Ÿæˆã™ã‚‹éƒ¨åˆ†ã§ä»Šã¾ã§Workers AIã®ç”¨æ„ã•ã‚ŒãŸãƒ¢ãƒ‡ãƒ«ã‚’ä½¿ã£ã¦ãã¾ã—ãŸãŒã€åˆ¥ã®ãƒ¢ãƒ‡ãƒ«ã‚’ä½¿ã£ã¦ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’ç”Ÿæˆã™ã‚‹ã‚ˆã†ã«ã—ã¦ã¿ãŸã„ã¨æ€ã„ã¾ã™ã€‚

https://developers.cloudflare.com/autorag/how-to/bring-your-own-generation-model/

ğŸ‘†ã‚’å…ƒã«é€²ã‚ã¦ã„ãã¾ã™ã€‚æ—©é€Ÿå¿…è¦ãªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚

```bash
$ cd app
$ yarn add ai @ai-sdk/openai zod@3.23.8
```

:::message alert
â€» æ‰‹å…ƒã®ç’°å¢ƒã ã¨ `zod@3.23.8` ã‚’ãƒãƒ¼ã‚¸ãƒ§ãƒ³æŒ‡å®šã§å…¥ã‚Œã¨ã‹ãªã„ã¨ ğŸ‘‡ã®ã‚¨ãƒ©ãƒ¼ãŒå‡ºã¾ã—ãŸâ€¦

**vite_ssr_import_0**.z.string(...).base64 is not a function
:::

æ¬¡ã« `OPENAI_API_KEY` ç’°å¢ƒå¤‰æ•°ã‚’ `app/wrangler.json` ã«è¿½åŠ ã—ã¾ã™ã€‚

```json
"vars": {
  "OPENAI_API_KEY": "<<your api key>>"
}
```

è¿½åŠ ã—ãŸã‚‰ `yarn cf-typegen` ã‚’å®Ÿè¡Œã—ã¦ `app/worker-configuration.d.ts` ã‚’æ›´æ–°ã—ã¨ãã¾ã™ã€‚

`app/src/worker/index.ts` ã«æ–°ãŸã« `/openai_query` ã‚’ä½œæˆã—ã¾ã™ã€‚

```tsx
app.get("/openai_query", async (c) => {
  const query = c.req.query("q");
  const target = c.req.query("target");
  if (!query) {
    return c.json({ error: "Query parameter is required" }, 400);
  }
  if (!target) {
    return c.json({ error: "Target parameter is required" }, 400);
  }

  try {
    const result = await c.env.AI.autorag("autorag-chatbot-ex").search({
      query,
      rewrite_query: true,
      filters: {
        type: "eq",
        key: "folder",
        value: `${target}/`,
      },
    });
    if (result.data.length === 0) {
      return Response.json({ text: `No data found for query "${query}"` });
    }
    const chunks = result.data
      .map((item) => {
        const data = item.content
          .map((content) => {
            return content.text;
          })
          .join("\n\n");

        return `<file name="${item.filename}">${data}</file>`;
      })
      .join("\n\n");
    const generateResult = await generateText({
      model: openai("gpt-4o-mini"),
      messages: [
        {
          role: "system",
          content:
            "You are a helpful assistant and your task is to answer the user question using the provided files.",
        },
        { role: "user", content: chunks },
        { role: "user", content: query },
      ],
    });
    return c.json(generateResult);
  } catch (error) {
    console.error("AutoRAG query failed:", error);
    return c.json({ error: "Failed to process query" }, 500);
  }
});
```

ã‚„ã£ã¦ã„ã‚‹äº‹ã¨ã—ã¦ã¯ `search` ã‚’ä½¿ã£ã¦ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹ã‹ã‚‰Embeddingsã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ã€ãã‚Œã‚’å‚ç…§ã™ã‚‹ã‚ˆã†ã«ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’ä½œæˆã—ã¦OpenAIã®ãƒ¢ãƒ‡ãƒ«ã«æŠ•ã’ã¦ã„ã¾ã™ã€‚

æ¬¡ã«ãƒ•ãƒ­ãƒ³ãƒˆå´ã‚‚æ–°è¦ã«UIã‚’è¿½åŠ ã—ã¾ã™ã€‚

:::details App.tsx

```tsx
function App() {
  // ... ä»–çœç•¥

  const [openaiQuery, setOpenaiQuery] = useState("");
  const [openaiResponse, setOpenaiResponse] = useState<string | null>(null);
  const [openaiLoading, setOpenaiLoading] = useState(false);
  const [openaiError, setOpenaiError] = useState<string | null>(null);
  
  const handleOpenaiQuery = async () => {
    if (!openaiQuery.trim()) return;

    setOpenaiLoading(true);
    setOpenaiError(null);
    setOpenaiResponse(null);

    try {
      const response = await fetch(
        `/openai_query?q=${encodeURIComponent(openaiQuery)}&target=${target}`
      );
      if (!response.ok) {
        throw new Error("Failed to fetch OpenAI response");
      }
      const data = await response.json();
      setOpenaiResponse(data.text);
    } catch {
      setOpenaiError("Failed to process OpenAI query");
    } finally {
      setOpenaiLoading(false);
    }
  };
  
    return (
    <>
      <h1>AutoRAG Query & Chat</h1>
        {/* ä»–çœç•¥ */}
        <div style={{ flex: 1 }}>
          <h2>OpenAI Search</h2>
          <div className="card">
            <div style={{ marginBottom: "1rem" }}>
              <input
                type="text"
                value={openaiQuery}
                onChange={(e) => setOpenaiQuery(e.target.value)}
                placeholder="Enter your query..."
                style={{
                  padding: "0.5rem",
                  fontSize: "1rem",
                  width: "300px",
                  marginRight: "0.5rem",
                }}
              />
              <button
                onClick={handleOpenaiQuery}
                disabled={openaiLoading || !openaiQuery.trim()}
                style={{
                  padding: "0.5rem 1rem",
                  fontSize: "1rem",
                }}
              >
                {loading ? "Searching..." : "Search"}
              </button>
            </div>
            {openaiError && (
              <div style={{ color: "red", marginBottom: "1rem" }}>
                Error: {openaiError}
              </div>
            )}
            {openaiResponse && (
              <div
                style={{
                  textAlign: "left",
                  maxWidth: "800px",
                  margin: "0 auto",
                }}
              >
                <h3>Response:</h3>
                <p
                  style={{
                    color: "black",
                    background: "#f5f5f5",
                    padding: "1rem",
                    borderRadius: "4px",
                    lineHeight: "1.6",
                  }}
                >
                  {openaiResponse}
                </p>
              </div>
            )}
          </div>
        </div>
      </div>
    </>
  );
```

:::

æ—©é€Ÿã‚¯ã‚¨ãƒªã‚’ã‹ã‘ã¦ã¿ã¾ã™ã€‚

![image20.png](/images/a04e4cc099f9c0/image20.png =400x)

Workers AIã®ãƒ¢ãƒ‡ãƒ«ã¨æ¯”ã¹ã¦ç´°ã‹ãªèª¬æ˜ã«ãªã£ãŸæ„Ÿã˜ã§ã—ã‚‡ã†ã‹ ğŸ‘€

æ±ç”¨çš„ãªè³ªå•ã‚‚ã—ã¦ã¿ã¾ã™ã€‚

![image21.png](/images/a04e4cc099f9c0/image21.png =400x)

ChatGPTã£ã½ã„(å½“ãŸã‚Šå‰ã§ã™ãŒ)ã§ã™ã­ï¼ä¸Šæ‰‹ãå‹•ã„ã¦ãã†ã§ã™ï¼

# ã¾ã¨ã‚

AutoRAGãŒãƒ‡ãƒ¼ã‚¿ã®å–ã‚Šè¾¼ã¿â†’ãƒ™ã‚¯ãƒˆãƒ«åŒ–â†’æ¤œç´¢ã‚’ä¸¸ã£ã¨ã‚„ã£ã¦ãã‚Œã‚‹ã®ã§ã€çµæ§‹ç°¡å˜ã«ç°¡æ˜“çš„ãªãƒãƒ£ãƒƒãƒˆãŒæ§‹ç¯‰ã§ãã¾ã—ãŸï¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹ç”Ÿæˆã®æ™‚ã®ãƒ¢ãƒ‡ãƒ«ã‚‚ã‚«ã‚¹ã‚¿ãƒ ã§ãã‚‹ã®ã§ã€å¥½ããªãƒ¢ãƒ‡ãƒ«ã§ã¡ã‚‡ã£ã¨ã—ãŸæ¤œç´¢ã‚„ã€ãƒãƒ£ãƒƒãƒˆãƒœãƒƒãƒˆã‚’ä½œã‚‹åˆ†ã«ã¯ä½¿ãˆãã†ã ãªã¨æ„Ÿã˜ã¾ã—ãŸã€‚

ã¾ãŸã€ä»Šå›è©¦ã—ãŸåˆ†ã¯ä»¥ä¸‹ãƒªãƒã‚¸ãƒˆãƒªã«Pushã—ã¦ã„ã¾ã™ã€‚

https://github.com/Slowhand0309/autorag-chatbot-ex
