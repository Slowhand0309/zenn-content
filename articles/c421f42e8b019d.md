---
title: "SwiftUIã§ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒãƒ¼ã‚¢ãƒ—ãƒªã‚’ä½œæˆã™ã‚‹"
emoji: "ğŸ"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics:
  - "swift"
  - "swiftui"
  - "mac"
published: true
---
# æ¦‚è¦

ä»Šå›ã¯SwiftUI ã® `MenuBarExtra` ã‚’ä½¿ã£ã¦ â€œãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒãƒ¼å¸¸é§ã‚¢ãƒ—ãƒªâ€ ã‚’è©¦ã—ã¦ã¿ã¾ã—ãŸã€‚ç°¡å˜ãªã‚µãƒ³ãƒ—ãƒ«ã¨æœ€å¾Œã«å³ã‚¯ãƒªãƒƒã‚¯ã§ã®ContextMenuè¡¨ç¤ºã‚‚è©¦ã—ã¦ã¿ã¦ã¾ã™ã€‚

# å‹•ä½œç’°å¢ƒ

```text
MBA M3 24GB
Sequoia 15.5
Xcode: 16.1 (16B40)
```

https://developer.apple.com/jp/design/human-interface-guidelines/the-menu-bar

ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒãƒ¼ã«é–¢ã—ã¦ã¯èª¬æ˜ã™ã‚‹ã¾ã§ã‚‚ãªã„ã¨æ€ã„ã¾ã™ãŒã€ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒãƒ¼ã®ä¸­ã«ã¯ã€Œã‚¢ãƒ—ãƒªãƒ¡ãƒ‹ãƒ¥ãƒ¼ã€ã¨ã€Œãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒãƒ¼ã‚¨ã‚¯ã‚¹ãƒˆãƒ©ã€ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚

- ã‚¢ãƒ—ãƒªãƒ¡ãƒ‹ãƒ¥ãƒ¼
  - ä½•ã‚‰ã‹ã®ã‚¢ãƒ—ãƒªã‚’é–‹ã„ã¦ã„ã‚‹æ™‚ã«å‡ºã‚‹ãƒ¡ãƒ‹ãƒ¥ãƒ¼
  - ä¾‹) Chrome
    ![image1.png](/images/c421f42e8b019d/image1.png)

- ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒãƒ¼ã‚¨ã‚¯ã‚¹ãƒˆãƒ©
  - å³å´ã«è¡¨ç¤ºã•ã‚Œã‚‹ã‚¢ãƒ—ãƒªå›ºæœ‰ã®æ©Ÿèƒ½ã‚’æç¤ºã™ã‚‹ãƒ¡ãƒ‹ãƒ¥ãƒ¼
    ![image2.png](/images/c421f42e8b019d/image2.png)

ä»Šå›ã¯ã€Œãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒãƒ¼ã‚¨ã‚¯ã‚¹ãƒˆãƒ©ã€ã‚’SwiftUIã§ä½œæˆã—ã¦ã„ã“ã†ã¨æ€ã„ã¾ã™ã€‚

ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒãƒ¼ã‚¨ã‚¯ã‚¹ãƒˆãƒ©ã®ä»•æ§˜ã«é–¢ã—ã¦é‡è¦ãã†ãªç®‡æ‰€ã‚’ä»¥ä¸‹ã«ãƒ”ãƒƒã‚¯ã‚¢ãƒƒãƒ—ã—ã¾ã—ãŸã€‚

- ã‚¢ãƒ—ãƒªã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼ç”¨ã®ã‚¹ãƒšãƒ¼ã‚¹ãŒè¶³ã‚Šãªã„ã¨ãã¯ã€å¿…è¦ã«å¿œã˜ã¦ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒãƒ¼ã‚¨ã‚¯ã‚¹ãƒˆãƒ©ãŒéè¡¨ç¤ºã«ãªã‚Šã¾ã™
- ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒãƒ¼ã‚¨ã‚¯ã‚¹ãƒˆãƒ©ãŒå¤šã™ãã‚‹å ´åˆã€ã‚¢ãƒ—ãƒªã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼è¡¨ç¤ºãŒçª®å±ˆã«ãªã‚‰ãªã„ã‚ˆã†ã«ä¸€éƒ¨ã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒãƒ¼ã‚¨ã‚¯ã‚¹ãƒˆãƒ©ãŒéè¡¨ç¤ºã«ãªã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™

# MenuBarExtra

https://developer.apple.com/documentation/SwiftUI/MenuBarExtra

`macOS 13.0+` ã‹ã‚‰ä½¿ãˆã¦ã€ãã®åã®é€šã‚Šãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒãƒ¼ã‚¨ã‚¯ã‚¹ãƒˆãƒ©ã«ã‚¢ãƒ—ãƒªã‚’è¡¨ç¤ºã—ã¦ãã‚Œã‚‹ `MenuBarExtra` ãŒç”¨æ„ã•ã‚Œã¦ã„ã¾ã™ã€‚ä»Šå›ã¯ã“ã¡ã‚‰ã‚’ä½¿ã£ã¦ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒãƒ¼ã‚¢ãƒ—ãƒªã‚’ä½œæˆã—ã¦ã„ããŸã„ã¨æ€ã„ã¾ã™ã€‚

# ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆ

Xcodeã‚’èµ·å‹•ã—ã€ã€ŒCreate New Projectâ€¦ã€>ã€ŒmacOSã€>ã€ŒAppã€ã‚’é¸æŠã—ã¾ã™ã€‚

![image3.png](/images/c421f42e8b019d/image3.png)

ä»Šå›ã¯ProductNameã€ŒMenuBarExampleã€ã¨ã—ã¦ä½œæˆã—ã¾ã—ãŸã€‚

![image4.png](/images/c421f42e8b019d/image4.png)

# æœ€ä½é™ã®å®Ÿè£…

ã¾ãšã¯ãŸã ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒãƒ¼ã«ã‚¢ãƒ—ãƒªãŒè¡¨ç¤ºã•ã‚Œã€ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨ãƒ†ã‚­ã‚¹ãƒˆãŒè¡¨ç¤ºã•ã‚Œã‚‹ã ã‘ã®ã‚¢ãƒ—ãƒªã‚’å®Ÿè£…ã—ã¦ã¿ãŸã„ã¨æ€ã„ã¾ã™ã€‚

- MenuBarExampleApp.swift

```swift
import SwiftUI

@main
struct MenuBarExampleApp: App {
    var body: some Scene {
        MenuBarExtra(
            "MenuBar Example",
            systemImage: "menubar.rectangle"
        ) {
            ContentView()
                .frame(width: 300, height: 180)
        }
        .menuBarExtraStyle(.window)
    }
}
```

- ContentView.swift

```swift
import SwiftUI

struct ContentView: View {

    var body: some View {
        Text("Hi")
    }
}

#Preview {
    ContentView()
}
```

ã“ã‚Œã‚’å®Ÿè¡Œã™ã‚‹ã¨ä»¥ä¸‹ã®æ§˜ãªã‚·ãƒ³ãƒ—ãƒ«ãªã‚¢ãƒ—ãƒªãŒèµ·å‹•ã•ã‚Œã¾ã™ã€‚

![image5.png](/images/c421f42e8b019d/image5.png =400x)

## menuBarExtraStyle

`MenuBarExtra` ã® `menuBarExtraStyle` ã§æŒ‡å®šã§ãã‚‹å€¤ã¯ä»¥ä¸‹ã®2ã¤ã«ãªã‚Šã¾ã™ã€‚

- menuBarExtraStyle
  - window:
    - å…ˆã»ã©å®Ÿè£…ã—ãŸã‚‚ã®
    - ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã«å¿œã˜ã¦å‹•çš„ã«ã‚µã‚¤ã‚ºã‚’å¤‰æ›´ã™ã‚‹ã“ã¨ã‚‚ã€ãƒ«ãƒ¼ãƒˆãƒ“ãƒ¥ãƒ¼ã«å›ºå®šãƒ•ãƒ¬ãƒ¼ãƒ ã‚’è¨­å®šã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™
  - menu:
    ![image6.png](/images/c421f42e8b019d/image6.png)
    - automatic: â†‘ã®menuã¨åŒã˜ã«ãªã‚Šã¾ã—ãŸ

# ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã‚³ãƒ”ãƒ¼

æ¬¡ã¯å…¥åŠ›ãƒ†ã‚­ã‚¹ãƒˆã‚’ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«å¤§æ–‡å­—ã«ã—ã¦ã‚³ãƒ”ãƒ¼ã™ã‚‹ã‚µãƒ³ãƒ—ãƒ«ã‚’å®Ÿè£…ã—ã¦ã¿ãŸã„ã¨æ€ã„ã¾ã™ã€‚

- ContentView.swift

```swift
import SwiftUI

struct ContentView: View {
    @State private var textInput: String = ""

    var body: some View {
        VStack(alignment: .leading) {
            Text("Add your text below:")
                .foregroundStyle(.secondary)
            TextEditor(text: $textInput)
                .padding(.vertical, 4)
                .scrollContentBackground(.hidden)
                .background(.thinMaterial)
            Button(
                "Copy uppercased result",
                systemImage: "square.on.square"
            ) {
                let pasteboard = NSPasteboard.general
                pasteboard.clearContents()
                pasteboard.setString(textInput.uppercased(), forType: .string)
            }
            .buttonStyle(.plain)
            .foregroundStyle(.blue)
            .bold()
        }
        .padding()
    }
}

#Preview {
    ContentView()
}
```

å®Ÿè¡Œã™ã‚‹ã¨ğŸ‘‡ã®ã‚ˆã†ãªViewãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚

![image7.png](/images/c421f42e8b019d/image7.png =400x)

å®Ÿéš›ã«ãƒ†ã‚­ã‚¹ãƒˆå…¥åŠ›ã—ã¦ã€ã€ŒCopy uppercased resultã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã¨å¤§æ–‡å­—ã§ã‚³ãƒ”ãƒ¼ã•ã‚Œã¾ã™ã€‚

![image8.png](/images/c421f42e8b019d/image8.png =400x)

scrollContentBackground ã®èª¬æ˜ã¯ğŸ‘‡

https://zenn.dev/tsuzuki817/articles/fb5f6261945af6

# LSUIElement

ã“ã®ã¾ã¾ã ã¨ Dockã¨ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚¹ã‚¤ãƒƒãƒãƒ£ãƒ¼(Cmd+Tab) ã«è¡¨ç¤ºã•ã‚Œã¦ã—ã¾ã†ã®ã§ã€ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒãƒ¼ã ã‘ã®ã‚¢ãƒ—ãƒªã®å ´åˆã€éè¡¨ç¤ºãŒæœ›ã¾ã—ã„ã‹ã¨æ€ã„ã¾ã™ã€‚

Info.plist ã« `Application is agent` é …ç›®ã‚’è¿½åŠ ã—å€¤ã‚’ `true` ã«ã—ã¦ã‚ã’ã‚Œã°éè¡¨ç¤ºã«ãªã‚‹ã®ã§è¨­å®šã—ã¨ãã¾ã™ã€‚

XCodeä¸Šã§ã€ŒTargetã€>ã€ŒInfoã€>ã€ŒApplication is agent (UIElement)ã€ã‚’è¿½åŠ ã—å€¤ã‚’ã€ŒYESã€ã«è¨­å®šã—ã¾ã™ã€‚

![image9.png](/images/c421f42e8b019d/image9.png)

å®Ÿè¡Œã™ã‚‹ã¨Dockã‚„ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚¹ã‚¤ãƒƒãƒãƒ£ãƒ¼ã«è¡¨ç¤ºã•ã‚Œãªããªã‚‹ã‹ã¨æ€ã„ã¾ã™ã€‚

# ContextMenu

ã“ã®ã¾ã¾ã ã¨çµ‚äº†ã•ã›ã‚‹äº‹ãŒã§ããªã„ã‚¢ãƒ—ãƒªã«ãªã£ã¦ã—ã¾ã†ã®ã§ã€å³ã‚¯ãƒªãƒƒã‚¯ã§ContextMenuã‚’è¡¨ç¤ºã•ã›ã€ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‹ã‚‰ã‚¢ãƒ—ãƒªã‚’çµ‚äº†ã§ãã‚‹ã‚ˆã†ã«ã—ã¦ã¿ãŸã„ã¨æ€ã„ã¾ã™ã€‚

ä»Šå›ã¯ **MenuBarExtraAccess** ã¨ã„ã†ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ä½¿ã£ã¦å®Ÿè£…ã—ã¦ã¿ãŸã„ã¨æ€ã„ã¾ã™ã€‚
https://github.com/orchetect/MenuBarExtraAccess

ã¾ãšã¯ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’è¿½åŠ ã—ã¾ã™ã€‚XCodeä¸Šã§ã€ŒFileã€>ã€ŒAdd Package Dependenciesâ€¦ã€ã‚’é¸æŠã—ã¾ã™ã€‚å³ä¸Šã®æ¤œç´¢çª“ã« `MenuBarExtraAccess` ã®Githubã®URLã‚’ã‚³ãƒ”ãƒšã—ã¾ã™ã€‚

ã™ã‚‹ã¨ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã®ã§ã€ŒAdd Packageã€ã§è¿½åŠ ã—ã¾ã™ã€‚

![image10.png](/images/c421f42e8b019d/image10.png)

ãã®éš›ã«ã€ŒAdd to Targetã€ã§Targetã‚’æŒ‡å®šã™ã‚‹ã®ã‚’å¿˜ã‚Œãšã«è¨­å®šã—ã¨ãã¾ã™ã€‚

æº–å‚™ãŒã§ããŸã‚‰ `MenuBarExampleApp.swift` ã«ContextMenuã®å®Ÿè£…ã‚’è¿½åŠ ã—ã¾ã™ã€‚

```swift
import SwiftUI
import MenuBarExtraAccess

@main
struct MenuBarExampleApp: App {
    @State private var isPresented = false
    @State private var statusItem: NSStatusItem?
    var body: some Scene {
        MenuBarExtra(
            "MenuBar Example",
            systemImage: "menubar.rectangle"
        ) {
            ContentView()
                .frame(width: 300, height: 180)
        }
        .menuBarExtraStyle(.window)
        .menuBarExtraAccess(isPresented: $isPresented) { item in
            statusItem = item
            addRightClickMonitor()
        }
    }
    
    private func addRightClickMonitor() {
        guard let item = statusItem else { return }
        NSEvent.addLocalMonitorForEvents(matching: .rightMouseDown) { event in
            if event.window == item.button?.window {
                popupContextMenu(for: item)
                return nil
            }
            return event
        }
    }

    private func popupContextMenu(for item: NSStatusItem) {
        let menu = NSMenu()
        menu.addItem(withTitle: "Preferencesâ€¦", action: nil, keyEquivalent: ",")
        menu.addItem(.separator())
        menu.addItem(withTitle: "Quit", action: #selector(NSApp.terminate(_:)), keyEquivalent: "q")
        item.menu = menu
        item.button?.performClick(nil)
        item.menu = nil
    }
}
```

å®Ÿè¡Œã—ã¦ã€å³ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨ContextMenuãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹ã‹ã¨æ€ã„ã¾ã™ã€‚

![image11.png](/images/c421f42e8b019d/image11.png)

å®Ÿéš›ã«ã€ŒQuitã€ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨ã‚¢ãƒ—ãƒªãŒçµ‚äº†ã—ã¾ã™ã€‚(Preferencesâ€¦ã¯ä»®ã§ç½®ã„ã¦ã‚‹ã ã‘ã§ã™)

ã¾ãŸContextMenuãŒé–‹ã„ãŸçŠ¶æ…‹ã§ã€ŒCmd+Qã€ã®ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆã§ã‚‚ã‚¢ãƒ—ãƒªãŒçµ‚äº†ã—ã¾ã™ã€‚

# å‚è€ƒURL

https://nilcoalescing.com/blog/BuildAMacOSMenuBarUtilityInSwiftUI/

https://stackoverflow.com/questions/76372729/add-contextmenu-to-menubarextra-swiftui-macos