---
title: "TCA„Å®Supabase„Åß„É≠„Ç∞„Ç§„É≥ÁîªÈù¢„Çí‰Ωú„Çã"
emoji: "üóÇ"
type: "tech" # tech: ÊäÄË°ìË®ò‰∫ã / idea: „Ç¢„Ç§„Éá„Ç¢
topics: []
published: false
---
# TCA (The Composable Architecture) „Å®„ÅØ?

> „Ç¢„Éó„É™„ÇíÈñãÁô∫„Åô„Çã„Åü„ÇÅ„ÅÆÁä∂ÊÖãÁÆ°ÁêÜ„Éï„É¨„Éº„É†„ÉØ„Éº„ÇØ„ÄÇTCA „ÅØ„ÄÅÈñãÁô∫ËÄÖ„Åå‰Ωø„ÅÑ„ÇÑ„Åô„ÅÑ„Çà„ÅÜ„Å´„ÄÅ‰∏ÄË≤´ÊÄß„ÅÆ„ÅÇ„ÇãÁêÜËß£„Åó„ÇÑ„Åô„ÅÑÊñπÊ≥ï„Åß„Ç¢„Éó„É™„Ç±„Éº„Ç∑„Éß„É≥„ÇíÊßãÁØâ„Åô„Çã„Åü„ÇÅ„Å´‰ΩøÁî®„Åï„Çå„Çã„ÄÇ

[https://github.com/pointfreeco/swift-composable-architecture](https://github.com/pointfreeco/swift-composable-architecture)

[Êó•Êú¨Ë™ûÁâà„ÅØ„Åì„Å°„Çâ](https://gist.github.com/kalupas226/bdf577e4a7066377ea0a8aaeebcad428)

## ‰∏ª„Å™Ê©üËÉΩ

- **State management**
  - ÂçòÁ¥î„Å™ÂÄ§Âûã„Çí‰Ωø„Å£„Å¶„Ç¢„Éó„É™„Ç±„Éº„Ç∑„Éß„É≥„ÅÆÁä∂ÊÖã„ÇíÁÆ°ÁêÜ„Åó„ÄÅÂ§ö„Åè„ÅÆÁîªÈù¢„Å´„Çè„Åü„Å£„Å¶Áä∂ÊÖã„ÇíÂÖ±Êúâ„Åô„ÇãÊñπÊ≥ï
- **Composition**
  - Â§ßË¶èÊ®°„Å™„Éï„Ç£„Éº„ÉÅ„É£„Éº„Çí„Å©„ÅÆ„Çà„ÅÜ„Å´Â∞è„Åï„Å™ÊßãÊàêË¶ÅÁ¥†„Å´ÂàÜËß£„Åó„ÄÅ„Åù„Çå„Åû„ÇåÁã¨Á´ã„Åó„Åü„É¢„Ç∏„É•„Éº„É´„Å´ÊäΩÂá∫„Åó„ÄÅ„Éï„Ç£„Éº„ÉÅ„É£„Éº„ÇíÂΩ¢Êàê„Åô„Çã„Åü„ÇÅ„Å´Á∞°Âçò„Å´„Å§„Å™„ÅéÂêà„Çè„Åõ„Çã„Åì„Å®„Åå„Åß„Åç„Çã„Åã
- **Side effects**
  - „Ç¢„Éó„É™„Ç±„Éº„Ç∑„Éß„É≥„ÅÆÁâπÂÆö„ÅÆÈÉ®ÂàÜ„Çí„ÄÅÂèØËÉΩ„Å™Èôê„Çä„ÉÜ„Çπ„ÉàÂèØËÉΩ„ÅßÁêÜËß£„Åó„ÇÑ„Åô„ÅÑÊñπÊ≥ï„ÅßÂ§ñÁïå„Å®ÂØæË©±„Åï„Åõ„ÇãÊñπÊ≥ï
- **Testing**
  - ÁµêÂêà„ÉÜ„Çπ„Éà„Åã„ÇâE2E„ÉÜ„Çπ„Éà„Åæ„Åß
- **Ergonomics**
  - ‰∏äË®ò„ÅÆ„Åô„Åπ„Å¶„Çí„ÄÅ„Åß„Åç„Çã„Å†„ÅëÂ∞ë„Å™„ÅÑ„Ç≥„É≥„Çª„Éó„Éà„Å®ÂèØÂãïÈÉ®ÂìÅ„Åß„ÄÅ„Ç∑„É≥„Éó„É´„Å™API„ÅßÂÆüÁèæ„Åô„Çã„Å´„ÅØ„Å©„ÅÜ„Åô„Çå„Å∞„ÅÑ„ÅÑ„Åã

## „Éë„ÉÉ„Ç±„Éº„Ç∏Â∞éÂÖ•

‰ªäÂõû„ÅØÂ≠¶Áøí„ÅÆÁÇ∫„ÄÅÂ§ñÈÉ®„Éë„ÉÉ„Ç±„Éº„Ç∏Â∞éÂÖ•Áî®„ÅÆPackage„Çí‰ΩúÊàê„Åó„ÄÅ„Åù„ÅÆ `Package.swift` „Å´TCA„Çí„Ç§„É≥„Éù„Éº„Éà„Åô„Çã„Çà„ÅÜ„Å´„Åó„Å¶„Åø„Åü„ÅÑ„Å®ÊÄù„ÅÑ„Åæ„Åô„ÄÇ

1. File > New > Package „Åã„Çâ `DependenciesPackages` „Å®„ÅÑ„ÅÜÂêçÂâç„ÅßPackage„Çí‰ΩúÊàê„Åô„Çã
2. `Package.swift` „Çí‰ª•‰∏ã„Å´‰øÆÊ≠£„Åô„Çã

    ```swift
    // swift-tools-version: 5.8
    // The swift-tools-version declares the minimum version of Swift required to build this package.
    
    import PackageDescription
    
    let package = Package(
        name: "DependenciesPackages",
        platforms: [
          .iOS(.v16)
        ],
        products: [
            // Products define the executables and libraries a package produces, and make them visible to other packages.
            .library(
                name: "DependenciesPackages",
                targets: ["DependenciesPackages"]),
        ],
        dependencies: [
            // Dependencies declare other packages that this package depends on.
            .package(url: "https://github.com/pointfreeco/swift-composable-architecture", branch: "main")
        ],
        targets: [
            // Targets are the basic building blocks of a package. A target can define a module or a test suite.
            // Targets can depend on other targets in this package, and on products in packages this package depends on.
            .target(
                name: "DependenciesPackages",
                dependencies: [
                    .product(name: "ComposableArchitecture", package: "swift-composable-architecture")
                ]),
            .testTarget(
                name: "DependenciesPackagesTests",
                dependencies: ["DependenciesPackages"]),
        ]
    )
    ```

3. „É°„Ç§„É≥„ÅÆTarget„ÅÆË®≠ÂÆö > General > Frameworks, Libraries, and Embedded Content  „Å´ `DependenciesPackages` „ÇíËøΩÂä†„Åô„Çã

## „Ç´„Ç¶„É≥„Çø„Éº„Ç¢„Éó„É™„ÅÆ„Çµ„É≥„Éó„É´

[„Åì„Å°„Çâ](https://github.com/pointfreeco/swift-composable-architecture/blob/main/Examples/CaseStudies/SwiftUICaseStudies/01-GettingStarted-Counter.swift)„ÇíÂèÇËÄÉ„Å´‰ΩúÊàê„Åó„Å¶„Åø„Åü„ÅÑ„Å®ÊÄù„ÅÑ„Åæ„Åô„ÄÇ

### 1. Reducer„ÅÆ‰ΩúÊàê

```swift
struct Counter: Reducer {
    struct State: Equatable {
        var count = 0
    }

    enum Action: Equatable {
        case decrement
        case increment
    }

    func reduce(into state: inout State, action: Action) -> Effect<Action> {
        switch action {
        case .decrement:
            state.count -= 1
            return .none
        case .increment:
            state.count += 1
            return .none
        }
    }
}
```

### 2. View„ÅÆ‰øÆÊ≠£

```swift
struct CounterView: View {
    let store: StoreOf<Counter>

    var body: some View {
        WithViewStore(self.store, observe: { $0 }) { viewStore in
            HStack {
                Button {
                    viewStore.send(.decrement)
                } label: {
                    Image(systemName: "minus")
                }
                Text("\(viewStore.count)")
                    .monospacedDigit()
                Button {
                    viewStore.send(.increment)
                } label: {
                    Image(systemName: "plus")
                }
            }
        }
    }
}
```

### 3. Preview„ÅÆ‰øÆÊ≠£

```swift
struct CounterView_Previews: PreviewProvider {
    static var previews: some View {
        CounterView(
            store: Store(initialState: Counter.State()) {
              Counter()
            }
        )
    }
}
```

ÊåôÂãï„ÅÆÊßòÂ≠ê‚Üì „Å°„ÇÉ„Çì„Å®„Ç´„Ç¶„É≥„Éà„Ç¢„ÉÉ„Éó„Éª„ÉÄ„Ç¶„É≥„Åß„Åç„Å¶„Åæ„Åô„ÄÇ

![image1.gif](/images/bab64b94c5ac72/image1.gif)

# TCA + Supabase„Åß„É≠„Ç∞„Ç§„É≥ÁîªÈù¢„Çí‰Ωú„Å£„Å¶„Åø„Çã

„Åæ„Åö„ÅØSupabase„ÅÆSwiftÁî®„ÅÆ„É©„Ç§„Éñ„É©„É™„ÇíÂ∞éÂÖ•

[Supabase Swift Client - Introduction](https://supabase.com/docs/reference/swift/introduction)

`Package.swift` „Å´‰ª•‰∏ã„ÇíËøΩÂä†

```swift
let package = Package(
    ...
    dependencies: [
        ...
        .package(url: "https://github.com/supabase/supabase-swift", branch: "master"), // Add the package
    ],
    targets: [
        .target(
            name: "YourTargetName",
            dependencies: [
              .product(name: "Supabase", package: "supabase-swift")
            ] // Add as a dependency
        )
    ]
)
```

Ë©¶„Åó„Å´„É≠„Ç∞„Ç§„É≥„Åß„Åç„Çã„Åã‚Üì„ÅßÁ¢∫Ë™ç„Åó„Å¶„Åø„Åæ„Åô„ÄÇ

```swift
import Supabase
import SwiftUI

struct LoginView: View {
    // swiftlint:disable line_length
    let client = SupabaseClient(
        supabaseURL: URL(string: "...")!, // Ë©¶„Åôsupabase„ÅÆurl„ÇíÂÖ•Âäõ
        supabaseKey: "...") // // Ë©¶„Åôsupabase„ÅÆanon api ky„ÇíÂÖ•Âäõ
    // swiftlint:enable line_length
    var body: some View {
        VStack {
            Button("LOGIN") {
                Task.detached(priority: .background) {
                    do {
                        try await client.auth.signIn(email: "...", password: "...")
                        let session = try await client.auth.session
                        print("### Session Info: \(session)")
                    } catch {
                        print("### Sign In Error: \(error)")
                    }
                }
            }
        }
    }
}
```

„ÄåLOGIN„Äç„Éú„Çø„É≥„ÇíÊäº„Åó„Å¶„Çª„ÉÉ„Ç∑„Éß„É≥ÊÉÖÂ†±„Åå„É≠„Ç∞„Å´Ë°®Á§∫„Åï„Çå„Å¶„ÅÑ„Çå„Å∞OK„Åß„Åô„ÄÇ

## ÂÆüÈöõ„Å´„Å£„ÅΩ„ÅÑ„É≠„Ç∞„Ç§„É≥ÁîªÈù¢„Çí‰ΩúÊàê

### LoginButton

Â∞ÇÁî®„ÅÆLoginButton„ÅÆ„Ç≥„É≥„Éù„Éº„Éç„É≥„Éà„Çí‰Ωú„Å£„Å¶„ÅÑ„Åç„Åü„ÅÑ„Å®ÊÄù„ÅÑ„Åæ„Åô„ÄÇ‚Üì„ÅÆButtonStyle„ÅßË™øÊï¥„Åó„Å¶„ÅÑ„Åç„Åæ„Åô„ÄÇ

****SwiftUI„ÅÆButtonStyle****

[SwiftUI„ÅÆButtonStyle„Çí„Ç´„Çπ„Çø„Éû„Ç§„Ç∫ ÔΩúTAAT](https://note.com/taatn0te/n/n1ba90904df34)

[ButtonStyle | Apple Developer Documentation](https://developer.apple.com/documentation/swiftui/buttonstyle)

```swift
import SwiftUI

struct RoundedButtonStyle: ButtonStyle {
    @Environment(\.isEnabled)
    var isEnabled

    var color: Color = .blue
    private let disabledColor: Color = .init(uiColor: .lightGray)
    private let cornerRadius: CGFloat = 12.0

    func makeBody(configuration: Configuration) -> some View {
        configuration.label
            .padding()
            .fontWeight(.bold)
            .foregroundColor(.white)
            // ÊúâÂäπÁÑ°Âäπ„Åß„Ç´„É©„Éº„ÇíÂ§âÊõ¥
            .background(isEnabled ? color : disabledColor)
            // Êäº‰∏ãÊôÇ„Åã„Å©„ÅÜ„Åã„ÅßÈÄèÊòéÂ∫¶„ÇíÂ§âÊõ¥
            .opacity(configuration.isPressed ? 0.8 : 1.0)
            .clipShape(RoundedRectangle(cornerRadius: cornerRadius))
    }
}

struct LoginButton: View {
    @Binding var isDisabled: Bool
    var onClick: () -> Void

    var body: some View {
        Button(action: onClick, label: {
            Text("Login")
        })
        .buttonStyle(RoundedButtonStyle())
        .disabled(isDisabled)
    }
}

struct LoginButton_Previews: PreviewProvider {
    static var previews: some View {
        ForEach(["iPhone 14", "iPhone SE (3rd generation)", "iPad (10th generation)"], id: \.self) { deviceName in
            VStack {
                LoginButton(isDisabled: .constant(true)) {
                    print("onClick")
                }
                LoginButton(isDisabled: .constant(false)) {
                    print("onClick")
                }
            }
            .previewDevice(PreviewDevice(rawValue: deviceName))
            .previewDisplayName(deviceName)
        }
    }
}
```

‚ÜìPreviewË°®Á§∫„Åó„ÅüÊßòÂ≠ê

![image2.png](/images/bab64b94c5ac72/image2.png)

## TextFieldStyle„ÅÆ„Ç´„Çπ„Çø„É†

```swift
struct CustomTextFieldStyle: TextFieldStyle {
    @FocusState private var isFocused: Bool
    // swiftlint:disable identifier_name
    func _body(configuration: TextField<Self._Label>) -> some View {
        VStack {
            configuration
                .focused($isFocused)
            Divider().frame(height: 1).background(isFocused ? Color.customBlue : Color.lightBlack)
        }
    }
    // swiftlint:enable identifier_name
}
```

## Reducer„Éó„É≠„Éà„Ç≥„É´„ÇíÂÆüË£Ö„Åó„ÅüSession„Çí‰ΩúÊàê„Åô„Çã

```swift
struct Session: Reducer {
    struct State: Equatable {
        var isLoading = false
        var name = ""
        var password = ""
    }

    enum Action: Equatable {
        case login
        case setName(String)
        case setPassword(String)
        case startLoading
        case stopLoading
    }

    func reduce(into state: inout State, action: Action) -> Effect<Action> {
        switch action {
        case .login:
            state.isLoading = true
            return .run(priority: .background, operation: { [name = state.name, password = state.password] send in
                do {
                    try await client.auth.signIn(email: name, password: password)
                    let session = try await client.auth.session
                    print("### Session Info: \(session)")
                } catch {
                    print("### Sign Up Error: \(error)")
                }
                await send(.stopLoading)
            })
        case let .setName(arg):
            state.name = arg
            return .none
        case let .setPassword(arg):
            state.password = arg
            return .none
        case .startLoading:
            state.isLoading = true
            return .none
        case .stopLoading:
            state.isLoading = false
            return .none
        }
    }
}
```

ÊúÄÁµÇÁöÑ„Å™„É≠„Ç∞„Ç§„É≥ÁîªÈù¢„ÅÆÂÆüË£Ö

```swift

import Combine
import ComposableArchitecture
import Supabase
import SwiftUI

// swiftlint:disable line_length
let client = SupabaseClient(
    supabaseURL: URL(string: "...")!,
    supabaseKey: "...")
// swiftlint:enable line_length

struct Session: Reducer {
    struct State: Equatable {
        var isLoading = false
        var name = ""
        var password = ""
    }

    enum Action: Equatable {
        case login
        case setName(String)
        case setPassword(String)
        case startLoading
        case stopLoading
    }

    func reduce(into state: inout State, action: Action) -> Effect<Action> {
        switch action {
        case .login:
            state.isLoading = true
            return .run(priority: .background, operation: { [name = state.name, password = state.password] send in
                do {
                    try await client.auth.signIn(email: name, password: password)
                    let session = try await client.auth.session
                    print("### Session Info: \(session)")
                } catch {
                    print("### Sign Up Error: \(error)")
                }
                await send(.stopLoading)
            })
        case let .setName(arg):
            state.name = arg
            return .none
        case let .setPassword(arg):
            state.password = arg
            return .none
        case .startLoading:
            state.isLoading = true
            return .none
        case .stopLoading:
            state.isLoading = false
            return .none
        }
    }
}

struct ActivityIndicator: UIViewRepresentable {
    func makeUIView(context: UIViewRepresentableContext<ActivityIndicator>) -> UIActivityIndicatorView {
        return UIActivityIndicatorView(style: .large)
    }
    func updateUIView(_ uiView: UIActivityIndicatorView, context: UIViewRepresentableContext<ActivityIndicator>) {
        uiView.startAnimating()
    }
}

struct LoginView: View {
    let store: StoreOf<Session>
    @State var isDisabled = true

    var body: some View {
        WithViewStore(self.store, observe: { $0 }) { viewStore in
            ZStack {
                VStack(alignment: .center) {
                    VStack(spacing: 24) {
                        TextField("User name", text: viewStore.binding(get: \.name, send: Session.Action.setName))
                            .padding()
                            .background(Color(.systemGray6))
                            .cornerRadius(12.0)
                            .onChange(of: viewStore.name) { _ in
                                isDisabled = viewStore.name.isEmpty || viewStore.password.isEmpty
                            }
                        SecureField("Password",
                                    text: viewStore.binding(get: \.password, send: Session.Action.setPassword))
                            .padding()
                            .background(Color(.systemGray6))
                            .cornerRadius(12.0)
                            .onChange(of: viewStore.password) { _ in
                                isDisabled = viewStore.name.isEmpty || viewStore.password.isEmpty
                            }
                    }
                        .padding(.horizontal, 24)
                        .padding(.bottom, 24)
                    LoginButton(isDisabled: $isDisabled) {
                        viewStore.send(.login)
                    }
                }
                if viewStore.isLoading {
                    ActivityIndicator()
                }
            }
        }
    }
}

struct LoginView_Previews: PreviewProvider {
    static var previews: some View {
        LoginView(
            store: Store(initialState: Session.State()) {
                Session()
            }
        )
    }
}
```

# ÂèÇËÄÉURL

[Êó¢Â≠ò„ÅÆ Xcode „Éó„É≠„Ç∏„Çß„ÇØ„Éà„Çí SwiftPM „Åß„Éû„É´„ÉÅ„É¢„Ç∏„É•„Éº„É´Âåñ„Åô„ÇãÊúÄÂàù„ÅÆ„Çπ„ÉÜ„ÉÉ„Éó](https://zenn.dev/kalupas226/articles/73118709e316ad)

[SwiftUI„ÅÆViewModifier„Çí‰Ωø„Å£„Å¶View„Çí„Ç´„Çπ„Çø„Éû„Ç§„Ç∫„Åô„Çã - Qiita](https://qiita.com/k_awoki/items/107773d6b14107954b91)

[iOS„Ç∑„Éü„É•„É¨„Éº„Çø„Éº„ÅÆ„Ç≠„Éº„ÉÅ„Çß„Éº„É≥ÊÉÖÂ†±ÂâäÈô§ | hmhv](https://hmhv.info/2022/04/check-ios-simulator-keychain/)

[[SwiftUI][TCA] binding](https://zenn.dev/chiii/articles/db7371f5904b2e)

[TCA „Åß AsyncStream „Çí„ÉÜ„Çπ„Éà„Åô„ÇãÊñπÊ≥ï](https://zenn.dev/kalupas226/articles/634300ae1ca106)

[https://software.small-desk.com/development/2020/09/19/spmrealm-swift-package-for-package-depends-on-realm/](https://software.small-desk.com/development/2020/09/19/spmrealm-swift-package-for-package-depends-on-realm/)

[https://stackoverflow.com/questions/72092041/swiftui-focus-state-api-environment-variable-not-working](https://stackoverflow.com/questions/72092041/swiftui-focus-state-api-environment-variable-not-working)

[https://thehappyprogrammer.com/custom-textfield-in-swiftui](https://thehappyprogrammer.com/custom-textfield-in-swiftui)

[https://www.choge-blog.com/programming/swiftuicustomtextfieldstyle/](https://www.choge-blog.com/programming/swiftuicustomtextfieldstyle/)

[https://software.small-desk.com/development/2021/09/22/swiftui-howto-focusstate/](https://software.small-desk.com/development/2021/09/22/swiftui-howto-focusstate/)
