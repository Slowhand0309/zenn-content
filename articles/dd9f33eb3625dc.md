---
title: "ã€Flutterã€‘go_router / go_router_builderã¨BottomNavigationBarã®æ§‹ç¯‰ã‚¬ã‚¤ãƒ‰"
emoji: "ğŸ‰"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics:
  - "flutter"
  - "dart"
  - "go_router"
  - "go_router_builder"
published: true
published_at: "2024-01-02 20:00"
---
# ã¯ã˜ã‚ã«

ã“ã®è¨˜äº‹ã¯ go_router/go_router_builder ã‚’ä½¿ã£ã¦ BottomNavigationBar ã¨é€£æºã™ã‚‹æ–¹æ³•ã‚’æ®µéšçš„ã«è©¦ã—ã¦ã„ã£ãŸè¨˜äº‹ã«ãªã‚Šã¾ã™

# go_router

[go_router | Flutter Package](https://pub.dev/packages/go_router)

> ç•°ãªã‚‹ç”»é¢é–“ã‚’ç§»å‹•ã™ã‚‹ãŸã‚ã®ä¾¿åˆ©ãª URL ãƒ™ãƒ¼ã‚¹ã® API ã‚’æä¾›ã—ã¾ã™ã€‚go_router ã‚’ä½¿ç”¨ã™ã‚‹ã¨ã€Flutter ã®ç”»é¢é·ç§»ã‚„ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ç®¡ç†ã‚’éå¸¸ã«ã‚·ãƒ³ãƒ—ãƒ«ãªã‚³ãƒ¼ãƒ‰ã§å®Ÿè£…ã§ãã¾ã™

# go_router_builder

[go_router_builder | Dart Package](https://pub.dev/packages/go_router_builder)

> Flutter ã®å®£è¨€å‹ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã§ã‚ã‚‹ go_router ç”¨ã®builderã§ã™ã€‚go_router_builder ã‚’ä½¿ç”¨ã™ã‚‹ã¨ã€ç”Ÿæˆã•ã‚ŒãŸå¼·åŠ›ã«å‹æŒ‡å®šã•ã‚ŒãŸãƒ«ãƒ¼ãƒˆãƒ˜ãƒ«ãƒ‘ãƒ¼ã‚’ã‚µãƒãƒ¼ãƒˆã§ãã¾ã™

# ç’°å¢ƒæ§‹ç¯‰ã‚„æº–å‚™

å„ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚„ç’°å¢ƒ

```bash
$ fvm --version
2.4.1

$ fvm flutter --version
Flutter 3.16.5 â€¢ channel stable â€¢ https://github.com/flutter/flutter.git
Framework â€¢ revision 78666c8dc5 (5 days ago) â€¢ 2023-12-19 16:14:14 -0800
Engine â€¢ revision 3f3e560236
Tools â€¢ Dart 3.2.3 â€¢ DevTools 2.28.4

$ sw_vers
ProductName: macOS
ProductVersion: 13.4.1
ProductVersionExtra: (c)
BuildVersion: 22F770820d
```

## 1. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ä½œæˆ

ä»Šå›ã¯ `go_router_example` ã¨ã„ã†ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåã§é€²ã‚ã¦ã„ãã¾ã™ã€‚

```bash
mkdir go_router_example
cd go_router_example
fvm use 3.16.5 --force
fvm flutter create .
```

## 2. pubã®è¿½åŠ 

```yaml:pubspec.yaml
dependencies:
  go_router: ^13.0.0

dev_dependencies:
  build_runner: ^2.4.7
  go_router_builder: ^2.4.0
```

ä¸Šè¨˜ã‚’è¿½åŠ ã—ã¦ `fvm flutter pub get` ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚

# å®Ÿè£…

## 1.  Homeãƒ«ãƒ¼ãƒˆã‚’å®Ÿè£…

### 1-1.  `lib/hoge_page.dart` ã®ä½œæˆ

äº‹å‰ã« `HomePage` ã‚’ä½œæˆã—ã¦ãŠãã¾ã™ã€‚ä¸­èº«ã¯HomePageãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹å˜ç´”ãªã‚‚ã®ã«ãªã‚Šã¾ã™ã€‚

```dart:lib/hoge_page.dart
import 'package:flutter/material.dart';

class HomePage extends StatelessWidget {
  const HomePage({super.key});

  @override
  Widget build(BuildContext context) {
    return const Scaffold(
      body: Center(
        child: Text('Home Page'),
      ),
    );
  }
}
```

### 1-2.  `lib/router/router.dart` ã®ä½œæˆ

ä»¥ä¸‹ã®å†…å®¹ã§ `router/router.dart` ã‚’ä½œæˆã—ã¾ã™ã€‚ ã¾ãŸ`HomePage` ã®importã‚‚è¿½åŠ ã—ã¨ãã¾ã™ã€‚

```dart:lib/router/router.dart
import 'package:flutter/material.dart';
import 'package:go_router/go_router.dart';
import 'package:go_router_example/hoge_page.dart';

part 'router.g.dart';

final GlobalKey<NavigatorState> rootNavigatorKey = GlobalKey<NavigatorState>();

final router = GoRouter(
  routes: $appRoutes,
  initialLocation: HomeRoute.path,
  navigatorKey: rootNavigatorKey,
);

@TypedGoRoute<HomeRoute>(
  path: HomeRoute.path,
)
class HomeRoute extends GoRouteData {
  const HomeRoute();

  static const path = '/home';

  @override
  Widget build(BuildContext context, GoRouterState state) => const HomePage();
}
```

ä»¥ä¸‹ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿæ–½ã— `router.g.dart` ã‚’ç”Ÿæˆã—ã¾ã™ã€‚

```bash
fvm flutter pub run build_runner build --delete-conflicting-outputs
```

:::details ã“ã®æ™‚ç‚¹ã§ç”Ÿæˆã•ã‚ŒãŸ `router.g.dart`

```dart
// GENERATED CODE - DO NOT MODIFY BY HAND

part of 'router.dart';

// **************************************************************************
// GoRouterGenerator
// **************************************************************************

List<RouteBase> get $appRoutes => [
      $homeRoute,
    ];

RouteBase get $homeRoute => GoRouteData.$route(
      path: '/home',
      factory: $HomeRouteExtension._fromState,
    );

extension $HomeRouteExtension on HomeRoute {
  static HomeRoute _fromState(GoRouterState state) => const HomeRoute();

  String get location => GoRouteData.$location(
        '/home',
      );

  void go(BuildContext context) => context.go(location);

  Future<T?> push<T>(BuildContext context) => context.push<T>(location);

  void pushReplacement(BuildContext context) =>
      context.pushReplacement(location);

  void replace(BuildContext context) => context.replace(location);
}
```

:::

### 1-2.  `lib/app.dart` ã¨ `lib/main.dart` ã®ä½œæˆ

æœ€å¾Œã« **`app.dart`** ã¨ **`main.dart`** ã‚’ä»¥ä¸‹å†…å®¹ã§ä½œæˆã—ã¾ã™ã€‚

- app.dart

    ```dart:lib/app.dart
    import 'package:flutter/material.dart';
    import 'package:go_router_example/router/router.dart';
    
    class App extends StatelessWidget {
      const App({super.key});
    
      @override
      Widget build(BuildContext context) {
        return MaterialApp.router(
          title: 'Router Demo',
          theme: ThemeData(
            colorScheme: ColorScheme.fromSeed(seedColor: Colors.deepPurple),
            useMaterial3: true,
          ),
          routerConfig: router,
        );
      }
    }
    ```

- main.dart

    ```dart:lib/main.dart
    import 'package:flutter/material.dart';
    import 'package:go_router_example/app.dart';
    
    void main() {
      runApp(const App());
    }
    ```

å®Ÿè¡Œã—ã¦ã¿ã¦ `HomePage` ãŒè¡¨ç¤ºã•ã‚Œã¨ã‘ã°OKã§ã™ã€‚

![image1.png](/images/dd9f33eb3625dc/image1.png =350x)

## 2.  BottomNavigationBarã¨é€£æº (çŠ¶æ…‹ãŒæ®‹ã‚‰ãªã„ãƒ‘ã‚¿ãƒ¼ãƒ³)

æ¬¡ã«å…ˆã»ã©ä½œæˆã—ãŸ `HomePage` ã¨æ–°ãŸã«ä½œæˆã™ã‚‹ `SettingsPage` ã®2ãƒšãƒ¼ã‚¸ã‚’åˆ‡ã‚Šæ›¿ãˆã‚Œã‚‹BottomNavigationBarã‚’æŒã¤ãƒšãƒ¼ã‚¸ã‚’ä½œæˆã—ã¦ã¿ãŸã„ã¨æ€ã„ã¾ã™ã€‚

ä½†ã— `HomePage` ã§æ“ä½œã—ã¦ `SettingsPage` ã¸åˆ‡ã‚Šæ›¿ãˆã¦ã‚‚ `HomePage` ã§**æ“ä½œã—ãŸå†…å®¹ã¯æ®‹ã‚‰ãšã‚¯ãƒªã‚¢ã•ã‚Œã¦ã—ã¾ã†ãƒ‘ã‚¿ãƒ¼ãƒ³**ã¨ãªã‚Šã¾ã™ã€‚å¾Œè¿°ã™ã‚‹ã‚¯ãƒªã‚¢ã•ã‚Œãªã„ãƒ‘ã‚¿ãƒ¼ãƒ³ã®æ¯”è¼ƒã¨ã—ã¦ã“ã¡ã‚‰ã‚‚è©¦ã—ã¦ã„ãã¾ã™ã€‚

BottomNavigationBarã‚’æŒã¤ãƒšãƒ¼ã‚¸ã¨ã—ã¦ `TopPage` ã‚’ä½œæˆã™ã‚‹å‰æã§ `router/router.dart` ã‚’ä¿®æ­£ã—ã¾ã™ã€‚

### 2-1. `lib/settings_page.dart` ã¨ `lib/top_page.dart` ã‚’ä½œæˆ

- `settings_page.dart`

    ```dart:lib/settings_page.dart
    import 'package:flutter/material.dart';
    
    class SettingsPage extends StatelessWidget {
      const SettingsPage({super.key});
    
      @override
      Widget build(BuildContext context) {
        return const Scaffold(
          body: Center(
            child: Text('Settings Page'),
          ),
        );
      }
    }
    ```

- `top_page.dart`

    ```dart:lib/top_page.dart
    import 'package:flutter/material.dart';
    import 'package:go_router_example/router/router.dart';
    
    enum PageIndex { home, settings }
    
    class TopPage extends StatefulWidget {
      const TopPage({required this.child, super.key});
    
      final Widget child;
    
      @override
      State<TopPage> createState() => _TopPageState();
    }
    
    class _TopPageState extends State<TopPage> {
      int _selectedIndex = 0;
    
      @override
      Widget build(BuildContext context) {
        return Scaffold(
          body: widget.child,
          bottomNavigationBar: _bottomNavigationBar(context),
        );
      }
    
      BottomNavigationBar _bottomNavigationBar(BuildContext context) {
        return BottomNavigationBar(
          currentIndex: _selectedIndex,
          items: const <BottomNavigationBarItem>[
            BottomNavigationBarItem(
              icon: Icon(Icons.home),
              label: "Home",
            ),
            BottomNavigationBarItem(
              icon: Icon(Icons.settings),
              label: "Settings",
            ),
          ],
          onTap: (int index) {
            setState(() {
              _selectedIndex = index;
            });
            if (index == PageIndex.home.index) {
              const HomeRoute().go(context);
            } else if (index == PageIndex.settings.index) {
              const SettingsRoute().go(context);
            }
          },
        );
      }
    }
    ```

### 2-2. `lib/router/router.dart` ã« `SettingsPage` ç”¨ã® `SettingsRoute` è¿½åŠ 

```dart:lib/router/router.dart
@TypedGoRoute<SettingsRoute>(
  path: SettingsRoute.path,
)
class SettingsRoute extends GoRouteData {
  const SettingsRoute();

  static const path = '/settings';

  @override
  Widget build(BuildContext context, GoRouterState state) => const SettingsPage();
}
```

### 2-3.  `lib/router/router.dart` ã« `TopShellRoute` ã‚’è¿½åŠ 

- `TopPage` ç”¨ã®[ShellRouteData](https://pub.dev/documentation/go_router/latest/go_router/ShellRouteData-class.html)ã«ãªã‚Šã¾ã™
  - å­ã®routeã¨ã—ã¦ `HomeRoute` ã¨ `SettingsRoute` ã‚’æŒ‡å®šã—ã¦ã„ã¾ã™
  - `TopShellRoute` ç”¨ã« [NavigatorState](https://api.flutter.dev/flutter/widgets/NavigatorState-class.html) ã‚’è¨­å®šã—ã¦ã„ã¾ã™
    - **`$navigatorKey`**Â ã¨ã„ã†staticãªã‚¯ãƒ©ã‚¹å¤‰æ•°ã«è¨­å®šã—ã¾ã™

```dart:lib/router/router.dart
final GlobalKey<NavigatorState> rootNavigatorKey = GlobalKey<NavigatorState>();
// â†“æ–°è¦ã«è¿½åŠ 
final GlobalKey<NavigatorState> shellNavigatorKey = GlobalKey<NavigatorState>();

// ....

@TypedShellRoute<TopShellRoute>(
  routes: <TypedRoute<RouteData>>[
    TypedGoRoute<HomeRoute>(path: HomeRoute.path),
    TypedGoRoute<SettingsRoute>(path: SettingsRoute.path),
  ],
)
class TopShellRoute extends ShellRouteData {
  const TopShellRoute();

  static final GlobalKey<NavigatorState> $navigatorKey = shellNavigatorKey;

  @override
  Widget builder(
    BuildContext context,
    GoRouterState state,
    Widget navigator,
  ) {
    return TopPage(child: navigator);
  }
}
```

:::details ã“ã“ã¾ã§ã® `router.dart` å…¨ä½“ã¯ã“ã¡ã‚‰

```dart
import 'package:flutter/material.dart';
import 'package:go_router/go_router.dart';
import 'package:go_router_example/hoge_page.dart';
import 'package:go_router_example/settings_page.dart';
import 'package:go_router_example/top_page.dart';

part 'router.g.dart';

final GlobalKey<NavigatorState> rootNavigatorKey = GlobalKey<NavigatorState>();
final GlobalKey<NavigatorState> shellNavigatorKey = GlobalKey<NavigatorState>();

final router = GoRouter(
  routes: $appRoutes,
  initialLocation: HomeRoute.path,
  navigatorKey: rootNavigatorKey,
);

@TypedShellRoute<TopShellRoute>(
  routes: <TypedRoute<RouteData>>[
    TypedGoRoute<HomeRoute>(path: HomeRoute.path),
    TypedGoRoute<SettingsRoute>(path: SettingsRoute.path),
  ],
)
class TopShellRoute extends ShellRouteData {
  const TopShellRoute();

  static final GlobalKey<NavigatorState> $navigatorKey = shellNavigatorKey;

  @override
  Widget builder(
    BuildContext context,
    GoRouterState state,
    Widget navigator,
  ) {
    return TopPage(child: navigator);
  }
}

@TypedGoRoute<HomeRoute>(
  path: HomeRoute.path,
)
class HomeRoute extends GoRouteData {
  const HomeRoute();

  static const path = '/home';

  @override
  Widget build(BuildContext context, GoRouterState state) => const HomePage();
}

@TypedGoRoute<SettingsRoute>(
  path: SettingsRoute.path,
)
class SettingsRoute extends GoRouteData {
  const SettingsRoute();

  static const path = '/settings';

  @override
  Widget build(BuildContext context, GoRouterState state) =>
      const SettingsPage();
}
```

:::

### 2-4. `lib/home_page.dart` ã‚’å†…éƒ¨ã§ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ã®stateã‚’æŒã¤ã‚ˆã†ã«å¤‰æ›´

- `hoge_page.dart`

    ```dart:lib/hoge_page.dart
    import 'package:flutter/material.dart';
    
    class HomePage extends StatefulWidget {
      const HomePage({super.key});
    
      @override
      State<HomePage> createState() => _HomePageState();
    }
    
    class _HomePageState extends State<HomePage> {
      int _counter = 0;
    
      void _incrementCounter() {
        setState(() {
          _counter++;
        });
      }
    
      @override
      Widget build(BuildContext context) {
        return Scaffold(
          body: Center(
            child: Column(
              mainAxisAlignment: MainAxisAlignment.center,
              children: <Widget>[
                const Text(
                  'You have pushed the button this many times:',
                ),
                Text(
                  '$_counter',
                  style: Theme.of(context).textTheme.headlineMedium,
                ),
              ],
            ),
          ),
          floatingActionButton: FloatingActionButton(
            onPressed: _incrementCounter,
            tooltip: 'Increment',
            child: const Icon(Icons.add),
          ),
        );
      }
    }
    ```

ã“ã“ã¾ã§ããŸã‚‰ `fvm flutter pub run build_runner build --delete-conflicting-outputs` ã‚’å®Ÿæ–½ã—ã€ `router.g.dart` ã‚’ç”Ÿæˆã—ã¨ãã¾ã™ã€‚

å®Ÿè¡Œã—ã¦ä»¥ä¸‹ã®æ§˜ã«å˜ç´”ã« `Home Page` ã¨ `Settings Page` ãŒåˆ‡ã‚Šæ›¿ã‚ã‚‹æ§˜ã«ãªã£ã¨ã‘ã°OKã§ã™ã€‚

ãŸã å…ˆã«è¿°ã¹ãŸé€šã‚Šã€**ã‚¿ãƒ–ã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹ã¨æ“ä½œã—ãŸå†…å®¹(state)ãŒã‚¯ãƒªã‚¢ã•ã‚Œã‚‹ã®ã§ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ãŒ0ã«æˆ»ã£ã¦ã„ã‚‹ã¨æ€ã„ã¾ã™**ã€‚

![image2.gif](/images/dd9f33eb3625dc/image2.gif =350x)

## 3.  BottomNavigationBarã¨é€£æº (çŠ¶æ…‹ãŒæ®‹ã‚‹ãƒ‘ã‚¿ãƒ¼ãƒ³)

### 3-1. å„Sub Route (HomeRoute, SettingsRoute) ç”¨ã® **[StatefulShellBranch](https://pub.dev/documentation/go_router/latest/go_router/StatefulShellBranch-class.html)** ã‚’ä½œæˆ

`router.dart` ã«ä»¥ä¸‹ã‚’è¿½åŠ ã—ã¾ã™ã€‚

```dart:lib/router/router.dart
// â†“NavigatorStateã‚’æ–°è¦è¿½åŠ 
final GlobalKey<NavigatorState> homeNavigatorKey = GlobalKey<NavigatorState>();
final GlobalKey<NavigatorState> settingsNavigatorKey =
    GlobalKey<NavigatorState>();

// ...

class HomeShellBranchData extends StatefulShellBranchData {
  const HomeShellBranchData();
  static final GlobalKey<NavigatorState> $navigatorKey = homeNavigatorKey;
}

class SettingsShellBranchData extends StatefulShellBranchData {
  const SettingsShellBranchData();
  static final GlobalKey<NavigatorState> $navigatorKey = settingsNavigatorKey;
}
```

### 3-2. @TypedShellRoute ã‚’ @TypedStatefulShellRoute ã«å¤‰æ›´

```dart:lib/router/router.dart
@TypedStatefulShellRoute<TopShellRoute>(
  branches: <TypedStatefulShellBranch<StatefulShellBranchData>>[
    TypedStatefulShellBranch<HomeShellBranchData>(
      routes: <TypedRoute<RouteData>>[
        TypedGoRoute<HomeRoute>(path: HomeRoute.path),
      ],
    ),
    TypedStatefulShellBranch<SettingsShellBranchData>(
      routes: <TypedRoute<RouteData>>[
        TypedGoRoute<SettingsRoute>(path: SettingsRoute.path),
      ],
    ),
  ],
)
```

ã“ã®æ™‚ç‚¹ã§ã¯ `TopShellRoute` ãŒã‚¨ãƒ©ãƒ¼ã«ãªã£ã¦ã„ã‚‹ã‹ã¨æ€ã„ã¾ã™ã€‚

### 3-3. TopShellRoute ã‚¯ãƒ©ã‚¹ãŒ [StatefulShellRouteData](https://pub.dev/documentation/go_router/latest/go_router/StatefulShellRouteData-class.html) ã‚’ç¶™æ‰¿ã™ã‚‹æ§˜ã«ä¿®æ­£

```dart:lib/router/router.dart
class TopShellRoute extends StatefulShellRouteData {
  const TopShellRoute();

  static final GlobalKey<NavigatorState> $navigatorKey = shellNavigatorKey;

  @override
  Widget builder(
    BuildContext context,
    GoRouterState state,
    StatefulNavigationShell navigator,
  ) {
    return TopPage(child: navigator);
  }
}
```

### 3-4. TopPage ãŒ [StatefulNavigationShell](https://pub.dev/documentation/go_router/latest/go_router/StatefulNavigationShell-class.html) ã‚’å—ã‘å–ã‚Œã‚‹æ§˜ã«ä¿®æ­£

```dart:lib/top_page.dart
import 'package:flutter/material.dart';
import 'package:go_router/go_router.dart';

enum PageIndex { home, settings }

class TopPage extends StatefulWidget {
  const TopPage({required this.navigationShell, super.key});

  final StatefulNavigationShell navigationShell;

  @override
  State<TopPage> createState() => _TopPageState();
}

class _TopPageState extends State<TopPage> {
  @override
  Widget build(BuildContext context) {
    return Scaffold(
      body: widget.navigationShell,
      bottomNavigationBar: _bottomNavigationBar(context),
    );
  }

  BottomNavigationBar _bottomNavigationBar(BuildContext context) {
    return BottomNavigationBar(
      currentIndex: widget.navigationShell.currentIndex,
      items: const <BottomNavigationBarItem>[
        BottomNavigationBarItem(
          icon: Icon(Icons.home),
          label: "Home",
        ),
        BottomNavigationBarItem(
          icon: Icon(Icons.settings),
          label: "Settings",
        ),
      ],
      onTap: (int index) {
        widget.navigationShell.goBranch(
          index,
          initialLocation: index == widget.navigationShell.currentIndex,
        );
      },
    );
  }
}
```

å…ˆã»ã©ã¾ã§ã® `BottomNavigationBar` ã® `currentIndex` ã‚’åˆ¶å¾¡ã™ã‚‹ç›®çš„ã® `_selectedIndex`  ãŒ `StatefulNavigationShell` ã® `currentIndex` ã«ç½®ãæ›ã‚ã£ã¦ã„ã¾ã™ã€‚

ã¾ãŸã‚¿ãƒƒãƒ—æ™‚ã®é·ç§»ã§ã¯ [StatefulNavigationShell#goBranch](https://pub.dev/documentation/go_router/latest/go_router/StatefulNavigationShell/goBranch.html) ã‚’ä½¿ç”¨ã—ã¦é·ç§»ã™ã‚‹æ§˜ã«å¤‰æ›´ã—ã¦ã¾ã™ã€‚

ã“ã“ã¾ã§ã§ããŸã‚‰ `fvm flutter pub run build_runner build --delete-conflicting-outputs`  ã‚’å®Ÿæ–½ã— `router.g.dart` ã‚’ç”Ÿæˆã—ã¨ãã¾ã™ã€‚

:::details ã“ã®æ™‚ç‚¹ã® `router.dart`

```dart
import 'package:flutter/material.dart';
import 'package:go_router/go_router.dart';
import 'package:go_router_example/hoge_page.dart';
import 'package:go_router_example/settings_page.dart';
import 'package:go_router_example/top_page.dart';

part 'router.g.dart';

final GlobalKey<NavigatorState> rootNavigatorKey = GlobalKey<NavigatorState>();
final GlobalKey<NavigatorState> shellNavigatorKey = GlobalKey<NavigatorState>();
final GlobalKey<NavigatorState> homeNavigatorKey = GlobalKey<NavigatorState>();
final GlobalKey<NavigatorState> settingsNavigatorKey =
    GlobalKey<NavigatorState>();

final router = GoRouter(
  routes: $appRoutes,
  initialLocation: HomeRoute.path,
  navigatorKey: rootNavigatorKey,
);

@TypedStatefulShellRoute<TopShellRoute>(
  branches: <TypedStatefulShellBranch<StatefulShellBranchData>>[
    TypedStatefulShellBranch<HomeShellBranchData>(
      routes: <TypedRoute<RouteData>>[
        TypedGoRoute<HomeRoute>(path: HomeRoute.path),
      ],
    ),
    TypedStatefulShellBranch<SettingsShellBranchData>(
      routes: <TypedRoute<RouteData>>[
        TypedGoRoute<SettingsRoute>(path: SettingsRoute.path),
      ],
    ),
  ],
)
class TopShellRoute extends StatefulShellRouteData {
  const TopShellRoute();

  static final GlobalKey<NavigatorState> $navigatorKey = shellNavigatorKey;

  @override
  Widget builder(
    BuildContext context,
    GoRouterState state,
    StatefulNavigationShell navigator,
  ) {
    return TopPage(navigationShell: navigator);
  }
}

class HomeShellBranchData extends StatefulShellBranchData {
  const HomeShellBranchData();
  static final GlobalKey<NavigatorState> $navigatorKey = homeNavigatorKey;
}

class SettingsShellBranchData extends StatefulShellBranchData {
  const SettingsShellBranchData();
  static final GlobalKey<NavigatorState> $navigatorKey = settingsNavigatorKey;
}

@TypedGoRoute<HomeRoute>(
  path: HomeRoute.path,
)
class HomeRoute extends GoRouteData {
  const HomeRoute();

  static const path = '/home';

  @override
  Widget build(BuildContext context, GoRouterState state) => const HomePage();
}

@TypedGoRoute<SettingsRoute>(
  path: SettingsRoute.path,
)
class SettingsRoute extends GoRouteData {
  const SettingsRoute();

  static const path = '/settings';

  @override
  Widget build(BuildContext context, GoRouterState state) =>
      const SettingsPage();
}
```

:::

å®Ÿè¡Œã—ã¦ã¿ã‚‹ã¨ã€ä»Šå›ã¯**ã‚¿ãƒ–ã‚’åˆ‡ã‚Šæ›¿ãˆã¦ã‚‚æ“ä½œã—ãŸå†…å®¹(state)ãŒæ®‹ã£ã¦ãŠã‚Šã€ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ã®å€¤ãŒãã®ã¾ã¾ã«ãªã£ã¦ã„ã‚‹ã®ãŒåˆ†ã‹ã‚‹ã¨æ€ã„ã¾ã™**ã€‚

![image3.gif](/images/dd9f33eb3625dc/image3.gif =350x)

## 4.  fullscreenã®ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã‚’è¡¨ç¤º (ãŠã¾ã‘)

BottomNavigationBarå†…ã®ãƒšãƒ¼ã‚¸ä¸Šã§ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã¨fullscreenã®ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ãŒè¡¨ç¤ºã•ã‚Œã‚‹ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’å®Ÿè£…ã—ã¦è¦‹ãŸã„ã¨æ€ã„ã¾ã™ã€‚è¨­å®šç”»é¢(SettingsPage)ä¸Šã§ã‚«ãƒ©ãƒ¼ãƒ”ãƒƒã‚«ãƒ¼ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã‚’è¡¨ç¤ºã™ã‚‹æ§˜ãªã‚±ãƒ¼ã‚¹ã‚’æƒ³å®šã—ã¦é€²ã‚ã¦ã„ãã¾ã™ã€‚

### 4-1. ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ç”¨ã®ç”»é¢ã‚’è¿½åŠ 

`lib/color_picker_dialog.dart` ã‚’ä»¥ä¸‹å†…å®¹ã§ä½œæˆã—ã¾ã™ã€‚

```dart:lib/color_picker_dialog.dart
import 'package:flutter/material.dart';

class ColorPickerDialog extends StatelessWidget {
  const ColorPickerDialog({super.key});

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: AppBar(title: const Text('ColorPickerDialog')),
      body: Container(
        color: Colors.deepPurple.shade300,
        child: const Center(
          child: Text('ColorPickerDialog'),
        ),
      ),
    );
  }
}
```

### 4-2. `router.dart` ä¿®æ­£

ä»¥ä¸‹ã‚’è¿½åŠ ã—ã¾ã™ã€‚

```dart:lib/router/router.dart
@TypedGoRoute<ColorPickerDialogRoute>(
  path: ColorPickerDialogRoute.path,
)
class ColorPickerDialogRoute extends GoRouteData {
  const ColorPickerDialogRoute();

  static const path = '/color_picker_dialog';

  @override
  Page<void> buildPage(BuildContext context, GoRouterState state) =>
      MaterialPage<Object>(
        fullscreenDialog: true,
        key: state.pageKey,
        child: const ColorPickerDialog(),
      );
}
```

### 4-3. `settings_page.dart` ä¿®æ­£

```dart:lib/settings_page.dart
import 'package:flutter/material.dart';
import 'package:go_router_example/router/router.dart';

class SettingsPage extends StatelessWidget {
  const SettingsPage({super.key});

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      body: Center(
        child: ElevatedButton(
            onPressed: () => const ColorPickerDialogRoute().push(context),
            child: const Text('Show Color Picker Dialog')),
      ),
    );
  }
}
```

ã“ã“ã¾ã§ã§ããŸã‚‰ `fvm flutter pub run build_runner build --delete-conflicting-outputs`  ã‚’å®Ÿæ–½ã— `router.g.dart` ã‚’ç”Ÿæˆã—å®Ÿè¡Œã—ã¦ã¿ã¾ã™ã€‚

â†“ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã‚Œã°OKã§ã™ã€‚

![image4.gif](/images/dd9f33eb3625dc/image4.gif =350x)

# ãƒªãƒã‚¸ãƒˆãƒª

[https://github.com/Slowhand0309/go_router_example](https://github.com/Slowhand0309/go_router_example)

ä»Šå›è©¦ã—ãŸåˆ†ã¯â†‘ã“ã¡ã‚‰ã«å…¬é–‹ã—ã¦ã¾ã™ã€‚

# ã“ã®è¨˜äº‹ã¯ä»¥ä¸‹ã®æƒ…å ±ã‚’å‚è€ƒã«ã—ã¦åŸ·ç­†ã—ã¾ã—ãŸ

- [ã€Flutterã€‘go_router ã‚’ã‚¿ã‚¤ãƒ—ã‚»ãƒ¼ãƒ•ã«ä½¿ã†æ–¹æ³•ã€go_router_builderã€‘](https://zenn.dev/flutteruniv_dev/articles/20220801-135028-flutter-go-router-builder)
- [Integrating Bottom Navigation with Go Router in Flutter | by onat Ã§ipli | Flutter Community | Sep, 2023 | Medium](https://medium.com/flutter-community/integrating-bottom-navigation-with-go-router-in-flutter-c4ec388da16a)
- [packages/packages/go_router_builder/example/lib/shell_route_example.dart at main Â· flutter/packages](https://github.com/flutter/packages/blob/main/packages/go_router_builder/example/lib/shell_route_example.dart)
- [ã€Flutterã€‘ go_routerã§TabBarView(+Î± in BottomNavigationBar)ã®ç”»é¢é·ç§»ã®æ–¹æ³•](https://zenn.dev/miyaken12/articles/40e1565c2dfe70)
- [[ç¶š] go_routerã§BottomNavigationBarã®æ°¸ç¶šåŒ–ã«æŒ‘æˆ¦ã™ã‚‹(StatefulShellRoute)](https://zenn.dev/flutteruniv_dev/articles/stateful_shell_route#statefulshellroute%E3%81%AE%E4%BD%BF%E3%81%84%E6%96%B9)