---
title: "ã€Flutterã€‘Storybookãƒ©ã‚¤ã‚¯ã«ä½¿ãˆã‚‹Monarchã‚’è©¦ã—ã¦ã¿ã‚‹"
emoji: "ğŸ“š"
type: "tech"
topics:
  - "flutter"
  - "monarch"
  - "dart"
  - "storybook"
published: true
published_at: "2022-08-11 07:23"
---

# [Build high-quality UIs with ease | Monarch](https://monarchapp.io/)
Monarchã¯Flutterã§Storybookã¿ãŸãã€Widgetã®ç¢ºèªã‚„ãƒ‡ãƒãƒƒã‚°ã€ãƒ†ã‚¹ãƒˆã‚’è¡Œã†ç‚ºã®ãƒ„ãƒ¼ãƒ«ã§ã€
è‰²ã€…å……å®Ÿã—ã¦ãã†ãªã®ã§ã€è©¦ã—ã¦ã¿ãŸã„ã¨æ€ã„ã¾ã™ã€‚

## è©¦ã—ãŸç’°å¢ƒ

```sh
$ sw_vers
ProductName:	macOS
ProductVersion:	12.4
BuildVersion:	21F79
```

## ãƒ†ã‚¹ãƒˆç”¨ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆ

```sh
$ mkdir monarch_sample
$ cd monarch_sample
$ fvm use 3.0.5 --force
$ fvm flutter create --org com.sample.monarch .
```

## ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
[ã“ã¡ã‚‰](https://monarchapp.io/docs/install)ã‚’å‚è€ƒã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ã„ãã¾ã™ã€‚
â€» macosã®å ´åˆã¯ã€äº‹å‰ã«XcodeãŒå¿…è¦ã§ã™ã€‚

```sh
$ curl -O https://d2dpq905ksf9xw.cloudfront.net/macos/monarch_macos_1.7.8.zip
$ unzip monarch_macos_1.7.8.zip
```
`monarch/bin` ã«ãƒ‘ã‚¹ã‚’é€šã—ã¦ã€`monarch` ã‚³ãƒãƒ³ãƒ‰ãŒä½¿ãˆã‚‹ã‚ˆã†ã«ã—ã¦ãŠãã€‚

## åˆæœŸåŒ–ã—ã¦èµ·å‹•
å…ˆç¨‹ã® `monarch_sample` ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç›´ä¸‹ã«ç§»å‹•ã—ã€ä»¥ä¸‹ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿæ–½ã—ã¾ã™ã€‚

```sh
$ monarch init
```
â†‘ã‚’å®Ÿæ–½ã™ã‚‹ã¨ `pubspec.yaml` ã«ã¯ä»¥ä¸‹ãŒè¿½åŠ ã•ã‚Œã¦ã„ã¾ã—ãŸã€‚

```yml
dev_dependencies:
  monarch: ^2.3.0
  build_runner: ^2.1.0
```
ã¾ãŸã€ä»¥ä¸‹ã® `build.yaml` ã¨ã‚µãƒ³ãƒ—ãƒ«ã® `stories` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãŒä½œæˆã•ã‚Œã¦ã„ã¾ã—ãŸã€‚
```yml
targets:
  $default:
    sources:
      - $package$
      - lib/**
      - stories/**
```
ã‚µãƒ³ãƒ—ãƒ«ã¨ã—ã¦ä½œæˆã•ã‚ŒãŸã€`stories/sample_button.dart` ã¨ `stories/sample_button_stories.dart` ã¯ä»¥ä¸‹ã®å†…å®¹ã§ä½œæˆã•ã‚Œã¦ã„ã¾ã—ãŸã€‚

:::details ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã¯ã“ã¡ã‚‰

```dart:stories/sample_button.dart
import 'package:flutter/material.dart';
import 'package:flutter/widgets.dart';

enum ButtonStyles { primary, secondary, disabled }

class Button extends StatelessWidget {
  final String text;
  final ButtonStyles style;

  Button(this.text, this.style);
  @override
  Widget build(BuildContext context) {
    return Center(
        child: TextButton(
            onPressed: () => null,
            style: TextButton.styleFrom(
                primary: getPrimaryColor(),
                backgroundColor: getBackgroundColor(),
                side: style == ButtonStyles.secondary
                    ? BorderSide(width: 0, color: Colors.black87)
                    : null),
            child: Text(this.text)));
  }

  Color getPrimaryColor() {
    switch (style) {
      case ButtonStyles.primary:
        return Colors.white;
      case ButtonStyles.secondary:
        return Colors.black87;
      case ButtonStyles.disabled:
        return Colors.white;
      default:
        return Colors.white;
    }
  }

  Color getBackgroundColor() {
    switch (style) {
      case ButtonStyles.primary:
        return Colors.green;
      case ButtonStyles.secondary:
        return Colors.white;
      case ButtonStyles.disabled:
        return Color(0xFFE0E0E0);
      default:
        return Colors.green;
    }
  }
}
```

```dart:stories/sample_button_stories.dart
import 'package:flutter/material.dart';
import 'sample_button.dart';

Widget primary() => Button(
  'Button', ButtonStyles.primary);

Widget secondary() => Button(
  'Button', ButtonStyles.secondary);

Widget disabled() => Button(
  'Button', ButtonStyles.disabled);
```
:::

æ—©é€Ÿã€èµ·å‹•ã—ã¦ã¿ã¾ã™ã€‚
```sh
$ monarch run 
Using flutter sdk at /Users/xxxx/fvm/versions/3.0.5/bin/flutter
Enabling Flutter for desktop

Downloading the Monarch UI for this project's flutter version...

  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100 31.4M  100 31.4M    0     0  6578k      0  0:00:04  0:00:04 --:--:-- 6750k

Extracting Monarch UI zip... Done.

Starting Monarch.

Preparing stories...
Preparing stories completed, took 47.6sec.

Launching Monarch app...
Launching Monarch app completed, took 2.6sec.

Attaching to stories...
Attaching to stories completed, took 16.5sec.

Setting up stories watch...
3.1sec elapsed
Setting up stories watch completed, took 4.5sec.

Monarch key commands:
r Hot reload (default).
R Hot restart.
h Show this list of commands.
âŒƒC Quit.

Monarch is ready. Project changes will reload automatically with hot reload.
Press "R" to force a hot restart.
```

`fvm` ã‚’ä½¿ç”¨ã—ã¦ã„ãŸã‚‰ `fvm` ã®flutter sdkã‚’ä½¿ç”¨ã™ã‚‹ã‚ˆã†ã§ã™ã€‚ã¾ãŸã€flutter sdk ã® desktop ã‚’æœ‰åŠ¹åŒ–ã—ã¦ã„ã¾ã™ã€‚
å®Ÿè¡Œã™ã‚‹ã¨å°‚ç”¨ã®ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ã‚¢ãƒ—ãƒªãŒèµ·å‹•ã—ã€Storiesã‚’é¸æŠã—ãŸã‚ŠæŒ™å‹•ã‚„ãƒ‡ãƒã‚¤ã‚¹ã®åˆ‡ã‚Šæ›¿ãˆç­‰ç›´æ„Ÿçš„ã«æ“ä½œã§ãã‚‹æ„Ÿã˜ã§ã™ âœ¨
![](https://img.esa.io/uploads/production/attachments/5529/2022/08/09/18452/c44be835-0975-4b90-9205-a0a6541f1ea5.gif)

ã¡ãªã¿ã«â†‘ã®ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ã‚¢ãƒ—ãƒªã§ã™ãŒã€
`monarch/bin/cache/monarch_ui/flutter_macos_3.0.5-stable` é…ä¸‹ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹ã‚ˆã†ã§ã—ãŸã€‚

## è©¦ã—ã«ä½•ã‹Storiesã‚’æ›¸ã„ã¦ã¿ã‚‹
ã‚ˆãã‚ã‚Šãã†ãªã€Iconã®ä¸Šã«ä½•ã‹ã®ä»¶æ•°ã‚’è¡¨ã™badgeã‚’è¡¨ç¤ºã™ã‚‹äº‹ãŒã§ãã‚‹ã€`BadgeIcon` Widgetã‚’ä½œæˆã—ãã®Storiesã‚’æ›¸ã„ã¦ã¿ãŸã„ã¨æ€ã„ã¾ã™ã€‚
â†“ã¾ãšã¯ `BadgeIcon` ã®å®Ÿè£…ã«ãªã‚Šã¾ã™ã€‚(ç´°ã‹ã„ãƒªãƒ•ã‚¡ã‚¯ã‚¿ç®‡æ‰€ã¯ã‚ã‚Šãã†ã§ã™ãŒã€ä»Šå›ä»®ã§ã€ã€)

```dart:lib/widgets/badge_icon.dart
import 'package:flutter/material.dart';

class BadgeIcon extends StatelessWidget {
  const BadgeIcon({Key? key, required this.icon, this.badgeCount = 0})
      : super(key: key);

  final Widget icon;
  final int badgeCount;

  @override
  Widget build(BuildContext context) {
    return Stack(
      children: <Widget>[icon, _badge()],
    );
  }

  Widget _badge() {
    return Positioned(
        top: 0,
        right: 0,
        child: Container(
          padding: const EdgeInsets.all(1),
          constraints: const BoxConstraints(minHeight: 13, minWidth: 13),
          decoration: BoxDecoration(
              color: Colors.red, borderRadius: BorderRadius.circular(7)),
          child: Text(
            badgeCount.toString(),
            style: const TextStyle(fontSize: 8, color: Colors.white),
            textAlign: TextAlign.center,
          ),
        ));
  }
}
```
ã¾ãšã¯ã€`0` ã¨`100` ã‚’ãƒãƒƒã‚¸è¡¨ç¤ºã™ã‚‹ `BadgeIcon` ã® Storiesã‚’æ›¸ã„ã¦ã¿ã¾ã™ã€‚

```dart:lib/widgets/badge_icon_stories.dart
import 'package:flutter/material.dart';
import 'badge_icon.dart';

Widget countZero() => const BadgeIcon(icon: Icon(Icons.mail));

Widget countOneHundred() => const BadgeIcon(
      icon: Icon(Icons.mail),
      badgeCount: 100,
    );
```
æ—©é€Ÿèµ·å‹•ã—ã¦ã¿ã‚‹ã¨ã€StoriesãŒå¢—ãˆã¦ã„ã¦ `BadgeIcon` é–¢é€£ã®è¦‹ãŸç›®ã‚’ç¢ºèªã§ãã¾ã™ã€‚
![](https://storage.googleapis.com/zenn-user-upload/6b43bf5e1f2c-20220811.gif)

## Riverpodã¨ä¸€ç·’ã«ä½¿ã†å ´åˆ
ã„ã„ã‚µãƒ³ãƒ—ãƒ«ã‹ã¯åˆ†ã‹ã‚Šã¾ã›ã‚“ãŒã€ã€å…ˆç¨‹ã® `BadgeIcon` ã¨Riverpodã‚’ä½¿ã†Widgetã‚’ä½œæˆã—ã¦ã¿ãŸã„ã¨æ€ã„ã¾ã™ã€‚

ã¾ãšã¯ã€`flutter_riverpod` ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚
```yml
dependencies:
  flutter_riverpod: ^1.0.4
```

æ–°è¦ã« `BadgeIconWithProvider` ã¨ã„ã†Widgetã‚’ä»¥ä¸‹å†…å®¹ã§ä½œæˆã—ã¾ã™ã€‚

```dart
import 'package:flutter/material.dart';
import 'package:flutter_riverpod/flutter_riverpod.dart';
import 'badge_icon.dart';

final countProvider = StateProvider.autoDispose<int>((ref) => 0);

class BadgeIconWithProvider extends ConsumerWidget {
  const BadgeIconWithProvider({Key? key}) : super(key: key);

  @override
  Widget build(BuildContext context, WidgetRef ref) {
    final count = ref.watch(countProvider);
    return Container(
      padding: const EdgeInsets.all(8),
      child: BadgeIcon(
        icon: const Icon(Icons.mail),
        badgeCount: count,
      ),
    );
  }
}
```
ã‚„ã£ã¦ã„ã‚‹äº‹ã¯ `countProvider` ã‹ã‚‰æ¸¡ã£ã¦ãã‚‹å€¤ã‚’ `BadgeIcon` ã®ã‚«ã‚¦ãƒ³ãƒˆã¨ã—ã¦æ¸¡ã—ã¦ã„ã‚‹ã ã‘ã®Widgetã«ãªã‚Šã¾ã™ã€‚
æ¬¡ã«Storiesã‚’æ›¸ã„ã¦ã¿ã¾ã™ã€‚

```dart
import 'package:flutter/material.dart';
import 'package:flutter_riverpod/flutter_riverpod.dart';
import 'badge_icon_with_provider.dart';

class CounterBody extends ConsumerWidget {
  const CounterBody({Key? key}) : super(key: key);

  @override
  Widget build(BuildContext context, WidgetRef ref) {
    final notifier = ref.watch(countProvider.notifier);
    return Column(
      children: <Widget>[
        const BadgeIconWithProvider(),
        const SizedBox(height: 5),
        ElevatedButton(
          child: const Text('ã‚«ã‚¦ãƒ³ãƒˆã‚¢ãƒƒãƒ—'),
          onPressed: () => notifier.update((state) => state + 1),
        ),
        const SizedBox(height: 5),
        ElevatedButton(
          child: const Text('ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³'),
          onPressed: () => notifier.update((state) => state - 1),
        ),
      ],
    );
  }
}

Widget counter() => const ProviderScope(child: CounterBody());
```
æœ¬å®¶ã®[Storybook](https://storybook.js.org/)ã ã¨ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’å…¥åŠ›ã—ã¦ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ç¢ºèªã§ããŸã‚Šã™ã‚‹ã¨æ€ã†ã®ã§ã™ãŒã€
Monarchã®å ´åˆãã†ã„ã£ãŸäº‹ãŒã§ããªã•ãã†ãªã®ã§ã€ã‚«ã‚¦ãƒ³ãƒˆã‚¢ãƒƒãƒ—ã€ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³ã™ã‚‹ãƒœã‚¿ãƒ³ã‚’è¨­ã‘ã¾ã—ãŸã€‚
ãƒœã‚¿ãƒ³æŠ¼ä¸‹ã§ `StateProvider` ã®å€¤ã‚’å¤‰åŒ–ã•ã›ã¦ã„ã¾ã™ã€‚

![](https://storage.googleapis.com/zenn-user-upload/fa21c7ddc2fb-20220811.gif)


# ã¾ã¨ã‚
Storybookã¿ãŸãWidgetå˜ä½“ã§ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ã—ã¦ä½œã£ã¦ã„ã‘ãã†ãªã®ã§ã€ä»Šå¾Œã‚‚ä½¿ã£ã¦ã„ã“ã†ã¨æ€ã„ã¾ã™ï¼
è¨˜äº‹å†…ã«ã¯æ›¸ã„ã¦ãªã„ã§ã™ãŒã€ã‚«ã‚¹ã‚¿ãƒ ãƒ†ãƒ¼ãƒã®åˆ‡ã‚Šæ›¿ãˆã‚„è¤‡æ•°Localeåˆ‡ã‚Šæ›¿ãˆã‚‚å¯¾å¿œã—ã¦ã„ã‚‹ã®ã§ã€ã“ã“ã‚‰è¾ºã‚‚ã¾ãŸä½¿ã£ã¦è¡ŒããŸã„ã¨æ€ã„ã¾ã™ã€‚
