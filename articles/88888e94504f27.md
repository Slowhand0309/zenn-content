---
title: "ã€Zigã€‘Zigã‚’è©¦ã—ãªãŒã‚‰ã®How toãƒ¡ãƒ¢"
emoji: "ğŸ“"
type: "tech"
topics:
  - "zig"
  - "lang"
  - "memo"
published: true
published_at: "2022-07-24 04:42"
---

# [Home âš¡ Zig Programming Language](https://ziglang.org/)
ä½•ã‹æ–°ã—ã„è¨€èªã‚’ã‚¤ãƒ³ãƒ—ãƒƒãƒˆã—ãªãŒã‚‰ã€ä½•ã‹ä½œã‚ŠãŸã„ã¨æ€ã„ã€æœ€è¿‘ã‚ˆãç›®ã«ã™ã‚‹ZigãŒè‰¯ã•ãã†ã ã£ãŸã®ã§ã€ä½œã‚ŠãªãŒã‚‰è‰²ã€…è©¦ã—ã¦ãƒ¡ãƒ¢ã—ãŸå†…å®¹ã«ãªã‚Šã¾ã™ã€‚

# è©¦ã—ãŸç’°å¢ƒ

```
macOS Monterey ãƒãƒ¼ã‚¸ãƒ§ãƒ³12.1 Apple M1
```

# ç’°å¢ƒæ§‹ç¯‰
Macã®å ´åˆ[Homebrew](https://ziglang.org/learn/getting-started/#macos)ã§å°å…¥å¯èƒ½ã¿ãŸã„ãªã®ã§ã€ãã¡ã‚‰ã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ã¿ãŸã„ã¨æ€ã„ã¾ã™ã€‚

```sh
$ brew install zig
```
ç¾æ™‚ç‚¹ã§ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«Versionã¯ `0.9.1` ã§ã—ãŸã€‚
```sh
$ zig version  
0.9.1
```

# Hello world
ä½•ã¯ã¨ã‚‚ã‚ã‚Œã€ã¾ãšã¯ `Hello world` ã‚„ã£ã¦ã¿ã¾ã™ã€‚
ã¾ãšã¯åˆæœŸåŒ–ã—ã¦ã€ãã®ã¾ã¾å®Ÿè¡Œã—ã¦ã¿ã¾ã™ã€‚
```sh
$ zig init-exe
$ zig build run
info: All your codebase are belong to us.
```
`init-exe` ã§ä»¥ä¸‹ãŒä½œæˆã•ã‚Œã¾ã™ã€‚
```
.
â”œâ”€â”€ build.zig
â””â”€â”€ src
    â””â”€â”€ main.zig
```
`build run` ã§ãƒ“ãƒ«ãƒ‰ã¨å®Ÿè¡Œã‚’è¡Œã£ã¦ãã‚Œã¾ã™ã€‚ãƒ“ãƒ«ãƒ‰ã•ã‚ŒãŸå®Ÿè¡Œãƒ•ã‚¡ã‚¤ãƒ«ã¯ `zig-out/bin/xxxx` ã«ä½œæˆã•ã‚Œã¦ã¾ã—ãŸã€‚

æ¬¡ã« `Hello world` ã‚’è¡¨ç¤ºã™ã‚‹ãŸã‚ã«`src/main.zig` ã‚’ä»¥ä¸‹ã«ä¿®æ­£ã—ã¾ã™ã€‚
`zig build run` ã§ `Hello, world!` ãŒè¡¨ç¤ºã•ã‚Œã‚Œã°OKã§ã™ã€‚

```zig
const std = @import("std");

pub fn main() !void {
    const stdout = std.io.getStdOut().writer();
    try stdout.print("Hello, {s}!\n", .{"world"});
}
```

# import
åˆ¥ãƒ•ã‚¡ã‚¤ãƒ«ã«å®šç¾©ã—ãŸé–¢æ•°ã‚’importã—ã¦å‘¼ã³å‡ºã™å ´åˆã€

```zig:funcs.zig
const std = @import("std");

pub fn debug() void {
  std.log.debug("funcs#debug call", .{});
}
```
â†‘ å‘¼ã³å‡ºã—ãŸã„é–¢æ•°ã« `pub` ã‚’ä»˜ã‘ã¾ã™ã€‚

```zig:main.zig
const funcs = @import("funcs.zig");
const debug = funcs.debug;

pub fn main() void {
    debug();
}
```
ã‚ã¨ã¯ã€å‘¼ã³å‡ºã™å´ã§ `@import` ã—ã¦ã‚„ã‚Œã°OKã§ã™ã€‚

# Allocator
Allocatorã®ç¨®é¡
- c_allocator
    - libcã‚’ãƒªãƒ³ã‚¯ã™ã‚‹å ´åˆã«æœ€é© (malloc_usable_sizeã‚’ä½¿ç”¨ã™ã‚‹)
- raw_c_allocator
    - `malloc`/`free`ã‚’ç›´æ¥å‘¼ã³å‡ºã™ (malloc_usable_sizeã‚’ä½¿ç”¨ã—ãªã„)
- page_allocator
    - ãƒ¡ãƒ¢ãƒªå‰²ã‚Šå½“ã¦ã¨è§£æ”¾ã®ãŸã³ã«ç›´æ¥ syscall ã‚’å‘¼ã³å‡ºã™ (Thread-safe and lock-free.)
- HeapAllocator
    - windowsã ã‘ã§ã—ã‹ä½¿ãˆãªã„? å†…éƒ¨ã§HANDLEã‚’ä½¿ç”¨
- ArenaAllocator
    - æ—¢å­˜ã®ã‚¢ãƒ­ã‚±ãƒ¼ã‚¿ã‚’ãƒ©ãƒƒãƒ—ã—ã€ã¾ã¨ã‚ã¦è§£æ”¾ã—ã¦ãã‚Œã‚‹
- FixedBufferAllocator
    - å›ºå®šé•·ã®ãƒãƒƒãƒ•ã‚¡ã§äº‹è¶³ã‚Šã‚‹å ´åˆã«ä½¿ç”¨
- LogToWriterAllocator
    - ä»–ã®ã‚¢ãƒ­ã‚±ãƒ¼ã‚¿ã‚’ä½¿ã†éš›ã«ã€æŒ‡å®šã—ãŸWriterã«ãƒ­ã‚°ã‚’å‡ºåŠ›ã—ã¦ãã‚Œã‚‹
- LoggingAllocator
    - ä»–ã®ã‚¢ãƒ­ã‚±ãƒ¼ã‚¿ã‚’ä½¿ã†éš›ã«ã€`std.log` ã«ãƒ­ã‚°ã‚’å‡ºåŠ›ã—ã¦ãã‚Œã‚‹

åŸºæœ¬çš„ãªä½¿ã„æ–¹
```zig
const std = @import("std");
const expect = std.testing.expect;

test "allocation" {
    const allocator = std.heap.page_allocator;

    const memory = try allocator.alloc(u8, 100);
    defer allocator.free(memory);

    try expect(memory.len == 100);
    try expect(@TypeOf(memory) == []u8);
}
```

LoggingAllocatorã‚’ä½¿ã†å ´åˆ
```zig
const std = @import("std");
const loggingAllocator = std.heap.loggingAllocator;

const allocator = loggingAllocator(std.heap.page_allocator).allocator();
// debug: alloc - success - len: 4602, ptr_align: 1, len_align: 1
// debug: free - len: 16384
```

# ãƒ•ã‚¡ã‚¤ãƒ«ã®æ‰±ã„
- ãƒ•ã‚¡ã‚¤ãƒ«ã‚ªãƒ¼ãƒ—ãƒ³/ã‚¯ãƒ­ãƒ¼ã‚º

```zig
const std = @import("std");

pub fn main() !void {
    const file_name = "xxxx";
    const file = try std.fs.cwd().openFile(fileName, .{});
    defer file.close();
}
```

- ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºã®å–å¾—
```zig
const std = @import("std");

pub fn main() !void {
    const stdout = std.io.getStdOut().writer();

    const file_name = "xxxx";
    const file = try std.fs.cwd().openFile(fileName, .{});
    defer file.close();

    const file_size = try file.getEndPos();
    try stdout.print("file size: {d}\n", .{file_size});
}
```

- ãƒ•ã‚¡ã‚¤ãƒ«ã®Read

```zig
const std = @import("std");

pub fn main() !void {
    const stdout = std.io.getStdOut().writer();

    const file_name = "xxxx";
    const file = try std.fs.cwd().openFile(fileName, .{});
    defer file.close();

    const file_size = try file.getEndPos();
    try stdout.print("file size: {d}\n", .{file_size});

    var reader = std.io.bufferedReader(file.reader());
    var instream = reader.reader();

    const allocator = std.heap. page_allocator;
    const contents = try instream.readAllAlloc(allocator, file_size);
    defer allocator.free(contents);

    try stdout.print("read file value: {c}\n", .{contents});
}
```

# è¤‡æ•°ã®å€¤ã‚’ã¾ã¨ã‚ã¦returnã—ãŸã„å ´åˆ

```zig
pub fn getPosition() struct { start: i32, end: i32 } {
  const start = 1000;
  const end = 2000;
  return .{
    .start = start,
    .end = end
  };
}
```
structã§æŸã­ã‚‹æ§˜ãªå½¢ã§returnã™ã‚‹

# ãƒãƒƒãƒ‰ãƒã‚¦ãƒã‚¦
brew installæ™‚ã«ä»¥ä¸‹ã‚¨ãƒ©ãƒ¼ã«é­é‡

```sh
Error: python@3.10: the bottle needs the Apple Command Line Tools to be installed.
  You can install them, if desired, with:
    xcode-select --install

You can try to install from source with:
  brew install --build-from-source python@3.10
Please note building from source is unsupported. You will encounter build
failures with some formulae. If you experience any issues please create pull
requests instead of asking for help on Homebrew's GitHub, Twitter or any other
official channels.
```

Python3ãŒå¿…è¦ãªã®ã§ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€šã‚Šã€`xcode-select --install` ã§ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ãƒ„ãƒ¼ãƒ«ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ç„¡äº‹ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã§ãã¾ã—ãŸã€‚

```sh
$ python3 --version
Python 3.9.13
```

----

ã€Œã‚‚ã£ã¨ã“ã†ã—ãŸæ–¹ãŒã€œã€ ãªã©ã‚ã‚Šã¾ã—ãŸã‚‰ã€ã‚¢ãƒ‰ãƒã‚¤ã‚¹é ‚ã‘ã‚‹ã¨åŠ©ã‹ã‚Šã¾ã™!
ã¾ãŸã€ãƒ¡ãƒ¢ãŒæºœã¾ã£ãŸã‚‰è¨˜äº‹ã«ã—ãŸã„ã¨æ€ã„ã¾ã™ã€‚

# å‚è€ƒURL
- [nrdmn/awesome-zig](https://github.com/nrdmn/awesome-zig)
- [Chapter 0 - Getting Started | ziglearn.org](https://ziglearn.org/)
- [ratfactor/ziglings: Learn the Zig programming language by fixing tiny broken programs.](https://github.com/ratfactor/ziglings)
- [ziglings ãƒ¡ãƒ¢](https://zenn.dev/tamago324/scraps/b072e8ae70907f)