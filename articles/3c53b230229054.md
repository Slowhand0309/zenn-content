---
title: "SwiftUI„ÅßQR„Ç≥„Éº„Éâ‰ΩúÊàê&Ë™≠„ÅøÂèñ„Çä„ÇíË°å„ÅÜ"
emoji: "üì∑"
type: "tech" # tech: ÊäÄË°ìË®ò‰∫ã / idea: „Ç¢„Ç§„Éá„Ç¢
topics:
  - "swift"
  - "swiftui"
  - "ios"
  - "qr„Ç≥„Éº„Éâ"
  - "visionkit"
published: true
---
# Ê¶ÇË¶Å

„Çø„Ç§„Éà„É´„ÅÆÈÄö„Çä„Åß„Åô„Åå„ÄÅSwiftUI„ÅßQR„Ç≥„Éº„Éâ„ÅÆÁîüÊàê„Å®Ë™≠„ÅøÂèñ„Çä„ÇíË©¶„Åó„Å¶Ë¶ã„Åü„ÅÑ„Å®ÊÄù„ÅÑ„Åæ„Åô„ÄÇ

iOS 13.0‰ª•Èôç„Åã„Çâüëá„ÅÆ‰æøÂà©„Å™„É°„ÇΩ„ÉÉ„Éâ„Çí‰Ωø„Åà„Çã„ÅÆ„Åß„ÄÅ„Åì„Å°„Çâ„Çí‰Ωø„Å£„Å¶ÁîüÊàê„Åó„Å¶„ÅÑ„Åç„Åü„ÅÑ„Å®ÊÄù„ÅÑ„Åæ„Åô„ÄÇ

https://developer.apple.com/documentation/coreimage/cifilter/3228262-qrcodegenerator

> „Åì„ÅÆ„É°„ÇΩ„ÉÉ„Éâ„ÅØ„ÄÅQR„Ç≥„Éº„Éâ„ÇíÁîªÂÉè„Å®„Åó„Å¶ÁîüÊàê„Åó„Åæ„Åô„ÄÇ QR„Ç≥„Éº„Éâ„ÅØ„ÄÅISO/IEC 18004:2006Ë¶èÊ†º„ÅßÂÆöÁæ©„Åï„Çå„Å¶„ÅÑ„ÇãÈ´òÂØÜÂ∫¶„Éû„Éà„É™„ÉÉ„ÇØ„Çπ„Éê„Éº„Ç≥„Éº„Éâ„Éï„Ç©„Éº„Éû„ÉÉ„Éà„Åß„Åô„ÄÇ
QR„Ç≥„Éº„Éâ„Éª„Ç∏„Çß„Éç„É¨„Éº„Çø„Éº„Éª„Éï„Ç£„É´„Çø„Éº„ÅØ„ÄÅ‰ª•‰∏ã„ÅÆ„Éó„É≠„Éë„ÉÜ„Ç£„Çí‰ΩøÁî®„Åó„Åæ„Åô
„Éªmessage: NSData „Å®„Åó„Å¶ QR „Ç≥„Éº„Éâ„Å®„Åó„Å¶„Ç®„É≥„Ç≥„Éº„Éâ„Åï„Çå„Çã„Éá„Éº„Çø„ÇíË°®„ÅôÊñáÂ≠óÂàó
„ÉªcorrectionLevel: NSString„Å®„Åó„Å¶„Ç®„É©„ÉºË®ÇÊ≠£ÂΩ¢Âºè„ÇíË°®„Åô1ÊñáÂ≠ó„ÅÆÊñáÂ≠óÂàó„ÄÇ L„ÅØ7„Éë„Éº„Çª„É≥„ÉàË£úÊ≠£„ÄÅM„ÅØ15„Éë„Éº„Çª„É≥„ÉàË£úÊ≠£„ÄÅQ„ÅØ25„Éë„Éº„Çª„É≥„ÉàË£úÊ≠£„ÄÅH„ÅØ30„Éë„Éº„Çª„É≥„ÉàË£úÊ≠£„ÄÇ

# Âãï‰ΩúÁí∞Â¢É

- MBA M3 24GB Sonoma 14.6.1
- Xcode: Version 16.1 (16B40)

# „Ç∑„É≥„Éó„É´„Å™ÂÆüË£Ö

„Åæ„Åö„ÅØ‰∏é„Åà„Çâ„Çå„ÅüÊñáÂ≠óÂàó„ÇíQR„Ç≥„Éº„Éâ„Å®„Åó„Å¶Ë°®Á§∫„Åô„Çã„Å†„Åë„ÅÆ„Ç∑„É≥„Éó„É´„Å™View„Çí‰ΩúÊàê„Åó„Å¶„ÅÑ„Åç„Åü„ÅÑ„Å®ÊÄù„ÅÑ„Åæ„Åô„ÄÇ

`QrCodeView.swift` „Çí‰ΩúÊàê„Åó„ÄÅ‰ª•‰∏ãÂÆüË£Ö„ÇíËøΩÂä†„Åó„Åæ„Åô„ÄÇ

```swift
import CoreImage.CIFilterBuiltins // ‚ë†
import SwiftUI

struct QrCodeView: View {
    var data: String
    var body: some View {
        Image(uiImage: qrImage)
            .interpolation(.none) // ‚ë°
            .resizable() // ‚ë¢
            .scaledToFit()
            .accessibilityLabel(Text("QRCode"))
    }

    private var qrImage: UIImage { // ‚ë£
        let qrCodeGenerator = CIFilter.qrCodeGenerator()
        qrCodeGenerator.message = Data(data.utf8)
        qrCodeGenerator.correctionLevel = "H"
        if let outputimage = qrCodeGenerator.outputImage {
            if let cgImage = CIContext().createCGImage(
                outputimage, from: outputimage.extent) {
                return UIImage(cgImage: cgImage)
            }
        }
        return UIImage()
    }
}

#Preview {
    QrCodeView(data: "abc")
        .frame(width: 150, height: 150)
}
```

‚ë† :`CoreImage.CIFilterBuiltins` „ÅÆimport

‚ë° : ÁîªÂÉèÊã°Â§ßÁ∏ÆÂ∞èÊôÇ„ÅÆË£úÈñì„Çí„Å™„Åè„Åô

‚Äª Ë£úÈñì„ÅØ„ÄÅÁîªÂÉè„ÇíÊã°Â§ß„Åæ„Åü„ÅØÁ∏ÆÂ∞è„Åô„Çã„Å®„Åç„Å´„ÄÅ„Éî„ÇØ„Çª„É´Èñì„ÇíÂüã„ÇÅ„Åü„Çä„Çπ„É†„Éº„Ç∫„Å´Ë°®Á§∫„Åô„Çã„Åü„ÇÅ„ÅÆ„Ç¢„É´„Ç¥„É™„Ç∫„É†„ÄÇQR„Ç≥„Éº„Éâ„Åß„ÅØË™≠„ÅøÂèñ„Çä„Ç®„É©„Éº„ÇíËµ∑„Åì„ÅôÂèØËÉΩÊÄß„Åå„ÅÇ„Çã„ÄÇ

‚ë¢ : „Ç¢„Çπ„Éö„ÇØ„ÉàÊØî„Çí‰øù„Å°„Å™„Åå„Çâ„É™„Çµ„Ç§„Ç∫ÂèØËÉΩ„Å´„Åô„Çã

‚ë£ : `CIFilter.qrCodeGenerator` „Çí‰ΩøÁî®„Åó„Å¶Âá∫ÂäõÁîªÂÉè„Çí `UIImage` „Å´Â§âÊèõ„Åó„Å¶„ÅÑ„Çã

üëáPreviewË°®Á§∫„ÅÆÊßòÂ≠ê

![image1.png](/images/3c53b230229054/image1.png =300x)

# JSONÊñáÂ≠óÂàó„ÇíQR„Ç≥„Éº„ÉâÂåñ„Åô„Çã

Ê¨°„Å´JSONÊñáÂ≠óÂàó„ÇíÂèó„ÅëÂèñ„Å£„Å¶QR„Ç≥„Éº„Éâ„ÇíÁîüÊàê„Åï„Åõ„Å¶„Åø„Åü„ÅÑ„Å®ÊÄù„ÅÑ„Åæ„Åô„ÄÇÊñ∞Ë¶è„Å´`JsonQrCodeView.swift` „Çí‰ΩúÊàê„Åó„Åæ„Åô„ÄÇ

„Åæ„Åö„ÅØJSONÂåñ„Åô„Çã„Ç™„Éñ„Ç∏„Çß„ÇØ„Éà„ÇíÂÆöÁæ©„Åó„Åæ„Åô„ÄÇ‰ªÆ„Å´ `Book` „Å®„ÅÑ„ÅÜ„Ç™„Éñ„Ç∏„Çß„ÇØ„Éà„ÇíÂÆöÁæ©„Åó„Åæ„Åô„ÄÇ

```swift
struct Book: Codable {
    let id: Int
    let title: String
    let author: String
    let publicationAt: Date
}
```

„Åì„ÅÆ `Book` „ÇíÂèó„ÅëÂèñ„Å£„Å¶JSONÊñáÂ≠óÂàóÂåñ„Åó„Å¶QR„Ç≥„Éº„ÉâÁîüÊàê„Åó„Åæ„Åô„ÄÇ

```swift
struct JsonQrCodeView: View {
    var book: Book
    var body: some View {
        if let json = jsonStr {
            QrCodeView(data: json)
                .frame(width: 150, height: 150)
        } else {
            Text("Qr Code Generate Error")
        }
    }

    private var jsonStr: String? {
        do {
            let encoder = JSONEncoder()
            encoder.outputFormatting = [.prettyPrinted, .withoutEscapingSlashes]
            let jsonData = try encoder.encode(book)
            return String(data: jsonData, encoding: .utf8)
        } catch {
            print(error.localizedDescription)
        }
        return nil
    }
}

#Preview {
    let book = Book(
        id: 1,
        title: "„Åì„Åì„Çç",
        author: "Â§èÁõÆÊº±Áü≥",
        publicationAt: Date()
    )
    JsonQrCodeView(book: book)
}
```

üëáPreviewË°®Á§∫„ÅÆÊßòÂ≠ê

![image2.png](/images/3c53b230229054/image2.png =300x)

„Åì„Å°„Çâ„ÇíiOS„ÅÆ„Ç´„É°„É©„Åß„Éï„Ç©„Éº„Ç´„Çπ„Åô„Çã„Å®JSONÊñáÂ≠óÂàó„ÅåË°®Á§∫„Åï„Çå„Çã„Åã„Å®ÊÄù„ÅÑ„Åæ„Åô„ÄÇ

# QR„Ç≥„Éº„ÉâË™≠„ÅøÂèñ„Çä

Ê¨°„Å´QR„Ç≥„Éº„Éâ„ÅÆË™≠„ÅøÂèñ„Çä„ÇíÂÆüË£Ö„Åó„Å¶„ÅÑ„Åç„Åü„ÅÑ„Å®ÊÄù„ÅÑ„Åæ„Åô„ÄÇ

ÂÆüË£Ö„ÅÆÊâãÊÆµ„Å®„Åó„Å¶„ÅØ„Åñ„Å£„Å®Ë™ø„Åπ„Å¶‰ª•‰∏ã„ÅÆ3„Å§„ÅÆÊñπÊ≥ï„Åå„ÅÇ„Çã„Åø„Åü„ÅÑ„Åß„Åô„ÄÇ

1. „Çµ„Éº„Éâ„Éë„Éº„ÉÜ„Ç£„ÅÆ„É©„Ç§„Éñ„É©„É™„Çí‰Ωø„ÅÜ
    - ÊúâÂêç„Å©„Åì„Çç„Å†„Å® [CodeScanner](https://github.com/twostraws/CodeScanner) „Åå„ÅÇ„Çä„Åù„ÅÜ„Åß„Åô
2. `AVFoundation` „Çí‰ΩøÁî®„Åó„Å¶ÂÆüË£Ö„Åô„Çã
3. `VisionKit`„ÅÆ`DataScannerViewController`„Çí‰ΩøÁî®„Åó„Å¶ÂÆüË£Ö„Åô„Çã
    - iOS 16‰ª•Èôç„ÅÆ„Åø‰ΩøÁî®ÂèØËÉΩ

‰ªäÂõû„ÅØ`VisionKit`„ÅÆ`DataScannerViewController`„ÇíË©¶„Åó„Å¶„Åø„Åü„ÅÑ„Å®ÊÄù„ÅÑ„Åæ„Åô„ÄÇ

https://developer.apple.com/documentation/visionkit/datascannerviewcontroller

## Ê∫ñÂÇô

„Ç´„É°„É©„Çí‰Ωø„ÅÜ„ÅÆ„Åß `Info.plist` „Å´ `Privacy - Camera Usage Description` „ÅÆË®≠ÂÆö„ÇíËøΩÂä†„Åó„Åæ„Åô„ÄÇ

`Value` „ÅØ‰Ωï„ÅÆÁÇ∫„Å´‰Ωø„ÅÜ„ÅãÁêÜÁî±„ÇíÊõ∏„ÅÑ„Å®„Åë„Å∞OK„Åß„Åô„ÄÇ

‚Äª Xcode13‰ª•Èôç„ÅÆÂ†¥Âêà„ÅØ„Éá„Éï„Ç©„É´„Éà„Åß `Info.plist` „ÅØ‰Ωú„Çâ„Çå„Å™„ÅÑ„ÅÆ„Åß„ÄÅ„ÄåTARGETS„Äç>„ÄåInfo„Äç„Çø„Éñ >„ÄåCustom macOS Application Target Properties„Äç„Åã„ÇâËøΩÂä†„Åó„Å¶‰∏ã„Åï„ÅÑ„ÄÇ

„Åæ„Åü„Ç´„É°„É©„Çí‰Ωø„ÅÜÈöõ„Å´ÂÆüÊ©ü„Åß„Å™„ÅÑ„Å®‰Ωø„Åà„Å™„ÅÑÁÇ∫„ÄÅÂÆüÊ©ü„ÅßÂãï‰Ωú„Åï„Åõ„ÇãÁÇ∫„ÅÆË®≠ÂÆö„ÇÇÂøÖË¶Å„Å´„Å™„Çä„Åæ„Åô„ÄÇ

üëáÂèÇËÄÉURL

https://www.ingenious.jp/articles/howto/xcode/xcode-actual-machine-test/

## ÂÆüË£Ö

Êñ∞Ë¶è `JsonQrCodeReaderView.swift` „Çí‰ª•‰∏ãÂÜÖÂÆπ„Åß‰ΩúÊàê„Åó„Åæ„Åô„ÄÇ

```swift
import SwiftUI
import VisionKit // ‚ë†

struct QRCodeScanner: UIViewControllerRepresentable {
    func makeUIViewController(context: Context) -> DataScannerViewController {
        // ‚ë°
        let dataScannerViewController = DataScannerViewController(
            recognizedDataTypes: [.barcode(symbologies: [.qr])],
            isHighlightingEnabled: true
        )
        try? dataScannerViewController.startScanning() // ‚ë¢
        return dataScannerViewController
    }

    func updateUIViewController(_ uiViewController: DataScannerViewController, context: Context) {
    }
}

struct JsonQrCodeReaderView: View {
    var body: some View {
        QRCodeScanner()
    }
}

#Preview {
    JsonQrCodeReaderView()
}
```

‚ë† : `VisionKit` „Çíimport„Åó„Å¶„ÅÑ„Åæ„Åô

‚ë° : `DataScannerViewController` „Çí‰ΩúÊàê„Åó„Å¶„ÅÑ„Åæ„Åô

- [recognizedDataTypes](https://developer.apple.com/documentation/visionkit/datascannerviewcontroller/recognizeddatatype)
  - `recognizedDataTypes: Set<DataScannerViewController.RecognizedDataType>`
  - `text(languages:textContentType:)` Âèà„ÅØ `barcode(symbologies:)` „ÇíÊåáÂÆö„Åó„Åæ„Åô
  - ‰ªäÂõû„ÅØ OR„Ç≥„Éº„Éâ„Å™„ÅÆ„Åß `[.barcode(symbologies: [.qr])]` „ÇíÊåáÂÆö„Åó„Å¶„ÅÑ„Åæ„Åô
- isHighlightingEnabled
  - OR„Ç≥„Éº„Éâ„ÇíË™çË≠ò„Åó„Åü„Çâ„Éè„Ç§„É©„Ç§„Éà„Åï„Çå„Çã„Çà„ÅÜ„Å´ `true` „Å´Ë®≠ÂÆö„Åó„Å¶„ÅÑ„Åæ„Åô

‚ë¢ : „Ç´„É°„É©Ëµ∑Âãï„ÅóScan„ÇíÈñãÂßã„Åô„Çã„Çà„ÅÜ„Å´„Åó„Å¶„ÅÑ„Åæ„Åô

üëáÂÆüÊ©ü„ÅßÂãï‰Ωú„Åï„Åõ„Å¶„ÅÑ„ÇãÊßòÂ≠ê

![image3.gif](/images/3c53b230229054/image3.gif =300x)

## Ë™≠„ÅøÂèñ„Å£„ÅüÂÜÖÂÆπ„ÇíË°®Á§∫

ÊúÄÂæå„Å´„ÄÅË™≠„ÅøÂèñ„Å£„ÅüQR„Ç≥„Éº„Éâ„ÅÆÂÜÖÂÆπ„ÇíÁîªÈù¢‰∏ä„Å´Ë°®Á§∫„Åï„Åõ„Å¶„Åø„Åü„ÅÑ„Å®ÊÄù„ÅÑ„Åæ„Åô„ÄÇ

üëá¬†ÂÆåÊàêÂΩ¢„ÅÆÂÆüË£Ö„Å´„Å™„Çä„Åæ„Åô„ÄÇ

```swift
struct QRCodeScanner: UIViewControllerRepresentable {
    // ‚ë†
    var dataScannerViewController = DataScannerViewController(
        recognizedDataTypes: [.barcode(symbologies: [.qr])],
        isHighlightingEnabled: true
    )

    func makeUIViewController(context: Context) -> DataScannerViewController {
        dataScannerViewController.delegate = context.coordinator
        try? dataScannerViewController.startScanning()
        return dataScannerViewController
    }

    func updateUIViewController(_ uiViewController: DataScannerViewController, context: Context) {
    }
    // ‚ë°
    func makeCoordinator() -> Coordinator {
        Coordinator(self)
    }

    final class Coordinator: NSObject, DataScannerViewControllerDelegate {
        private let parent: QRCodeScanner
        private var textView: UIView?

        init(_ parent: QRCodeScanner) {
            self.parent = parent
        }

        func dataScanner(_ dataScanner: DataScannerViewController,
                         didAdd addedItems: [RecognizedItem],
                         allItems: [RecognizedItem]
        ) {
            guard case .barcode(let barcode) = addedItems.first else {
                return
            }
            // ‚ë¢
            if let text = barcode.payloadStringValue {
                let frame = CGRect(
                    x: barcode.bounds.topLeft.x,
                    y: barcode.bounds.topLeft.y,
                    width: abs(barcode.bounds.topRight.x - barcode.bounds.topLeft.x) + 15,
                    height: abs(barcode.bounds.topLeft.y - barcode.bounds.bottomLeft.y) + 15
                )
                let textView = UITextView(frame: frame)
                textView.font = UIFont.systemFont(ofSize: 10)
                textView.text = text
                parent.dataScannerViewController.overlayContainerView.addSubview(textView)
                self.textView = textView
            }
        }
        // ‚ë£
        func dataScanner(_ dataScanner: DataScannerViewController,
                         didRemove removedItems: [RecognizedItem],
                         allItems: [RecognizedItem]
        ) {
            self.textView?.removeFromSuperview()
        }
    }
}
```

‚ë† : Delegate„Åã„Çâ‰Ωø„Åà„Çã„Çà„ÅÜ„Å´ `DataScannerViewController` „ÇíÂ§ñÂá∫„Åó„Åó„Å¶„ÅÑ„Åæ„Åô

‚ë° : `DataScannerViewControllerDelegate` „Åß„Ç§„Éô„É≥„Éà„ÅÆ„ÇÑ„Çä„Å®„Çä„Åå„Åß„Åç„ÇãÊßò„Å´ `makeCoordinator` „Åß `Coordinator` „ÇØ„É©„Çπ„ÇíËøî„Åó„Å¶„ÅÑ„Åæ„Åô

‚ë¢ :  QR„Ç≥„Éº„Éâ„ÅåË™çË≠ò„Åï„Çå„Åü„ÇâÂëº„Å∞„Çå„Åæ„Åô„ÄÇ`barcode: RecognizedItem.Barcode` „ÅÆ `bounds` „Å´Ë™çË≠ò„Åó„ÅüÈ†òÂüü„Åå„Çª„ÉÉ„Éà„Åï„Çå„Å¶„ÅÑ„Çã„ÅÆ„Åß„ÄÅ„Åù„ÅÆÈ†òÂüü„Å´Ë™≠„ÅøÂèñ„Å£„ÅüÊñáÂ≠óÂàó„Çí `UITextView` „Å®„Åó„Å¶‰ΩúÊàê„Åó„ÄÅdataScannerViewController„ÅÆ `overlayContainerView` „Å´View„ÇíËøΩÂä†„Åó„Å¶„ÅÑ„Åæ„Åô

‚ë£ : QR„Ç≥„Éº„Éâ„ÅåË™çË≠ò„ÅåÂÅúÊ≠¢„Åï„Çå„Åü„ÇâÂëº„Å∞„Çå„Åæ„Åô„ÄÇ‰ªäÂõû„ÅØ1„Å§„Å†„Åë„Åó„ÅãË™çË≠ò„Åï„Åõ„Å™„ÅÑÂâçÊèê„Å™„ÅÆ„Åß„ÄÅ‚ë¢„Åß‰ΩúÊàê„Åó„Åü `UITextView` „ÇíÂâäÈô§„Åó„Å¶„Åæ„Åô

üëáÂÆüÊ©ü„ÅßÂãï‰Ωú„Åï„Åõ„Å¶„ÅÑ„ÇãÊßòÂ≠ê

![image4.gif](/images/3c53b230229054/image4.gif =300x)

# ÂèÇËÄÉURL

https://qiita.com/ikaasamay/items/58d1a401e98673a96fd2

https://medium.com/@ramesh_aran86/how-to-use-visionkit-in-swiftui-for-text-and-barcode-scanning-on-ios-e3f66c9006f2