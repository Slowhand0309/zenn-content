---
title: "ã€Androidã€‘Calendarè¦‹ãŸç›®èª¿æ•´"
emoji: "ğŸ”–"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: []
published: false
---
# ã¯ã˜ã‚ã«

[å‰å›](https://zenn.dev/slowhand/articles/576938af385568)è©¦ã—ãŸ [Calendar](https://github.com/kizitonwose/Calendar) ã®è¦‹ãŸç›®ã‚„æŒ™å‹•ã‚’èª¿æ•´ã—ãŸéš›ã®ã‚‚ã®ã«ãªã‚Šã¾ã™ã€‚
ä»Šå›ã‚«ã‚¹ã‚¿ãƒ ã—ãŸBefore â†’ Afterã¯ä»¥ä¸‹ã«ãªã‚Šã¾ã™ã€‚

- Before
    ![image1.png](/images/41c0db864657d0/image1.png)

- After
    ![image2.gif](/images/41c0db864657d0/image2.gif)

# ç’°å¢ƒæ§‹ç¯‰ã‚„æº–å‚™

å„ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚„ç’°å¢ƒ

```text
- Android Studio Giraffe | 2022.3.1 Patch 1
- com.kizitonwose.calendar:compose: 2.4.0-beta01
```

## ãƒ™ãƒ¼ã‚¹ã¨ãªã‚‹å®Ÿè£…

```kotlin
@Composable
fun CalendarCompose() {
    val currentMonth = remember { YearMonth.now() }
    val startMonth = remember { currentMonth.minusMonths(100) } // Adjust as needed
    val endMonth = remember { currentMonth.plusMonths(100) } // Adjust as needed
    val firstDayOfWeek = remember { firstDayOfWeekFromLocale() } // Available from the library

    val state = rememberCalendarState(
        startMonth = startMonth,
        endMonth = endMonth,
        firstVisibleMonth = currentMonth,
        firstDayOfWeek = firstDayOfWeek
    )

    Column(modifier = Modifier.fillMaxSize()) {
        HorizontalCalendar(
            state = state,
            dayContent = { Day(it) }
        )
    }
}

@Composable
private fun Day(day: CalendarDay) {
    Box(
        modifier = Modifier
            .aspectRatio(1f), // This is important for square sizing!
        contentAlignment = Alignment.Center
    ) {
        Text(text = day.date.dayOfMonth.toString())
    }
}
```

å‰å›å®Ÿè£…ã—ãŸæœ€ä½é™ã®å®Ÿè£…ã«ãªã‚Šã¾ã™ã€‚å‹•ä½œã¨ã—ã¦ã¯â†“ã®æ§˜ã«å·¦å³ã‚¹ãƒ¯ã‚¤ãƒ—ã§æœˆå¤‰æ›´ãŒã§ãã‚‹ã ã‘ã®ã‚‚ã®ã§ã™ã€‚

![image3.gif](/images/41c0db864657d0/image3.gif)

# å®Ÿè£…

## 1. æ›œæ—¥ã‚’è¡¨ç¤ºã™ã‚‹

### 1-1. `MonthHeader` ã‚’è¿½åŠ 

```kotlin
fun DayOfWeek.displayText(uppercase: Boolean = false): String {
    return getDisplayName(TextStyle.SHORT, Locale.getDefault()).let { value ->
        if (uppercase) value.uppercase(Locale.getDefault()) else value
    }
}

@Composable
private fun MonthHeader(daysOfWeek: List<DayOfWeek>) {
    Row(
        modifier = Modifier
            .fillMaxWidth()
            .testTag("MonthHeader"),
    ) {
        for (dayOfWeek in daysOfWeek) {
            Text(
                modifier = Modifier.weight(1f),
                textAlign = TextAlign.Center,
                fontSize = 15.sp,
                text = dayOfWeek.displayText(),
                fontWeight = FontWeight.Medium,
            )
        }
    }
}
```

### 1-2. `HorizontalCalendar` ã«åæ˜ ã™ã‚‹

```kotlin
Column(modifier = Modifier.fillMaxSize()) {
        HorizontalCalendar(
            state = state,
            dayContent = { Day(it) },
            monthHeader = { month ->
                val daysOfWeek = month.weekDays.first().map { it.date.dayOfWeek }
                MonthHeader(daysOfWeek = daysOfWeek)
            }
        )
    }
```

![image4.png](/images/41c0db864657d0/image4.png)

## 2. è¡¨ç¤ºæœˆã«å«ã¾ã‚Œãªã„æ—¥ã®TextColorã‚’å¤‰æ›´ã™ã‚‹

Day Composable ã§ `day.position` ã«ã‚ˆã‚‹åˆ¤å®šã‚’è¿½åŠ ã™ã‚‹

```kotlin
@Composable
private fun Day(day: CalendarDay) {
    val textColor = when (day.position) {
        DayPosition.MonthDate -> Color.Unspecified
        DayPosition.InDate, DayPosition.OutDate -> Color.LightGray
    }
    Box(
        modifier = Modifier
            .aspectRatio(1f),
        contentAlignment = Alignment.Center
    ) {
        Text(text = day.date.dayOfMonth.toString(), color = textColor)
    }
}
```

![image5.png](/images/41c0db864657d0/image5.png)

## 3. bodyéƒ¨åˆ†ã®èƒŒæ™¯è‰²ã‚’å¤‰æ›´ã™ã‚‹

`HorizontalCalendar` ã« `monthBody` ã‚’è¿½åŠ 

```kotlin
monthBody = { _, content ->
                Box(
                    modifier = Modifier.background(
                        brush = Brush.verticalGradient(
                            colors = listOf(
                                MaterialTheme.colorScheme.primary.copy(alpha = 0.2f),
                                MaterialTheme.colorScheme.tertiary.copy(alpha = 0.2f)
                            )
                        )
                    )
                ) {
                    content()
                }
            },
```

![image6.png](/images/41c0db864657d0/image6.png)

## 4. æ—¥ä»˜ã«æ ç·šã‚’è¿½åŠ ã™ã‚‹

```kotlin
HorizontalCalendar(
    ...
    monthBody = { _, content ->
        Box(
            modifier = Modifier
                .background(
                    brush = Brush.verticalGradient(
                        colors = listOf(
                            MaterialTheme.colorScheme.primary.copy(alpha = 0.2f), // TODO: ç€ã›æ›¿ãˆè€ƒæ…®
                            MaterialTheme.colorScheme.tertiary.copy(alpha = 0.2f) // TODO: ç€ã›æ›¿ãˆè€ƒæ…®
                        )
                    )
                )
                .border(width = 0.5.dp, color = Color.LightGray) // è¿½åŠ 
        ) {
            content()
        }
    },
)

@Composable
private fun Day(day: CalendarDay) {
    val textColor = when (day.position) {
        DayPosition.MonthDate -> Color.Unspecified
        DayPosition.InDate, DayPosition.OutDate -> Color.LightGray
    }
    Box(
        modifier = Modifier
            .aspectRatio(1f)
            .border(width = 0.5.dp, color = Color.LightGray) // è¿½åŠ 
            .padding(1.dp),
        contentAlignment = Alignment.Center
    ) {
        Text(text = day.date.dayOfMonth.toString(), color = textColor)
    }
}
```

![image7.png](/images/41c0db864657d0/image7.png)

## 5. æ—¥ä»˜ã‚’å·¦ä¸Šã«å¯„ã›ã¦åœŸæ—¥ã®è‰²ã‚’å¤‰ãˆã‚‹

```kotlin
@Composable
private fun Day(day: CalendarDay) {
    val textColor = when (day.position) {
        DayPosition.MonthDate -> when (day.date.dayOfWeek) {
            DayOfWeek.SATURDAY -> Color.Blue
            DayOfWeek.SUNDAY -> Color.Red
            else -> Color.Unspecified
        }

        DayPosition.InDate, DayPosition.OutDate -> Color.LightGray
    }
    Box(
        modifier = Modifier
            .aspectRatio(1f)
            .border(width = 0.5.dp, color = Color.LightGray)
            .padding(1.dp),
        contentAlignment = Alignment.Center
    ) {
        Text(
            modifier = Modifier
                .align(Alignment.TopStart)
                .padding(top = 3.dp, start = 4.dp),
            text = day.date.dayOfMonth.toString(), color = textColor
        )
    }
}
```

![image8.png](/images/41c0db864657d0/image8.png)

## 6. é¸æŠã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹

ã¾ãšã¯é¸æŠã•ã‚ŒãŸæ—¥ä»˜ã‚’ä¿æŒã™ã‚‹ä»¥ä¸‹å¤‰æ•°ã‚’è¿½åŠ ã—ã¾ã™ã€‚

```kotlin
var selection by remember { mutableStateOf<CalendarDay?>(null) }
```

æ¬¡ã« `Day` ComposableãŒã‚¯ãƒªãƒƒã‚¯ã§ãã‚‹ã‚ˆã†ã« `Modifier` ã« `clickable` ã‚’è¿½ã—ã¾ã™ã€‚

```kotlin
@Composable
private fun Day(day: CalendarDay, onClick: (CalendarDay) -> Unit = {}) {
    ...
    Box(
        modifier = Modifier
            .aspectRatio(1f)
            .border(width = 0.5.dp, color = Color.LightGray)
            .padding(1.dp)
            .clickable { // â†è¿½åŠ 
                onClick(day)
            },
        contentAlignment = Alignment.Center
    ) {
       ...
    }
}
```

ã“ã®çŠ¶æ…‹ã§ã‚¯ãƒªãƒƒã‚¯ã•ã‚ŒãŸæ™‚ã«ãƒ­ã‚°ãŒå‡ºã‚‹æ§˜ã«ã—ã¦ã¿ã¾ã™ã€‚

```kotlin
HorizontalCalendar(
    state = state,
    dayContent = {
        Day(it) { clickDay ->
            Timber.d("clickDay: $clickDay")
        }
    },
```

ã‚¯ãƒªãƒƒã‚¯ã—ãŸæ—¥ä»˜ãŒãƒ­ã‚°ã«å‡ºåŠ›ã•ã‚Œã¦ã„ã¾ã™â†“

![image9.gif](/images/41c0db864657d0/image9.gif)

ã¾ãŸã€è¡¨ç¤ºã—ã¦ã„ã‚‹æœˆä»¥å¤–ã®æœˆã®æ—¥ä»˜ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã‚‚åå¿œã—ãªã„ã‚ˆã†ã«ã™ã‚‹ã«ã¯ *`clickable`* ã® `enabled` ã«ä»¥ä¸‹ã‚’è¨­å®šã—ã¾ã™ã€‚

```kotlin
.clickable(enabled = day.position == DayPosition.MonthDate) { // â†è¿½åŠ 
    onClick(day)
},
```

![image10.gif](/images/41c0db864657d0/image10.gif)

æœ€å¾Œã«é¸æŠæ—¥ä»˜ã‚’åæ˜ ã—ã¾ã™ã€‚

```kotlin
Day(it, isSelected = selection == it) { clickDay ->
    selection = clickDay
}

...

@Composable
private fun Day(
    day: CalendarDay,
    isSelected: Boolean = false, // â† è¿½åŠ 
    onClick: (CalendarDay) -> Unit = {}
) {
    ...
    Box(
        modifier = Modifier
            .aspectRatio(1f)
            .background(color = if (isSelected) Color.Cyan else Color.Transparent) // â† è¿½åŠ 
            .border(width = 0.5.dp, color = Color.LightGray)
            .padding(1.dp)
            .clickable(enabled = day.position == DayPosition.MonthDate) {
                onClick(day)
            },
        contentAlignment = Alignment.Center
    ) {
       ...
    }
}
```

![image11.gif](/images/41c0db864657d0/image11.gif)

ä»¥ä¸Šã«ãªã‚Šã¾ã™ã€‚
