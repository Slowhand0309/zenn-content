---
title: "ã€Flutterã€‘simple_audio ã‚’è©¦ã™"
emoji: "ğŸ¶"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics:
  - "flutter"
  - "dart"
  - "android"
  - "pub"
published: true
---
# æ¦‚è¦
ä»Šå›ã¯ä»¥ä¸‹ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’è©¦ã—ã¦ã¿ãŸã„ã¨æ€ã„ã¾ã™ã€‚ãƒ‘ãƒƒã¨è©¦ã™ã ã‘ãªã®ã§Androidã®ã¿ã§è©¦ã—ã¦ã„ã¾ã™ã€‚

https://pub.dev/packages/simple_audio

- ã§ãã‚‹ã ã‘ã‚·ãƒ³ãƒ—ãƒ«ã«ã€ã‚³ã‚¢æ©Ÿèƒ½ã®ã¿ (ä¾‹: å†ç”Ÿ/ä¸€æ™‚åœæ­¢) ã‚’æä¾›
- å®‰å®šæ€§ã¨æ¯”è¼ƒçš„ãƒã‚°ã®ãªã„çŠ¶æ…‹ã‚’ç›®æŒ‡ã—ã¦ã„ã‚‹

ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’è¦‹ã¦ã¿ã‚‹ã¨ã‚³ã‚¢éƒ¨åˆ†ãŒRustã‚’ä½¿ã£ã¦å®Ÿè£…ã•ã‚Œã¦ã„ã¾ã™ã€‚
ã‚·ãƒ³ãƒ—ãƒ«ã«éŸ³ã‚’é³´ã‚‰ã™ã“ã¨ã«ç‰¹åŒ–ã—ãŸãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ç›®æŒ‡ã—ã¦ã„ã‚‹ã¨ã„ã†äº‹ãªã®ã§ã€å®Ÿéš›ã«è©¦ã—ã¦ã¿ãŸã„ã¨æ€ã„ã¾ã™ã€‚

## ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

ä»¥ä¸‹ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿæ–½ã—ã¦è¿½åŠ ã™ã‚‹ã‹

```bash
flutter pub add simple_audio
```

`pubspec.yaml` ã«ä»¥ä¸‹ã‚’è¿½åŠ ã—ã¾ã™ã€‚

```yaml
dependencies:
  simple_audio: ^2.0.4
```

æ¬¡ã«ã‚µãƒ³ãƒ—ãƒ«å®Ÿè£…ã«å¿…è¦ãªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ãŠãã¾ã™ã€‚ä»Šå› [file_picker](https://pub.dev/packages/file_picker) ã¨ [permission_handler](https://pub.dev/packages/permission_handler) ã‚’ä½¿ã„ã¾ã™

```bash
flutter pub add file_picker permission_handler
```

```yaml
dependencies:
  file_picker: ^8.1.7
  permission_handler: ^11.3.1
```

# ã‚·ãƒ³ãƒ—ãƒ«ãªå®Ÿè£…

ä»Šå›ã¯mp3ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é³´ã‚‰ã™ã ã‘ã®å®Ÿè£…ã‚’è©¦ã—ã¦ã¿ãŸã„ã¨æ€ã„ã¾ã™ã€‚Flutterãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’æ–°è¦ä½œæˆã—ã€`main.dart` ã®ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆéƒ¨åˆ†ã‚’ä»¥ä¸‹ã®ã‚ˆã†ã«ä¿®æ­£ã—ã¾ã™ã€‚

```dart
void main() async {
  WidgetsFlutterBinding.ensureInitialized();

  await SimpleAudio.init(); // â† è¿½åŠ 
  // ....
}
```

æ¬¡ã« `android/app/src/main/AndroidManifest.xml` ã«ä»¥ä¸‹ `Permission` ã‚’è¿½åŠ ã—ã¾ã™ã€‚

```xml
    <uses-permission android:name="android.permission.READ_EXTERNAL_STORAGE" android:maxSdkVersion="32" />
    <uses-permission android:name="android.permission.READ_MEDIA_AUDIO" />
```

æ¬¡ã« `SimpleAudioSample.dart` ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä»¥ä¸‹å†…å®¹ã§ä½œæˆã—ã€ã‚¢ãƒ—ãƒªå†…ã§ã“ã¡ã‚‰ã®ç”»é¢ã‚’è¡¨ç¤ºã™ã‚‹ã‚ˆã†ã«å®Ÿè£…ã—ã¾ã™ã€‚

```dart
import 'package:file_picker/file_picker.dart';
import 'package:flutter/material.dart';
import 'package:permission_handler/permission_handler.dart';
import 'package:simple_audio/simple_audio.dart';

class SimpleAudioSample extends StatelessWidget {
  const SimpleAudioSample({super.key});

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: AppBar(title: const Text('Simple Audio')),
      body: Center(
        child: ElevatedButton(
          onPressed: () async {
ã€€ã€€ã€€ã€€ã€€ã€€ã€€// â‘ 
            var status = await Permission.audio.status;
            if (!status.isGranted) {
              status = await Permission.audio.request();
            }
            if (status.isDenied) {
              return;
            }
            // â‘¡
            final path = await pickFile();
            if (path == null) {
              return;
            }
            // â‘¢
            final SimpleAudio player =
                SimpleAudio(shouldNormalizeVolume: false);
            await player.stop();
            await player.open(path);
          },
          child: const Text('Play sound'),
        ),
      ),
    );
  }

  Future<String?> pickFile() async {
    FilePickerResult? file = await FilePicker.platform
        .pickFiles(dialogTitle: "Pick file to play.", type: FileType.audio);

    final PlatformFile? pickedFile = file?.files.single;
    return pickedFile?.path;
  }
}
```

- â‘  : Permissionãƒã‚§ãƒƒã‚¯
ã€€ã€€- ä»¥å‰ã¯ permission_handler ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®`Permission.storage` ã¯ `READ_EXTERNAL_STORAGE` ã¨ `WRITE_EXTERNAL_STORAGE` ã«ç´ã¥ã„ã¦ã„ã¾ã—ãŸãŒã€Android 10 (API 29)ã‹ã‚‰éæ¨å¥¨ã€Android 13 (API 33)ã§ã¯å‰Šé™¤ã•ã‚Œã¦ã„ã¾ã™
ã€€ã€€- ä»£ã‚ã‚Šã« `READ_MEDIA_IMAGES` `READ_MEDIA_VIDEO` `READ_MEDIA_AUDIO` ã‚’ä½¿ç”¨ã™ã‚‹æ§˜ã«ãªã‚Šã¾ã—ãŸ
ã€€ã€€- ãã‚Œãã‚Œ `Permission.photos` `Permission.videos` `Permission.audio` ã«ç´ã¥ã„ã¦ã„ã¾ã™
ã€€ã€€- ä»Šå›ã¯Audioã®ã¿ãªã®ã§ `Permission.audio` ã‚’ä½¿ç”¨ã—ã¦ã„ã¾ã™
ã€€ã€€- â€» compileSdkVersionãŒ33ä»¥ä¸Šã®è¨­å®šãŒå¿…è¦

https://source.android.com/docs/core/storage?hl=ja

- â‘¡ : Audioãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿
ã€€ã€€- file_pickerãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ä½¿ç”¨ã—ã¦ã€Audioãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã‚“ã§ã„ã¾ã™

- â‘¢ : Audioãƒ•ã‚¡ã‚¤ãƒ«ã®å†ç”Ÿ
ã€€ã€€- ä»Šå›ã®ãƒ¡ã‚¤ãƒ³ã®å‡¦ç†ã«ãªã‚Šã¾ã™
ã€€ã€€- SimpleAudioã®Playerã‚’åˆæœŸåŒ–ã—ã¦ã€Audioãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ‘ã‚¹ã‚’ä¸ãˆã¦ã„ã¾ã™
ã€€ã€€- `open` ã‚’å®Ÿæ–½ã™ã‚‹ã¨ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§è‡ªå‹•å†ç”Ÿã•ã‚Œã¾ã™

ğŸ‘‡ã‚·ãƒ¥ãƒŸãƒ¬ãƒ¼ã‚¿ã§å®Ÿè¡Œã™ã‚‹ã¨éŸ³ãŒå†ç”Ÿã•ã‚Œã‚‹ã‹ã¨æ€ã„ã¾ã™ã€‚(gifãªã®ã§é›°å›²æ°—ã ã‘â€¦)

![image1.gif](/images/36ab0c56850755/image1.gif =300x)

# å‚è€ƒURL

[Android13å¯¾å¿œï¼ˆãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ¡ãƒ‡ã‚£ã‚¢æ¨©é™ï¼‰](https://www.jisei-firm.com/android_develop42/)