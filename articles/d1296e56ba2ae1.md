---
title: "ã€Androidã€‘Compose ã§ material3ã® Navigation Barã‚’è©¦ã™"
emoji: "ğŸ¹"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics:
  - "android"
  - "kotlin"
  - "compose"
  - "material3"
published: true
---
# ã¯ã˜ã‚ã«

`androidx-navigation-compose` ã‚’ä½¿ç”¨ã—ã¦material3ã®Navigation Barã‚’è©¦ã—ã¦ã¿ãŸã„ã¨æ€ã„ã¾ã™

[Compose ã‚’ä½¿ç”¨ã—ãŸãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ Â |Â  Jetpack Compose Â |Â  Android Developers](https://developer.android.com/jetpack/compose/navigation?hl=ja)

# ç’°å¢ƒæ§‹ç¯‰ã‚„æº–å‚™

å„ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚„ç’°å¢ƒ

```sh
# Android Studio Giraffe | 2022.3.1 Patch 1

$ sw_vers
ProductName: macOS
ProductVersion: 13.4
BuildVersion: 22F66
```

## 1. æ–°è¦ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆ

ã‚µãƒ³ãƒ—ãƒ«ç”¨ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã—ã¦ã„ãã¾ã™ã€‚

ã€ŒEmpty Activityã€ã®Templateã‚’é¸æŠ

![image1.png](/images/d1296e56ba2ae1/image1.png)

ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåã¯ã€ŒComposeBottomNavigationExampleã€ã¨ã—ã¾ã—ãŸã€‚

![image2.png](/images/d1296e56ba2ae1/image2.png)

â€»ã€ŒKotlin DSL (build.gradle.kts) + Gradle Version Catalogs (Experimental)ã€ã‚’é¸æŠã—ã¦ã¾ã™

## 2. å¿…è¦ãªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’è¿½åŠ 

### 1-1.  `gradle/libs.versions.toml` ã«ä»¥ä¸‹ã‚’è¿½åŠ 

```toml
[versions]
androidx-navigation = "2.7.2"

[libraries]
androidx-navigation-compose = { module = "androidx.navigation:navigation-compose", version.ref = "androidx-navigation" }
```

### 1-2. `app/build.gradle` ã«ä»¥ä¸‹ã‚’è¿½åŠ 

```kotlin
dependencies {
  ...
  implementation(libs.androidx.navigation.compose)
}
```

`compose-navigation` ã® `2.7.2` ã ã¨ `compileSdk` ã‚’ `34` ã«ã—ã¦ãŠãå¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

## 3. ãƒ™ãƒ¼ã‚¹ã¨ãªã‚‹ `MyAppNavHost` é–¢æ•°ã‚’è¿½åŠ 

æ–°è¦ã« `MyAppNavHost.kt` ã‚’ä»¥ä¸‹å†…å®¹ã§ä½œæˆã—ã¾ã™ã€‚

```kotlin
@Composable
fun MyAppNavHost(
    navController: NavHostController = rememberNavController(),
    startDestination: String = "home"
) {
    NavHost(navController = navController, startDestination = startDestination) {
        composable("home") {
            Greeting("Android")
        }
    }
}
```

## 4. `MainActivity` ã§ `MyAppNavHost` ã‚’å‘¼ã¶ã‚ˆã†ã«ä¿®æ­£

```kotlin
class MainActivity : ComponentActivity() {
    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        setContent {
            ComposeBottomNavigationExampleTheme {
                // A surface container using the 'background' color from the theme
                Surface(
                    modifier = Modifier.fillMaxSize(),
                    color = MaterialTheme.colorScheme.background
                ) {
                    MyAppNavHost() // â† ã“ã“ã‚’ä¿®æ­£
                }
            }
        }
    }
}
```

ã“ã“ã¾ã§ã§å®Ÿè¡Œã—ã¦ã„ã¤ã‚‚ã® `Greeting` ã®å†…å®¹ãŒå‡ºã¨ã‘ã°OKã§ã™ã€‚

# å®Ÿè£…

## 1. ã‚·ãƒ³ãƒ—ãƒ«ãªå®Ÿè£…

ã¾ãšã¯ä¸€ç•ªã‚·ãƒ³ãƒ—ãƒ«ãªå®Ÿè£…ã‚’è©¦ã—ã¦ã¿ãŸã„ã¨æ€ã„ã¾ã™ã€‚

æ–°è¦ã« `HomeScreen.kt` ã‚’ä½œæˆã—ã€ä»¥ä¸‹ã«ä¿®æ­£ã—ã¾ã™ã€‚

```kotlin
enum class MainScreenTab(
    val icon: ImageVector,
    val label: String
) {
    Home(
        icon = Icons.Outlined.Home,
        label = "Home"
    ),
    List(
        icon = Icons.Outlined.List,
        label = "List"
    ),
    Settings(
        icon = Icons.Outlined.Info,
        label = "About"
    )
}

@OptIn(ExperimentalMaterial3Api::class)
@Composable
fun MainScreen() {
    var selectedItem by remember { mutableIntStateOf(0) }
    Scaffold(
        bottomBar = {
            NavigationBar {
                MainScreenTab.values().forEachIndexed { index, item ->
                    NavigationBarItem(
                        icon = { Icon(item.icon, contentDescription = item.label) },
                        label = { Text(item.label) },
                        selected = selectedItem == index,
                        onClick = { selectedItem = index }
                    )
                }
            }
        }
    ) {
        Box(modifier = Modifier.padding(it))
    }
}

@Preview(showBackground = true)
@Composable
fun MainScreenPreview() {
    ComposeBottomNavigationExampleTheme {
        MainScreen()
    }
}
```

â†“Previewã§ã®è¡¨ç¤ºã¯ä»¥ä¸‹ã®æ§˜ã«ãªã‚Šã¾ã™ã€‚

![image3.png](/images/d1296e56ba2ae1/image3.png =350x)

## 2. `MainScreen`ã‚’å‘¼ã³å‡ºã™`NavGraph` ã‚’ä½œæˆ

mainScreenç”¨ã«NavGraphBuilderã®æ‹¡å¼µé–¢æ•°ã¨ã—ã¦å®šç¾©ã—ã¦ã„ãã¾ã™ã€‚

composableã§ã¯ãªã [navigation](https://developer.android.com/reference/kotlin/androidx/navigation/compose/package-summary#(androidx.navigation.NavGraphBuilder).navigation(kotlin.String,kotlin.String,kotlin.collections.List,kotlin.collections.List,kotlin.Function1,kotlin.Function1,kotlin.Function1,kotlin.Function1,kotlin.Function1)) ã‚’ä»•æ§˜ã™ã‚‹ã¨ãƒã‚¹ãƒˆã—ãŸ NavGraphã‚’å®šç¾©ã™ã‚‹äº‹ãŒã§ãã¾ã™ã€‚

```kotlin
private fun NavGraphBuilder.mainScreen() {
    navigation(route = "main", startDestination = "main/entry") {
        composable("main/entry") {
            MainScreen()
        }
    }
}
```

`MyAppNavHost` ã‚’ä»¥ä¸‹ã«ä¿®æ­£ã—ã¾ã™ã€‚

```kotlin
@Composable
fun MyAppNavHost(
    navController: NavHostController = rememberNavController(),
    startDestination: String = "main" // mainã«å¤‰æ›´
) {
    NavHost(navController = navController, startDestination = startDestination) {
        mainScreen() // å…ˆç¨‹ã®æ‹¡å¼µé–¢æ•° mainScreenã‚’å‘¼ã³å‡ºã™
    }
}
```

ã“ã“ã¾ã§ã§å®Ÿéš›ã«å‹•ã‹ã—ã¦ã¿ã‚‹ã¨å…ˆç¨‹ã®PreviewåŒæ§˜ã®ç”»é¢ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã‹ã¨æ€ã„ã¾ã™ã€‚

## 3. Navigation Barå†…ã®NavGraphã‚’ä½œæˆ

ã¾ãš `MainScreenTab` ã«NavGraphç”¨ã® `id` ã‚’è¿½åŠ ã—ã¾ã™ã€‚

```kotlin
enum class MainScreenTab(
    val id: String,
    val icon: ImageVector,
    val label: String
) {
    Home(
        id = "main/home",
        icon = Icons.Outlined.Home,
        label = "Home"
    ),
    List(
        id = "main/list",
        icon = Icons.Outlined.List,
        label = "List"
    ),
    Settings(
        id = "main/about",
        icon = Icons.Outlined.Info,
        label = "About"
    )
}
```

æ¬¡ã« `MainScreen` ã‚’ä»¥ä¸‹ã«ä¿®æ­£ã—ã¾ã™ã€‚

`rememberNavController` ã§ `MainScreen` ã®Navigation Barç”¨ã®navControllerã‚’ä½œæˆã—ã€ `currentBackStackEntryAsState` (Composable) ã‹ã‚‰ç¾åœ¨ã®é¸æŠã—ã¦ã„ã‚‹Tabã‚’åˆ¤å®šã—ã¾ã™ã€‚

```kotlin
@Composable
fun MainScreen() {
    val nestedNavController = rememberNavController()
    val navBackStackEntry by nestedNavController.currentBackStackEntryAsState()
    val currentTab = navBackStackEntry?.destination?.route
    Scaffold(
        bottomBar = {
            NavigationBar {
                MainScreenTab.values().forEachIndexed { index, item ->
                    NavigationBarItem(
                        icon = { Icon(item.icon, contentDescription = item.label) },
                        label = { Text(item.label) },
                        selected = currentTab == item.id,
                        onClick = { nestedNavController.navigate(item.id) }
                    )
                }
            }
        }
    ) {
        Box(modifier = Modifier.padding(it)) {
            NavHost(
                navController = nestedNavController,
                startDestination = "main/home",
                modifier = Modifier,
            ) {
                composable("main/home") {
                    Text("main/home")
                }
                composable("main/list") {
                    Text("main/list")
                }
                composable("main/about") {
                    Text("main/about")
                }
            }
        }
    }
}
```

![image4.gif](/images/d1296e56ba2ae1/image4.gif =350x)

# ã“ã®è¨˜äº‹ã¯ä»¥ä¸‹ã®æƒ…å ±ã‚’å‚è€ƒã«ã—ã¦åŸ·ç­†ã—ã¾ã—ãŸ

- [ã€JetpackComposeã€‘BottomNavigation ã®ä½¿ã„æ–¹](https://android.benigumo.com/20220818/bottomnavigation/)
- [Jetpack Composeã§ç”»é¢é·ç§»ã‚’ã™ã‚‹](https://zenn.dev/joo_hashi/articles/d48e7ef51ee53f)
- [[Jetpack Compose] NavigationBar ã¨ Nested Navigation](https://zenn.dev/ykrods/articles/580bc1fda58081)
- [Navigation Composeã§ã‚°ãƒ©ãƒ•ã‚’å…¥ã‚Œå­ã«ã™ã‚‹ | mokelab tech sheets](https://tech.mokelab.com/android/compose/app/navigation/nested.html)