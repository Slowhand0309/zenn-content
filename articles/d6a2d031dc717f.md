---
title: "ã€Androidã€‘Rich Text Editorã®Compose Rich Editorã‚’è©¦ã™"
emoji: "ğŸ–‹ï¸"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics:
  - "android"
  - "kotlin"
  - "compose"
  - "richtext"
published: true
---
# æ¦‚è¦

Androidã§Rich Text Editorã‚’å®Ÿè£…ã™ã‚‹éš›ã«ã€è‰¯ã•ã’ãªãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’æ¢ã—ã¦ã„ãŸæ‰€ `Compose Rich Editor` ãŒComposeã§æ‰±ã„ã‚„ã™ãã†ã ã£ãŸã®ã§è©¦ã—ã¦ã¿ã¾ã—ãŸã€‚
â€» Compose Multiplatform å¯¾å¿œã¨ã®äº‹ã§ã™ãŒä»Šå›ã¯Androidã®ã¿ã§ã—ã‹è©¦ã—ã¦ã¾ã›ã‚“ã€‚

# å‹•ä½œç’°å¢ƒ

- M3 MacBook Air 14.4.1
- Android Studio Iguana | 2023.2.1 Patch 1
- ã‚¨ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿: Pixel 8 Pro API Level VanillalceCream

# ãƒ™ãƒ¼ã‚¹ã¨ãªã‚‹ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆ

1. ã€ŒNew Projectâ€¦ã€ã§ã€ŒEmpty Activityã€ã‚’é¸æŠã—ã¾ã™
    ![image1.png](/images/d6a2d031dc717f/image1.png)

2. ä»Šå›ã¯ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåã‚’ã€ŒRichTextEditorExamplesã€ã¨ã—ã¦ä»¥ä¸‹å†…å®¹ã§ä½œæˆã—ã¾ã™
    ![image2.png](/images/d6a2d031dc717f/image2.png)

# Compose Rich Editor

[Compose Rich Editor](https://mohamedrejeb.github.io/Compose-Rich-Editor/)

- Jetpack Compose ã¨ Compose Multiplatform ã®ä¸¡æ–¹ã«å¯¾å¿œ
- ä¸€èˆ¬çš„ãªãƒ†ã‚­ã‚¹ãƒˆ ã‚¹ã‚¿ã‚¤ãƒ«æ©Ÿèƒ½ã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹ WYSIWYG ã‚¨ãƒ‡ã‚£ã‚¿

[Compose Rich Editor](https://compose-richeditor.netlify.app/)

â†‘ã“ã¡ã‚‰ã§ãƒ‡ãƒ¢ã‚’è§¦ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

## ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

`settings.gradle(.kts)` ã® `dependencyResolutionManagement` > `repositories` ã«

`mavenCentral()` ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹äº‹ã‚’ç¢ºèªã— `gradle/libs.versions.toml` ã«ä»¥ä¸‹ã‚’è¿½åŠ ã—ã¾ã™ã€‚

```toml
[versions]
richeditorCompose = "1.0.0-rc03"

[libraries]
richeditor-compose = { module = "com.mohamedrejeb.richeditor:richeditor-compose", version.ref = "richeditorCompose" }
```

æ¬¡ã« `app/build.gradle.kts` ã«ä»¥ä¸‹ã‚’è¿½åŠ ã—ã¾ã™ã€‚

```kotlin
dependencies {
  implementation(libs.richeditor.compose)
}
```

## ç°¡å˜ãªå®Ÿè£…

æ—©é€Ÿã‚·ãƒ³ãƒ—ãƒ«ãªã‚‚ã®ã‚’è©¦ã—ã¦ã¿ãŸã„ã¨æ€ã„ã¾ã™ã€‚ã¾ãš `MainActivity.kt` ã«ä»¥ä¸‹ã®æ§˜ãª `Composable` ã‚’ä½œæˆã—ã¾ã™ã€‚

```kotlin
@Composable
fun Editor() {
    val state = rememberRichTextState()

    LazyColumn(
        modifier = Modifier
            .fillMaxSize()
            .padding(20.dp)
    ) {
        item {
            Button(onClick = {
                state.toggleSpanStyle(
                    SpanStyle(
                        fontWeight = FontWeight.Bold
                    )
                )
            }) {
                Text(text = "bold", color = if (state.currentSpanStyle.fontWeight == FontWeight.Bold) Color.Red else Color.White)
            }
        }
        item {
            RichTextEditor(
                modifier = Modifier.fillMaxWidth(),
                state = state,
            )
        }
    }
}
```

ã“ã‚Œã‚’ `MainActivity` å†…ã§å‘¼ã¶ã‚ˆã†ã«ä¿®æ­£ã—ã¾ã™ã€‚

```kotlin
class MainActivity : ComponentActivity() {
    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        setContent {
            RichTextEditorExamplesTheme {
                Surface(
                    modifier = Modifier.fillMaxSize(),
                    color = MaterialTheme.colorScheme.background
                ) {
                    Editor() // â† ä¿®æ­£
                }
            }
        }
    }
}
```

æ—©é€Ÿå®Ÿè¡Œã—ã¦ã¿ã¾ã™!

![image3.gif](/images/d6a2d031dc717f/image3.gif =300x)

â†‘ã¡ã‚‡ã£ã¨åˆ†ã‹ã‚Šã¥ã‚‰ã„ã‹ã‚‚ã§ã™ãŒã€ãƒ†ã‚­ã‚¹ãƒˆãŒç·¨é›†ã§ãã¦ä¸Šéƒ¨ã®ã€Œboldã€ã®ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã¨ã€ãã®å¾Œå…¥åŠ›ã—ãŸæ–‡å­—ã« `bold` ã®è£…é£¾ãŒè¿½åŠ ã•ã‚Œã¦ã„ã‚‹ã“ã¨ãŒåˆ†ã‹ã‚Šã¾ã™ã€‚

## ä»–ã®ã‚¹ã‚¿ã‚¤ãƒ«å®Ÿè£…

`bold` ä»¥å¤–ã«ã‚‚ã‚¹ã‚¿ã‚¤ãƒ«å¤‰æ›´ãƒœã‚¿ãƒ³ã‚’è¨­ç½®ã—ã€è‰²ã€…è©¦ã—ã¦ã¿ãŸã„ã¨æ€ã„ã¾ã™ã€‚

```kotlin
@Composable
fun Editor() {
    val state = rememberRichTextState()

    LazyColumn(
        modifier = Modifier
            .fillMaxSize()
            .padding(20.dp)
    ) {
        item {
            LazyRow(
                verticalAlignment = Alignment.CenterVertically,
            ) {
             item {
                 StyleButton(
                     state = state,
                     text = "left",
                     isSelected = state.currentParagraphStyle.textAlign == TextAlign.Left,
                     onClick = {
                         state.addParagraphStyle(
                             ParagraphStyle(
                                 textAlign = TextAlign.Left,
                             )
                         )
                     }
                 )
                 StyleButton(
                     state = state,
                     text = "center",
                     isSelected = state.currentParagraphStyle.textAlign == TextAlign.Center,
                     onClick = {
                         state.addParagraphStyle(
                             ParagraphStyle(
                                 textAlign = TextAlign.Center,
                             )
                         )
                     }
                 )
                 StyleButton(
                     state = state,
                     text = "right",
                     isSelected = state.currentParagraphStyle.textAlign == TextAlign.Right,
                     onClick = {
                         state.addParagraphStyle(
                             ParagraphStyle(
                                 textAlign = TextAlign.Right,
                             )
                         )
                     }
                 )
                 StyleButton(
                     state = state,
                     text = "bold",
                     isSelected = state.currentSpanStyle.fontWeight == FontWeight.Bold,
                     onClick = {
                         state.toggleSpanStyle(
                             SpanStyle(
                                 fontWeight = FontWeight.Bold
                             )
                         )
                     }
                 )
                 StyleButton(
                     state = state,
                     text = "italic",
                     isSelected = state.currentSpanStyle.fontStyle == FontStyle.Italic,
                     onClick = {
                         state.toggleSpanStyle(
                             SpanStyle(
                                 fontStyle = FontStyle.Italic
                             )
                         )
                     }
                 )
                 StyleButton(
                     state = state,
                     text = "underline",
                     isSelected = state.currentSpanStyle.textDecoration?.contains(TextDecoration.Underline) == true,
                     onClick = {
                         state.toggleSpanStyle(
                             SpanStyle(
                                 textDecoration = TextDecoration.Underline
                             )
                         )
                     }
                 )
                 StyleButton(
                     state = state,
                     text = "lineThrough",
                     isSelected = state.currentSpanStyle.textDecoration?.contains(TextDecoration.LineThrough) == true,
                     onClick = {
                         state.toggleSpanStyle(
                             SpanStyle(
                                 textDecoration = TextDecoration.LineThrough
                             )
                         )
                     }
                 )
                 StyleButton(
                     state = state,
                     text = "fontSize",
                     isSelected = state.currentSpanStyle.fontSize == 28.sp,
                     onClick = {
                         state.toggleSpanStyle(
                             SpanStyle(
                                 fontSize = 28.sp
                             )
                         )
                     }
                 )
                 StyleButton(
                     state = state,
                     text = "red",
                     isSelected = state.currentSpanStyle.color == Color.Red,
                     onClick = {
                         state.toggleSpanStyle(
                             SpanStyle(
                                 color = Color.Red
                             )
                         )
                     }
                 )
                 StyleButton(
                     state = state,
                     text = "unorderedList",
                     isSelected = state.isUnorderedList,
                     onClick = {
                         state.toggleUnorderedList()
                     }
                 )
                 StyleButton(
                     state = state,
                     text = "orderedList",
                     isSelected = state.isOrderedList,
                     onClick = {
                         state.toggleOrderedList()
                     }
                 )
                 StyleButton(
                     state = state,
                     text = "code",
                     isSelected = state.isCodeSpan,
                     onClick = {
                         state.toggleCodeSpan()
                     }
                 )
             }
            }
        }
        item {
            RichTextEditor(
                modifier = Modifier.fillMaxWidth(),
                state = state,
            )
        }
    }
}

@Composable
fun StyleButton(state: RichTextState, text: String, isSelected: Boolean, onClick: () -> Unit) {
    Button(onClick = onClick) {
        Text(
            text = text,
            color = if (isSelected) Color.Red else Color.White
        )
    }
}

```

é•·ããªã‚Šã¾ã—ãŸãŒã€â†‘ã‚’å®Ÿè¡Œã™ã‚‹ã¨ä»¥ä¸‹ã®ã‚ˆã†ã«è‰²ã€…è©¦ã›ã¾ã™ã€‚

![image4.gif](/images/d6a2d031dc717f/image4.gif =300x)

ç¾åœ¨ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã‚‹ã‚¹ã‚¿ã‚¤ãƒ«ã¯[ã“ã¡ã‚‰](https://mohamedrejeb.github.io/Compose-Rich-Editor/getting_started/#supported-styling-formats)ã§ç¢ºèªã§ãã¾ã™ã€‚

## Import / Export

 `Compose Rich Editor` ã§ã¯ **`HTML`** ã¨ **`Markdown`** ã®Import / Export ã«å¯¾å¿œã—ã¦ã„ã‚‹æ§˜ã§ã™ã€‚

æ—©é€Ÿè©¦ã—ã¦ã¿ãŸã„ã¨æ€ã„ã¾ã™ã€‚ å…ˆã»ã©ã®`Editor` ã«ä»¥ä¸‹ã‚’è¿½åŠ ã—ã¾ã™ã€‚

```kotlin
@Composable
fun Editor() {
    val state = rememberRichTextState()
    val text = remember { mutableStateOf("") } // è¿½åŠ 

    LazyColumn(
        modifier = Modifier
            .fillMaxSize()
            .padding(20.dp)
    ) {
        item {
            LazyRow(
                verticalAlignment = Alignment.CenterVertically,
            ) {
             item {
                 // ...
            }
        }
        item {
            RichTextEditor(
                modifier = Modifier.fillMaxWidth(),
                state = state,
            )
        }
        // â†“æ–°è¦è¿½åŠ 
        item {
            Button(onClick = { text.value = state.toHtml() }) {
                Text(text = "HTML")
            }
        }
        item {
            Button(onClick = { text.value = state.toMarkdown() }) {
                Text(text = "Markdown")
            }
        }
        item {
            Text(text = text.value)
        }
    }
}
```

å…¥åŠ›ã—ãŸãƒ†ã‚­ã‚¹ãƒˆã‚’ `HTML` ã¨ `Markdown` ã§å‡ºåŠ›ã™ã‚‹ãƒœã‚¿ãƒ³ã‚’è¨­ã‘ã¦ã€å‡ºåŠ›ã•ã‚ŒãŸå†…å®¹ã‚’è¡¨ç¤ºã•ã›ã¦ã„ã¾ã™ã€‚å®Ÿè¡Œã—ã¦ã¿ã‚‹ã¨â†“ã®æ§˜ã«è¡¨ç¤ºã•ã‚Œã¾ã—ãŸã€‚

![image5.gif](/images/d6a2d031dc717f/image5.gif =300x)

`Markdown` ã§ã¯ `left`, `center` , `right` ãªã©ã® `text-align` ã‚„ `fontSize` , `fontColor` , `underline` ã¯htmlã§è£œå®Œã—ã¦å‡ºåŠ›ãªã©ã¯ã—ã¦ãã‚Œãªã„ã¿ãŸã„ã§ã™ã€‚

# ã¾ã¨ã‚

è¦‹å‡ºã—ã‚„ç”»åƒã€ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ãªã©ã€ã‚ã£ãŸã‚‰å¬‰ã—ã„æ©Ÿèƒ½ã¯ã‚ã‚Šã¾ã™ãŒã€ã‚·ãƒ³ãƒ—ãƒ«ãªã‚‚ã®ã§ã‚ã‚Œã°ä½¿ãˆãã†ã‹ãªã¨ã„ã†æ„Ÿæƒ³ã§ã™ã€‚ã¾ãŸ `link` ã‚„ `codeãƒ–ãƒ­ãƒƒã‚¯` ã®ã¡ã‚‡ã£ã¨ã—ãŸã‚¹ã‚¿ã‚¤ãƒ«èª¿æ•´ã¯ã§ããã†ã§ã™ãŒã€ãã®ä»–ã®ç´°ã‹ãªã‚¹ã‚¿ã‚¤ãƒ«èª¿æ•´ã¯ã§ããªã•ãã†ã§ã—ãŸã€‚

(â€» ç”»åƒã€ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã¯ã¯[ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://mohamedrejeb.github.io/Compose-Rich-Editor/getting_started/)ã«å°†æ¥å®Ÿè£…äºˆå®šã¨æ˜è¨˜ã•ã‚Œã¦ã¾ã™)
