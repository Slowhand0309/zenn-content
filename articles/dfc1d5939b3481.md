---
title: "Reactã®Componentã‚’SVGåŒ– with foreignObject"
emoji: "ğŸ”®"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics:
  - "react"
  - "typescript"
  - "svg"
  - "foreignobject"
  - "devcontainer"
published: true
---
# æ¦‚è¦

Reactã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’foreignObjectã‚’ä½¿ã£ã¦SVGåŒ–ã§ããªã„ã‹è©¦ã—ãŸæ™‚ã®ãƒ¡ãƒ¢ã«ãªã‚Šã¾ã™ã€‚

æ—¢ã«ã€[vercelã®satori](https://github.com/vercel/satori) ãªã©ã§jsxã‚’SVGåŒ–ã§ããŸã‚Šã™ã‚‹ã‚‚ã®ãŒã‚ã‚‹ã‹ã¨æ€ã„ã¾ã™ãŒã€å ´åˆã«ã‚ˆã£ã¦ã¯foreignObjectã‚’ä½¿ã†æ–¹æ³•ã‚‚ã‚ã‚‹ã‚ˆã¨ã„ã†è¨˜äº‹ã«ãªã‚Šã¾ã™ã€‚

# foreignObjectã¨ã¯?

https://developer.mozilla.org/ja/docs/Web/SVG/Element/foreignObject

> **`<foreignObject>`**Â [SVG](https://developer.mozilla.org/ja/docs/Web/SVG)Â è¦ç´ ã¯ã€ç•°ãªã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã«ã‚ˆã£ã¦æç”»ã•ã‚Œã‚‹ã‚°ãƒ©ãƒ•ã‚£ãƒƒã‚¯ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’æŒã¤å¤–éƒ¨ XML åå‰ç©ºé–“ã‚’å«ã‚ã‚‹ã“ã¨ã‚’å¯èƒ½ã«ã—ã¾ã™ã€‚å«ã¾ã‚ŒãŸå¤–éƒ¨ã‚°ãƒ©ãƒ•ã‚£ãƒƒã‚¯ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã¯ã€SVG å¤‰æ›ã‚„åˆæˆã®å¯¾è±¡ã¨ãªã‚Šã¾ã™ã€‚

â†“ã¿ãŸã„ãªäº‹ãŒå¯èƒ½ã«ãªã‚Šã¾ã™ã€‚â€» ä¸Šè¨˜ã‚µã‚¤ãƒˆã®ã‚µãƒ³ãƒ—ãƒ«ã‚’å°‘ã—ä¿®æ­£ã—ã¦ã„ã¾ã™ã€‚

```xml
<svg width="400px" height="300px" viewBox="0 0 400 300"
     xmlns="http://www.w3.org/2000/svg">
  <desc>This example uses the 'switch' element to provide a
        fallback graphical representation of a paragraph, if
        XHTML is not supported.</desc>

  <!-- The 'switch' element will process the first child element
       whose testing attributes evaluate to true.-->
  <switch>

    <!-- Process the embedded XHTML if the requiredExtensions attribute
         evaluates to true (i.e., the user agent supports XHTML
         embedded within SVG). -->
    <foreignObject width="200" height="50"
                   requiredExtensions="http://www.w3.org/1999/xhtml">
      <!-- XHTML content goes here -->
      <body xmlns="http://www.w3.org/1999/xhtml">
        <div style="background-color: red; color: white">
          <p>Here is a paragraph that requires word wrap</p>
        </div>
      </body>
    </foreignObject>

    <!-- Else, process the following alternate SVG.
         Note that there are no testing attributes on the 'text' element.
         If no testing attributes are provided, it is as if there
         were testing attributes and they evaluated to true.-->
    <text font-size="10" font-family="Verdana">
      <tspan x="10" y="10">process the following alternate SVG</tspan>
    </text>
  </switch>
</svg>

```

ã“ã¡ã‚‰ã‚’ä»¥ä¸‹ã®ã‚µã‚¤ãƒˆã«è²¼ã‚Šä»˜ã‘ã‚‹ã¨æŒ™å‹•ãŒç¢ºèªã§ãã¾ã™ã€‚

https://www.svgviewer.dev/

![image1.png](/images/dfc1d5939b3481/image1.png =500x)

## `<switch>` è¦ç´ ã«é–¢ã—ã¦

> switchè¦ç´ ã¯ã€testingå±æ€§ãŒtrueã¨è©•ä¾¡ã•ã‚Œã‚‹æœ€åˆã®å­è¦ç´ 
> ã‚’å‡¦ç†ã—ã¾ã™ã€‚

`foreignObject` ã®æç”»ã«å¤±æ•—ã—ãŸã‚‰æ¬¡ã®è¦ç´ ã®

```xml
    <text font-size="10" font-family="Verdana">
      <tspan x="10" y="10">process the following alternate SVG</tspan>
    </text>
```

ãŒæç”»ã•ã‚Œã‚‹ã¨ã„ã†äº‹ã®æ§˜ã§ã™ã€‚

## `requiredExtensions` å±æ€§ã«é–¢ã—ã¦

> å¿…è¦ãªè¨€èªæ‹¡å¼µã®ãƒªã‚¹ãƒˆã‚’æŒ‡å®šã™ã‚‹ã€‚ è¨€èªæ‹¡å¼µã¯ï¼Œã“ã®ä»•æ§˜ã§å®šã‚ã‚‰ã‚Œã¦ã„ã‚‹ç‰¹èƒ½ã®ç¯„å›²å¤–ã§ã‚ã‚Šã€ UA ã®æ©Ÿèƒ½ã®ç¯„ç–‡ã§ã‚ã‚‹ã€‚ å€‹ã€…ã®è¨€èªæ‹¡å¼µã¯Â IRI å‚ç…§Â ã«ã‚ˆã‚ŠæŒ‡å®šã•ã‚Œã‚‹ã€‚


ä¸Šè¨˜ã®ä¾‹ã§è¨€ã†ã¨ [`http://www.w3.org/1999/xhtml`](http://www.w3.org/1999/xhtml) xhtml ã‚’æŒ‡å®šã—ã¦ã„ã‚‹äº‹ã«ãªã‚Šã¾ã™ã€‚

# ç¢ºèªç”¨ã®ã‚µãƒ³ãƒ—ãƒ«ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆ

https://github.com/Slowhand0309/nodejs-devcontainer-boilerplate

â†‘ã“ã¡ã‚‰ã‚’ãƒ™ãƒ¼ã‚¹ã«ã‚µãƒ³ãƒ—ãƒ«ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã—ã¦ã„ããŸã„ã¨æ€ã„ã¾ã™ã€‚ `git clone` ã—ä¸€åº¦VSCodeä¸Šã‹ã‚‰devcontainerã‚’ä½¿ç”¨ã—ã‚³ãƒ³ãƒ†ãƒŠã‚’èµ·å‹•ã€ä»Šå›ã¯ `Vite` ã§ `React` `Typescript` æ§‹æˆã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã—ã¾ã™ã€‚

```bash
yarn create vite . --template react-ts
# Ignore files and continueã‚’é¸ã‚“ã§ä½œæˆ
Current directory is not empty. Please choose how to proceed:
    Remove existing files and continue
    Cancel operation
â¯   Ignore files and continue

```

`.devcontainer/postAttach.sh` ã«ä»¥ä¸‹ã‚’è¿½åŠ ã—ã¾ã™ã€‚

```bash
yarn install
yarn dev
```

`.devcontainer/docker-compose.yml` ã«ä»¥ä¸‹ã‚’è¿½åŠ ã—ã¾ã™ã€‚

```yaml
services:
  app:
    build: .
    ...
    working_dir: /usr/src
    ports: # ports è¿½åŠ 
      - "5173:5173"
```

`package.json` ã® `scripts` > `dev` ã‚’ä»¥ä¸‹ã«å¤‰æ›´ã—ã¾ã™ã€‚

```json
  "scripts": {
    "dev": "vite --host=0.0.0.0",
    // ...
  },
```

ã“ã“ã¾ã§ã—ã¦ã€å†åº¦VSCodeã§devcontainerã‚’ä½¿ã£ã¦ã‚³ãƒ³ãƒ†ãƒŠã‚’èµ·å‹•ã—ç›´ã—ã¾ã™ã€‚

ãƒ–ãƒ©ã‚¦ã‚¶ã§ [http://localhost:5173/](http://localhost:5173/) ã«ã‚¢ã‚¯ã‚»ã‚¹ã—Vite + React ãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã‚Œã°OKã§ã™ã€‚

# Componentã®HTMLæ–‡å­—åˆ—åŒ–

ã¾ãšã¯foreignObjectã«åŸ‹ã‚è¾¼ã‚€Componentã‚’ä½œæˆã—ãŸã„ã¨æ€ã„ã¾ã™ã€‚

`src/components/Item.tsx` ã‚’ä»¥ä¸‹å†…å®¹ã§ä½œæˆã—ã¾ã™ã€‚

```tsx
export const Item = () => {
  return (
    <div
      style={{
        width: "450px",
        overflow: "hidden",
        borderRadius: "8px",
        boxShadow: "0 4px 15px rgba(0,0,0,.2)",
        padding: "16px",
      }}
    >
      <h1>Item</h1>
      <p>Item content</p>
    </div>
  );
};
```

ã“ã®Componentã‚’è¡¨ç¤ºã•ã›ã‚‹ã¨â†“ã®æ§˜ã«ãªã‚Šã¾ã™ã€‚

![image2.png](/images/dfc1d5939b3481/image2.png)

ã“ã¡ã‚‰ã‚’ã¾ãšã¯foreignObjectå†…ã«åŸ‹ã‚è¾¼ã‚€ç”¨ã«HTMLæ–‡å­—åˆ—åŒ–ã—ã¦è¦‹ãŸã„ã¨æ€ã„ã¾ã™ã€‚

HTMLæ–‡å­—åˆ—åŒ–ã«ã¯ [`ReactDOMServer.renderToStaticMarkup`](https://ja.react.dev/reference/react-dom/server/renderToStaticMarkup) ã‚’ä½¿ã„ã¾ã™ã€‚

`src/App.tsx` ã‚’ä»¥ä¸‹ã«ä¿®æ­£ã—ã¾ã™ã€‚

```tsx
import { useState } from "react";
import ReactDOMServer from "react-dom/server";
import { Item } from "./components/Item";

const App = () => {
  const [element, setElement] = useState("");
  return (
    <div>
      <Item />
      <hr style={{ margin: "16px" }} />
      <button
        onClick={() => {
          const result = ReactDOMServer.renderToStaticMarkup(<Item />);
          setElement(result);
        }}
      >
        Convert
      </button>
      <hr style={{ margin: "16px" }} />
      {element}
    </div>
  );
};

export default App;

```

å®Ÿè¡Œã—ã¦ã€ŒConvertã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã¨HTMLæ–‡å­—åˆ—åŒ–ã§ãã¦ã„ã‚‹ã‹ã¨æ€ã„ã¾ã™ã€‚

![image3.gif](/images/dfc1d5939b3481/image3.gif)

# Componentã®SVGåŒ–

æœ¬é¡Œã®Componentã®SVGåŒ–ã‚’ã‚„ã£ã¦ã„ããŸã„ã¨æ€ã„ã¾ã™ã€‚

ã¾ãšã¯foreignObjectã®switchéƒ¨åˆ†ã‚’ä½œæˆã™ã‚‹ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½œæˆã—ã¾ã™ã€‚

```tsx
const createForeignObject = (
  width: number,
  height: number,
  content: string
) => {
  const g = document.createElementNS("http://www.w3.org/2000/svg", "g");
  const sw = document.createElementNS("http://www.w3.org/2000/svg", "switch");

  // foreignObjectã‚’ä½œæˆ
  const foreignObject = document.createElementNS(
    "http://www.w3.org/2000/svg",
    "foreignObject"
  );
  foreignObject.setAttribute("width", width.toString());
  foreignObject.setAttribute("height", height.toString());
  foreignObject.setAttribute(
    "requiredExtensions",
    "http://www.w3.org/1999/xhtml"
  );

  const div = document.createElementNS("http://www.w3.org/1999/xhtml", "div");
  div.setAttribute("xmlns", "http://www.w3.org/1999/xhtml");
  div.setAttribute("style", "padding: 8px"); // contentã®å½±ã‚’è¡¨ç¤ºã•ã›ã‚‹ç‚ºã«å°‘ã—paddingè¨­å®š
  div.innerHTML = content;

  // foreignObjectãŒã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ãªã„å ´åˆã«ä»¥ä¸‹ã®textãŒè¡¨ç¤ºã•ã‚Œã‚‹
  const fallthrough = document.createElementNS(
    "http://www.w3.org/2000/svg",
    "text"
  );
  fallthrough.setAttribute("x", "0");
  fallthrough.setAttribute("y", "10");
  fallthrough.setAttribute("font-size", "10");
  fallthrough.setAttribute("fill", "red");
  fallthrough.textContent = "failed to generate svg";

  foreignObject.appendChild(div);
  sw.appendChild(foreignObject);
  sw.appendChild(fallthrough);
  g.appendChild(sw);
  return g;
};

```

â†‘ã§ã¯å¼•æ•°ã®contentã‚’foreignObjectå†…ã®divé…ä¸‹ã«è¨­å®šã—ã€foreignObjectãŒã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ãªã„å ´åˆã®textã‚’è¿½åŠ ã—ãŸã‚‚ã®ã‚’è¿”ã—ã¦ã„ã¾ã™ã€‚

`src/App.tsx` ã‚’ä»¥ä¸‹ã«ä¿®æ­£ã—ã¾ã™ã€‚

```tsx
const App = () => {
  const element = useRef<HTMLDivElement>(null);
  return (
    <div>
      <Item />
      <hr style={{ margin: "16px" }} />
      <button
        onClick={() => {
          const svg = document.createElementNS(
            "http://www.w3.org/2000/svg",
            "svg"
          );
          svg.setAttribute("width", "100%");
          svg.setAttribute("height", "100%");
          const content = ReactDOMServer.renderToStaticMarkup(<Item />);
          const g = createForeignObject(500, 500, content);
          svg.appendChild(g);
          element.current && element.current.appendChild(svg);
        }}
      >
        Convert
      </button>
      <hr style={{ margin: "16px" }} />
      <div style={{ width: "500px", height: "500px" }} ref={element} />
    </div>
  );
};
```

ä»Šå›SVGã‚’è¡¨ç¤ºã•ã›ã‚‹å¤–æ ã®å¹…ã¨é«˜ã•ã¯ 500pxÃ—500px ã«å›ºå®šã—ã¦ã¾ã™ã€‚

ã“ã“ã¾ã§ã§å®Ÿéš›ã«SVGå‡ºåŠ›ã—ã¦ã¿ã¾ã™ã€‚

![image4.gif](/images/dfc1d5939b3481/image4.gif)

ã¡ã‚ƒã‚“ã¨SVGåŒ–ã§ãã¦ã„ãã†ã§ã™! ğŸ‰

ä»Šå›ã‚·ãƒ³ãƒ—ãƒ«ãªã‚‚ã®ã§è©¦ã—ã¾ã—ãŸãŒã€å®Ÿéš›ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç­‰ã§ã‚‚ã—ä½¿ã†å ´åˆã€CSSãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã ã£ãŸã‚Šã€Stateç®¡ç†ã ã£ãŸã‚ŠãŒå…¥ã£ã¦ãã¦ã‚ˆã‚Šè¤‡é›‘ã«ãªã‚‹ã‹ã¨æ€ã„ã¾ã™ã€‚

ãã†ã„ã£ãŸComponentã®å ´åˆã†ã¾ãSVGåŒ–ã§ããªã„ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚‚ã‚ã‚‹ã‹ã¨æ€ã†ã®ã§ã€èª¿æ•´ãŒå¿…è¦ã«ãªã‚Šãã†ã§ã™ã€‚

# å‚è€ƒURL

https://triple-underscore.github.io/SVG11/struct.html#ConditionalProcessingRequiredExtensionsAttribute
