---
title: "ç¾ä»£ã®WebæŠ€è¡“ã«å¯¾å¿œã—ãŸã‚­ãƒ£ãƒ—ãƒãƒ£ãƒ„ãƒ¼ãƒ«ã®ã€ŒsnapDOMã€ã‚’è©¦ã™"
emoji: "ğŸ“¸"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics:
  - "snapdom"
  - "web"
  - "html"
  - "ã‚­ãƒ£ãƒ—ãƒãƒ£"
published: true
---
# æ¦‚è¦

Webãƒšãƒ¼ã‚¸ã®ç”»åƒã‚­ãƒ£ãƒ—ãƒãƒ£ã§æ˜” [html2canvas](https://html2canvas.hertzen.com/) ãªã©ã‚’ä½¿ã£ã¦è‰²ã€…ãƒãƒã£ãŸçµŒé¨“ãŒã‚ã£ãŸã®ã§ã™ãŒã€æœ€è¿‘ snapDOM ã¨ã„ã†ã‚­ãƒ£ãƒ—ãƒãƒ£ãƒ„ãƒ¼ãƒ«ãŒGithubã®ãƒˆãƒ¬ãƒ³ãƒ‰ã«ä¸ŠãŒã£ã¦ã„ãŸã®ã§ã€ã©ã‚Œãã‚‰ã„é€²åŒ–ã—ã¦ã„ã‚‹ã®ã‹è©¦ã—ã¦ã¿ã¾ã—ãŸã€‚

# snapDOMã¨ã¯?

https://zumerlab.github.io/snapdom/

> SnapDOMã¯ã€æ“¬ä¼¼è¦ç´ ã€Shadow DOMã€web fontsãªã©ã‚’ã‚µãƒãƒ¼ãƒˆã—ã€éå¸¸ã«é«˜é€Ÿã‹ã¤æ­£ç¢ºã«HTMLè¦ç´ ã‚’ç”»åƒã«ã‚­ãƒ£ãƒ—ãƒãƒ£ã—ã¾ã™ã€‚
snapDOMã¯ã€ã‚ºãƒ¼ãƒ ãƒ™ãƒ¼ã‚¹ã®ãƒ“ãƒ¥ãƒ¼é·ç§»ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã§ã‚ã‚‹Zumlyã®ãŸã‚ã«ä½œã‚‰ã‚ŒãŸã€é«˜é€Ÿã§æ­£ç¢ºãªDOM-to-imageã‚­ãƒ£ãƒ—ãƒãƒ£ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚

[Zooming user interface](https://ja.wikipedia.org/wiki/%E3%82%BA%E3%83%BC%E3%83%9F%E3%83%B3%E3%82%B0%E3%83%A6%E3%83%BC%E3%82%B6%E3%82%A4%E3%83%B3%E3%82%BF%E3%83%95%E3%82%A7%E3%83%BC%E3%82%B9) ç”¨ã®ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã® [Zumly](https://github.com/zumerlab/zumly) ç”¨ã«ä½œã‚‰ã‚ŒãŸã¨ã®äº‹ã§ã™ãŒã€[html2canvas](https://html2canvas.hertzen.com/) ã®æ™‚ã‚ˆã‚Šã‚‚æ“¬ä¼¼è¦ç´ ã€Shadow DOMãªã©ã®é€²åŒ–ã«å¯¾å¿œã—ã¤ã¤ã€é«˜é€Ÿã¨ã„ã†äº‹ã§æ—©é€Ÿè©¦ã—ã¦ã„ããŸã„ã¨æ€ã„ã¾ã™ã€‚

## [Benchmark](https://zumerlab.github.io/snapdom/#benchmark)

ãƒ‡ãƒ¢ã‚µã‚¤ãƒˆã®æ–¹ã«[html2canvas](https://html2canvas.hertzen.com/)ã¨ã®Benchmarkæ¯”è¼ƒãŒã‚ã‚‹ã®ã§è©¦ã—ã¦ã¿ã‚‹ã¨snapDOMã®æ–¹ãŒ **16.2å€æ—©ã„** ã¨ã®çµæœã§ã—ãŸã€‚

![image1.png](/images/9f6437d7c8b54b/image1.png =400x)

ã¾ãŸã€ä»–ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ **[html-to-image](https://github.com/bubkoo/html-to-image)** ã‚„å¤ã„snapDOMãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¨ã®æ¯”è¼ƒã‚‚READMEã«è¼‰ã£ã¦ã„ã¾ã™ã€‚

https://github.com/zumerlab/snapdom#simple-elements

# ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆ

ä»Šå›ã¯ **[StackBlitz](https://stackblitz.com/)** ã®ã‚·ãƒ³ãƒ—ãƒ«ãª HTML/CSS/JS ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ä½¿ã£ã¦è©¦ã—ã¦ã¿ãŸã„ã¨æ€ã„ã¾ã™ã€‚

![image2.png](/images/9f6437d7c8b54b/image2.png)

ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã—ã€ä»¥ä¸‹ã®3ãƒ•ã‚¡ã‚¤ãƒ«ã®æ§‹æˆã«ã—ã¾ã—ãŸã€‚

- index.html

    ```html
    <!DOCTYPE html>
    <html lang="en">
      <head>
        <title>snapDOM Example</title>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width" />
        <link rel="stylesheet" href="styles.css" />
        <script type="module" src="script.js"></script>
      </head>
      <body>
        <main>
          <h1>snapDOM Example</h1>
        </main>
      </body>
    </html>
    ```

- script.js

    ```jsx
    import { snapdom } from 'https://unpkg.com/@zumer/snapdom/dist/snapdom.mjs';
    
    console.log('Hello');
    ```

- styles.css

    ```css
    * {
      box-sizing: border-box;
    }
    
    body {
      margin: 0;
      font-family: system-ui, sans-serif;
      color: black;
      background-color: white;
    }
    
    main {
      padding: 1rem;
    }
    
    h1 {
      font-weight: bold;
      font-size: 1.5rem;
    }
    
    ```

`script.js` ã«ã¯ **CDN (stable)** ã® `ES Module build` å½¢å¼ã®snapDOMã‚’èª­ã¿è¾¼ã‚€ã‚ˆã†ã«ã—ã¾ã—ãŸã€‚

# ç°¡å˜ãªã‚µãƒ³ãƒ—ãƒ«ã‚’è©¦ã™

è©¦ã—ã« `index.html` ã® `<div id="target">` è¦ç´ ã‚’ã‚­ãƒ£ãƒ—ãƒãƒ£ã—ã¦ã€bodyã®ä¸€ç•ªä¸‹ã« `png` ç”»åƒã¨ã—ã¦è¿½åŠ ã™ã‚‹ã‚ˆã†ãªã‚µãƒ³ãƒ—ãƒ«ã‚’è©¦ã—ã¦ã¿ã¾ã™ã€‚

- index.html

    ```html
    ...
      <body>
        <main>
          <div id="target">
            <h1>snapDOM Example</h1>
            <p>12345678901234567890</p>
          </div>
        </main>
      </body>
    ...
    ```

- styles.css

    ```css
    #target {
      width: 300px;
      height: auto;
      padding: 16px;
      overflow: hidden;
      border-radius: 8px;
      border: thick double #32a1ce;
    }
    ```

ã“ã®æ™‚ç‚¹ã§ã®è¡¨ç¤ºã¯ä»¥ä¸‹ã®æ§˜ã«ãªã£ã¦ã„ã¾ã™ã€‚

![image3.png](/images/9f6437d7c8b54b/image3.png =300x)

æ¬¡ã« `script.js` ã«ä»¥ä¸‹ã‚’è¿½åŠ ã—ã¾ã™ã€‚

```jsx
const el = document.querySelector('#target');
const png = await snapdom.toPng(el);
document.body.appendChild(png);
```

å†ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ã¨ğŸ‘‡ã®æ§˜ã«ã‚­ãƒ£ãƒ—ãƒãƒ£ã•ã‚ŒãŸpngç”»åƒãŒè¿½åŠ ã•ã‚Œã¦ã„ã¾ã™ã€‚ã¡ã‚ƒã‚“ã¨å‹•ã„ã¦ãã†ã§ã™ âœ¨

![image4.png](/images/9f6437d7c8b54b/image4.png =300x)

# Shadow DOM ã‚’è©¦ã™

ãã‚‚ãã‚‚ Shadow DOM ã¨ã¯â€¦?

> **Shadow DOM ã¨ã¯ã€Web ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’å®Ÿç¾ã™ã‚‹ãŸã‚ã®ä»•çµ„ã¿ã®ä¸€ã¤ã§ã€HTML è¦ç´ ã®ä¸­ã«â€œå½±ã® DOM ãƒ„ãƒªãƒ¼â€ã‚’ä½œã‚‹æŠ€è¡“ã§ã™ã€‚**
> ã“ã‚Œã«ã‚ˆã‚Šã€ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå†…éƒ¨ã®æ§‹é€ ã‚„ã‚¹ã‚¿ã‚¤ãƒ«ã‚’å¤–éƒ¨ã‹ã‚‰ç›´æ¥å¹²æ¸‰ã•ã‚Œãªã„ã‚ˆã†ã«ã‚«ãƒ—ã‚»ãƒ«åŒ–ã§ãã¾ã™ã€‚ãŸã¨ãˆã°ã€Web ãƒšãƒ¼ã‚¸å…¨ä½“ã® CSS ãŒãƒœã‚¿ãƒ³ã®ãƒ‡ã‚¶ã‚¤ãƒ³ã‚’å¤‰æ›´ã—ã¦ã‚‚ã€Shadow DOM å†…ã«ã‚ã‚‹ãƒœã‚¿ãƒ³ã®ã‚¹ã‚¿ã‚¤ãƒ«ã¯å½±éŸ¿ã‚’å—ã‘ã¾ã›ã‚“ã€‚
> ã¤ã¾ã‚Š Shadow DOM ã¯ã€Œéƒ¨å“ã‚’ç‹¬ç«‹ã—ã¦ä½œã‚Šã€ä»–ã®ã‚³ãƒ¼ãƒ‰ã‚„ã‚¹ã‚¿ã‚¤ãƒ«ã«å·¦å³ã•ã‚Œãšã«å®‰å…¨ã«å†åˆ©ç”¨ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ã€ãŸã‚ã®ä»•çµ„ã¿ã§ã‚ã‚Šã€ãƒ¢ãƒ€ãƒ³ãªãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰é–‹ç™ºã«ãŠã„ã¦æ¬ ã‹ã›ãªã„åŸºç›¤ã«ãªã£ã¦ã„ã¾ã™ã€‚

å…ˆã»ã©ã® `<div id="target">` è¦ç´ å†…ã« Shadow DOM ã‚’è¿½åŠ ã—ã¦ã‚­ãƒ£ãƒ—ãƒãƒ£ã—ã¦ã¿ã¾ã™ã€‚

- index.html

    ```html
    ...
      <body>
        <main>
          <h1>snapDOM Example</h1>
          <div id="target">
            <template shadowrootmode="open">
              <h1>snapDOM Example</h1>
            </template>
          </div>
        </main>
      </body>
     ...
    ```

    `<template shadowrootmode="open">` ã‚’ä½¿ã£ã¦ `<h1>snapDOM Example</h1>` ã‚’ Shadow DOMã¨ã—ã¦ `<div id="target">` å†…ã«è¿½åŠ ã—ã¦ã„ã¾ã™ã€‚ã¾ãŸé€šå¸¸ã®DOMã® `h1` ã‚‚å…ˆé ­ã§è¡¨ç¤ºã•ã›ã¦ã€Shadow DOMã¨ã®é•ã„ãŒåˆ†ã‹ã‚‹ã‚ˆã†ã«ã—ã¦ã„ã¾ã™ã€‚

- styles.css

    ```css
    h1 {
      font-weight: bold;
      font-size: 1.5rem;
      color: red;
    }
    ```

ã“ã®æ™‚ç‚¹ã§ğŸ‘‡ã®æ§˜ã«è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚

![image5.png](/images/9f6437d7c8b54b/image5.png =300x)

`styles.css` ã‹ã‚‰ã®å¹²æ¸‰ã‚’å—ã‘ãšã« Shadow DOMå†…ã® `h1` ãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹ã‹ã¨æ€ã„ã¾ã™ã€‚

ã“ã‚Œã‚’snapDOMã§ã‚­ãƒ£ãƒ—ãƒãƒ£ã—ãŸã‚‚ã®ãŒğŸ‘‡ã«ãªã‚Šã¾ã™ã€‚

![image6.png](/images/9f6437d7c8b54b/image6.png =300x)

ã¡ã‚ƒã‚“ã¨Shadow DOM ãŒã‚­ãƒ£ãƒ—ãƒãƒ£ã•ã‚Œã¦ã„ã‚‹ã®ãŒåˆ†ã‹ã‚Šã¾ã™ âœ¨

# fontåŸ‹ã‚è¾¼ã¿ã‚’è©¦ã™

snapDOMã¯ **`embedFonts`** ã‚’ `true` ã«è¨­å®šã™ã‚‹ã¨ã€ã‚­ãƒ£ãƒ—ãƒãƒ£ã•ã‚ŒãŸã‚µãƒ–ãƒ„ãƒªãƒ¼å†…ã§ä½¿ç”¨ã•ã‚Œã¦ã„ã‚‹@font-faceãƒ«ãƒ¼ãƒ«ã‚’åŸ‹ã‚è¾¼ã‚“ã§ãã‚Œã‚‹ã¨ã„ã†äº‹ãªã®ã§ã€Google Fonts ã‚’ä½¿ç”¨ã—ã¦è©¦ã—ã¦ã¿ãŸã„ã¨æ€ã„ã¾ã™ã€‚

ä»Šå›ã¯ [Bitcount Single Ink](https://fonts.google.com/specimen/Bitcount+Single+Ink) ã¨ã„ã†ãƒ•ã‚©ãƒ³ãƒˆã§è©¦ã—ã¦ã¿ã¾ã™ã€‚

- index.html

```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- ä»¥ä¸‹ã‚’è¿½åŠ  -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Bitcount+Single+Ink:wght@100..900&display=swap"
      rel="stylesheet"
    />
```

- styles.css

```css
#target {
  font-family: 'Bitcount Single Ink'; /* æ–°è¦è¿½åŠ  */
  width: 300px;
  /* ... */
}
```

ã“ã®æ™‚ç‚¹ã§ã¯ä»¥ä¸‹ã®æ§˜ã«è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚

![image7.png](/images/9f6437d7c8b54b/image7.png =300x)

**`embedFonts`** ã‚’æŒ‡å®šã—ã¦ã„ãªã„ç‚ºfontã¯ã‚­ãƒ£ãƒ—ãƒãƒ£éƒ¨åˆ†ã«ã¯åæ˜ ã•ã‚Œã¦ã¾ã›ã‚“ã€‚**`embedFonts`** ã« `true` ã‚’è¨­å®šã—ã¦ã¿ã¾ã™ã€‚

- script.js

```jsx
import { snapdom } from 'https://unpkg.com/@zumer/snapdom/dist/snapdom.mjs';

const el = document.querySelector('#target');
const png = await snapdom.toPng(el, { embedFonts: true }); // ã‚ªãƒ—ã‚·ãƒ§ãƒ³è¿½åŠ 
document.body.appendChild(png);
```

ğŸ‘‡ã‚­ãƒ£ãƒ—ãƒãƒ£éƒ¨åˆ†ã«ã‚‚ã¡ã‚ƒã‚“ã¨fontãŒåæ˜ ã•ã‚Œã¦ã„ã¾ã™ âœ¨

![image8.png](/images/9f6437d7c8b54b/image8.png =300x)

ã“ã“ã¾ã§å®Ÿè£…ã¯ã“ã¡ã‚‰ğŸ‘‡ã«ãªã‚Šã¾ã™ã€‚

https://stackblitz.com/edit/stackblitz-starters-nnxwwffe?file=index.html

# Reactãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ä½¿ã£ã¦ã¿ã‚‹

æ¬¡ã« React ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§snapDOMã‚’ä½¿ã£ã¦ã¿ã¾ã™ã€‚**[StackBlitz](https://stackblitz.com/)** ã® React (TypeScript) ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ä½¿ã£ã¦ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã—ã¾ã™ã€‚

![image9.png](/images/9f6437d7c8b54b/image9.png)

ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œã£ãŸã‚‰ `yarn add @zumer/snapdom` ã§snapDOMãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’è¿½åŠ ã—ã¾ã™ã€‚

`src/App.tsx` ã«ä»¥ä¸‹ã‚’è¿½åŠ ã—ã¾ã™ã€‚

```tsx
import { snapdom } from '@zumer/snapdom'; // è¿½åŠ 

function App() {
  const ref = useRef<HTMLDivElement>(null); // è¿½åŠ 
  // ....
  return (
    <div ref={ref}>
      {/* ... */}
      {/* ä»¥ä¸‹ãƒœã‚¿ãƒ³è¿½åŠ  */}
      <button
        onClick={async () => {
          if (!ref.current) return;
          const result = await snapdom(ref.current);
          const img = await result.toWebp();
          document.body.appendChild(img);
        }}
      >
        Capture
      </button>
    </div>
  );
}
```

ã“ã®çŠ¶æ…‹ã§ã€ŒCaptureã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã¨ğŸ‘‡ã®æ§˜ã«ã‚­ãƒ£ãƒ—ãƒãƒ£ãŒã§ãã¾ã—ãŸÂ âœ¨

![image10.png](/images/9f6437d7c8b54b/image10.png)

# ã¾ã¨ã‚

æ˜”ã®ä½“é¨“ã ã¨ã€å¿…ãšä¸Šæ‰‹ãã‚­ãƒ£ãƒ—ãƒãƒ£ã§ããªãã¦è©¦è¡ŒéŒ¯èª¤ã—ãŸã¨ã„ã†æ„Ÿã˜ã ã£ãŸã¨æ€ã†ã®ã§ã™ãŒã€ä»Šå›ç°¡å˜ãªã‚‚ã®ã‚’è©¦ã—ãŸã¨ã„ã†äº‹ã‚‚ã‚ã‚‹ã‹ã‚‚ã§ã™ãŒã€snapDOM ã‚’ä½¿ã£ã¦ä¸Šæ‰‹ãã‚­ãƒ£ãƒ—ãƒãƒ£ã§ããªã„ã€œã¿ãŸã„ãªäº‹ã¯ãªã‹ã£ãŸæ§˜ã«æ€ã„ã¾ã—ãŸã€‚

# å‚è€ƒURL

https://dev.to/tinchox5/snapdom-a-modern-and-faster-alternative-to-html2canvas-1m9a