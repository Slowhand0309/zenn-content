---
title: "ã€Reactã€‘(è¦ªã‹ã‚‰å­|å­ã‹ã‚‰è¦ª)ã®é–¢æ•°ã‚’å‘¼ã³å‡ºã™"
emoji: "ğŸ‘¶"
type: "tech"
topics:
  - "react"
  - "typescript"
  - "hooks"
published: true
published_at: "2021-05-10 21:09"
---

# è¦ªã‹ã‚‰å­ã®é–¢æ•°ã‚’å‘¼ã³å‡ºã™
å®Ÿè£…æ–¹æ³•ã¨ã—ã¦ã¯ã€å­ä¾›å´ã®å‚ç…§ã‚’è¦ªã‹ã‚‰è§¦ã‚Œã‚‹ã‚ˆã†ã«ã—ã¦ã‚„ã‚Šã€
å‚ç…§ã‚’é€šã˜ã¦å­ä¾›å´ã®é–¢æ•°ã‚’å‘¼ã³å‡ºã›ã‚Œã‚‹ã‚ˆã†ã«ã—ã¦ã‚„ã‚Šã¾ã™ã€‚

## å­ä¾›å´ã®å®Ÿè£…

```tsx
const ChildrenBase: React.ForwardRefRenderFunction<
  { printId: () => void },
  {
    id: string;
  }
> = ({ id }, ref) => {
  // è¦ªã‹ã‚‰å‘¼ã°ã‚Œã‚‹é–¢æ•°ã‚’å®šç¾©
  useImperativeHandle(ref, () => ({
    printId() {
      console.log(id);
    },
  }));

  return <div>Children</div>;
};
const Children = forwardRef(ChildrenBase);
```
[forwardRef](https://ja.reactjs.org/docs/forwarding-refs.html)ã¨[useImperativeHandle](https://ja.reactjs.org/docs/hooks-reference.html#useimperativehandle)ã‚’ä½¿ã£ã¦å®Ÿç¾ã—ã¾ã™ã€‚
forwardRefã§Childrenã‚’å‚ç…§ã—ã€useImperativeHandleã§é–¢æ•°ã‚’å‚ç…§ã«ä»˜ä¸ã—ã¾ã™ã€‚

## è¦ªå´ã®å®Ÿè£…

```tsx
const Parent: React.FC = () => {
  const childRef = useRef<{ printId: () => void }>();
  useEffect(() => {
    childRef.current?.printId();
  }, [childRef.current]);
  return <Children id={'1234567'} ref={childRef} />;
};

export default Parent;
```

è¦ªå´ã¯å‚ç…§ã‚’é€šã—ã¦ã€å­ä¾›å´ã®é–¢æ•°ã‚’å‘¼ã³å‡ºã—ã¾ã™ã€‚

# å­ã‹ã‚‰è¦ªã®é–¢æ•°ã‚’å‘¼ã³å‡ºã™
ä»Šåº¦ã¯é€†ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã§ã€å­ä¾›å´ã‹ã‚‰è¦ªå´ã®é–¢æ•°ã‚’å‘¼ã³å‡ºã™ãƒ‘ã‚¿ãƒ¼ãƒ³ã§ã™ã€‚
å®Ÿè£…æ–¹æ³•ã¨ã—ã¦ã€ä»Šå›ã¯propsã§æ¸¡ã™å®Ÿè£…ã§ã¯ãªãã€å…¨ã¦ã®å­ä¾›ã«è¦ªã®é–¢æ•°ã‚’å‘¼ã¹ã‚‹ã‚ˆã†ã«ã—ã¦ã‚„ã‚Šã¾ã™ã€‚
ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã¨ã—ã¦ã¯ `Layout` ç­‰ã®å…±é€šã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§ã€å­ä¾›ãŒä½¿ãŠã†ã¨æ€ã£ãŸã‚‰ `Layout` ã®é–¢æ•°ãŒä½¿ãˆã‚‹
ã‚ˆã†ãªã‚±ãƒ¼ã‚¹ã«ãªã‚‹ã‹ã¨æ€ã„ã¾ã™ã€‚

## å­ä¾›å´ã®å®Ÿè£…

```tsx
type ChildrenDispatchProps = {
  printId?: (id: string) => void;
};

const Children: React.FC<ChildrenDispatchProps & { id: string }> = ({
  printId,
  id,
}) => {
  return <button onClick={() => printId(id)}>ãƒœã‚¿ãƒ³</button>;
};
```
è¦ªã‹ã‚‰æ¸¡ã•ã‚Œã‚‹é–¢æ•°ã¯ `?` ä»˜ãã§å®šç¾©ã—ãªã„ã¨Typeã‚¨ãƒ©ãƒ¼ã«ãªã‚Šã¾ã™ã€‚

## è¦ªå´ã®å®Ÿè£…

```tsx
const Parent: React.FC = ({ children }) => {
  const printId = (id: string) => {
    console.log(id);
  };
  const childWithProps = React.Children.map(children, (child) => {
    if (React.isValidElement(child)) {
      const dispatch: ChildrenDispatchProps = {
        printId: printId,
      };
      return React.cloneElement(child, { ...dispatch });
    }
    return child;
  });
  return <div>{childWithProps}</div>;
};

const App: React.FC = () => {
  return (
    <Parent>
      <Children id={'1'} />
      <Children id={'2'} />
    </Parent>
  );
};
```
`cloneElement` ã§å­ä¾›ã«è¦ªå´ã§å®šç¾©ã—ãŸé–¢æ•°ã‚’ä»˜ä¸ã—ã¦ã‚„ã‚Šã¾ã™ã€‚
â†‘ã®ã‚ˆã†ã«ã™ã‚‹äº‹ã§ã€å­ä¾›å´ã¯ `ChildrenDispatchProps` ã‚’å—ã‘å–ã‚‹ã‚ˆã†ã«ã—ãŸå ´åˆã€ãã®å­ä¾›ã¯
è¦ªã®é–¢æ•° `printId` ã‚’ä½¿ãˆã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

â€» `React.cloneElement` ã‚„ `React.isValidElement` ç­‰ã¯ä»¥ä¸‹ãƒªãƒ³ã‚¯å…ˆã‚’å‚ç…§
[React ã®æœ€ä¸Šä½ API - React](https://ja.reactjs.org/docs/react-api.html#cloneelement)


# å‚è€ƒãƒªãƒ³ã‚¯

- [React hooksã§å­ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®é–¢æ•°ã‚’å®Ÿè¡Œã™ã‚‹ - Qiita](https://qiita.com/maruware/items/b6da39ac44753253b379)
- [forwardRef ã¨ useImperativeHandle - 30æ­³ã‹ã‚‰ã®ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°](https://numb86-tech.hatenablog.com/entry/2019/12/06/122217)
- [ref ã®ãƒ•ã‚©ãƒ¯ãƒ¼ãƒ‡ã‚£ãƒ³ã‚° â€“ React](https://ja.reactjs.org/docs/forwarding-refs.html)
- [javascript â€” è¦ªã‹ã‚‰å­ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å‘¼ã³å‡ºã™](https://www.it-swarm-ja.tech/ja/javascript/%E8%A6%AA%E3%81%8B%E3%82%89%E5%AD%90%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89%E3%82%92%E5%91%BC%E3%81%B3%E5%87%BA%E3%81%99/825675793/)
- [javascript - How to pass props to {this.props.children} - Stack Overflow](https://stackoverflow.com/questions/32370994/how-to-pass-props-to-this-props-children)
