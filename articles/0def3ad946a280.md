---
title: "ã€Flutterã€‘ç”»é¢ä¸Šã§Themeç·¨é›†ã—ç·¨é›†ã•ã‚ŒãŸJSONã‚’ä½¿ã£ã¦å‹•çš„ã«ãƒ†ãƒ¼ãƒã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹"
emoji: "ğŸ–Œï¸"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics:
  - "flutter"
  - "riverpod"
  - "dart"
  - "freezed"
  - "theme"
published: true
---

# æ¦‚è¦

ä»Šå›Flutterã‚¢ãƒ—ãƒªã§ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãƒ†ãƒ¼ãƒã‚«ãƒ©ãƒ¼ã‚’åˆ‡ã‚Šæ›¿ãˆã‚‰ã‚Œã‚‹æ©Ÿèƒ½ã‚’å®Ÿè£…ã™ã‚‹éš›ã€ç”»é¢ä¸Šã§ç›´æ„Ÿçš„ã«ãƒ†ãƒ¼ãƒã‚«ãƒ©ãƒ¼ã‚’ä¿®æ­£ã—ã€ã‚¢ãƒ—ãƒªå†…ã§ä¿®æ­£ã—ãŸãƒ‡ãƒ¼ã‚¿ã‚’å–ã‚Šè¾¼ã¿ã€ç°¡å˜ã«åˆ‡ã‚Šæ›¿ãˆãŒã§ãã‚‹å®Ÿè£…æ–¹æ³•ã‚’è©¦ã—ã¾ã—ãŸã€‚

# å‹•ä½œç’°å¢ƒ

- flutterSdkVersion: 3.7.12
- simulator iPhone 14 (iOS 16.0)
- macOS Ventura ãƒãƒ¼ã‚¸ãƒ§ãƒ³13.3.1 Apple Intel

## ä»Šå›ä½¿ç”¨ã™ã‚‹ãƒ„ãƒ¼ãƒ«

[https://github.com/zeshuaro/appainter](https://github.com/zeshuaro/appainter)

ä»Šå›ã¯ `appainter` ã¨ã„ã†ãƒ„ãƒ¼ãƒ«ã‚’ä½¿ã£ã¦é€²ã‚ã¦ã¿ãŸã„ã¨æ€ã„ã¾ã™ã€‚ `appainter` ã®ç‰¹å¾´ã¨ã—ã¦ã¯ä»¥ä¸‹ã«ãªã‚Šã¾ã™ã€‚

- ç”»é¢ä¸Šã§Themeã‚’ç·¨é›†
  - Flutterè£½ã§Desktopã‚„Webã§ä½¿ãˆã‚‹
  - Webç‰ˆã‚’[ã“ã¡ã‚‰](https://appainter.dev/)ã«ãƒ‡ãƒ—ãƒ­ã‚¤ã•ã‚Œã¦ã„ã‚‹ã®ã§ä»Šå›ã¯ãƒ‡ãƒ—ãƒ­ã‚¤ã•ã‚ŒãŸWebç‰ˆã‚’ä½¿ç”¨
- ä¸»ãªæµã‚Œã¨ã—ã¦ã¯ä»¥ä¸‹
  - ãƒ†ãƒ¼ãƒä½œæˆ â†’ jsonãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ â†’ Flutterå†…ã§jsonã‚’decodeã—ã¦ThemeDataã¨ã—ã¦ä½¿ã†

# å®Ÿè£…

## ã¾ãšã¯Appainterã§ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®Themeã‚’è¡¨ç¤ºã•ã›ã¦ã¿ã‚‹

ä»¥ä¸‹ã§ä¸€æ—¦ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ã¾ã¾Exportã—ã¦jsonã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¦ã¿ã¾ã™

[Appainter](https://appainter.dev/#/)

æ¬¡ã« `pubspec.yaml` ã«ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸjsonã‚’assetã¨ã—ã¦è¨­å®šã—ã¾ã™

```yaml
flutter:
  assets:
    - assets/appainter_theme.json
```

decodeç”¨ã« `pubspec.yaml` ã« `json_theme` ã‚’è¿½åŠ ã—ã¾ã™

```yaml
dependencies:
  json_theme: ^4.0.0
```

`main.dart` ã‚’ä»¥ä¸‹ã®æ§˜ã«ä¿®æ­£ã—ã€å®Ÿè¡Œã•ã›ã¦ã¿ã¾ã™

```dart
void main() async {
  WidgetsFlutterBinding.ensureInitialized();

  final themeStr = await rootBundle.loadString('assets/appainter_theme.json');
  final themeJson = jsonDecode(themeStr);
  final theme = ThemeDecoder.decodeThemeData(themeJson)!;

  runApp(MyApp(theme: theme));
}

class MyApp extends StatelessWidget {
  const MyApp({super.key, required this.theme});
  final ThemeData theme;

  // This widget is the root of your application.
  @override
  Widget build(BuildContext context) {
    return MaterialApp(
      title: 'Flutter Demo',
      theme: theme,
      home: const MyHomePage(title: 'Flutter Demo Home Page'),
    );
  }
}
```

â†“å®Ÿè¡Œçµæœ ã¡ã‚ƒã‚“ã¨ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸThemeãŒåæ˜ ã•ã‚Œã¦ã¾ã™ âœ¨

![image1](/images/0def3ad946a280/image1.png =350x)

## Riverpodã¨SharedPreferencesã‚’ä½¿ã£ã¦å‹•çš„ã«Themeã‚’åˆ‡ã‚Šæ›¿ãˆã‚Œã‚‹ã‚ˆã†ã«ã™ã‚‹

ã¾ãšã¯å¿…è¦ãªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™

```yaml
dependencies:
  flutter_hooks: ^0.18.6
 hooks_riverpod: ^2.3.5
 shared_preferences: ^2.1.0
 freezed: ^2.3.2
 freezed_annotation: ^2.2.0

dev_dependencies:
  build_runner: ^2.1.0
```

æ¬¡ã«Appainterã®ã‚µã‚¤ãƒˆã§å…ˆã»ã©ã®themeã‚«ãƒ©ãƒ¼ã¨ã¯ç•°ãªã‚‹themeã‚’ä½œæˆã—ã€ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã™

![image2](/images/0def3ad946a280/image2.png =800x)

Seed colorãŒèµ¤ã£ã½ã„è‰²ã®Themeã‚’ä½œæˆã—ã¦ã¿ã¾ã—ãŸã€‚ã“ã‚Œã‚’ `assets/appainter_theme_red.json` ã®ãƒ‘ã‚¹ã§ä¿å­˜ã—ã¾ã™ã€‚ æ¬¡ã« `theme_state.dart` ã‚’ä»¥ä¸‹å†…å®¹ã§ä½œæˆã—ã¾ã™

```dart
import 'package:flutter/material.dart';
import 'package:freezed_annotation/freezed_annotation.dart';

part 'theme_state.freezed.dart';

@freezed
class ThemeState with _$ThemeState {
  const ThemeState._();
  const factory ThemeState({
    @Default('') String currentTheme,
    @Default({}) Map<String, ThemeData> themes,
    @Default({}) Map<String, ThemeData> darkThemes,
  }) = _ThemeState;

  ThemeData currentLightTheme() => themes[currentTheme] ?? ThemeData.light();
  ThemeData currentDarkTheme() => darkThemes[currentTheme] ?? ThemeData.dark();
}
```

`freezed` ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹ã®ã§ã€build_runnerã‚’èµ°ã‚‰ã›ã¦ãŠãã¾ã™ã€‚

æ¬¡ã« `theme_notifier.dart` ã‚’ä»¥ä¸‹å†…å®¹ã§ä½œæˆã—ã¾ã™ã€‚

```dart
import 'package:appainter_example/theme_state.dart';
import 'package:flutter/material.dart';
import 'package:hooks_riverpod/hooks_riverpod.dart';
import 'package:shared_preferences/shared_preferences.dart';

final themeNotifierProvider = StateNotifierProvider<ThemeNotifier, ThemeState>(
  (ref) => ThemeNotifier(const ThemeState()),
);

class ThemeNotifier extends StateNotifier<ThemeState> {
  ThemeNotifier(ThemeState initState) : super(initState);

  static const preferenceKey = "currentTheme";

  ThemeData get currentTheme =>
      state.themes[state.currentTheme] ?? ThemeData.light();

  ThemeData get currentDarkTheme =>
      state.darkThemes[state.currentTheme] ?? ThemeData.dark();

  Future<void> apply(String theme) async {
    final preference = await SharedPreferences.getInstance();
    await preference.setString(preferenceKey, theme);
    state = state.copyWith(currentTheme: theme);
  }

  Future<String> initialize() async {
    final theme = await _savedPreferenceTheme();
    state = state.copyWith(currentTheme: theme);
    return theme;
  }

  Future<String> _savedPreferenceTheme() async {
    final preference = await SharedPreferences.getInstance();
    return preference.getString(preferenceKey) ?? "default";
  }
}
```

`main.dart` ã§ `ThemeNotifier` ã‚’ä½¿ã†ã‚ˆã†ã«ä¿®æ­£ã—ã¾ã™ã€‚

```dart
Future<ThemeData> loadTheme(String path) async {
  final themeStr = await rootBundle.loadString(path);
  final themeJson = jsonDecode(themeStr);
  final theme = ThemeDecoder.decodeThemeData(themeJson)!;
  return theme;
}

void main() async {
  WidgetsFlutterBinding.ensureInitialized();

  final defaultTheme = await loadTheme('assets/appainter_theme.json');
  final redTheme = await loadTheme('assets/appainter_theme_red.json');
  final themeState =
      ThemeState(themes: Map.of({'default': defaultTheme, 'red': redTheme}));

  runApp(ProviderScope(
    overrides: [
      themeNotifierProvider.overrideWith((ref) => ThemeNotifier(themeState)),
    ],
    child: const MyApp(),
  ));
}

class MyApp extends HookConsumerWidget {
  const MyApp({super.key});

  // This widget is the root of your application.
  @override
  Widget build(BuildContext context, WidgetRef ref) {
    final themeProvider = ref.watch(themeNotifierProvider.notifier);
    final themeState = ref.watch(themeNotifierProvider);
    return FutureBuilder(
        future: themeProvider.initialize(),
        builder: (context, snapshot) {
          if (!snapshot.hasData) {
            return const SizedBox.shrink();
          }
          return MaterialApp(
            title: 'Flutter Demo',
            theme: themeState.currentLightTheme(),
            home: const HomePage(),
          );
        });
  }
}
```

æœ€å¾Œã« `HomePage` ã‚’ä½œæˆã—ã¾ã™ã€‚

```dart
class HomePage extends HookConsumerWidget {
  const HomePage({Key? key}) : super(key: key);

  @override
  Widget build(BuildContext context, WidgetRef ref) {
    final provider = ref.watch(themeNotifierProvider.notifier);
    return Scaffold(
      appBar: AppBar(title: const Text('Home')),
      body: Padding(
        padding: const EdgeInsets.all(8.0),
        child: Column(
          crossAxisAlignment: CrossAxisAlignment.start,
          children: [
            ElevatedButton(
              onPressed: () => provider.apply('default'),
              child: const Text('ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã«åˆ‡ã‚Šæ›¿ãˆ'),
            ),
            const SizedBox(height: 18),
            ElevatedButton(
              onPressed: () => provider.apply('red'),
              child: const Text('REDã«åˆ‡ã‚Šæ›¿ãˆ'),
            ),
          ],
        ),
      ),
    );
  }
}
```

ã“ã‚Œã§æœ€ä½é™ã®å®Ÿè£…ãŒå®Œäº†ã—ã¾ã—ãŸã€‚æ—©é€Ÿå®Ÿè¡Œã—ã¦ã¿ã¾ã™!

â†“å®Ÿè¡Œçµæœ ã¡ã‚ƒã‚“ã¨ThemeãŒåˆ‡ã‚Šæ›¿ã‚ã£ã¦ã„ã‚‹ã®ãŒç¢ºèªã§ãã‚‹ã‹ã¨æ€ã„ã¾ã™ âœ¨

![image3](/images/0def3ad946a280/image3.gif =350x)

# ã¾ã¨ã‚

Themeä½œæˆã‚’ç”»é¢ä¸Šã§ç°¡å˜ã«è¡Œãˆjsonãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã§ãã‚‹ã®ã§ã€jsonãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç½®ãæ›ãˆã‚‹ã ã‘ã§ãƒ†ãƒ¼ãƒã®ä¿®æ­£ãŒã§ãã€æ–°ãŸãªãƒ†ãƒ¼ãƒã®è¿½åŠ ã‚‚æ¯”è¼ƒçš„ç°¡å˜ã«è¿½åŠ ã§ãã‚‹ã‹ã¨æ€ã„ã¾ã™ã€‚ã“ã®æ–¹æ³•ã«ã‚ˆã‚Šã€ãƒ‡ã‚¶ã‚¤ãƒ³ã®èª¿æ•´ãªã©ã«é›†ä¸­ã—ã¦ã§ãã‚‹ã‚ˆã†ã«ãªã‚‹ã®ã§ã€çµæ§‹è‰¯ã•ãã†ãªæ§‹æˆã‹ãªã¨æ€ã£ã¦ã„ã¾ã™!

# å‚è€ƒURL

[Riverpod, StateNotifierã§ã‚¢ãƒ—ãƒªå†…ãƒ†ãƒ¼ãƒã®åˆ‡ã‚Šæ›¿ãˆæ©Ÿèƒ½ã‚’å®Ÿè£…ã™ã‚‹](https://zenn.dev/altiveinc/articles/theme-selector-with-riverpod-statenotifier)

[Flutterã§Color Schemeã‚’ç”Ÿæˆã™ã‚‹Webã‚¢ãƒ—ãƒªã‚’ä½œã£ã¦ã¿ãŸ](https://zenn.dev/enoiu/articles/5961d970bc3e1c)
