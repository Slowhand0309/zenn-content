---
title: "Hono Ã— Zod-OpenAPIã§å¿«é©APIé–‹ç™º"
emoji: "ğŸš€"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics:
  - "hono"
  - "cloudflareworkers"
  - "zod"
  - "openapi"
  - "swagger"
published: true
published_at: "2024-09-22 21:00"
---
# æ¦‚è¦

æœ€è¿‘ã€Honoã¨Zodã‚’ä½¿ã£ã¦OpenAPIãƒ™ãƒ¼ã‚¹ã®APIã‚’æ§‹ç¯‰ã™ã‚‹æ©Ÿä¼šãŒã‚ã‚Šã€ãã®ä½“é¨“ãŒè‰¯ã‹ã£ãŸãŸã‚ã€è¨˜äº‹ã¨ã—ã¦ã¾ã¨ã‚ã¾ã—ãŸã€‚æœ¬è¨˜äº‹ã§ã¯ã€Honoã¨Cloudflare Workersã‚’çµ„ã¿åˆã‚ã›ãŸæ§‹æˆã‚’å‰æã«ã€APIã‚’ä½œæˆã™ã‚‹æ‰‹é †ã‚„ãƒã‚¤ãƒ³ãƒˆã‚’ç´¹ä»‹ã—ã¦ã„ã¾ã™ã€‚ä»–ã«ã‚‚è‰¯ã„æ–¹æ³•ã‚„ã‚¢ãƒ—ãƒ­ãƒ¼ãƒãŒã‚ã‚Œã°ã€ãœã²ã”æ„è¦‹ã‚’ã„ãŸã ã‘ã‚‹ã¨å¬‰ã—ã„ã§ã™ã€‚

# å‹•ä½œç’°å¢ƒ

- node: 22.7.0
- yarn: 1.22.22

# ç’°å¢ƒæ§‹ç¯‰

## Hono + Cloudflare Workers ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆ

æ—©é€Ÿãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œã£ã¦ã„ãã¾ã™ã€‚ `create hono` ã§templateã« `cloudflare-workers` ã‚’é¸æŠã—ã¾ã™ã€‚

```bash
$ yarn create hono .
âœ” Using target directory â€¦ .
? Which template do you want to use? cloudflare-workers
? Directory not empty. Continue? yes
âœ” Cloning the template
? Do you want to install project dependencies? yes
? Which package manager do you want to use? yarn
âœ” Installing project dependencies
ğŸ‰ Copied project files
```

Dockerã‚’ä½¿ã£ã¦ã„ã‚‹å ´åˆ `wrangler.toml`Â ã«ğŸ‘‡ã‚’è¿½åŠ ã—ã¨ãã¾ã™ã€‚

```toml
[dev]
ip = "0.0.0.0"
port = 8787
```

`yarn install` & `yarn dev` ã§èµ·å‹•ã—ã€[http://localhost:8787/](http://localhost:8787/) ã«ã‚¢ã‚¯ã‚»ã‚¹ã— `Hello Hono!` ãŒè¡¨ç¤ºã•ã‚Œã¨ã‘ã°OKã§ã™ã€‚

## å¿…è¦ãªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸è¿½åŠ 

ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’è¡¨ç¤ºã™ã‚‹ç‚ºã® `@hono/swagger-ui` ã‚‚è¿½åŠ ã—ã¾ã™ã€‚

```bash
yarn add @hono/zod-openapi @hono/swagger-ui
```

# ä»Šå›ä½œæˆã™ã‚‹APIã®æ¦‚è¦

ã‚¿ã‚¹ã‚¯ç®¡ç†ã‚¢ãƒ—ãƒªã®APIã‚’æƒ³å®šã—ã€ã‚¿ã‚¹ã‚¯ã®å–å¾—ã¨ä½œæˆã‚’è¡Œãˆã‚‹ã‚ˆã†ãªAPIã‚’å®Ÿè£…ã—ã¾ã™ã€‚ `GET /api/tasks` ã§ã‚¿ã‚¹ã‚¯ã®ãƒªã‚¹ãƒˆã‚’å–å¾—ã—ã€`POST /api/tasks`  ã§æ–°ã—ã„ã‚¿ã‚¹ã‚¯ã‚’ä½œæˆã§ãã‚‹æƒ³å®šã§å®Ÿè£…ã—ã¦ã„ãã¾ã™ã€‚

![image1.png](/images/b7872e09b84e15/image1.png)

# ãƒ¢ãƒ‡ãƒ«å®šç¾©

ã¾ãšã¯ã‚¿ã‚¹ã‚¯ã‚’è¡¨ã™ãƒ¢ãƒ‡ãƒ«ã¨ã—ã¦ `src/models/task.ts` ã‚’ä»¥ä¸‹å†…å®¹ã§ä½œæˆã—ã¾ã™ã€‚

```tsx
import { z } from '@hono/zod-openapi';

export const TaskSchema = z
  .object({
    uuid: z.string().openapi({
      example: '12345678-e29b-41d4-a716-123456789000',
    }),
    title: z.string().openapi({
      example: 'Title',
    }),
    description: z.string().openapi({
      example: 'Description',
    }),
    completed: z.boolean().openapi({
      example: false,
    }),
    priority: z.number().min(1).max(5).openapi({
      example: 3,
    }), // ã‚¿ã‚¹ã‚¯ã®å„ªå…ˆåº¦ï¼ˆ1ã€œ5ï¼‰
  })
  .openapi('TaskSchema');

// æ–°ã—ã„ã‚¿ã‚¹ã‚¯ä½œæˆç”¨ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ¢ãƒ‡ãƒ«
export const CreateTaskSchema = z
  .object({
    title: z.string().openapi({
      example: 'Title',
    }),
    description: z.string().openapi({
      example: 'Description',
    }),
    priority: z.number().min(1).max(5).default(3).openapi({
      example: 3,
    }),
    completed: z.boolean().default(false).openapi({
      example: false,
    }),
  })
  .openapi('CreateTaskSchema');

// ã‚¿ã‚¹ã‚¯ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ¢ãƒ‡ãƒ«
export const TaskListSchema = z.array(TaskSchema).openapi('TaskListSchema');
```

`POST /api/tasks` ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ™‚ã«ä½¿ã†æƒ³å®šã® `CreateTaskSchema` ã‚„ `GET /api/tasks` ã§ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ç”¨ã® `TaskListSchema` ã‚‚å®šç¾©ã—ã¦ã„ã¾ã™ã€‚

ã¤ã„ã§ã«ã‚¨ãƒ©ãƒ¼ç”¨ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹Schemaã‚‚å®šç¾©ã—ã¦ãŠãã¾ã™ã€‚`src/models/error.ts` ã‚’ä»¥ä¸‹å†…å®¹ã§ä½œæˆã—ã¾ã™ã€‚

```tsx
import { z } from '@hono/zod-openapi';

export const ErrorResponse = z
  .object({
    message: z.string(),
    stackTrace: z.string().optional(),
  })
  .openapi('ErrorResponse');
```

# å„ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆå®Ÿè£…

## GET /api/tasks ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ

æ–°è¦ã« `src/api/tasks/getTasks.ts` ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã€OpenAPI ã®ãƒ«ãƒ¼ãƒˆå®šç¾©ã‚’è¡Œã„ã¾ã™ã€‚ã“ã“ã§ã¯ã€`@hono/zod-openapi` ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã® `createRoute` ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚

```tsx
import { createRoute } from '@hono/zod-openapi';
import { ErrorResponse, TaskListSchema } from '../../models';

export const getTasksRoute = createRoute({
  path: '/',
  method: 'get',
  description: 'ç™»éŒ²ã•ã‚Œã¦ã„ã‚‹ã™ã¹ã¦ã®ã‚¿ã‚¹ã‚¯ã®ãƒªã‚¹ãƒˆã‚’å–å¾—ã—ã¾ã™',
  responses: {
    200: {
      description: 'OK',
      content: {
        'application/json': {
          schema: TaskListSchema,
        },
      },
    },
    500: {
      description: 'Internal Server Error',
      content: {
        'application/json': {
          schema: ErrorResponse,
        },
      },
    },
  },
});
```

ã“ã“ã§ã¯ã€HTTPã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰ `200` ã®æˆåŠŸæ™‚ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã«ã€`src/models/task.ts` ã§å®šç¾©ã—ãŸ `TaskListSchema` ã‚’ä½¿ç”¨ã—ã¦ã„ã¾ã™ã€‚åŠ ãˆã¦ã€`500` ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ãŸå ´åˆã«ã¯ã€`src/models/error.ts` ã§å®šç¾©ã—ãŸ `ErrorResponse` ã‚’è¿”ã™è¨­å®šã‚’è¡Œã£ã¦ã„ã¾ã™ã€‚

æ¬¡ã«å®Ÿéš›ã«ä½•ã‚‰ã‹ã®å‡¦ç†ã‚’è¡Œã„ã€ã‚¿ã‚¹ã‚¯ä¸€è¦§ã‚’è¿”ã™å‡¦ç†ã®å®Ÿè£…ã‚’è¡Œã„ã¾ã™ã€‚ä»Šå›ã¯ã‚µãƒ³ãƒ—ãƒ«ã®ç‚ºã€å›ºå®šãƒ‡ãƒ¼ã‚¿ã‚’è¿”ã™ã‚ˆã†ã«ã—ã¦ã„ã¾ã™ã€‚

```tsx
type TaskSchema = z.infer<typeof TaskSchema>;

export const getTasksHandler: RouteHandler<typeof tasksRoute, {}> = async (c) => {
  try {
    const tasks: TaskSchema[] = [
      {
        uuid: '12345678-e29b-41d4-a716-123456789000',
        title: 'Buy Groceries',
        description: 'Purchase milk, eggs, and bread from the store',
        completed: false,
        priority: 2,
      },
      {
        uuid: '23456789-c23e-59c3-c234-234567890111',
        title: 'Morning Run',
        description: 'Run 5 kilometers in the park',
        completed: false,
        priority: 5,
      },
    ];

    return c.json(tasks, 200);
  } catch (e) {
    console.error(e);
    return c.json({ message: 'Internal Server Error', stackTrace: e }, 500);
  }
};
```

## POST /api/tasks ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ

æ–°è¦ã« `src/api/tasks/createTasks.ts` ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¾ã™ã€‚GETã®æ™‚ã¨åŒã˜ã‚ˆã†ã«ã¾ãšã¯OpenAPI ã®ãƒ«ãƒ¼ãƒˆå®šç¾©ã‚’è¡Œã„ã¾ã™ã€‚

```tsx
import { createRoute } from '@hono/zod-openapi';
import { CreateTaskSchema, ErrorResponse, TaskSchema } from '../../models';

type CreateTaskSchema = z.infer<typeof CreateTaskSchema>;

export const createTasksRoute = createRoute({
  path: '/',
  method: 'post',
  description: 'æ–°ãŸã«ã‚¿ã‚¹ã‚¯ã‚’ç™»éŒ²ã—ã¾ã™',
  request: {
    body: {
      content: {
        'application/json': {
          schema: CreateTaskSchema,
        },
      },
    },
  },
  responses: {
    200: {
      description: 'OK',
      content: {
        'application/json': {
          schema: TaskSchema,
        },
      },
    },
    500: {
      description: 'Internal Server Error',
      content: {
        'application/json': {
          schema: ErrorResponse,
        },
      },
    },
  },
});
```

`request` ã® `schema` ã«ãƒ¢ãƒ‡ãƒ«å®šç¾©ã®æ™‚ã«å®Ÿè£…ã—ãŸ `CreateTaskSchema` ã‚’è¨­å®šã—ã¦ã„ã¾ã™ã€‚

æ¬¡ã«å®Ÿéš›ã®å‡¦ç†éƒ¨åˆ†ã‚’å®Ÿè£…ã—ã¦ã„ãã¾ã™ã€‚ã“ã¡ã‚‰ã‚‚æœ¬æ¥ã¯DBç­‰ã«ä¿å­˜ã—ãŸã‚Šã¨å‡¦ç†ã‚’è¡Œã†ã‹ã¨æ€ã„ã¾ã™ãŒã€ä»Šå›ã¯å—ã‘å–ã£ãŸãƒ‡ãƒ¼ã‚¿ã«uuidã‚’ç™ºè¡Œã—ã¦è¿”ã™ã‚ˆã†ã«ã—ã¦ã„ã¾ã™ã€‚

```tsx
type TaskSchema = z.infer<typeof TaskSchema>;

export const createTasksHandler: RouteHandler<
  typeof createTasksRoute,
  {}
> = async (c) => {
  try {
    const newTask = await c.req.json<CreateTaskSchema>();
    const uuid = crypto.randomUUID();
    const task: TaskSchema = {
      uuid,
      ...newTask,
    };

    return c.json(task, 200);
  } catch (e) {
    console.error(e);
    return c.json({ message: 'Internal Server Error', stackTrace: e }, 500);
  }
};
```

# Routerå®šç¾©

`src/api/tasks/index.ts` ã‚’ä»¥ä¸‹å†…å®¹ã§ä½œæˆã—ã¾ã™ã€‚

```tsx
import { OpenAPIHono } from '@hono/zod-openapi';
import { createTasksHandler, createTasksRoute } from './createTask';
import { getTasksHandler, getTasksRoute } from './getTasks';

export const tasksApi = new OpenAPIHono();
tasksApi
  .openapi(getTasksRoute, getTasksHandler)
  .openapi(createTasksRoute, createTasksHandler);
```

ã“ã“ã§ã¯ä½œæˆã—ãŸ `GET /api/tasks ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ (getTasks)` ã¨ `POST /api/tasks ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ (createTask)` ã‚’ `tasksApi` ã¨ã„ã†Routeã«è¨­å®šã—ã¦ã„ã¾ã™ã€‚

æ¬¡ã« `src/api/index.ts` ã‚’ä»¥ä¸‹å†…å®¹ã§ä½œæˆã—ã¾ã™ã€‚

```tsx
import { swaggerUI } from '@hono/swagger-ui';
import { OpenAPIHono } from '@hono/zod-openapi';
import { tasks, tasksRoute } from './tasks';

export const api = new OpenAPIHono();

api
  .route('/tasks', tasksApi)
  .doc('/specification', {
    openapi: '3.0.0',
    info: {
      title: 'API',
      version: '1.0.0',
    },
  })
  .get(
    '/doc',
    swaggerUI({
      url: '/api/specification',
    })
  );
```

ã“ã“ã§ã¯å…ˆã»ã©ã® `tasksApi` ã‚’ `Nested route` ã¨ã—ã¦è¿½åŠ ã— `Swagger ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ` ã‚’ç”Ÿæˆã™ã‚‹ç‚ºã®å‡¦ç†ã‚’è¿½åŠ ã—ã¦ã„ã¾ã™ã€‚ğŸ‘†ã®å ´åˆ `/api/doc` ã§ `Swagger ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ` ã‚’è¦‹ã‚‹ã“ã¨ãŒã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

æœ€å¾Œã« `src/index.ts` ã§å…ˆç¨‹ä½œæˆã—ãŸ `api` ã‚’ `Nested route` ã¨ã—ã¦è¿½åŠ ã—ã¾ã™ã€‚

(ã¾ãŸã€JSON ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’è¦‹ã‚„ã™ãã™ã‚‹ [prettyJSON](https://hono.dev/docs/middleware/builtin/pretty-json) ã¨ 404 ã®è¨­å®šã‚‚è¡Œãªã£ã¦ã„ã¾ã™)

```tsx
import { Hono } from 'hono';
import { prettyJSON } from 'hono/pretty-json';
import { api } from './api';

const app = new Hono();
app.use(prettyJSON());
app.notFound((c) => c.json({ message: 'Not Found', ok: false }, 404));

app.route('/api', api);

export default app;

```

# å‹•ä½œç¢ºèª

## Swagger ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

ã“ã‚Œã§æº–å‚™ãŒã§ããŸã®ã§ã€å‹•ä½œç¢ºèªã—ã¦ã„ããŸã„ã¨æ€ã„ã¾ã™ã€‚ã¾ãšã¯ `Swagger ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ` ãŒã¡ã‚ƒã‚“ã¨è¡¨ç¤ºã•ã‚Œã‚‹ã‹ [http://localhost:8787/api/doc](http://localhost:8787/api/doc) ã«ãƒ–ãƒ©ã‚¦ã‚¶ã§ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ã¿ã¾ã™ã€‚

![image2.png](/images/b7872e09b84e15/image2.png)

å„ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã¨SchemasãŒåæ˜ ã•ã‚ŒãŸãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãŒç”Ÿæˆã•ã‚Œã¦ã„ã‚Œã°OKã§ã™ã€‚

## ãƒ¬ã‚¹ãƒãƒ³ã‚¹ç¢ºèª

æœ€å¾Œã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ã£ã¦ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’ç¢ºèªã—ã¦ã¿ã¾ã™ã€‚

ã¾ãšã¯ `GET /api/tasks ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ` ã‚’è©¦ã—ã¦ã¿ã¾ã™ã€‚

```bash
$ curl -i 'http://localhost:8787/api/tasks?pretty'                                   main
HTTP/1.1 200 OK
Content-Length: 385
Content-Type: application/json; charset=UTF-8

[
  {
    "uuid": "12345678-e29b-41d4-a716-123456789000",
    "title": "Buy Groceries",
    "description": "Purchase milk, eggs, and bread from the store",
    "completed": false,
    "priority": 2
  },
  {
    "uuid": "23456789-c23e-59c3-c234-234567890111",
    "title": "Morning Run",
    "description": "Run 5 kilometers in the park",
    "completed": false,
    "priority": 5
  }
]
```

ã¡ã‚ƒã‚“ã¨å€¤ãŒè¿”ã£ã¦ãã¦ãã†ã§ã™ âœ¨

æ¬¡ã« `POST /api/tasks ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³` ã‚’è©¦ã—ã¦ã¿ã¾ã™ã€‚

```bash
$ curl -i -X POST 'http://localhost:8787/api/tasks?pretty' -H 'Content-Type: application/json' -d '{"title":"è²·ã„ç‰©", "description":"ä»Šæ—¥ã®è²·ã„ç‰©", "priority": 1, "completed": false}'
HTTP/1.1 200 OK
Content-Length: 154
Content-Type: application/json; charset=UTF-8

{
  "uuid": "104685a2-9728-488b-8505-0b64a426329a",
  "title": "è²·ã„ç‰©",
  "description": "ä»Šæ—¥ã®è²·ã„ç‰©",
  "priority": 1,
  "completed": false
}
```

ã“ã¡ã‚‰ã‚‚æ„å›³ã—ãŸå€¤ãŒè¿”ã£ã¦ãã¦ã„ãã†ã§ã™ã€‚ã“ã“ã§ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã® `title` ãŒç„¡ã„çŠ¶æ…‹ã§ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ã£ã¦ã¿ã¾ã™ã€‚

```bash
$ curl -i -X POST 'http://localhost:8787/api/tasks?pretty' -H 'Content-Type: application/json' -d '{"description":"ä»Šæ—¥ã®è²·ã„ç‰©", "priority": 1, "completed": false}'  
HTTP/1.1 400 Bad Request
Content-Length: 274
Content-Type: application/json; charset=UTF-8

{
  "success": false,
  "error": {
    "issues": [
      {
        "code": "invalid_type",
        "expected": "string",
        "received": "undefined",
        "path": [
          "title"
        ],
        "message": "Required"
      }
    ],
    "name": "ZodError"
  }
}
```

ã¡ã‚ƒã‚“ã¨Validationã‚¨ãƒ©ãƒ¼ãŒè¿”ã£ã¦ãã¾ã—ãŸ âœ¨

# èªè¨¼

æœ€å¾Œã« `/api/doc` ã« Basicèªè¨¼ã‚’ã€ãã‚Œä»¥å¤–ã® `GET /api/tasks` ã‚„ `POST /api/tasks` ã« Bearerèªè¨¼ã‚’ã¤ã‘ã¦ã¿ãŸã„ã¨æ€ã„ã¾ã™ã€‚

## /api/docã¸ã®Basicèªè¨¼

Routerå®šç¾©ã®æ™‚ç‚¹ã§ä½œæˆã—ãŸ `src/api/tasks/index.ts` ã«å¯¾ã—ã¦ã€ä»¥ä¸‹ã‚’è¿½åŠ ã—ã¾ã™ã€‚

```tsx
api
  .route('/tasks', tasksApi)
  .doc('/specification', {
    openapi: '3.0.0',
    info: {
      title: 'API',
      version: '1.0.0',
    },
  })
  // â†“ã“ã“ã‹ã‚‰è¿½åŠ 
  .use('/doc/*', async (c, next) => {
    const auth = basicAuth({
      username: 'user', // æœ¬æ¥ã¯ç’°å¢ƒå¤‰æ•°ç­‰ã§ã¡ã‚ƒã‚“ã¨å€¤ã‚’è¨­å®š
      password: 'pass', // ä»Šå›ã¯å›ºå®š
    });
    return auth(c, next);
  })
  // ã“ã“ã¾ã§
  .get(
    '/doc',
    swaggerUI({
      url: '/api/specification',
    })
  );
```

ã“ã†ã™ã‚‹ã“ã¨ã§ [http://localhost:8787/api/doc](http://localhost:8787/api/doc) ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã¨èªè¨¼ãŒã‹ã‹ã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

![image3.png](/images/b7872e09b84e15/image3.png)

## /api/tasksã¸ã®Bearerèªè¨¼

ä»Šåº¦ã¯ `GET/PODT /api/tasks` (/api/doc ã¯é™¤ã) ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ™‚ã«Bearerèªè¨¼ã‚’ã¤ã‘ã¦ã¿ãŸã„ã¨æ€ã„ã¾ã™ã€‚

`src/api/index.ts` ã«ä»¥ä¸‹ã‚’è¿½åŠ ã—ã¾ã™ã€‚

```tsx
export const api = new OpenAPIHono();
// â†“è¿½åŠ 
// /api/docä»¥å¤–ã¯Bearerèªè¨¼ã‚’ã‹ã‘ã‚‹
api.use('/*', async (c, next) => {
  if (c.req.path === '/api/doc' || c.req.path === '/api/specification') {
    return next();
  }
  const auth = bearerAuth({
    token: 'token', // ãƒ‡ãƒ¢ç”¨ãªã®ã§å›ºå®š
  });
  return auth(c, next);
});
// ã“ã“ã¾ã§
```

ä»–ã«è‰¯ã„æ–¹æ³•ãŒã‚ã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ãŒã€æ€ã„ã¤ãæ–¹æ³•ã§è©¦ã—ã¦ã¿ã¾ã—ãŸã€‚

(ä»–ã®æ–¹æ³•ã‚’ã”å­˜çŸ¥ã®æ–¹ã¯æ•™ãˆã¦é ‚ã‘ã‚‹ã¨åŠ©ã‹ã‚Šã¾ã™ ğŸ™)

ã“ã®çŠ¶æ…‹ã§ `GET /api/tasks ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ` ã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’æŠ•ã’ã¦ã¿ã¾ã™ã€‚

```bash
$ curl -i 'http://localhost:8787/api/tasks?pretty'                                   main
HTTP/1.1 401 Unauthorized
Content-Length: 12
Content-Type: text/plain;charset=UTF-8
WWW-Authenticate: Bearer realm=""

Unauthorized
```

`401` ãŒè¿”ã£ã¦ãã¦ã¾ã™ã€‚æ¬¡ã« `token` ã‚’ä»˜ä¸ã—ã¦ãƒªã‚¯ã‚¨ã‚¹ãƒˆã—ã¦ã¿ã¾ã™ã€‚

```bash
$ curl -i -H 'Authorization: Bearer token' 'http://localhost:8787/api/tasks?pretty'    
HTTP/1.1 200 OK
Content-Length: 385
Content-Type: application/json; charset=UTF-8

[
  {
    "uuid": "12345678-e29b-41d4-a716-123456789000",
    "title": "Buy Groceries",
    "description": "Purchase milk, eggs, and bread from the store",
    "completed": false,
    "priority": 2
  },
  {
    "uuid": "23456789-c23e-59c3-c234-234567890111",
    "title": "Morning Run",
    "description": "Run 5 kilometers in the park",
    "completed": false,
    "priority": 5
  }
]
```

ã¡ã‚ƒã‚“ã¨è¿”ã£ã¦ãã¦ã¾ã™ âœ¨Â 

`/api/doc` ã‚‚è©¦ã—ã¦ã¿ã¾ã™ã€‚ [http://localhost:8787/api/doc](http://localhost:8787/api/doc) ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦Basicèªè¨¼ã ã‘æœ‰åŠ¹ã«ãªã£ã¦ã„ã‚Œã°æˆåŠŸã§ã™ï¼

![image4.png](/images/b7872e09b84e15/image4.png =350x)

# ã¾ã¨ã‚

Modelã®Schemaè€ƒãˆã¦ã€æ¬¡ã«APIã®Schemaã€å®Ÿè£…ã¨è‡ªç„¶ãªæµã‚Œã§é€²ã‚ã¦ã„ã‘ã‚‹ä¸­ã§ã€Honoã®å®Ÿè£…ã®ã—ã‚„ã™ã•ã¨ç›¸ã¾ã£ã¦é–‹ç™ºä½“é¨“ãŒã¨ã¦ã‚‚ã‚¹ãƒ ãƒ¼ã‚ºã«æ„Ÿã˜ã¾ã—ãŸã€‚èªè¨¼ã‚‚æ—¢å­˜ã®middlewareã‚’è¿½åŠ ã™ã‚‹ã ã‘ã§ã€ã‚µã‚¯ãƒƒã¨å®Ÿè£…ã§ãã‚‹ã®ãŒå¬‰ã—ã„ã§ã™ã­ã€‚

# å‚è€ƒURL

https://tech.fusic.co.jp/posts/hono-zod-openapi/

https://zenn.dev/praha/articles/d1d6462a27e37e
