---
title: "ã€React Hooksã€‘ã‚±ãƒ¼ã‚¹æ¯ã®useEffectã®æŒ™å‹•"
emoji: "ğŸ“"
type: "tech"
topics:
  - "react"
  - "typescript"
  - "hooks"
  - "memo"
published: true
published_at: "2021-06-14 23:06"
---

# ã“ã®è¨˜äº‹ã¯?
`useEffect` ã‚’ä½¿ã£ã¦ã„ã¦ã€ã€Œã“ã®æ™‚ã©ã‚“ãªæŒ™å‹•ã™ã‚‹ã‚“ã ã£ã‘?ã€ ã¨ã„ã†ã®ã‚’
æ€ã„ã¤ã„ãŸã‚±ãƒ¼ã‚¹åˆ†ã ã‘è©¦ã—ãŸæ™‚ã®ãƒ¡ãƒ¢ã«ãªã‚Šã¾ã™ã€‚

**å„ãƒãƒ¼ã‚¸ãƒ§ãƒ³**

```
    "react": "17.0.2",
    "react-dom": "17.0.2",

    "@types/react": "^17.0.9",
    "@types/react-dom": "^17.0.6",
```

# useEffectã®å®Ÿè£…
ã¡ãªã¿ã« `useEffect` ã®å®Ÿè£…ã¯ã¨ã„ã†ã¨ [ReactHooks.js](https://github.com/facebook/react/blob/1a3f1afbd3cf815d4e55628cd7d84ef20171bab8/packages/react/src/ReactHooks.js) ã«ã¯â†“ã®ã‚ˆã†ã«å®Ÿè£…ã•ã‚Œã¦ã„ã¾ã™ã€‚

```js
export function useEffect(
  create: () => (() => void) | void,
  deps: Array<mixed> | void | null,
): void {
  const dispatcher = resolveDispatcher();
  return dispatcher.useEffect(create, deps);
}
```

ç¬¬1å¼•æ•°ã«å‡¦ç†ã®å®Ÿæ…‹ã¨ã€ç¬¬2å¼•æ•°ã«å½±éŸ¿ã™ã‚‹é…åˆ—ã‚’æŒ‡å®šã™ã‚‹ãŠé¦´æŸ“ã¿ã®å½¢ã§ã™ã€‚

# Caseåˆ¥ã®æŒ™å‹•
## Case1. ç¬¬2å¼•æ•°ãŒç©ºé…åˆ—

```tsx
import React, { useEffect, useState } from 'react';

const Case1: React.VFC<{ count: number }> = ({ count }) => {
  useEffect(() => {
    console.log('Case1 useEffect.');
    console.log({ count });
  }, []);
  return <>Case1 count: {count}</>;
};

const Practice: React.FC = () => {
  const [counter, setCounter] = useState(0);
  return (
    <div>
      <Case1 count={counter} />
      <hr />
      <button onClick={() => setCounter(counter + 1)}>ã‚«ã‚¦ãƒ³ãƒˆã‚¢ãƒƒãƒ—</button>
    </div>
  );
};

export default Practice;
```

ã‚ˆãæ›¸ãã‚±ãƒ¼ã‚¹ã‹ã¨æ€ã„ã¾ã™ã€‚
`Case1` ã‚’å†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã•ã›ã‚‹ç‚ºã«ã€è¦ªã§ã‚«ã‚¦ãƒ³ãƒˆã‚¢ãƒƒãƒ—ã—ãŸå€¤ã‚’ `Case1` ã§è¡¨ç¤ºã•ã›ã¦ã„ã¾ã™ã€‚

![](https://storage.googleapis.com/zenn-user-upload/0a937e1780d4b3a72aefc5b4.gif)

`useEffect` å†…ãŒåˆå›ã®ã¿å®Ÿè¡Œã•ã‚Œã€å½“ç„¶ã‚«ã‚¦ãƒ³ãƒˆã®å€¤ã‚‚åˆæœŸå€¤ãŒå‡ºåŠ›ã•ã‚Œã¦ã„ã¾ã™ã€‚

## Case2. ç¬¬2å¼•æ•°ã«æŒ‡å®šã‚ã‚Š

```tsx
import React, { useEffect, useState } from 'react';

const Case2: React.VFC<{ count: number }> = ({ count }) => {
  useEffect(() => {
    console.log('Case2 useEffect.');
    console.log({ count });
  }, [count]);
  return <>Case2 count: {count}</>;
};

const Practice: React.FC = () => {
  const [counter, setCounter] = useState(0);
  return (
    <div>
      <Case2 count={counter} />
      <hr />
      <button onClick={() => setCounter(counter + 1)}>ã‚«ã‚¦ãƒ³ãƒˆã‚¢ãƒƒãƒ—</button>
    </div>
  );
};

export default Practice;
```

ã“ã¡ã‚‰ã‚‚ã‚ˆãã‚ã‚‹ã‚±ãƒ¼ã‚¹ã‹ã¨æ€ã„ã¾ã™ã€‚
ã¾ãšã¯å˜ç´”ã« `useEffect` ã®ç¬¬2å¼•æ•°ã«ã‚«ã‚¦ãƒ³ãƒˆã‚’æŒ‡å®šã—ã¦ã„ã¾ã™ã€‚

![](https://storage.googleapis.com/zenn-user-upload/c954d8cf373e996065e97004.gif)

ã‚«ã‚¦ãƒ³ãƒˆãŒæ›´æ–°ã•ã‚ŒãŸã®ã§ã€`useEffect` å†…ã®å‡¦ç†ã‚‚ãã‚Œã«åˆã‚ã›ã¦å‡¦ç†ãŒèµ°ã£ã¦ã„ã¾ã™ã€‚
æ¬¡ã«åˆ¥ã®å€¤ã‚’`useEffect` å†…ã§å‚ç…§ã—ãŸã‚‰ã©ã†ãªã‚‹ã‹è©¦ã—ã¦è¦‹ãŸã„ã¨æ€ã„ã¾ã™ã€‚

```tsx
import React, { useEffect, useState } from 'react';

const Case2: React.VFC<{ count: number; subCount: number }> = ({
  count,
  subCount,
}) => {
  useEffect(() => {
    console.log('Case2 useEffect.');
    console.log({ count });
    console.log({ subCount });
  }, [count]);
  return (
    <>
      Case2 count: {count} / sub: {subCount}
    </>
  );
};

const Practice: React.FC = () => {
  const [counter, setCounter] = useState(0);
  const [subCounter, setSubCounter] = useState(0);
  return (
    <div>
      <Case2 count={counter} subCount={subCounter} />
      <hr />
      <button onClick={() => setCounter(counter + 1)}>ã‚«ã‚¦ãƒ³ãƒˆã‚¢ãƒƒãƒ—</button>
      <button onClick={() => setSubCounter(subCounter + 1)}>
        ã‚µãƒ– ã‚«ã‚¦ãƒ³ãƒˆã‚¢ãƒƒãƒ—
      </button>
    </div>
  );
};

export default Practice;
```
ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ã‚’ã‚‚ã†ä¸€ã¤å¢—ã‚„ã—ã¦ã€ç•°ãªã‚‹å€¤ã«ãªã‚‹ã‚ˆã†ã«ã—ã¦è©¦ã—ã¦ã¿ã¾ã™ã€‚
![](https://storage.googleapis.com/zenn-user-upload/4f70b386d039885ae875b439.gif)

æœ€åˆã®ã‚«ã‚¦ãƒ³ãƒˆãŒæ›´æ–°ã•ã‚ŒãŸã‚¿ã‚¤ãƒŸãƒ³ã‚°ã®ã‚µãƒ–ã‚«ã‚¦ãƒ³ãƒˆã®å€¤ã‚’å‚ç…§ã§ãã¦ã„ã¾ã™ã€‚

## Case3. ç¬¬2å¼•æ•°ãŒç©ºã ã‘ã©ã€CallbackãŒå‘¼ã°ã‚Œã‚‹

æ¬¡ã¯ã¡ã‚‡ã£ã¨ç‰¹æ®Šã§ç¬¬2å¼•æ•°ã‚’ç©ºã«ã—ã¦åˆå›ã—ã‹å‘¼ã°ã‚Œãªã„ã‚ˆã†ã«ã™ã‚‹ã‘ã©ã€ã‚¿ã‚¤ãƒãƒ¼ã‚’ä½¿ã£ã¦
3ç§’ãŠãã«ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ã®å€¤ã‚’è¡¨ç¤ºã•ã›ã¾ã™ã€‚

```tsx
import React, { useEffect, useState } from 'react';

const Case3: React.VFC<{ count: number; subCount: number }> = ({
  count,
  subCount,
}) => {
  useEffect(() => {
    console.log('Case3 useEffect.');
    const timer = setInterval(() => {
      console.log({ count });
      console.log({ subCount });
    }, 3000);

    return () => clearInterval(timer);
  }, []);
  return (
    <>
      Case3 count: {count} / sub: {subCount}
    </>
  );
};

const Practice: React.FC = () => {
  const [counter, setCounter] = useState(0);
  const [subCounter, setSubCounter] = useState(0);
  return (
    <div>
      <Case3 count={counter} subCount={subCounter} />
      <hr />
      <button onClick={() => setCounter(counter + 1)}>ã‚«ã‚¦ãƒ³ãƒˆã‚¢ãƒƒãƒ—</button>
      <button onClick={() => setSubCounter(subCounter + 1)}>
        ã‚µãƒ– ã‚«ã‚¦ãƒ³ãƒˆã‚¢ãƒƒãƒ—
      </button>
    </div>
  );
};

export default Practice;
```

![](https://storage.googleapis.com/zenn-user-upload/8ce73d819acd5bf3d9214a91.gif)

ã‚«ã‚¦ãƒ³ãƒˆã‚’æ›´æ–°ã—ã¦ã„ã‚‹ã«ã‚‚é–¢ã‚ã‚‰ãšã€ã‚¿ã‚¤ãƒãƒ¼ã§3ç§’æ¯ã«è¡¨ç¤ºã•ã‚Œã‚‹å€¤ã¯åˆæœŸå€¤ã®ã¾ã¾ã«ãªã£ã¦ã„ã¾ã™ã€‚

## Case4. ç¬¬2å¼•æ•°ã«æŒ‡å®šã‚ã‚Šã‹ã¤CallbackãŒå‘¼ã°ã‚Œã‚‹

```tsx
import React, { useEffect, useState } from 'react';

const Case4: React.VFC<{ count: number; subCount: number }> = ({
  count,
  subCount,
}) => {
  useEffect(() => {
    console.log('Case4 useEffect.');
    const timer = setInterval(() => {
      console.log({ count });
      console.log({ subCount });
    }, 3000);

    return () => clearInterval(timer);
  }, [count]);
  return (
    <>
      Case4 count: {count} / sub: {subCount}
    </>
  );
};

const Practice: React.FC = () => {
  const [counter, setCounter] = useState(0);
  const [subCounter, setSubCounter] = useState(0);
  return (
    <div>
      <Case4 count={counter} subCount={subCounter} />
      <hr />
      <button onClick={() => setCounter(counter + 1)}>ã‚«ã‚¦ãƒ³ãƒˆã‚¢ãƒƒãƒ—</button>
      <button onClick={() => setSubCounter(subCounter + 1)}>
        ã‚µãƒ– ã‚«ã‚¦ãƒ³ãƒˆã‚¢ãƒƒãƒ—
      </button>
    </div>
  );
};

export default Practice;
```

![](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/299271/d2449450-334a-ea04-887e-5da2afd0201d.gif)

`Case3` ã¨ `Case4` ã‹ã‚‰ç¬¬2å¼•æ•°ãªã—ã®å ´åˆã¯åˆå›ã®çŠ¶æ…‹ã‚’ä¿æŒã€
ç¬¬2å¼•æ•°ã‚ã‚Šã®å ´åˆã¯ç¬¬2å¼•æ•°ãŒæ›´æ–°ã•ã‚ŒãŸã‚¿ã‚¤ãƒŸãƒ³ã‚°ã®çŠ¶æ…‹ã‚’ä¿æŒã—ã¦ã„ã‚‹ã“ã¨ãŒåˆ†ã‹ã‚Šã¾ã—ãŸ :eyes:

## Case5. åˆ¥ã®useEffectã‹ã‚‰å€¤ã‚’æ›´æ–°ã™ã‚‹

ã“ã‚Œã‚‚ç‰¹æ®Šã§ã€ã‚¿ã‚¤ãƒãƒ¼ã§ãƒ­ã‚°ã‚’å‡ºã—ã¦ã„ã‚‹ `useEffect` ã¯ç¬¬2å¼•æ•°ç„¡ã—ã§ã€åˆ¥ã® `useEffect` ã§
ã‚«ã‚¦ãƒ³ãƒˆãŒæ›´æ–°ã•ã‚Œã‚‹ã¨åå¿œã™ã‚‹ã‚ˆã†ã«ã—ã¦ã€å†…éƒ¨ã®ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ã‚’æ›´æ–°ã™ã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚

```tsx
import React, { useEffect, useState } from 'react';

const Case5: React.VFC<{ count: number; subCount: number }> = ({
  count,
  subCount,
}) => {
  const [internalCounter, setInternalCounter] = useState(0);
  useEffect(() => {
    console.log('Case5 useEffect.');
    const timer = setInterval(() => {
      console.log({ count });
      console.log({ subCount });
      console.log({ internalCounter });
    }, 3000);

    return () => clearInterval(timer);
  }, []);

  useEffect(() => {
    setInternalCounter(internalCounter + 1);
  }, [count]);
  return (
    <>
      Case5 count: {count} / sub: {subCount} / internal: {internalCounter}
    </>
  );
};

const Practice: React.FC = () => {
  const [counter, setCounter] = useState(0);
  const [subCounter, setSubCounter] = useState(0);
  return (
    <div>
      <Case5 count={counter} subCount={subCounter} />
      <hr />
      <button onClick={() => setCounter(counter + 1)}>ã‚«ã‚¦ãƒ³ãƒˆã‚¢ãƒƒãƒ—</button>
      <button onClick={() => setSubCounter(subCounter + 1)}>
        ã‚µãƒ– ã‚«ã‚¦ãƒ³ãƒˆã‚¢ãƒƒãƒ—
      </button>
    </div>
  );
};

export default Practice;
```

![](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/299271/2b5d7d5e-e7c4-a6e5-f36a-acb5eebd33c3.gif)


`Case3`, `Case4` ã¨åŒã˜çµæœã¨ãªã‚Šã¾ã—ãŸã€‚
