---
title: "Storybookã§ã®VRT(Visual Regression Testing) ã‚’æœ€å°æ§‹æˆã§è©¦ã™"
emoji: "ğŸ’¯"
type: "tech"
topics:
  - "storybook"
  - "vrt"
  - "nextjs"
  - "react"
published: true
published_at: "2021-11-09 23:12"
---

# ã¯ã˜ã‚ã«
ã‚¿ã‚¤ãƒˆãƒ«ã®é€šã‚Šã€VRT(Visual Regression Testing) ã‚’Storybookã‚’ç”¨ã„ã¦æœ€ä½é™ã®æ§‹æˆã§è©¦ã—ã¦ã¿ã¾ã—ãŸã€‚
â€» æœ€ä½é™ã®æ§‹æˆã§è©¦ã—ãŸã®ã§ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«å°å…¥ã™ã‚‹å ´åˆã¯ã‚‚ã†å°‘ã—è€ƒæ…®ãŒå¿…è¦ãã†ã§ã™ã€‚ã€‚

# å¯¾è±¡è€…
- VRT(Visual Regression Testing) ã«èˆˆå‘³ãŒã‚ã‚‹
- Storybookã‚’ç”¨ã„ã¦VRTã‚’å°å…¥ã—ã‚ˆã†ã¨æ€ã£ã¦ã„ã‚‹
- VRTã©ã‚“ãªã‚‚ã®ã‹è©¦ã—ã¦ã¿ãŸã„

# ã‚´ãƒ¼ãƒ«
â†“ã®ã‚ˆã†ã«ãŠè©¦ã—ã§ãƒ¬ãƒãƒ¼ãƒˆå‡ºåŠ›ãŒè¦‹ã‚Œã‚‹çŠ¶æ…‹
![image1](https://storage.googleapis.com/zenn-user-upload/89bef1f4dadb2d2dd581d069.gif)

# ç’°å¢ƒæ§‹ç¯‰ã‚„æº–å‚™

å„ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚„ç’°å¢ƒ

```
- storybook/react: 6.3.12
- storycap: 3.1.0
- node: v12.22.0
```

## 1. Dockerå‘¨ã‚Š
[ã“ã¡ã‚‰](https://github.com/puppeteer/puppeteer/blob/main/docs/troubleshooting.md#running-on-alpine)ã‚’å‚è€ƒã«Dockerfileã‚’ä½œæˆã—ã¦ã„ãã¾ã™ã€‚å¾Œã»ã©ä½¿ã† `puppeteer` ã®ç‚ºã«è‰²ã€…å…¥ã‚Œã¦ã¾ã™ã€‚

```Dockerfile
FROM node:12.22.0-alpine

RUN apk update && \
    apk add --no-cache \
      git \
      vim \
      chromium \
      nss \
      freetype \
      harfbuzz \
      ca-certificates \
      ttf-freefont \
```

`docker-compose.yml` ã¯ä»¥ä¸‹ã«ãªã‚Šã¾ã™ã€‚

```yml
version: '3.3'
volumes:
  modules_data:
    driver: local
  next_data:
    driver: local

services:
  vrt:
    build: .
    image: xxxx/vrt
    container_name: 'vrt'
    environment:
      - PUPPETEER_SKIP_CHROMIUM_DOWNLOAD=true
      - PUPPETEER_EXECUTABLE_PATH=/usr/bin/chromium-browser
    volumes:
      - .:/usr/src
      - modules_data:/usr/src/node_modules
      - next_data:/usr/src/.next
    command: ash -c "yarn install && yarn dev"
    ports:
      - '3000:3000'
      - '6006:6006'
    working_dir: /usr/src
```

puppeteerã®è¨­å®šç”¨ã®ç’°å¢ƒå¤‰æ•° `PUPPETEER_SKIP_CHROMIUM_DOWNLOAD` ã¨
 `PUPPETEER_EXECUTABLE_PATH` ã‚’è¨­å®šã—ã¦ã„ã¾ã™ã€‚

å®Ÿéš›ã®æ‰‹é †ã®è©³ç´°ã¯çœãã¾ã™ãŒã€
`npx create-next-app@latest --typescript` ã§nextjsã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã—ã€èµ·å‹•ã§ãã‚‹ã¾ã§ã«ã—ã¨ãã¾ã™ã€‚
(ä»Šå› Next.jsã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®æƒ³å®šã§å®Ÿæ–½ã—ã¦ã¾ã™ãŒã€storybookãŒä½¿ãˆã‚Œã°ä½•ã§ã‚‚è‰¯ã•ãã†ã‹ã¨æ€ã„ã¾ã™ã€‚)

## 2. Storybookã«å¿…è¦ãªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

### 2-1.`npx sb init` ã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```sh
$ npx sb init
```

`package.json` ã«è¿½åŠ ã•ã‚ŒãŸã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚„ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¯ä»¥ä¸‹ã«ãªã‚Šã¾ã™ã€‚

```json
  "scripts": {
    "storybook": "start-storybook -p 6006",
    "build-storybook": "build-storybook"
  },
  "devDependencies": {
    "@babel/core": "^7.16.0",
    "@storybook/addon-actions": "^6.3.12",
    "@storybook/addon-essentials": "^6.3.12",
    "@storybook/addon-links": "^6.3.12",
    "@storybook/react": "^6.3.12",
    "babel-loader": "^8.2.3",
  }
```
ã¾ãŸã€`stories` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªé…ä¸‹ã«ã‚µãƒ³ãƒ—ãƒ«ãŒä½œæˆã•ã‚Œã¦ã„ã¾ã™ã€‚ã¾ãšã¯ã“ã® `stories` ã®ã‚µãƒ³ãƒ—ãƒ«ã§VRTã‚’è©¦ã—ã¦ã¿ãŸã„ã¨æ€ã„ã¾ã™ã€‚
æ—©é€Ÿ `yarn storybook` ã§storybookã‚’èµ·å‹•ã—ã¦ã¿ã¾ã™ã€‚
èµ·å‹•å¾Œ `http://localhost:6006/` ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã¨ä»¥ä¸‹ã®ã‚ˆã†ãªç”»é¢ãŒè¡¨ç¤ºã•ã‚Œã‚Œã°OKã§ã™ã€‚

![image2](https://storage.googleapis.com/zenn-user-upload/85213d46d33ea9f94d25b57a.png)

## 3. storycap ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
[reg-viz/storycap: A Storybook Addon, Save the screenshot image of your stories via puppeteer.](https://github.com/reg-viz/storycap)
`v3.0.0` ã‹ã‚‰ `Puppeteer` ã‚’åˆ¥é€”ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ãŸã‚‚ã®ã‚’ä½¿ã†ã‚ˆã†ã«ãªã£ãŸã½ã„ã®ã§ã€
puppeteerã‚‚ä¸€ç·’ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ãŠãã¾ã™ã€‚[å‚è€ƒ](https://github.com/reg-viz/storycap#chromium-version)
 
```sh
$ yarn add -D storycap puppeteer
```

ä»¥ä¸‹ä»Šå›ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚ŒãŸãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã«ãªã‚Šã¾ã™ã€‚

```json
    "puppeteer": "^11.0.0",
    "storycap": "^3.1.0"
```

`package.json` ã® `script` ã«
```json
"storycap": "storycap --serverCmd \"yarn storybook\" http://localhost:6006 --serverTimeout 600000"
```
ã‚’è¿½åŠ ã—ã€è©¦ã—ã«å®Ÿè¡Œã—ã¦ã¿ã¾ã™ã€‚

```sh
$ yarn storycap
```

æˆåŠŸã™ã‚‹ã¨ã€`__screenshots__` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ç”»åƒãŒä¿å­˜ã•ã‚Œã¾ã™ã€‚
Storycap ã¯ `simple` ã¨ `managed` ã®2ãƒ¢ãƒ¼ãƒ‰ãŒã‚ã‚Šã€ä¸Šè¨˜ã®ã¾ã¾ã ã¨ `simple` ãƒ¢ãƒ¼ãƒ‰ã§
ä»Šå›ã¯ç´°ã‹ãåˆ¶å¾¡ã—ãŸã„å ´åˆã¯ `managed` ãƒ¢ãƒ¼ãƒ‰ã‚’ä½¿ã†ã‚ˆã†ã§ã™ã€‚

## 4. reg-suit ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
[reg-viz/reg-suit: Visual Regression Testing tool](https://github.com/reg-viz/reg-suit)

```sh
$ yarn add -D reg-suit
```

åˆæœŸè¨­å®šã‚’è¡Œã„ã¾ã™ã€‚

```sh
$ yarn reg-suit init --use-yarn
```

![image3](https://storage.googleapis.com/zenn-user-upload/874b0e0f99349cf4bbde0a97.png)

â†‘åˆå›å¿…è¦ãªPluginã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã‚’é¸æŠã™ã‚‹ã®ã§ã™ãŒã€ä»Šå›ã¯ãŠè©¦ã—ãªã®ã§ `reg-publish-s3-plugin` ã ã‘é¸æŠã—ã¾ã—ãŸã€‚
å¾Œã®è³ªå•ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«å›ç­”ã—ã¾ã—ãŸã€‚

```sh
? Working directory of reg-suit. .reg # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®.reg
? Append ".reg" entry to your .gitignore file. Yes
? Directory contains actual images. __screenshots__ # storycapã®å‡ºåŠ›å…ˆã®__screenshots__ã‚’æŒ‡å®š
? Threshold, ranges from 0 to 1. Smaller value makes the comparison more sensitive. 0
[reg-suit] info Set up reg-publish-s3-plugin:
? Create a new S3 bucket No # S3ã®Bucketã¯åˆ¥é€”ç”¨æ„ã™ã‚‹ã®ã§Noã§åå‰ã‚‚ç©ºã«ã—ã¾ã—ãŸ
? Existing bucket name 
``` 

ã“ã“ã¾ã§ã§å‡ºæ¥ä¸ŠãŒã£ãŸ `regconfig.json` ã¯ä»¥ä¸‹ã«ãªã‚Šã¾ã™ã€‚

```json
{
  "core": {
    "workingDir": ".reg",
    "actualDir": "__screenshots__",
    "thresholdRate": 0,
    "addIgnore": true,
    "ximgdiff": {
      "invocationType": "client"
    }
  },
  "plugins": {
    "reg-publish-s3-plugin": {
      "bucketName": "$S3_BUCKET_NAME"
    }
  }
}
```

â€»å¾Œã€…ä½œæˆã—ãŸãƒã‚±ãƒƒãƒˆåã‚’å¤–éƒ¨ã‹ã‚‰è¨­å®šã™ã‚‹ç‚ºã« `$S3_BUCKET_NAME` ã‚’æŒ‡å®šã—ã¦ã„ã¾ã™ã€‚
ã¾ãŸã€`package.json` ã® `script` ã« `"regression": "reg-suit run"` ã‚’è¿½åŠ ã—ã¾ã—ãŸã€‚

## 5. S3ã«reg-suitç”¨ã®ãƒã‚±ãƒƒãƒˆä½œæˆ
è©³ç´°ã¯å‰²æ„›ã—ã¾ã™ãŒã€ä»Šå›  `reg-suit-sample` ã¨ã„ã†ãƒã‚±ãƒƒãƒˆã‚’ä½œæˆã—ã¦ä½¿ã„ã¾ã™ã€‚
ã¾ãŸreg-suitå®Ÿè¡Œæ™‚ã«S3ã‚¢ã‚¯ã‚»ã‚¹ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’æŒ‡å®šã™ã‚‹ç‚ºã«ã€docker-compose.ymlã«ã‚¢ã‚¯ã‚»ã‚¹ã‚­ãƒ¼ç­‰ã‚’è¿½åŠ ã—ã¾ã—ãŸã€‚

```yml
    environment:
      AWS_DEFAULT_REGION: ap-northeast-1
      AWS_ACCESS_KEY_ID: ${AWS_ACCESS_KEY_ID}
      AWS_SECRET_ACCESS_KEY: ${AWS_SECRET_ACCESS_KEY}
      S3_BUCKET_NAME: ${S3_BUCKET_NAME}
```

# VRTå®Ÿæ–½

## 1. S3ãŒç©ºã®çŠ¶æ…‹ã§å®Ÿè¡Œ

```sh
$ yarn storycap
$ yarn regression
```

å®Ÿè¡ŒãŒå®Œäº†ã™ã‚‹ã¨S3ã«ã¯ä»¥ä¸‹ãŒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã•ã‚Œã¦ã„ã¾ã—ãŸã€‚
â€»å¾Œã€…å‡ºã¦ãã¾ã™ãŒã€ã“ã®æ™‚ `key generator plugin` ã‚’æŒ‡å®šã—ã¦ã„ãªã„ç‚ºã€`snapshot_æ—¥æ™‚` ã§ä½œæˆã•ã‚Œã¦ã„ã¾ã™ã€‚

![image4](https://storage.googleapis.com/zenn-user-upload/dc22e480fe4c7f3ca96e8855.png)

 yarn regressionã§ç”Ÿæˆã•ã‚ŒãŸå‡ºåŠ›ã«ã‚ã‚‹ `Report URL` ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ã¿ã‚‹ã¨ä»¥ä¸‹ã®ãƒ¬ãƒãƒ¼ãƒˆãŒå‡ºåŠ›ã•ã‚Œã¦ã„ã¾ã—ãŸã€‚
 
![image5](https://storage.googleapis.com/zenn-user-upload/8da7484fdc2f85fde08e5e86.png)

## 2. å·®åˆ†ãŒç™ºç”Ÿã™ã‚‹ã‚ˆã†ã«å¤‰æ›´ã—ã¦å†åº¦å®Ÿæ–½

å†åº¦å®Ÿè¡Œã™ã‚‹ã¨åˆ¥é€”snapshotãŒä½œæˆã‚Œã¦ã„ã¾ã—ãŸã€‚

![image6](https://storage.googleapis.com/zenn-user-upload/d546c9bf77f98d96d2c4562f.png)

ãŸã ã—ã€ãƒ¬ãƒãƒ¼ãƒˆã‚’è¦‹ã¦ã‚‚å·®åˆ†ãŒæ¤œçŸ¥ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚ã€‚
ã‚ˆãã‚ˆããƒ­ã‚°ã‚’è¦‹ã¦ã¿ã‚‹ã¨ã€

```sh
[reg-suit] info Skipped to detect the previous snapshot key because key generator plugin is not set up.
[reg-suit] info Skipped to fetch the expected data because expected key is null.
```
`key generator plugin` ãŒã‚»ãƒƒãƒˆã•ã‚Œã¦ã„ãªã„ã®ã§ã€æ¯”è¼ƒå…ƒã®ãƒ‡ãƒ¼ã‚¿ã‚’å–ã£ã¦ãã¦ãã‚Œã¦ãªã„ã‚ˆã†ã§ã™ã€‚
æ”¹ã‚ã¦ã€[reg-simple-keygen-plugin](https://github.com/reg-viz/reg-suit/blob/master/packages/reg-simple-keygen-plugin/README.md)ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦å†åº¦å®Ÿæ–½ã—ã¦ã¿ãŸã„ã¨æ€ã„ã¾ã™ã€‚

```sh
$ yarn add -D reg-simple-keygen-plugin
```

`regconfig.json` ã® `plugins` ã«â†“ã®ã‚ˆã†ã«è¿½åŠ ã—ã¾ã™ã€‚

```json
    "reg-simple-keygen-plugin": {
      "expectedKey": "hoge",
      "actualKey": "fuga"
    },
``` 
ä»Šå›ã¯ãŠè©¦ã—ãªã®ã§ã€keyã¯ä¸€åº¦åˆ‡ã‚Šã§ä½¿ã†å‰æã§ã‚»ãƒƒãƒˆã—ã¦ã„ã¾ã™ã€‚
ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã¡ã‚ƒã‚“ã¨ä½¿ã†å ´åˆã€[reg-keygen-git-hash-plugin](https://github.com/reg-viz/reg-suit/tree/master/packages/reg-keygen-git-hash-plugin/README.md)ã‚’ä½¿ã†ã‹ã€
CIã§ç”Ÿæˆã—ãŸhashå€¤ã‚’ä½¿ã†äº‹ã«ãªã‚‹ã‹ã¨æ€ã„ã¾ã™ã€‚-> [ã“ã¡ã‚‰](https://github.com/reg-viz/reg-suit/blob/master/packages/reg-simple-keygen-plugin/README.md#using-environment-values)

S3ã®ãƒ‡ãƒ¼ã‚¿ã‚‚å‰Šé™¤ã—ãƒªã‚»ãƒƒãƒˆã—ãŸçŠ¶æ…‹ã§å†åº¦å®Ÿè¡Œã—ã¾ã™ã€‚

åˆå›ã¯ actual ã—ã‹ç„¡ã„ã®ã§ã€`actualKey` ã‚’ `hoge` ã«å¤‰æ›´ã—ã¦å®Ÿæ–½ã—ã¨ãã¾ã™ã€‚

![image7](https://storage.googleapis.com/zenn-user-upload/99f50f4f17c1400328ba87f7.png)

æ¬¡ã¯ `actualKey` ã‚’ `fuga`  ã«æˆ»ã—ã¦å·®åˆ†ãŒå‡ºã‚‹ã‚ˆã†ã«å®Ÿæ–½ã—ã¾ã™ã€‚
å‡ºåŠ›ã•ã‚ŒãŸãƒ¬ãƒãƒ¼ãƒˆã«ã¯ä»¥ä¸‹ã®æ§˜ã«å·®åˆ†ãŒè¡¨ç¤ºã•ã‚Œã€æ¯”è¼ƒã§ãã‚‹ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã™ :sparkles: 

![image1](https://storage.googleapis.com/zenn-user-upload/89bef1f4dadb2d2dd581d069.gif)

ã‚ã§ãŸã—ã‚ã§ãŸã— :tada:  

ã€‚ã€‚ã€‚ã§çµ‚ã‚ã‚Šã˜ã‚ƒãªã `storycap` ã® `managed` ãƒ¢ãƒ¼ãƒ‰ã‚’ä½¿ã£ã¦
ã‚‚ã†å°‘ã—è‰²ã€…è©¦ã—ã¦ã¿ãŸã„ã¨æ€ã„ã¾ã™ã€‚

## 3. ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’æ–°è¦ã«ä½œæˆã—ã¦æ“ä½œæ™‚ã®ã‚­ãƒ£ãƒ—ãƒãƒ£ã§VRTã‚’å®Ÿæ–½ã™ã‚‹
ãŸã ãŸã ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆè¡¨ç¤ºã—ã¦ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆå´©ã‚Œã¦ãªã„ã‹ãƒ†ã‚¹ãƒˆã™ã‚‹å ´åˆã¯ã€ä¸Šè¨˜ã§ã‚‚äº‹è¶³ã‚Šãã†ã§ã™ãŒã€
ãƒ›ãƒãƒ¼ã—ãŸã‚Šã€ã‚¯ãƒªãƒƒã‚¯ã—ãŸã‚Šã€ä½•ã‹ã—ã‚‰æ“ä½œã—ãŸéš›ã«ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒåå¿œã™ã‚‹å ´åˆã®ãƒ†ã‚¹ãƒˆã‚‚è©¦ã—ã¦ã¿ãŸã„ã¨æ€ã„ã¾ã™ã€‚

### 3-1. ToggleButtonã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ä½œæˆ
![image8](https://storage.googleapis.com/zenn-user-upload/8f5c34a262a9efde02b0b632.gif)

â†‘ã®ã‚ˆã†ã«hoverã§è‰²ãŒå¤‰ã‚ã£ã¦ã€ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨ON / OFF ãŒåˆ‡ã‚Šæ›¿ã‚ã‚‹èª°å¾—ãªã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ä½œæˆã—ã¾ã™ã€‚
ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆã¨ã—ã¦ã¯ä»¥ä¸‹ã«ãªã‚Šã¾ã™ã€‚

```
â”œâ”€â”€ pages
â”œâ”€â”€ components
â”‚Â Â  â””â”€â”€ ToggleButton
â”‚Â Â      â”œâ”€â”€ index.css
â”‚Â Â      â”œâ”€â”€ index.stories.tsx
â”‚Â Â      â””â”€â”€ index.tsx
```

```tsx
import React, { useState } from 'react';
import './index.css';

export type ToggleButtonProps = {};

const ToggleButton: React.VFC = () => {
  const [on, setOn] = useState(false);
  return (
    <div style={{ padding: '0.5rem' }}>
      <button className="toggle-button" onClick={() => setOn(!on)}>
        {on ? 'ON' : 'OFF'}
      </button>
    </div>
  );
};

export default ToggleButton;
```

```css
.toggle-button {
  background-color: aliceblue;
}

.toggle-button:hover {
  background-color: bisque;
}
```

### 3-2. Storybookã®è¨­å®š

`.storybook/main.js` ã¨ `.storybook/preview.js` ã‚’ãã‚Œãã‚Œä»¥ä¸‹ã«ä¿®æ­£ã—ã¾ã™ã€‚

```js:main.js
module.exports = {
  "stories": [
    "../components/**/*.stories.@(js|jsx|ts|tsx)"
  ],
  "addons": [
    "@storybook/addon-links",
    "@storybook/addon-essentials",
    "storycap"
  ]
}
```

```js:preview.js
import { withScreenshot } from 'storycap';

export const decorators = [
  withScreenshot,
];

export const parameters = {
  actions: { argTypesRegex: "^on[A-Z].*" },
  controls: {
    matchers: {
      color: /(background|color)$/i,
      date: /Date$/,
    },
  },
}
```

æ¬¡ã« `components/ToggleButton/index.stories.tsx` ã¯ä»¥ä¸‹ã®æ§˜ã«è¨­å®šã—ã¾ã—ãŸã€‚

```tsx
import { Meta, Story } from '@storybook/react';
import React from 'react';
import ToggleButton, { ToggleButtonProps } from '.';

export default {
  title: 'components/ToggleButton',
  component: ToggleButton,
} as Meta;

const Template: Story<ToggleButtonProps> = (args) => <ToggleButton {...args} />;

// Basic
export const Basic: Story<ToggleButtonProps> = Template.bind({});
Basic.parameters = {
  screenshot: {
    variants: {
      hovered: {
        hover: '.toggle-button',
      },
      clicked: {
        click: '.toggle-button',
      },
    },
  },
};
Basic.args = {};
```
screenshotã®variantsã§è¤‡æ•°çŠ¶æ…‹ã‚’æŒ‡å®šã§ãã‚‹ã®ã§ä»Šå›ã¯ `hover` ã¨ `click` ã—ãŸçŠ¶æ…‹ã‚‚ã‚­ãƒ£ãƒ—ãƒãƒ£ã™ã‚‹ã‚ˆã†ã«ã—ã¾ã—ãŸã€‚
ã“ã®çŠ¶æ…‹ã§ä¸€åº¦S3ã«ã‚¢ãƒƒãƒ—ã—ã¨ãã¾ã™ã€‚
æ¬¡ã«hoverã—ãŸéš›ã®è‰²ã‚’å°‘ã—å¤‰æ›´ã—ã¦ã€VRTã‚’å®Ÿè¡Œã—ã¦ã¿ã¾ã™ã€‚

```css
.toggle-button:hover {
  background-color: antiquewhite;
}
```
â†“hoveræ™‚ã®å¾®å¦™ãªè‰²ã®é•ã„ã‚‚ã¡ã‚ƒã‚“ã¨æ¤œçŸ¥ã—ã¦ãã‚Œã¦ã„ã¾ã™ :sparkles: 

![image9](https://storage.googleapis.com/zenn-user-upload/c1b6a7a90808ff9573b17c77.png)

ã¡ãªã¿ã« `thresholdRate` ã‚’å¤‰ãˆã¦è©¦ã—ã¦ã¿ãŸæ‰€ã€`0.002` ä»¥ä¸Šã ã¨â†‘ã®é•ã„ã¯æ¤œçŸ¥ã§ããšã€`0 ~ 0.001` ã®é–“ã ã¨æ¤œçŸ¥ã—ã¦ãã‚Œã¾ã—ãŸ ã€‚

# ã¾ã¨ã‚

å€‹äººçš„ã«ã¯å°å…¥ã—ã¦ã—ã¾ãˆã°ã€ç¶™ç¶šçš„ã«ãƒã‚§ãƒƒã‚¯ãŒã§ãã‚‹ã—ã€å°å…¥ã‚‚ã™ã”ã„å¤§å¤‰ã¨ã„ã†ã‚ã‘ã§ã‚‚ç„¡ã„ã®ã§
è²»ç”¨å¯¾åŠ¹æœé«˜ãã¦è‰¯ã•ãã†ã ãªã¨æ€ã„ã¾ã—ãŸ :sparkles: 

ä»Šå›è©¦ã—ãŸåˆ†ã¯ä»¥ä¸‹ã®ãƒªãƒã‚¸ãƒˆãƒªã«ã‚¢ãƒƒãƒ—ã—ã¦ã¾ã™ã€‚
[Slowhand0309/vrt-nextjs-storybook-sample: VRT(Visual Regression Testing) project with Next.js, Storybook](https://github.com/Slowhand0309/vrt-nextjs-storybook-sample)

# å‚è€ƒãƒªãƒ³ã‚¯
- [Visual Regression Testing ã¯ã˜ã‚ã¾ã—ãŸ â€“ å…·ä½“çš„ãªé‹ç”¨ Tips â€“ PSYENCE:MEDIA](https://tech.recruit-mp.co.jp/front-end/visual-regression-testing/)
- [React/Next.jsã«Storybookã‚’å°å…¥ã™ã‚‹ | tech-broccoli.life](https://tech-broccoli.life/articles/engineer/add-storybook-for-nextjs/)
- [storybook-chrome-screenshotã¨zisuiã¨Storycapã¨ | by Yosuke Kurami | Medium](https://quramy.medium.com/storybook-chrome-screenshot%E3%81%A8zisui%E3%81%A8storycap%E3%81%A8-b878f8ed8361)
- [reg-suit+CircleCIã§Visual Regression Testç’°å¢ƒã®æ§‹ç¯‰](https://zenn.dev/toshiokun/articles/3d7087b84ba1d9)

