---
title: "Vercelã§è¨­å®šã—ãŸç’°å¢ƒå¤‰æ•°ã‚’Next.jsã§ä½¿ç”¨ã™ã‚‹"
emoji: "ğŸ’»"
type: "tech"
topics:
  - "nextjs"
  - "vercel"
  - "ç’°å¢ƒå¤‰æ•°"
published: true
published_at: "2020-12-19 02:43"
---

## Vercelå´ã§ç’°å¢ƒå¤‰æ•°ã‚’è¨­å®šã™ã‚‹

[Vercelã®ç’°å¢ƒå¤‰æ•°ã«é–¢ã™ã‚‹ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://vercel.com/docs/environment-variables)

è¨­å®šã§ãã‚‹ç’°å¢ƒã¨ã—ã¦ã¯ä»¥ä¸‹ã®3ç’°å¢ƒã«ãªã‚Šã¾ã™ã€‚

|ç’°å¢ƒ|èª¬æ˜|
| :---- | :---  |
| Production | æœ¬ç•ªç’°å¢ƒ |
| Preview | æœ¬ç•ªç’°å¢ƒä»¥å¤–ã§ãƒ‡ãƒ—ãƒ­ã‚¤ã•ã‚ŒãŸç’°å¢ƒ (feature/xxx ãƒ–ãƒ©ãƒ³ãƒç­‰) |
| Development | æ‰‹å…ƒã®ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒ |

ã¾ãŸã€è¨­å®šã§ãã‚‹å€¤ã®ç¨®é¡ã¯ä»¥ä¸‹ã®3é€šã‚Šã«ãªã‚Šã¾ã™ã€‚

|ã‚¿ã‚¤ãƒ—|èª¬æ˜|
| :---- | :---  |
| Plaintext | å¹³æ–‡ |
| Secret | ã‚»ã‚­ãƒ¥ã‚¢ãªå€¤ (æš—å·åŒ–ã•ã‚Œã‚‹/Developmentç’°å¢ƒã ã¨ä½¿ãˆãªã„) |
| Reference to System Environment Variable | Vercelå´ã§ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§è¨­å®šã•ã‚Œã‚‹å€¤ (åå‰ã‚’æŒ‡å®šã—ã¦å‚ç…§ã™ã‚‹) |

ç’°å¢ƒå¤‰æ•°ã‚’è¨­å®šã™ã‚‹éš›ã¯ã€ŒProject Settingsã€>ã€ŒEnvironment Variablesã€ã‹ã‚‰è¨­å®šã§ãã¾ã™ã€‚
![](https://storage.googleapis.com/zenn-user-upload/taza7ms29ha18jit2z2hjbz3vcsd)


Next.js 9.4 ã‹ã‚‰ã¯ `NEXT_PUBLIC_` ã®ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ã‚’ä»˜ã‘ã¦ç’°å¢ƒå¤‰æ•°ã‚’è¨­å®šã™ã‚‹ã¨
 `next.config.js` ã§envè¨­å®šã—ãªãã¦ã‚‚ç›´æ¥ä½¿ãˆã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ :sparkles: 

ä¾‹)
`NEXT_PUBLIC_API_URL` ã‚’ Plaintextã§è¨­å®šã€‚Next.jså†…ã§ã¯â†“ã®æ§˜ã«å‚ç…§ã§ãã¾ã™ã€‚

```ts
process.env.NEXT_PUBLIC_API_URL
```
â€» Next.jsèµ·å‹•ã™ã‚‹éš›ã®ã‚³ãƒãƒ³ãƒ‰ã¯ **`vercel dev`** ã‚’ä½¿ã‚ãªã„ã¨è¨­å®šã—ãŸç’°å¢ƒå¤‰æ•°ãŒä¸Šè¨˜ã®æ§˜ã«ä½¿ãˆãªã„ã®ã§æ³¨æ„

## Next.jså´ã§VercelCLIã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

`vercel` ã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ãˆã‚‹ã‚ˆã†ã«ã™ã‚‹ç‚ºã« [vercel cli](https://vercel.com/docs/cli) ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚

```sh
$ yarn global add vercel
```
ã‚³ãƒãƒ³ãƒ‰ã¨ã—ã¦ã¯ `vercel` ã§ã‚‚ `vc` ã§ã‚‚ä½¿ãˆã¾ã™ã€‚

### ãƒ­ã‚°ã‚¤ãƒ³

```sh
$ vercel login
```
ä¸Šè¨˜ã‚³ãƒãƒ³ãƒ‰ã‚’å©ãã¨åˆå›èªè¨¼ã‚’æ±‚ã‚ã‚‰ã‚Œã€
Vercelã«ç™»éŒ²ã•ã‚Œã¦ã„ã‚‹ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å…¥åŠ›ã™ã‚‹ã¨ã€ç¢ºèªãƒ¡ãƒ¼ãƒ«ãŒé€ã‚‰ã‚Œã¾ã™ã€‚

```
$ vercel login
Vercel CLI 21.0.1
> No existing credentials found. Please log in:
We sent an email to xxxxxxxx@gmail.com. Please follow the steps provided inside it and make sure the security code matches XXXXXXXX.
âœ” Email confirmed
Congratulations! You are now logged in. In order to deploy something, run `vercel`.
ğŸ’¡  Connect your Git Repositories to deploy every branch push automatically (https://vercel.link/git).
```
â†“å±Šã„ãŸç¢ºèªãƒ¡ãƒ¼ãƒ« (ãƒ¡ãƒ¼ãƒ«å†…ã®ã‚³ãƒ¼ãƒ‰ã¨ä¸€è‡´ã—ã¦ã„ã‚‹äº‹ã‚’ç¢ºèªã—ã¦Verifyã™ã‚‹)
![](https://storage.googleapis.com/zenn-user-upload/721ucbip9sm5suprvuak7rt3o2fg)


ã“ã®æ™‚ä½œæˆã•ã‚Œã‚‹èªè¨¼æƒ…å ±ãªã©ã®ãƒ•ã‚¡ã‚¤ãƒ«ã¯ä»¥ä¸‹ã«ãªã‚Šã¾ã™ã€‚

```
~/.config/configstore/update-notifier-vercel.json
~/.local/share/com.vercel.cli/auth.json 
~/.local/share/com.vercel.cli/config.json
```

### æ—¢å­˜ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¨ãƒªãƒ³ã‚¯
æ¬¡ã« `vercel` ã‚³ãƒãƒ³ãƒ‰ã‚’å©ãã¨ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒªãƒ³ã‚¯è¨­å®šãŒå§‹ã¾ã‚Šã¾ã™ã€‚

```
Vercel CLI 21.0.1
? Set up and deploy â€œ/usr/srcâ€? [Y/n] y
? Which scope do you want to deploy to? xxx â€» è¤‡æ•°ãƒãƒ¼ãƒ ã«æ‰€å±ã—ã¦ã„ã‚‹äººã¯ã“ã“ã§é¸æŠ
? Link to existing project? [y/N] y
? Whatâ€™s the name of your existing project? xxxx â€» ãƒªãƒ³ã‚¯ã•ã‚Œã‚‹ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’é¸æŠ
ğŸ”—  Linked to xxxxxxxx/xxxxx (created .vercel)
ğŸ”  Inspect: https://vercel.com/xxxxxxx [5s]
âœ…  Preview: https://orbital-xxxxxxx.vercel.app [58s]
ğŸ“  To deploy to production (xxxxxxxxx), run `vercel --prod`
```
è³ªå•ã«ç­”ãˆã‚‹ã¨ `.vercel` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãŒä½œæˆã•ã‚Œã¦ãŠã‚Šã€ä»¥ä¸‹ã®ãƒ•ã‚¡ã‚¤ãƒ«ãŒä½œæˆã•ã‚Œã¦ã„ã¾ã—ãŸã€‚

- project.json

```json
{"projectId":"xxxxxxxxxxxxxxx","orgId":"team_xxxxxxxxxx"}
```

- README.txt

```
> Why do I have a folder named ".vercel" in my project?
The ".vercel" folder is created when you link a directory to a Vercel project.

> What does the "project.json" file contain?
The "project.json" file contains:
- The ID of the Vercel project that you linked ("projectId")
- The ID of the user or team your Vercel project is owned by ("orgId")

> Should I commit the ".vercel" folder?
No, you should not share the ".vercel" folder with anyone.
Upon creation, it will be automatically added to your ".gitignore" file.
```

Vecelã«ãƒ‡ãƒ—ãƒ­ã‚¤ã•ã‚Œã¦ã„ã‚Œã°æˆåŠŸã§ã™ã€‚
ã‚ã¨ã¯ `vercel dev` ã§èµ·å‹•ã•ã›ã‚Œã°Vercelã®ç’°å¢ƒå¤‰æ•°ãŒä½¿ãˆã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚
â€» `vercel dev` ã§ãƒãƒ¼ãƒˆã‚’è¨­å®šã™ã‚‹å ´åˆã¯ `vercel dev -l 3005` ã®æ§˜ã« `-l` ã§æŒ‡å®šã—ã¾ã™

## ã€è£œè¶³ã€‘Dockerã‚’ä½¿ã£ã¦ã„ã‚‹å ´åˆ

Dockerã‚’ä½¿ã£ã¦ã„ã‚‹å ´åˆã€ãã®ã¾ã¾ã ã¨ `vercel cli` ã®èªè¨¼ã‚’è¡Œã£ã¦ã‚‚ã‚³ãƒ³ãƒ†ãƒŠå†èµ·å‹•ã•ã›ãŸã‚‰
èªè¨¼æƒ…å ±ãŒå¤±ã‚ã‚Œã¦ã—ã¾ã„ã¾ã™ã€‚ãã“ã§æ°¸ç¶šåŒ–ã•ã›ã‚‹ç‚ºã«ã€ãƒ›ã‚¹ãƒˆå´ã¨Volumeã‚’bindã•ã›ã‚‹ã‹ã€
èªè¨¼æƒ…å ±ç”¨ã®Volumeã‚’ä½œæˆã—ã¦bindã•ã›ã‚‹ã‹ã§å¯¾å¿œå¯èƒ½ã§ã™ã€‚

- ãƒ›ã‚¹ãƒˆå´ã¨Volumeã‚’bindã™ã‚‹ä¾‹

    ```
    services:
      app:
        volumes:
              - ~/.config/configstore:/root/.config/configstore
              - ~/.local:/root/.local
    ```

- èªè¨¼æƒ…å ±ç”¨ã®Volumeã‚’ä½œæˆã—ã¦bindã™ã‚‹ä¾‹

    ```
    volumes:
      config_data:
      local_data:
    
    services:
      app:
        volumes:
              - config_data:/root/.config/configstore
              - local_data:/root/.local
    ```

## ãƒãƒƒãƒ‰ãƒã‚¦ãƒã‚¦

- `The dev script in package.json must not contain vercel dev` ãŒç™ºç”Ÿã™ã‚‹!
    - `package.json` ã® `scripts` å†…ã« `"dev": "vercel dev"` ã¨æ›¸ã„ã¦ã—ã¾ã£ã¦ã‚‹ã®ãŒåŸå›   / [ã“ã¡ã‚‰](https://github.com/vercel/vercel/blob/master/errors/now-dev-as-dev-script.md)å‚è€ƒ

## å‚è€ƒã«ãªã£ãŸURL

- [vercelã§ã®ç’°å¢ƒå¤‰æ•°ã®æ‰±ã„ãŒä¾¿åˆ©ã«ãªã£ãŸ](https://blog.ojisan.io/vercel-env)
